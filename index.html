
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Level Up - 7 Levels of Self</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{--bg:#0d0a1a;--card:rgba(30,26,46,0.95);--border:#3d3655;--text:#f5f0ff;--muted:#b8b0cc;--pink:#FF3CAC;--orange:#FF6B35;--purple:#784BA0;--blue:#2F80ED;--green:#00D26A;--yellow:#F7C948;--silver:#C0C0C0;--red:#FF4757;--gold:#FFD700}
html,body{height:100%;overflow-x:hidden;-webkit-overflow-scrolling:touch}
body{font-family:'Inter',system-ui,sans-serif;background:linear-gradient(180deg,#1a1035 0%,#0d0a1a 100%);min-height:100%;color:var(--text);touch-action:manipulation}
.app{max-width:500px;margin:0 auto;padding:16px 16px 40px;min-height:100%}
button,a{touch-action:manipulation;cursor:pointer;-webkit-user-select:none;user-select:none}
.hook{position:fixed;inset:0;background:linear-gradient(180deg,#1a1035 0%,#0d0a1a 100%);display:flex;align-items:center;justify-content:center;z-index:300;text-align:center;padding:24px}
.hook.hidden{display:none}
.hook-line{font-size:clamp(28px,8vw,38px);font-weight:800;margin-bottom:16px;opacity:0;transform:translateY(20px);background:linear-gradient(135deg,var(--orange),var(--pink),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hook-line.show{animation:fadeUp 0.8s forwards}
.hook-sub{font-size:clamp(14px,4vw,18px);color:var(--muted);line-height:1.6;margin:24px 0;opacity:0}
.hook-sub.show{animation:fadeUp 0.8s forwards}
.hook-btn{padding:18px 48px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:16px;color:#fff;font-size:18px;font-weight:700;cursor:pointer;opacity:0;-webkit-appearance:none}
.hook-btn.show{animation:fadeUp 0.6s forwards}
.hook-btn:active{transform:scale(0.97);opacity:0.9}
@keyframes fadeUp{to{opacity:1;transform:translateY(0)}}
.onboard{position:fixed;inset:0;background:linear-gradient(180deg,#1a1035 0%,#0d0a1a 100%);display:none;flex-direction:column;z-index:200;overflow-y:auto;-webkit-overflow-scrolling:touch}
.onboard.active{display:flex}
.onboard-screen{display:none;flex-direction:column;min-height:100%;padding:24px 24px 100px;overflow-y:auto}
.onboard-screen.active{display:flex}
.onboard-title{font-size:clamp(22px,6vw,28px);font-weight:800;text-align:center;margin:32px 0 20px;background:linear-gradient(135deg,var(--orange),var(--pink),var(--purple),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.onboard-sub{text-align:center;color:var(--muted);font-size:15px;margin-bottom:20px}
.onboard-text{text-align:center;color:var(--muted);font-size:clamp(14px,4vw,16px);line-height:1.7;margin-bottom:8px}
.onboard-text2{text-align:center;color:var(--text);font-size:15px;margin-bottom:8px}
.onboard-highlight{text-align:center;color:var(--text);font-size:clamp(15px,4vw,17px);font-weight:600}
.onboard-highlight strong{color:var(--pink)}
.onboard-spacer{height:24px}
.onboard-levels{display:flex;flex-direction:column;gap:10px;margin-bottom:20px}
.onboard-level{display:flex;align-items:center;gap:14px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px 14px}
.onboard-num{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:15px;font-weight:700;color:#000;flex-shrink:0}
.onboard-info{flex:1}
.onboard-name{font-size:15px;font-weight:600}
.onboard-desc{font-size:13px;color:var(--muted)}
.onboard-dots{display:flex;justify-content:center;gap:8px;margin:20px 0}
.dot{width:8px;height:8px;border-radius:50%;background:var(--border)}
.dot.active{background:var(--pink)}
.onboard-btns{display:flex;gap:12px;margin-top:auto;padding:20px 0}
.onboard-skip{padding:16px 24px;background:transparent;border:none;color:var(--muted);font-size:15px;cursor:pointer}
.onboard-next,.onboard-start{flex:1;padding:16px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:12px;color:#fff;font-size:16px;font-weight:700;cursor:pointer;-webkit-appearance:none}
.onboard-next:active,.onboard-start:active{transform:scale(0.97)}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
.logo{font-size:clamp(20px,6vw,24px);font-weight:800;background:linear-gradient(135deg,var(--orange),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.controls{display:flex;gap:8px}
.ctrl-btn{width:44px;height:44px;border-radius:50%;background:var(--card);border:1px solid var(--border);color:var(--muted);font-size:20px;cursor:pointer;-webkit-appearance:none}
.ctrl-btn.on{background:linear-gradient(135deg,var(--orange),var(--pink));color:#fff;border:none}
.hero{text-align:center;margin-bottom:24px}
.hero h1{font-size:clamp(24px,7vw,30px);font-weight:800;margin-bottom:10px;background:linear-gradient(135deg,var(--orange),var(--pink),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero p{color:var(--muted);font-size:clamp(13px,3.5vw,15px)}
.challenge{background:var(--card);border:2px solid var(--pink);border-radius:16px;padding:20px;margin-bottom:20px;cursor:pointer;transition:transform 0.2s}
.challenge:active{transform:scale(0.98)}
.badge{display:inline-flex;align-items:center;gap:6px;background:var(--pink);color:#fff;font-size:11px;font-weight:700;padding:6px 12px;border-radius:20px;margin-bottom:12px}
.badge-dot{width:8px;height:8px;background:#fff;border-radius:50%;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
.challenge h2{font-size:clamp(18px,5vw,22px);font-weight:700;margin-bottom:8px}
.challenge p{color:var(--muted);font-size:clamp(12px,3.5vw,14px);margin-bottom:14px}
.challenge-footer{display:flex;justify-content:space-between;font-size:clamp(11px,3vw,13px);color:var(--muted);flex-wrap:wrap;gap:8px}
.challenge.done{opacity:0.6}
.challenge.done .badge{background:var(--green)}
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:24px}
.stat{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px 6px;text-align:center}
.stat-val{font-size:clamp(20px,5vw,26px);font-weight:700;background:linear-gradient(135deg,var(--orange),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.stat-label{font-size:clamp(8px,2.5vw,10px);font-weight:600;color:var(--muted);text-transform:uppercase;margin-top:6px}
.modes{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:28px}
.mode{background:var(--card);border:2px solid var(--border);border-radius:16px;padding:16px;text-align:center;cursor:pointer;transition:all 0.2s}
.mode:active{transform:scale(0.97);border-color:var(--pink)}
.mode-icon{font-size:clamp(28px,8vw,36px);margin-bottom:10px}
.mode-name{font-size:clamp(14px,4vw,16px);font-weight:700;margin-bottom:6px}
.mode-desc{font-size:clamp(11px,3vw,13px);color:var(--muted)}
.action-btns{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:28px}
.action-btn{display:flex;align-items:center;justify-content:center;gap:8px;background:var(--card);border:2px solid var(--border);border-radius:12px;padding:14px 12px;cursor:pointer;transition:all 0.2s;text-decoration:none;color:var(--text)}
.action-btn:active{transform:scale(0.97)}
.action-btn-icon{font-size:20px}
.action-btn-text{font-size:clamp(12px,3.5vw,14px);font-weight:600}
.action-btn.assess{border-color:var(--blue)}
.action-btn.share{border-color:var(--green)}
.section-title{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:14px}
.levels{display:flex;flex-direction:column;gap:8px;margin-bottom:28px}
.level{display:flex;align-items:center;gap:14px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;cursor:pointer;transition:all 0.2s}
.level:active{border-color:var(--pink)}
.level.locked{opacity:0.4;cursor:not-allowed}
.level-num{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:15px;font-weight:700;color:#000;flex-shrink:0}
.level-info{flex:1}
.level-name{font-size:15px;font-weight:600}
.level-desc{font-size:13px;color:var(--muted)}
.footer{text-align:center;padding:20px}
.footer a{color:var(--pink);text-decoration:none;font-size:14px;font-weight:600;display:inline-block;padding:10px}
.footer p{font-size:12px;color:var(--muted);margin-top:6px}
.game{display:none}
.game.active{display:block}
.home.hidden{display:none}
.game-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.game-info{font-size:15px}
.game-mode{color:var(--muted);font-size:12px;text-transform:uppercase}
.quit{width:44px;height:44px;border-radius:50%;background:rgba(255,71,87,0.2);border:2px solid var(--red);color:var(--red);font-size:20px;cursor:pointer;-webkit-appearance:none}
.timer{height:8px;background:var(--border);border-radius:4px;margin-bottom:20px;overflow:hidden}
.timer.hidden{display:none}
.timer-fill{height:100%;background:var(--green);transition:width 0.1s}
.timer-fill.warn{background:var(--gold)}
.timer-fill.danger{background:var(--red)}
.scenario{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px;margin-bottom:16px}
.scenario-cat{display:inline-block;background:var(--border);padding:6px 12px;border-radius:20px;font-size:11px;text-transform:uppercase;margin-bottom:14px}
.scenario-text{font-size:clamp(15px,4vw,17px);line-height:1.7}
.choices{display:flex;flex-direction:column;gap:10px}
.choice{width:100%;padding:14px 16px;background:var(--card);border:2px solid var(--border);border-radius:12px;color:var(--text);font-size:clamp(13px,3.5vw,15px);text-align:left;cursor:pointer;line-height:1.5;transition:all 0.2s;-webkit-appearance:none}
.choice:active:not(:disabled){border-color:var(--pink);transform:scale(0.98)}
.choice:disabled{cursor:default}
.choice.selected{border-color:var(--pink);background:rgba(255,60,172,0.1)}
.choice.correct{border-color:var(--green);background:rgba(0,210,106,0.15)}
.choice.wrong{border-color:var(--red);background:rgba(255,71,87,0.15)}
.choice.dim{opacity:0.3}
.results{display:none;text-align:center;padding-top:40px}
.results.active{display:block}
.results h2{font-size:24px;margin-bottom:20px}
.score{font-size:clamp(48px,15vw,72px);font-weight:900;background:linear-gradient(135deg,var(--orange),var(--pink),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin:20px 0}
.result-msg{font-size:clamp(14px,4vw,18px);color:var(--muted);margin-bottom:32px}
.results-btn{width:100%;padding:18px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:12px;color:#fff;font-size:16px;font-weight:700;cursor:pointer;-webkit-appearance:none}
.results-btn:active{transform:scale(0.97)}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.9);display:none;align-items:center;justify-content:center;padding:20px;z-index:100}
.modal.active{display:flex}
.modal-content{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:24px;max-width:400px;width:100%;max-height:90vh;overflow-y:auto}
.modal-icon{font-size:48px;text-align:center;margin-bottom:12px}
.modal-title{font-size:clamp(20px,6vw,26px);font-weight:700;text-align:center;margin-bottom:20px}
.feedback-box{background:rgba(0,0,0,0.3);border-radius:12px;padding:16px;margin-bottom:20px}
.feedback-label{font-size:11px;color:var(--muted);text-transform:uppercase;margin-bottom:10px}
.feedback-text{font-size:clamp(13px,3.5vw,15px);line-height:1.6}
.modal-btn{width:100%;padding:16px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:12px;color:#fff;font-size:16px;font-weight:700;cursor:pointer;-webkit-appearance:none}
.modal-btn:active{transform:scale(0.97)}
.share-toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%);background:var(--green);color:#fff;padding:12px 24px;border-radius:12px;font-size:14px;font-weight:600;opacity:0;transition:opacity 0.3s;z-index:500}
.share-toast.show{opacity:1}
</style>
</head>
<body>
<audio id="music" loop><source src="level-up.mp3" type="audio/mpeg"></audio>
<div class="share-toast" id="shareToast">Link copied!</div>
<div class="hook" id="hook"><div><div class="hook-line" id="line1">Something's off.</div><div class="hook-line" id="line2">You can feel it.</div><div class="hook-sub" id="hookSub">This game shows you exactly where<br>‚Äî and what to do about it.</div><button class="hook-btn" id="hookBtn">Show Me</button></div></div>
<div class="onboard" id="onboard"><div class="onboard-screen active" id="onboard1"><div class="onboard-title">There Are Levels To This</div><div class="onboard-text">Most people are stuck ‚Äî not because they lack knowledge, but because they're working on the wrong level.</div><div class="onboard-spacer"></div><div class="onboard-text2">Three games. One transformation.</div><div class="onboard-text2">Mirror reveals. Agreement trains. Decision challenges.</div><div class="onboard-spacer"></div><div class="onboard-highlight">The goal isn't the "highest" level.<br>It's the <strong>right</strong> level.</div><div class="onboard-dots"><span class="dot active"></span><span class="dot"></span></div><div class="onboard-btns"><button class="onboard-skip" id="skipBtn">Skip</button><button class="onboard-next" id="nextBtn1">Next</button></div></div><div class="onboard-screen" id="onboard2"><div class="onboard-title">The 7 Levels of Self</div><div class="onboard-sub">You can't skip levels. Master each one before you climb.</div><div class="onboard-levels"><div class="onboard-level"><div class="onboard-num" style="background:#FF6B35">1</div><div class="onboard-info"><div class="onboard-name">Individual</div><div class="onboard-desc">Your relationship with yourself</div></div></div><div class="onboard-level"><div class="onboard-num" style="background:#FF3CAC">2</div><div class="onboard-info"><div class="onboard-name">Family</div><div class="onboard-desc">Your closest relationships</div></div></div><div class="onboard-level"><div class="onboard-num" style="background:#784BA0">3</div><div class="onboard-info"><div class="onboard-name">Groups</div><div class="onboard-desc">Teams, friends, communities</div></div></div><div class="onboard-level"><div class="onboard-num" style="background:#2F80ED">4</div><div class="onboard-info"><div class="onboard-name">Community</div><div class="onboard-desc">Your role in the larger whole</div></div></div><div class="onboard-level"><div class="onboard-num" style="background:#00D26A">5</div><div class="onboard-info"><div class="onboard-name">Society</div><div class="onboard-desc">Systems, culture, nation</div></div></div><div class="onboard-level"><div class="onboard-num" style="background:#F7C948">6</div><div class="onboard-info"><div class="onboard-name">World</div><div class="onboard-desc">Global connection</div></div></div><div class="onboard-level"><div class="onboard-num" style="background:#C0C0C0">7</div><div class="onboard-info"><div class="onboard-name">Generations</div><div class="onboard-desc">Legacy that outlasts you</div></div></div></div><div class="onboard-dots"><span class="dot"></span><span class="dot active"></span></div><div class="onboard-btns"><button class="onboard-skip" id="skipBtn2">Skip</button><button class="onboard-start" id="goBtn">Let's Go</button></div></div></div>
<div class="app"><div class="home" id="home"><div class="header"><div class="logo">LEVEL UP</div><div class="controls"><button class="ctrl-btn" id="musicBtn">üéµ</button><button class="ctrl-btn on" id="soundBtn">üîä</button></div></div><div class="hero"><h1>Discover Your Level</h1><p>Mirror reveals. Agreement trains. Decision challenges.</p></div><div class="challenge" id="dailyCard"><div class="badge"><span class="badge-dot"></span>TRENDING GLOBALLY</div><h2>Worldwide Challenge</h2><p>Same 3 scenarios for everyone on Earth. One chance daily.</p><div class="challenge-footer"><span id="dailyCta">Tap to join the global movement</span><span id="dailyTimer">Resets in --:--:--</span></div></div><div class="stats"><div class="stat"><div class="stat-val" id="statPlayed">0</div><div class="stat-label">Played</div></div><div class="stat"><div class="stat-val" id="statMirror">0</div><div class="stat-label">Recognized</div></div><div class="stat"><div class="stat-val" id="statAccept">0</div><div class="stat-label">Accepted</div></div><div class="stat"><div class="stat-val" id="statStreak">0</div><div class="stat-label">Streak</div></div></div><div class="modes"><div class="mode" id="mirrorMode"><div class="mode-icon">ü™û</div><div class="mode-name">Mirror Game</div><div class="mode-desc">See yourself honestly</div></div><div class="mode" id="agreementMode"><div class="mode-icon">‚öñÔ∏è</div><div class="mode-name">Agreement Game</div><div class="mode-desc">Acceptance vs Judgment</div></div></div><div class="action-btns"><a class="action-btn assess" href="https://www.levelsofself.com/selfassessment" target="_blank" rel="noopener"><span class="action-btn-icon">üìã</span><span class="action-btn-text">Assessment</span></a><button class="action-btn share" id="shareBtn"><span class="action-btn-icon">üîó</span><span class="action-btn-text">Share</span></button></div><div class="section-title">Your Journey</div><div class="levels" id="levelMap"></div><div class="footer"><a href="https://www.levelsofself.com" target="_blank" rel="noopener">Learn the Full Framework ‚Üí</a><p>LevelsOfSelf.com</p></div></div><div class="game" id="game"><div class="game-header"><div class="game-info"><div class="game-mode" id="gameMode">Mirror</div><div id="gameProgress">1/5</div></div><button class="quit" id="quitBtn">‚úï</button></div><div class="timer" id="timerBar"><div class="timer-fill" id="timerFill"></div></div><div class="scenario"><div class="scenario-cat" id="scenarioCat">Level 1: Individual</div><div class="scenario-text" id="scenarioText">Loading...</div></div><div class="choices" id="choices"></div></div><div class="results" id="results"><h2 id="resultsTitle">Game Complete</h2><div class="score" id="finalScore">0</div><p class="result-msg" id="resultMsg">Keep going!</p><button class="results-btn" id="homeBtn">Continue</button></div></div>
<div class="modal" id="feedbackModal"><div class="modal-content"><div class="modal-icon" id="fbIcon">üí°</div><div class="modal-title" id="fbTitle">Insight</div><div class="feedback-box"><div class="feedback-label" id="fbLabel">Reflection</div><div class="feedback-text" id="fbText">...</div></div><button class="modal-btn" id="nextBtn">Next</button></div></div>
<script src="mirror-level1-individual.js"></script>
<script src="mirror-level2-family.js"></script>
<script src="mirror-level3-groups.js"></script>
<script src="mirror-level4-community.js"></script>
<script src="mirror-level5-society.js"></script>
<script src="mirror-level6-world.js"></script>
<script src="mirror-level7-generations.js"></script>
<script src="agreement-game.js"></script>
<script src="worldwide-challenge.js"></script>
<script>
const MIRROR_SCENARIOS=[...(typeof LEVEL_1_INDIVIDUAL!=='undefined'?LEVEL_1_INDIVIDUAL:[]),...(typeof LEVEL_2_FAMILY!=='undefined'?LEVEL_2_FAMILY:[]),...(typeof LEVEL_3_GROUPS!=='undefined'?LEVEL_3_GROUPS:[]),...(typeof LEVEL_4_COMMUNITY!=='undefined'?LEVEL_4_COMMUNITY:[]),...(typeof LEVEL_5_SOCIETY!=='undefined'?LEVEL_5_SOCIETY:[]),...(typeof LEVEL_6_WORLD!=='undefined'?LEVEL_6_WORLD:[]),...(typeof LEVEL_7_GENERATIONS!=='undefined'?LEVEL_7_GENERATIONS:[])];
const LEVELS=[{id:1,name:'Individual',color:'#FF6B35',desc:'Your relationship with yourself'},{id:2,name:'Family',color:'#FF3CAC',desc:'Your closest relationships'},{id:3,name:'Groups',color:'#784BA0',desc:'Teams, friends, communities'},{id:4,name:'Community',color:'#2F80ED',desc:'Your role in the larger whole'},{id:5,name:'Society',color:'#00D26A',desc:'Systems, culture, nation'},{id:6,name:'World',color:'#F7C948',desc:'Global connection'},{id:7,name:'Generations',color:'#C0C0C0',desc:'Legacy that outlasts you'}];
let music=document.getElementById('music');music.volume=0.4;let musicOn=false,soundOn=true;
let data=JSON.parse(localStorage.getItem('levelup_v3'))||{games:0,mirrorRecognized:0,mirrorTotal:0,agreementAccepted:0,agreementTotal:0,streak:0,lastDaily:null,unlocked:[1,2,3,4,5,6,7],seenIntro:false};
let game={mode:null,scenarios:[],idx:0,answers:[],timer:null,timeLeft:15,useTimer:true};
function save(){localStorage.setItem('levelup_v3',JSON.stringify(data))}
function playSound(f,d){if(!soundOn)return;try{let c=new(window.AudioContext||window.webkitAudioContext)(),o=c.createOscillator(),g=c.createGain();o.frequency.value=f;o.connect(g);g.connect(c.destination);g.gain.setValueAtTime(0.1,c.currentTime);g.gain.exponentialRampToValueAtTime(0.001,c.currentTime+d);o.start();o.stop(c.currentTime+d)}catch(e){}}
function positiveSound(){[523,659,784].forEach((f,i)=>setTimeout(()=>playSound(f,0.15),i*80))}
function neutralSound(){playSound(440,0.2)}
function shuffle(a){let arr=[...a];for(let i=arr.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]}return arr}
function hashDate(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h=h&h}return Math.abs(h)}
function shareGame(){const u=window.location.href;if(navigator.share){navigator.share({title:'Level Up',text:'Discover your level!',url:u}).catch(()=>{})}else{navigator.clipboard.writeText(u).then(()=>{document.getElementById('shareToast').classList.add('show');setTimeout(()=>document.getElementById('shareToast').classList.remove('show'),2000)}).catch(()=>{prompt('Copy:',u)})}}
function showHook(){setTimeout(()=>document.getElementById('line1').classList.add('show'),400);setTimeout(()=>document.getElementById('line2').classList.add('show'),1400);setTimeout(()=>document.getElementById('hookSub').classList.add('show'),2600);setTimeout(()=>document.getElementById('hookBtn').classList.add('show'),3400)}
document.getElementById('hookBtn').addEventListener('click',function(e){e.preventDefault();document.getElementById('hook').classList.add('hidden');document.getElementById('onboard').classList.add('active');music.play().then(()=>{musicOn=true;document.getElementById('musicBtn').classList.add('on')}).catch(()=>{})});
document.getElementById('skipBtn').addEventListener('click',function(){data.seenIntro=true;save();document.getElementById('onboard').classList.remove('active');updateHome()});
document.getElementById('skipBtn2').addEventListener('click',function(){data.seenIntro=true;save();document.getElementById('onboard').classList.remove('active');updateHome()});
document.getElementById('nextBtn1').addEventListener('click',function(){document.getElementById('onboard1').classList.remove('active');document.getElementById('onboard2').classList.add('active')});
document.getElementById('goBtn').addEventListener('click',function(){data.seenIntro=true;save();document.getElementById('onboard').classList.remove('active');updateHome()});
function updateHome(){document.getElementById('statPlayed').textContent=data.games;document.getElementById('statMirror').textContent=data.mirrorRecognized;document.getElementById('statAccept').textContent=data.agreementAccepted;document.getElementById('statStreak').textContent=data.streak;let today=new Date().toDateString(),daily=document.getElementById('dailyCard');if(data.lastDaily===today){daily.classList.add('done');document.getElementById('dailyCta').textContent="‚úì Completed today"}else{daily.classList.remove('done');document.getElementById('dailyCta').textContent='Tap to join the global movement'}let map=document.getElementById('levelMap');map.innerHTML='';LEVELS.forEach(lv=>{let unlocked=data.unlocked.includes(lv.id),div=document.createElement('div');div.className='level'+(unlocked?'':' locked');div.innerHTML='<div class="level-num" style="background:'+lv.color+'">'+lv.id+'</div><div class="level-info"><div class="level-name">'+lv.name+(unlocked?'':' üîí')+'</div><div class="level-desc">'+lv.desc+'</div></div>';if(unlocked)div.addEventListener('click',()=>startLevelPlay(lv.id));map.appendChild(div)});updateTimer()}
function updateTimer(){let now=new Date(),tom=new Date(now);tom.setDate(tom.getDate()+1);tom.setHours(0,0,0,0);let d=tom-now,h=String(Math.floor(d/3600000)).padStart(2,'0'),m=String(Math.floor((d%3600000)/60000)).padStart(2,'0'),s=String(Math.floor((d%60000)/1000)).padStart(2,'0');document.getElementById('dailyTimer').textContent='Resets in '+h+':'+m+':'+s}
function startMirrorGame(lf=null){game.mode='mirror';game.idx=0;game.answers=[];game.useTimer=false;let pool=MIRROR_SCENARIOS.filter(s=>lf?s.level===lf:data.unlocked.includes(s.level));if(pool.length===0){alert('No scenarios');return}game.scenarios=shuffle(pool).slice(0,10);document.getElementById('home').classList.add('hidden');document.getElementById('results').classList.remove('active');document.getElementById('game').classList.add('active');document.getElementById('gameMode').textContent='Mirror Game';document.getElementById('timerBar').classList.add('hidden');showMirrorScenario()}
function startAgreementGame(lf=null){game.mode='agreement';game.idx=0;game.answers=[];game.useTimer=true;if(typeof DECISION_SCENARIOS==='undefined'||DECISION_SCENARIOS.length===0){alert('Agreement Game loading... Please refresh.');return}let pool=DECISION_SCENARIOS.filter(s=>lf?s.level===lf:data.unlocked.includes(s.level));if(pool.length===0){alert('No scenarios for unlocked levels');return}game.scenarios=shuffle(pool).slice(0,10);document.getElementById('home').classList.add('hidden');document.getElementById('results').classList.remove('active');document.getElementById('game').classList.add('active');document.getElementById('gameMode').textContent='Agreement Game';document.getElementById('timerBar').classList.remove('hidden');showAgreementScenario()}
function startDecisionGame(){let today=new Date().toDateString();if(data.lastDaily===today)return;game.mode='decision';game.idx=0;game.answers=[];game.useTimer=true;game.scenarios=[];if(typeof window.SCENARIOS==='undefined'){alert('Worldwide Challenge loading... Please refresh.');return}let seed=hashDate(today),num=3,all=[];for(let l=1;l<=7;l++){if(window.SCENARIOS[l])all=all.concat(window.SCENARIOS[l].map(s=>({...s,level:l})))}for(let i=0;i<num&&i<all.length;i++){let idx=(seed+i*31337)%all.length;game.scenarios.push(all[idx]);seed=(seed*31337)&0xFFFFFF}if(game.scenarios.length===0){alert('No scenarios');return}document.getElementById('home').classList.add('hidden');document.getElementById('results').classList.remove('active');document.getElementById('game').classList.add('active');document.getElementById('gameMode').textContent='Worldwide Challenge';document.getElementById('timerBar').classList.remove('hidden');showDecisionScenario()}
function startLevelPlay(id){startMirrorGame(id)}
function showMirrorScenario(){let s=game.scenarios[game.idx];if(!s){endGame();return}document.getElementById('gameProgress').textContent=(game.idx+1)+'/'+game.scenarios.length;let lv=LEVELS.find(l=>l.id===s.level);document.getElementById('scenarioCat').textContent='Level '+s.level+': '+(lv?lv.name:'');document.getElementById('scenarioText').textContent=s.text;let c=document.getElementById('choices');c.innerHTML='';[{text:"That's Me",value:true},{text:"That's Not Me",value:false}].forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=ch.text;b.addEventListener('click',()=>selectMirrorChoice(ch,b,s));c.appendChild(b)})}
function selectMirrorChoice(ch,btn,sc){document.querySelectorAll('.choice').forEach(b=>b.disabled=true);btn.classList.add('selected');game.answers.push({recognized:ch.value,insight:sc.insight});if(ch.value)data.mirrorRecognized++;data.mirrorTotal++;positiveSound();setTimeout(()=>showMirrorFeedback(sc.insight,ch.value),400)}
function showMirrorFeedback(ins,rec){document.getElementById('fbIcon').textContent='üí°';document.getElementById('fbIcon').style.color='var(--pink)';document.getElementById('fbTitle').textContent=rec?'Recognized':'Noted';document.getElementById('fbLabel').textContent='Insight';document.getElementById('fbText').textContent=ins;document.getElementById('feedbackModal').classList.add('active')}
function showAgreementScenario(){let s=game.scenarios[game.idx];if(!s){endGame();return}document.getElementById('gameProgress').textContent=(game.idx+1)+'/'+game.scenarios.length;let lv=LEVELS.find(l=>l.id===s.level);document.getElementById('scenarioCat').textContent='Level '+s.level+': '+(lv?lv.name:'');document.getElementById('scenarioText').textContent=s.scenario;let c=document.getElementById('choices');c.innerHTML='';shuffle(s.choices).forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=ch.text;b.addEventListener('click',()=>selectAgreementChoice(ch,b,s));c.appendChild(b)});if(game.useTimer)startTimer()}
function selectAgreementChoice(ch,btn,sc){if(game.timer)clearInterval(game.timer);document.querySelectorAll('.choice').forEach(b=>b.disabled=true);let isAcc=ch.type==='acceptance';game.answers.push({type:ch.type,isAcceptance:isAcc,insight:ch.insight});if(isAcc){btn.classList.add('correct');data.agreementAccepted++;positiveSound()}else{btn.classList.add('wrong');let acc=sc.choices.find(c=>c.type==='acceptance');document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===acc.text)b.classList.add('correct');else if(b!==btn)b.classList.add('dim')});neutralSound()}data.agreementTotal++;setTimeout(()=>showAgreementFeedback(ch,isAcc),500)}
function showAgreementFeedback(ch,isAcc){document.getElementById('fbIcon').textContent=isAcc?'‚úì':'‚öñÔ∏è';document.getElementById('fbIcon').style.color=isAcc?'var(--green)':'var(--yellow)';document.getElementById('fbTitle').textContent=isAcc?'Acceptance':'Judgment';document.getElementById('fbLabel').textContent=isAcc?'Why this works':'Learning opportunity';document.getElementById('fbText').textContent=ch.insight;document.getElementById('feedbackModal').classList.add('active')}
function showDecisionScenario(){let s=game.scenarios[game.idx];if(!s){endGame();return}document.getElementById('gameProgress').textContent=(game.idx+1)+'/'+game.scenarios.length;let lv=LEVELS.find(l=>l.id===s.level);document.getElementById('scenarioCat').textContent='Level '+s.level+': '+(lv?lv.name:'');document.getElementById('scenarioText').textContent=s.text;let c=document.getElementById('choices');c.innerHTML='';s.choices.forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=ch.text;b.addEventListener('click',()=>selectDecisionChoice(ch,b,s));c.appendChild(b)});if(game.useTimer)startTimer()}
function selectDecisionChoice(ch,btn,sc){if(game.timer)clearInterval(game.timer);document.querySelectorAll('.choice').forEach(b=>b.disabled=true);let isCorr=ch.correct===true;game.answers.push({correct:isCorr,feedback:ch.fb});if(isCorr){btn.classList.add('correct');positiveSound()}else{btn.classList.add('wrong');let corr=sc.choices.find(c=>c.correct===true);document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===corr.text)b.classList.add('correct');else if(b!==btn)b.classList.add('dim')});neutralSound()}setTimeout(()=>showDecisionFeedback(ch,isCorr),500)}
function showDecisionFeedback(ch,isCorr){document.getElementById('fbIcon').textContent=isCorr?'‚úì':'üí°';document.getElementById('fbIcon').style.color=isCorr?'var(--green)':'var(--yellow)';document.getElementById('fbTitle').textContent=isCorr?'Correct!':'Not Quite';document.getElementById('fbLabel').textContent='Insight';document.getElementById('fbText').textContent=ch.fb;document.getElementById('feedbackModal').classList.add('active')}
function startTimer(){game.timeLeft=15;if(game.timer)clearInterval(game.timer);game.timer=setInterval(()=>{game.timeLeft-=0.1;let pct=(game.timeLeft/15)*100,fill=document.getElementById('timerFill');fill.style.width=pct+'%';fill.classList.remove('warn','danger');if(game.timeLeft<=5)fill.classList.add('danger');else if(game.timeLeft<=10)fill.classList.add('warn');if(game.timeLeft<=0){clearInterval(game.timer);timeUp()}},100)}
function timeUp(){let s=game.scenarios[game.idx];document.querySelectorAll('.choice').forEach(b=>b.disabled=true);if(game.mode==='agreement'){let acc=s.choices.find(c=>c.type==='acceptance');game.answers.push({type:'timeout',isAcceptance:false});data.agreementTotal++;document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===acc.text)b.classList.add('correct');else b.classList.add('dim')});neutralSound();setTimeout(()=>{document.getElementById('fbIcon').textContent='‚è∞';document.getElementById('fbTitle').textContent="Time's Up";document.getElementById('fbLabel').textContent='The accepting response';document.getElementById('fbText').textContent=acc.insight;document.getElementById('feedbackModal').classList.add('active')},500)}else if(game.mode==='decision'){let corr=s.choices.find(c=>c.correct===true);game.answers.push({correct:false});document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===corr.text)b.classList.add('correct');else b.classList.add('dim')});neutralSound();setTimeout(()=>{document.getElementById('fbIcon').textContent='‚è∞';document.getElementById('fbTitle').textContent="Time's Up";document.getElementById('fbLabel').textContent='The right response';document.getElementById('fbText').textContent=corr.fb;document.getElementById('feedbackModal').classList.add('active')},500)}}
document.getElementById('nextBtn').addEventListener('click',function(){document.getElementById('feedbackModal').classList.remove('active');game.idx++;if(game.idx>=game.scenarios.length){endGame()}else{if(game.mode==='mirror')showMirrorScenario();else if(game.mode==='agreement')showAgreementScenario();else if(game.mode==='decision')showDecisionScenario()}});
function endGame(){if(game.timer)clearInterval(game.timer);data.games++;if(game.mode==='decision'){let today=new Date().toDateString(),yesterday=new Date(Date.now()-86400000).toDateString();if(data.lastDaily===yesterday)data.streak++;else if(data.lastDaily!==today)data.streak=1;data.lastDaily=today}save();document.getElementById('game').classList.remove('active');document.getElementById('results').classList.add('active');if(game.mode==='mirror'){let rec=game.answers.filter(a=>a.recognized).length;document.getElementById('resultsTitle').textContent='Mirror Complete';document.getElementById('finalScore').textContent=rec+'/'+game.answers.length;document.getElementById('resultMsg').textContent='Patterns recognized.'}else if(game.mode==='agreement'){let acc=game.answers.filter(a=>a.isAcceptance).length;document.getElementById('resultsTitle').textContent='Agreement Complete';document.getElementById('finalScore').textContent=acc+'/'+game.answers.length;document.getElementById('resultMsg').textContent=acc>=8?'Strong acceptance!':acc>=5?'Growing.':'Keep practicing.'}else if(game.mode==='decision'){let corr=game.answers.filter(a=>a.correct).length;document.getElementById('resultsTitle').textContent='Challenge Complete';document.getElementById('finalScore').textContent='üî• '+data.streak;document.getElementById('resultMsg').textContent=corr+'/'+game.answers.length+' correct!'}}
document.getElementById('homeBtn').addEventListener('click',function(){document.getElementById('results').classList.remove('active');document.getElementById('home').classList.remove('hidden');updateHome()});
document.getElementById('quitBtn').addEventListener('click',function(){if(game.timer)clearInterval(game.timer);document.getElementById('game').classList.remove('active');document.getElementById('feedbackModal').classList.remove('active');document.getElementById('home').classList.remove('hidden');updateHome()});
document.getElementById('musicBtn').addEventListener('click',function(){if(musicOn){music.pause();musicOn=false;this.classList.remove('on')}else{music.play().then(()=>{musicOn=true;this.classList.add('on')}).catch(()=>{})}});
document.getElementById('soundBtn').addEventListener('click',function(){soundOn=!soundOn;this.classList.toggle('on',soundOn);if(soundOn)playSound(600,0.1)});
document.getElementById('dailyCard').addEventListener('click',function(){if(!this.classList.contains('done'))startDecisionGame()});
document.getElementById('mirrorMode').addEventListener('click',()=>startMirrorGame());
document.getElementById('agreementMode').addEventListener('click',()=>startAgreementGame());
document.getElementById('shareBtn').addEventListener('click',shareGame);
if(data.seenIntro){document.getElementById('hook').classList.add('hidden');updateHome()}else{showHook()}
setInterval(updateTimer,1000);
console.log('Mirror:',MIRROR_SCENARIOS.length,'Agreement:',typeof DECISION_SCENARIOS!=='undefined'?DECISION_SCENARIOS.length:0,'Decision:',typeof window.SCENARIOS!=='undefined'?Object.values(window.SCENARIOS).flat().length:0);
</script>
</body></html>
