<!DOCTYPE html>
<!-- 
  ╔═══════════════════════════════════════════════════════════════════════════╗
  ║                                                                           ║
  ║   ██╗     ███████╗ ██████╗ ███████╗███╗   ██╗██████╗  █████╗ ██████╗ ██╗  ║
  ║   ██║     ██╔════╝██╔════╝ ██╔════╝████╗  ██║██╔══██╗██╔══██╗██╔══██╗╚██╗ ║
  ║   ██║     █████╗  ██║  ███╗█████╗  ██╔██╗ ██║██║  ██║███████║██████╔╝ ██║ ║
  ║   ██║     ██╔══╝  ██║   ██║██╔══╝  ██║╚██╗██║██║  ██║██╔══██║██╔══██╗ ██║ ║
  ║   ███████╗███████╗╚██████╔╝███████╗██║ ╚████║██████╔╝██║  ██║██║  ██║██╔╝ ║
  ║   ╚══════╝╚══════╝ ╚═════╝ ╚══════╝╚═╝  ╚═══╝╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ║
  ║                                                                           ║
  ╠═══════════════════════════════════════════════════════════════════════════╣
  ║  LEVEL UP - Levels of Self | v12.2.0 LEGENDARY | February 6, 2026         ║
  ║  Built by Arthur Palyan | Best Life Coach California 2025                 ║
  ║  Live on Google Play & iOS App Store | 175 Countries                      ║
  ╠═══════════════════════════════════════════════════════════════════════════╣
  ║                                                                           ║
  ║  CHANGELOG v12.2.0 (Feb 6, 2026) - MOBILE UX UPDATE                       ║
  ║  ─────────────────────────────────────────────────────                    ║
  ║  • Share with Lily button on results screen (sends gameplay to Lily)      ║
  ║  • Value proposition added: What You Get / What You Save                  ║
  ║  • New FAQ: "What will this help me with?"                                ║
  ║  • Coach cards always show pink borders                                   ║
  ║  • Lily always shows purple border                                        ║
  ║  • FAQ updated with Connectors partner role                               ║
  ║  • Print output includes coach contact info                               ║
  ║  • Results screen value reminder                                          ║
  ║  • Intro hook: "Get clarity. Save time. Stop the cycle."                  ║
  ║                                                                           ║
  ╠═══════════════════════════════════════════════════════════════════════════╣
  ║                                                                           ║
  ║  THE LEGENDARY DESIGN SYSTEM                                              ║
  ║  ─────────────────────────────                                            ║
  ║  100+ CSS custom properties | Award-caliber visual design                 ║
  ║                                                                           ║
  ║  COLORS:                                                                  ║
  ║    • Deep space color palette with bright/glow variants                   ║
  ║    • 8 accent colors, each with 3 tones (base/bright/glow)                ║
  ║    • Semantic color tokens (text, border, card hierarchy)                 ║
  ║                                                                           ║
  ║  GRADIENTS:                                                               ║
  ║    • --grad-legendary: Full spectrum 5-stop gradient                      ║
  ║    • Radial variants for buttons and cards                                ║
  ║    • 4-point animated mesh background                                     ║
  ║                                                                           ║
  ║  SHADOWS:                                                                 ║
  ║    • 8-level depth system (2xs → 2xl)                                     ║
  ║    • Color-tinted glow shadows for each accent                            ║
  ║    • Inner shadow variants for inset effects                              ║
  ║    • Composite card shadows with border glow                              ║
  ║                                                                           ║
  ║  MOTION:                                                                  ║
  ║    • 10 named easing curves including elastic & bounce                    ║
  ║    • 5 duration tokens for consistent timing                              ║
  ║    • 7 transition presets (instant → elastic)                             ║
  ║    • Animated mesh float (30s infinite)                                   ║
  ║                                                                           ║
  ║  EFFECTS:                                                                 ║
  ║    • Shine sweep on all button hovers                                     ║
  ║    • Aurora glow ring behind primary CTAs                                 ║
  ║    • Film-grain noise texture overlay                                     ║
  ║    • Cinematic vignette                                                   ║
  ║    • 24px glassmorphism blur with saturation                              ║
  ║    • Custom scrollbar styling                                             ║
  ║    • Pulsing glow effects on CTAs                                         ║
  ║    • Radial highlight on card hover                                       ║
  ║    • Legendary selection glow states                                      ║
  ║    • Score celebration with radial pulse                                  ║
  ║                                                                           ║
  ║  DESKTOP:                                                                 ║
  ║    • Floating card with legendary glow halo                               ║
  ║    • Inner shine highlight on top edge                                    ║
  ║    • Fixed parallax background                                            ║
  ║                                                                           ║
  ╠═══════════════════════════════════════════════════════════════════════════╣
  ║  CONTENT: 6,854 scenarios | 19 archetypes | 16 themes | 6 core wounds     ║
  ╠═══════════════════════════════════════════════════════════════════════════╣
  ║  TECH: PWA | localStorage | Inter font | No backend                       ║
  ║  URLs: 100levelup.com | levelsofself.com | selfcheck.100levelup.com       ║
  ╚═══════════════════════════════════════════════════════════════════════════╝
-->
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Level Up">
<meta name="theme-color" content="#0d0a1a">
<meta name="description" content="See the patterns that quietly run your life. Get clarity. Save time. Stop the cycle. Free self-awareness game by Arthur Palyan.">
<meta name="keywords" content="self-awareness, personal growth, patterns, behavior, coaching, transformation, 7 levels">
<meta name="author" content="Arthur Palyan">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://100levelup.com/">
<meta property="og:site_name" content="Level Up">
<meta property="og:title" content="Everyone sees your pattern except you.">
<meta property="og:description" content="See the patterns that quietly run your life. Free self-awareness game with 6,854 scenarios across 7 levels.">
<meta property="og:image" content="https://100levelup.com/og-game.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:image:alt" content="Level Up - See the patterns that run your life">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@levelsofself">
<meta name="twitter:creator" content="@arthurpalyan">
<meta name="twitter:url" content="https://100levelup.com/">
<meta name="twitter:title" content="Everyone sees your pattern except you.">
<meta name="twitter:description" content="See the patterns that quietly run your life. Free self-awareness game. What's your pattern?">
<meta name="twitter:image" content="https://100levelup.com/og-game.png">

<!-- Favicons -->
<link rel="icon" type="image/png" sizes="32x32" href="icon-192.png">
<link rel="icon" type="image/png" sizes="16x16" href="icon-192.png">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="shortcut icon" href="icon-192.png">
<link rel="canonical" href="https://100levelup.com/" />
    <link rel="manifest" href="manifest.json">
<!-- Preload critical assets -->
<link rel="preload" href="logo_edited.webp" as="image" type="image/webp">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<title>Level Up - See Your Patterns | 7 Levels of Self</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}
html{background:#08060f;min-height:100%;min-height:-webkit-fill-available;scroll-behavior:smooth}
:root{
  /* ═══════════════════════════════════════════════════════════════════════
     LEGENDARY COLOR SYSTEM - Crafted for maximum visual impact
     ═══════════════════════════════════════════════════════════════════════ */
  /* Deep space background tones */
  --bg:#08060f;--bg-elevated:#0f0c18;--bg-surface:#141020;
  /* Card system - frosted glass effect */
  --card:rgba(18,14,28,0.92);--card-elevated:rgba(26,20,40,0.95);--card-glass:rgba(255,255,255,0.02);--card-glow:rgba(255,60,172,0.03);
  /* Border system - subtle to vivid */
  --border:#1f1a30;--border-subtle:#2a2445;--border-vivid:#3d3660;--border-glow:rgba(255,60,172,0.4);--border-gold:rgba(255,215,0,0.5);
  /* Text hierarchy */
  --text:#faf8ff;--text-bright:#ffffff;--text-secondary:#e8e0f8;--text-tertiary:#c0b8d8;--muted:#8880a0;--muted-soft:#686080;
  /* LEGENDARY Color Palette - Deeper saturation, richer tones */
  --pink:#FF2DA0;--pink-bright:#FF5CC0;--pink-glow:rgba(255,45,160,0.5);
  --orange:#FF5722;--orange-bright:#FF7A4D;--orange-glow:rgba(255,87,34,0.5);
  --purple:#6B35B0;--purple-bright:#8B55D0;--purple-deep:#4A2080;--purple-glow:rgba(107,53,176,0.5);
  --blue:#1E6FE0;--blue-bright:#4090FF;--blue-glow:rgba(30,111,224,0.5);
  --cyan:#00C8F0;--cyan-bright:#40E0FF;--cyan-glow:rgba(0,200,240,0.5);
  --green:#00C060;--green-bright:#20E080;--green-glow:rgba(0,192,96,0.5);
  --yellow:#F0B000;--gold:#FFD000;--gold-bright:#FFE040;--gold-glow:rgba(255,208,0,0.6);
  --red:#FF3050;--red-bright:#FF5070;--red-glow:rgba(255,48,80,0.5);
  --silver:#A8B0C0;--platinum:#E0E8F0;
  /* ═══════════════════════════════════════════════════════════════════════
     LEGENDARY GRADIENTS - Multi-stop, animated, alive
     ═══════════════════════════════════════════════════════════════════════ */
  --grad-legendary:linear-gradient(135deg,#FF5722 0%,#FF2DA0 25%,#6B35B0 50%,#1E6FE0 75%,#00C8F0 100%);
  --grad-primary:linear-gradient(135deg,#FF5722 0%,#FF2DA0 100%);
  --grad-primary-vivid:linear-gradient(135deg,#FF7A4D 0%,#FF5CC0 50%,#8B55D0 100%);
  --grad-primary-radial:radial-gradient(circle at 30% 30%,#FF7A4D,#FF2DA0 50%,#6B35B0);
  --grad-secondary:linear-gradient(135deg,#6B35B0 0%,#1E6FE0 100%);
  --grad-secondary-vivid:linear-gradient(135deg,#8B55D0 0%,#4090FF 100%);
  --grad-success:linear-gradient(135deg,#00C060 0%,#00A050 100%);
  --grad-warning:linear-gradient(135deg,#FFD000 0%,#FF7A4D 100%);
  --grad-gold:linear-gradient(135deg,#FFE040 0%,#FFD000 50%,#F0A000 100%);
  --grad-glass:linear-gradient(135deg,rgba(255,255,255,0.06) 0%,rgba(255,255,255,0.01) 100%);
  --grad-dark:linear-gradient(180deg,rgba(15,12,24,0.98) 0%,rgba(8,6,15,1) 100%);
  --grad-shine:linear-gradient(135deg,rgba(255,255,255,0.15) 0%,transparent 40%,transparent 60%,rgba(255,255,255,0.05) 100%);
  /* Animated mesh - the LEGENDARY signature */
  --grad-mesh:
    radial-gradient(ellipse 80% 60% at 20% 10%,rgba(107,53,176,0.2) 0%,transparent 50%),
    radial-gradient(ellipse 60% 80% at 90% 80%,rgba(255,45,160,0.15) 0%,transparent 50%),
    radial-gradient(ellipse 50% 50% at 10% 90%,rgba(30,111,224,0.12) 0%,transparent 45%),
    radial-gradient(ellipse 40% 40% at 80% 20%,rgba(255,87,34,0.08) 0%,transparent 40%);
  /* ═══════════════════════════════════════════════════════════════════════
     LEGENDARY SHADOWS - Dimensional depth system
     ═══════════════════════════════════════════════════════════════════════ */
  --shadow-2xs:0 1px 2px rgba(0,0,0,0.25);
  --shadow-xs:0 1px 3px rgba(0,0,0,0.3),0 1px 2px rgba(0,0,0,0.2);
  --shadow-sm:0 2px 6px rgba(0,0,0,0.35),0 1px 3px rgba(0,0,0,0.25);
  --shadow-md:0 4px 16px rgba(0,0,0,0.4),0 2px 6px rgba(0,0,0,0.3);
  --shadow-lg:0 8px 32px rgba(0,0,0,0.45),0 4px 12px rgba(0,0,0,0.35);
  --shadow-xl:0 16px 48px rgba(0,0,0,0.5),0 8px 20px rgba(0,0,0,0.4);
  --shadow-2xl:0 24px 64px rgba(0,0,0,0.55),0 12px 28px rgba(0,0,0,0.45);
  /* Glow shadows - colored light emission */
  --shadow-glow-pink:0 0 20px var(--pink-glow),0 0 40px rgba(255,45,160,0.25),0 0 60px rgba(255,45,160,0.1);
  --shadow-glow-purple:0 0 20px var(--purple-glow),0 0 40px rgba(107,53,176,0.25),0 0 60px rgba(107,53,176,0.1);
  --shadow-glow-gold:0 0 20px var(--gold-glow),0 0 40px rgba(255,208,0,0.3),0 0 60px rgba(255,208,0,0.15);
  --shadow-glow-cyan:0 0 20px var(--cyan-glow),0 0 40px rgba(0,200,240,0.25);
  --shadow-glow-legendary:0 0 30px var(--pink-glow),0 0 60px var(--purple-glow),0 0 90px rgba(255,87,34,0.15);
  /* Inner shadows for depth */
  --shadow-inner:inset 0 2px 4px rgba(0,0,0,0.4);
  --shadow-inner-lg:inset 0 4px 12px rgba(0,0,0,0.5);
  --shadow-inner-glow:inset 0 0 20px rgba(255,45,160,0.08);
  /* Card composite shadow */
  --shadow-card:0 4px 20px rgba(0,0,0,0.45),0 0 0 1px rgba(255,255,255,0.03);
  --shadow-card-hover:0 8px 40px rgba(0,0,0,0.5),0 0 0 1px rgba(255,255,255,0.06),var(--shadow-glow-pink);
  /* ═══════════════════════════════════════════════════════════════════════
     LEGENDARY MOTION - Cinematic easing & timing
     ═══════════════════════════════════════════════════════════════════════ */
  --ease-linear:linear;
  --ease-in:cubic-bezier(0.4,0,1,1);
  --ease-out:cubic-bezier(0,0,0.2,1);
  --ease-in-out:cubic-bezier(0.4,0,0.2,1);
  --ease-out-expo:cubic-bezier(0.16,1,0.3,1);
  --ease-out-back:cubic-bezier(0.34,1.56,0.64,1);
  --ease-out-quart:cubic-bezier(0.25,1,0.5,1);
  --ease-spring:cubic-bezier(0.175,0.885,0.32,1.275);
  --ease-bounce:cubic-bezier(0.68,-0.55,0.265,1.55);
  --ease-elastic:cubic-bezier(0.68,-0.6,0.32,1.6);
  /* Timing tokens */
  --duration-instant:75ms;--duration-fast:150ms;--duration-normal:250ms;--duration-slow:400ms;--duration-slower:600ms;
  /* Transition presets */
  --transition-instant:all var(--duration-instant) var(--ease-out);
  --transition-fast:all var(--duration-fast) var(--ease-out);
  --transition-normal:all var(--duration-normal) var(--ease-out-expo);
  --transition-slow:all var(--duration-slow) var(--ease-out-expo);
  --transition-bounce:all var(--duration-slow) var(--ease-out-back);
  --transition-spring:all var(--duration-slower) var(--ease-spring);
  --transition-elastic:all var(--duration-slower) var(--ease-elastic);
  /* ═══════════════════════════════════════════════════════════════════════
     LEGENDARY SPACING & SIZING
     ═══════════════════════════════════════════════════════════════════════ */
  --space-px:1px;--space-0:0;--space-1:4px;--space-2:8px;--space-3:12px;--space-4:16px;--space-5:20px;--space-6:24px;--space-8:32px;--space-10:40px;--space-12:48px;--space-16:64px;
  --radius-none:0;--radius-sm:6px;--radius-md:10px;--radius-lg:14px;--radius-xl:18px;--radius-2xl:24px;--radius-3xl:32px;--radius-full:9999px;
  /* ═══════════════════════════════════════════════════════════════════════
     TYPOGRAPHY
     ═══════════════════════════════════════════════════════════════════════ */
  --font-body:'Inter',system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
  --font-weight-normal:400;--font-weight-medium:500;--font-weight-semibold:600;--font-weight-bold:700;--font-weight-extrabold:800;
  --letter-spacing-tight:-0.02em;--letter-spacing-normal:-0.01em;--letter-spacing-wide:0.02em;
  --line-height-tight:1.2;--line-height-normal:1.5;--line-height-relaxed:1.7;
}
/* ═══════════════════════════════════════════════════════════════════════
   LEGENDARY BODY - Living, breathing canvas
   ═══════════════════════════════════════════════════════════════════════ */
body{
  font-family:var(--font-body);
  background:var(--bg);
  min-height:100vh;min-height:100dvh;
  color:var(--text);
  overflow-x:hidden;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  text-rendering:optimizeLegibility;
  letter-spacing:var(--letter-spacing-normal);
  line-height:var(--line-height-normal);
}
/* Animated mesh gradient layer */
body::before{
  content:'';position:fixed;inset:0;
  background:var(--grad-mesh);
  pointer-events:none;z-index:-3;
  animation:meshFloat 30s ease-in-out infinite;
}
@keyframes meshFloat{
  0%,100%{transform:translate(0,0) scale(1)}
  25%{transform:translate(-2%,1%) scale(1.02)}
  50%{transform:translate(1%,2%) scale(0.98)}
  75%{transform:translate(2%,-1%) scale(1.01)}
}
/* Vignette overlay */
body::after{
  content:'';position:fixed;inset:0;
  background:radial-gradient(ellipse 70% 70% at 50% 50%,transparent 0%,rgba(8,6,15,0.4) 70%,rgba(8,6,15,0.8) 100%);
  pointer-events:none;z-index:-2;
}
/* Noise texture for film-like quality */
body{
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
  background-size:256px 256px;
  background-blend-mode:overlay;
}
body::-webkit-scrollbar{width:8px;background:var(--bg)}
body::-webkit-scrollbar-thumb{background:var(--border-vivid);border-radius:var(--radius-full)}
body::-webkit-scrollbar-thumb:hover{background:var(--purple)}
/* ═══════════════════════════════════════════════════════════════════════
   LEGENDARY APP CONTAINER
   ═══════════════════════════════════════════════════════════════════════ */
.app{
  max-width:500px;
  margin:0 auto;
  padding:var(--space-4);
  padding-top:var(--space-5);
  padding-bottom:0;
  position:relative;
  overflow-x:hidden;
}
/* Desktop - Floating legendary card */
@media (min-width:768px){
  body{display:flex;justify-content:center;align-items:flex-start;padding:var(--space-8);background-attachment:fixed}
  .app{
    box-shadow:var(--shadow-2xl),var(--shadow-glow-legendary);
    border-radius:var(--radius-3xl);
    background:var(--grad-dark);
    min-height:calc(100vh - 64px);
    max-height:none;
    border:1px solid rgba(255,255,255,0.06);
    backdrop-filter:blur(24px) saturate(200%);
    -webkit-backdrop-filter:blur(24px) saturate(200%);
    position:relative;
    overflow:hidden;
  }
  .app::before{
    content:'';position:absolute;inset:0;
    border-radius:var(--radius-3xl);
    background:var(--grad-shine);
    pointer-events:none;
    opacity:0.5;
  }
  .app::after{
    content:'';position:absolute;inset:0;
    border-radius:var(--radius-3xl);
    box-shadow:inset 0 1px 0 rgba(255,255,255,0.08);
    pointer-events:none;
  }
  .game,.results{max-width:100%}
  .modal{backdrop-filter:blur(20px) saturate(200%)}
  .modal-content{box-shadow:var(--shadow-2xl),0 0 0 1px rgba(255,255,255,0.08)}
}
/* Solid overlay - prevents any content bleed-through */
body.hook-active{overflow:hidden;position:fixed;width:100%;height:100%;touch-action:none}
body.hook-active .app{visibility:hidden;pointer-events:none}
.hook{position:fixed;inset:0;background:#0d0a1a;display:flex;align-items:safe center;justify-content:center;z-index:9999;text-align:center;padding:24px;padding-top:max(24px,env(safe-area-inset-top));overflow:hidden;-webkit-overflow-scrolling:touch;isolation:isolate;overscroll-behavior:none;scrollbar-width:none;-ms-overflow-style:none}
.hook.scrollable{overflow-y:auto}
.hook::-webkit-scrollbar{display:none}
.hook::after{content:'';position:absolute;inset:0;background:linear-gradient(180deg,#1a1035 0%,#0d0a1a 100%);z-index:-2}
.hook::before{content:'';position:absolute;top:-30%;left:-30%;width:160%;height:160%;background:radial-gradient(circle at 30% 30%,rgba(255,107,53,0.12) 0%,transparent 50%),radial-gradient(circle at 70% 70%,rgba(120,75,160,0.15) 0%,transparent 50%);pointer-events:none;animation:ambientFloat 20s ease-in-out infinite;z-index:-1}
@keyframes ambientFloat{0%,100%{transform:translate(0,0)}50%{transform:translate(-2%,2%)}}
.hook.hidden{display:none}
/* Hook Music Controls - matches in-game ctrl-btn style */
.hook-music-controls{display:flex;justify-content:center;gap:10px;margin-bottom:20px;animation:fadeIn 0.5s ease}
.hook-music-btn{width:40px;height:40px;border-radius:50%;background:var(--card);border:1px solid var(--border);color:var(--muted);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--transition-fast);position:relative;overflow:hidden}
.hook-music-btn::before{content:'';position:absolute;inset:0;background:radial-gradient(circle at center,rgba(255,60,172,0.15),transparent 70%);opacity:0;transition:var(--transition-normal);pointer-events:none}
.hook-music-btn:hover{transform:translateY(-2px);box-shadow:var(--shadow-sm)}
.hook-music-btn:hover::before{opacity:1}
.hook-music-btn:active{transform:scale(0.95)}
.hook-music-btn.on{background:linear-gradient(135deg,var(--orange),var(--pink));color:#fff;border:none}
.hook-music-btn.off{background:var(--card);color:var(--muted);border:1px solid var(--border)}
.hook-music-btn.spotify{color:#1DB954}
.hook-music-btn.spotify:hover{border-color:#1DB954;background:rgba(29,185,84,0.1)}
.hook-music-btn.apple{color:#FC3C44}
.hook-music-btn.apple:hover{border-color:#FC3C44;background:rgba(252,60,68,0.1)}
.hook-music-icon{font-size:18px}
.hook-music-logo{width:20px;height:20px}
.hook-container{max-width:480px;width:100%;position:relative;z-index:1;min-height:min-content;display:flex;flex-direction:column;justify-content:safe center;overflow:visible;padding-left:16px;padding-right:16px;padding-top:max(24px,env(safe-area-inset-top));padding-bottom:max(24px,env(safe-area-inset-bottom))}
.hook-container::-webkit-scrollbar{display:none}
.hook-screen{display:none;flex-direction:column;align-items:center;opacity:0;transform:translateY(20px);width:100%;padding:20px 0;flex-shrink:0}
.hook-screen.active{display:flex;opacity:1;transform:translateY(0);animation:screenFadeIn 0.6s cubic-bezier(0.16,1,0.3,1)}
.hook-screen-scrollable.active{align-items:center;min-height:min-content}

.hook-screen-scrollable{justify-content:flex-start;padding-top:max(40px,env(safe-area-inset-top,20px));padding-bottom:max(60px,env(safe-area-inset-bottom,40px));overflow-y:auto;margin-top:auto;margin-bottom:auto;max-height:100%}
@keyframes screenFadeIn{to{opacity:1;transform:translateY(0)}}
.hook-line{font-size:clamp(24px,6vw,38px);font-weight:800;line-height:1.2;margin-bottom:4px;opacity:0;transform:translateY(30px);background:linear-gradient(135deg,var(--orange) 0%,var(--pink) 50%,var(--purple) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-align:center;padding:0 8px}
.hook-logo{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:clamp(200px,60vw,320px);opacity:0;transition:opacity 0.8s ease;z-index:10;pointer-events:none}
.hook-logo img{width:100%;height:auto}
.hook-line.show{animation:lineFadeUp 1s cubic-bezier(0.16,1,0.3,1) forwards}
@keyframes lineFadeUp{to{opacity:1;transform:translateY(0)}}
.hook-sub{font-size:16px;color:var(--text);line-height:1.4;margin:20px 0;opacity:0;font-weight:500;max-width:340px;white-space:normal}
.hook-sub.show{animation:lineFadeUp 0.8s cubic-bezier(0.16,1,0.3,1) forwards}
.hook-btn{padding:18px 48px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:16px;color:#fff;font-size:18px;font-weight:700;cursor:pointer;opacity:0;transform:translateY(20px);box-shadow:0 4px 24px rgba(255,60,172,0.4);transition:all 0.3s cubic-bezier(0.16,1,0.3,1);position:relative;overflow:hidden}
.hook-btn::before{content:'';position:absolute;inset:-3px;background:var(--grad-legendary);border-radius:19px;z-index:-1;filter:blur(12px);opacity:0;transition:var(--transition-normal);pointer-events:none}
.hook-btn::after{content:'';position:absolute;top:0;left:-100%;width:50%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.25),transparent)}
.hook-btn.show{opacity:1;transform:translateY(0)}
.hook-btn.show::before{animation:auroraGlow 3s ease-in-out infinite}
@keyframes auroraGlow{0%,100%{opacity:0.4;filter:blur(12px)}50%{opacity:0.7;filter:blur(16px)}}
@keyframes btnFadeUp{to{opacity:1;transform:translateY(0)}}
.hook-btn:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 8px 36px rgba(255,60,172,0.5)}
.hook-btn:hover::after{left:150%;transition:left 0.5s ease-out}
.hook-btn:hover::before{opacity:0.8}
.hook-btn:active{transform:translateY(-1px) scale(0.98)}
.hook-progress{display:flex;gap:6px;margin-bottom:28px;justify-content:center}
.h-dot{width:40px;height:4px;border-radius:4px;background:rgba(255,255,255,0.12);transition:all 0.5s cubic-bezier(0.16,1,0.3,1);position:relative;overflow:hidden;cursor:pointer}
.h-dot:hover{background:rgba(255,255,255,0.25)}
.h-dot::after{content:'';position:absolute;inset:0;background:linear-gradient(90deg,var(--orange),var(--pink));border-radius:4px;transform:scaleX(0);transform-origin:left;transition:transform 0.6s cubic-bezier(0.34,1.56,0.64,1)}
.h-dot.active::after,.h-dot.done::after{transform:scaleX(1)}
.h-dot.active{box-shadow:0 0 16px rgba(255,60,172,0.3)}
.hook-question-title{font-size:24px;font-weight:800;margin-bottom:8px;color:var(--text);animation:fadeIn 0.4s ease}
.hook-question-sub{color:var(--muted);font-size:14px;margin-bottom:24px;font-weight:500;animation:fadeIn 0.4s ease 0.1s backwards}
.recognition-grid{display:flex;flex-direction:column;gap:10px;width:100%;margin-bottom:24px}
.recognition-item{animation:fadeIn 0.3s ease backwards}
.recognition-item:nth-child(1){animation-delay:0.05s}
.recognition-item:nth-child(2){animation-delay:0.1s}
.recognition-item:nth-child(3){animation-delay:0.15s}
.recognition-item:nth-child(4){animation-delay:0.2s}
.recognition-item:nth-child(5){animation-delay:0.25s}
.recognition-item{background:var(--card);border:2px solid var(--border);border-radius:14px;padding:14px 18px;font-size:14px;color:var(--text);cursor:pointer;transition:all 0.25s cubic-bezier(0.16,1,0.3,1);text-align:left;line-height:1.4;position:relative;overflow:hidden}
.recognition-item::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,60,172,0.08),transparent 50%);opacity:0;transition:var(--transition-normal);pointer-events:none}
.recognition-item:hover{border-color:var(--pink);transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,0.2)}
.recognition-item:hover::before{opacity:1}
.recognition-item.selected{border-color:var(--pink);background:linear-gradient(135deg,rgba(255,60,172,0.15),rgba(120,75,160,0.15));box-shadow:0 0 0 3px rgba(255,60,172,0.2),0 8px 24px rgba(255,60,172,0.15),0 0 30px rgba(255,60,172,0.1)}
.recognition-item.selected::after{content:'✓';position:absolute;right:14px;top:50%;transform:translateY(-50%);color:var(--pink);font-weight:700;font-size:16px;text-shadow:0 0 10px rgba(255,60,172,0.5)}
.validation-hint{font-size:13px;color:var(--pink);text-align:center;margin-top:12px;opacity:0;transition:opacity 0.3s;font-weight:500}
.validation-hint.show{opacity:1}
.hook-btn-row{display:flex;gap:var(--space-3);width:100%;max-width:380px;margin-top:var(--space-4);justify-content:center}
.hook-btn-secondary{
  flex:0 0 auto;
  padding:16px 20px;
  background:var(--grad-secondary-vivid);
  border:none;
  border-radius:var(--radius-lg);
  color:#fff;
  font-size:15px;
  font-weight:var(--font-weight-semibold);
  cursor:pointer;
  transition:var(--transition-normal);
  box-shadow:0 4px 20px var(--purple-glow);
  position:relative;
  overflow:hidden;
  display:flex;
  align-items:center;
  gap:6px;
}
.hook-btn-secondary .back-arrow{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
  font-weight:700;
  transition:var(--transition-fast);
}
.hook-btn-secondary::before{content:'';position:absolute;inset:0;background:linear-gradient(105deg,transparent 40%,rgba(255,255,255,0.2) 50%,transparent 60%);transform:translateX(-100%);transition:transform 0.5s var(--ease-out-expo);pointer-events:none}
.hook-btn-secondary:hover{transform:translateY(-4px) scale(1.02);box-shadow:0 8px 32px var(--purple-glow),var(--shadow-glow-purple)}
.hook-btn-secondary:hover::before{transform:translateX(100%)}
.hook-btn-secondary:hover .back-arrow{transform:translateX(-3px)}
.hook-btn-secondary:active{transform:translateY(-1px) scale(0.98);transition:var(--transition-fast)}
.hook-btn-row .hook-btn{flex:1;margin:0;padding:16px 24px}
.voice-options{display:flex;flex-direction:column;gap:10px;width:100%;margin-bottom:24px}
.voice-option{animation:fadeIn 0.3s ease backwards}
.voice-option:nth-child(1){animation-delay:0.05s}
.voice-option:nth-child(2){animation-delay:0.1s}
.voice-option:nth-child(3){animation-delay:0.15s}
.voice-option:nth-child(4){animation-delay:0.2s}
.voice-option:nth-child(5){animation-delay:0.25s}
.voice-option{background:var(--card);border:2px solid var(--border);border-radius:14px;padding:14px 18px;font-size:14px;color:var(--text);cursor:pointer;transition:all 0.25s cubic-bezier(0.16,1,0.3,1);text-align:left;line-height:1.4;font-style:italic;position:relative}
.voice-option:hover{border-color:var(--pink);transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,0.2)}
.voice-option.selected{border-color:var(--pink);background:linear-gradient(135deg,rgba(255,60,172,0.15),rgba(120,75,160,0.15));box-shadow:0 0 0 3px rgba(255,60,172,0.2),0 8px 24px rgba(255,60,172,0.15)}
.voice-option.selected::after{content:'✓';position:absolute;right:14px;top:50%;transform:translateY(-50%);color:var(--pink);font-weight:700;font-size:16px}
.reveal-icon{font-size:80px;margin-bottom:20px;filter:drop-shadow(0 8px 24px rgba(0,0,0,0.3));animation:revealFloat 3s ease-in-out infinite}
@keyframes revealFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
.reveal-label{font-size:12px;text-transform:uppercase;letter-spacing:2.5px;color:var(--pink);margin-bottom:10px;font-weight:700;animation:fadeIn 0.4s ease}
.reveal-pattern{font-size:30px;font-weight:800;margin-bottom:14px;background:linear-gradient(135deg,var(--orange),var(--pink),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:fadeIn 0.5s ease}
.reveal-insight{font-size:17px;color:var(--text);line-height:1.6;margin-bottom:16px;font-style:italic;max-width:340px;opacity:0.95;animation:fadeIn 0.5s ease 0.2s backwards}
.reveal-context{font-size:14px;color:var(--muted);line-height:1.5;margin-bottom:20px;max-width:340px;animation:fadeIn 0.5s ease 0.3s backwards}
.reveal-divider{width:60px;height:2px;background:linear-gradient(90deg,var(--pink),var(--purple));margin:0 auto 16px;border-radius:2px}
.levels-intro{font-size:13px;color:var(--muted);margin-bottom:12px;font-weight:500;animation:fadeIn 0.4s ease;text-align:center}
.reveal-stats{display:flex;gap:40px;margin-bottom:28px;padding:20px 28px;background:var(--card);border-radius:16px;border:1px solid var(--border);animation:fadeIn 0.4s ease;transition:var(--transition-fast)}
.reveal-stats:hover{border-color:var(--pink);box-shadow:0 4px 20px rgba(255,60,172,0.15)}
.reveal-stat{text-align:center}
.reveal-stat-value{font-size:32px;font-weight:800;background:linear-gradient(135deg,var(--pink),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;transition:var(--transition-fast)}
.reveal-stats:hover .reveal-stat-value{filter:brightness(1.2)}
.reveal-stat-label{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-top:4px;font-weight:600}
.reveal-cta{font-size:14px;color:var(--muted);margin-bottom:20px;line-height:1.5;max-width:340px;text-align:center;animation:fadeIn 0.4s ease}
.levels-compact{display:flex;flex-direction:column;gap:0;width:100%;max-width:400px;margin-bottom:20px}
.level-compact{display:flex;align-items:center;gap:10px;background:var(--card);border:2px solid var(--border);border-radius:10px;padding:10px 14px;cursor:pointer;transition:all 0.25s ease;margin-bottom:6px;position:relative;animation:fadeIn 0.3s ease backwards}
.level-compact:nth-child(1){animation-delay:0.05s}
.level-compact:nth-child(2){animation-delay:0.1s}
.level-compact:nth-child(3){animation-delay:0.15s}
.level-compact:nth-child(4){animation-delay:0.2s}
.level-compact:nth-child(5){animation-delay:0.25s}
.level-compact:nth-child(6){animation-delay:0.3s}
.level-compact:nth-child(7){animation-delay:0.35s}
.level-compact:hover{border-color:var(--pink);transform:translateX(4px)}
.level-compact::after{content:'›';position:absolute;right:14px;font-size:20px;font-weight:bold;color:#FFD700;text-shadow:0 0 8px rgba(255,215,0,0.7),0 0 16px rgba(255,215,0,0.5);transition:transform 0.3s ease;animation:arrowGlow 2s ease-in-out infinite}
.level-compact.selected::after{transform:rotate(90deg);color:var(--pink);text-shadow:0 0 8px rgba(255,60,172,0.7),0 0 16px rgba(255,60,172,0.5);animation:none}
.level-compact.selected{border-color:var(--pink);background:linear-gradient(135deg,rgba(255,60,172,0.1),rgba(120,75,160,0.1));box-shadow:0 0 0 2px rgba(255,60,172,0.2)}
.level-dot{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:#000;flex-shrink:0;transition:var(--transition-fast)}
.level-compact:hover .level-dot{transform:scale(1.1)}
.level-compact-info{display:flex;flex-direction:row;align-items:baseline;gap:6px;text-align:left;flex:1;min-width:0;overflow:hidden}
.level-compact-name{font-size:13px;font-weight:600;color:var(--text);transition:var(--transition-fast);white-space:nowrap}
.level-compact:hover .level-compact-name{color:var(--pink)}
.level-compact-desc{font-size:10px;color:var(--muted);transition:var(--transition-fast);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.level-compact:hover .level-compact-desc{color:var(--text)}
.level-detail{display:none;background:rgba(0,0,0,0.3);border-left:3px solid var(--pink);border-radius:0 8px 8px 0;padding:12px 14px;margin:-2px 0 8px 14px;font-size:12px;color:var(--muted);line-height:1.6;text-align:left;animation:detailFadeIn 0.3s ease}
.level-detail.show{display:block}
@keyframes detailFadeIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
/* Screen 5: Shareable Pattern Card */
.reveal-label-top{font-size:11px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--pink);margin-bottom:20px}
.pattern-card-container{width:100%;max-width:360px;margin-bottom:28px}
.pattern-card-share{background:linear-gradient(165deg,#1e1a2e 0%,#13101f 100%);border-radius:28px;padding:36px 28px;position:relative;box-shadow:0 12px 80px rgba(255,60,172,0.3),0 0 0 1px rgba(255,255,255,0.1),inset 0 1px 0 rgba(255,255,255,0.1);overflow:hidden}
.card-glow{position:absolute;top:-100px;left:50%;transform:translateX(-50%);width:300px;height:300px;background:radial-gradient(circle,rgba(255,60,172,0.2) 0%,rgba(255,107,53,0.1) 40%,transparent 70%);pointer-events:none;animation:glowPulse 4s ease-in-out infinite}
@keyframes glowPulse{0%,100%{opacity:0.6;transform:translateX(-50%) scale(1)}50%{opacity:1;transform:translateX(-50%) scale(1.1)}}
.card-content-share{position:relative;z-index:1;text-align:center}
.pattern-icon-share{font-size:80px;margin-bottom:20px;line-height:1;filter:drop-shadow(0 8px 32px rgba(0,0,0,0.5))}
.pattern-name-share{font-size:28px;font-weight:800;margin-bottom:16px;background:linear-gradient(135deg,var(--orange) 0%,var(--pink) 50%,var(--purple) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1.2}
.pattern-tagline-share{font-size:16px;color:var(--text);line-height:1.6;font-style:italic;opacity:0.9;max-width:300px;margin:0 auto 24px}
.card-divider{width:50px;height:2px;background:linear-gradient(90deg,transparent,var(--pink),transparent);margin:0 auto 20px;border-radius:2px}
.card-footer-share{display:flex;flex-direction:column;gap:4px}
.footer-question{font-size:15px;color:var(--text);font-weight:600}
.footer-url{font-size:13px;color:var(--pink);font-weight:700;letter-spacing:0.5px}
/* Share Buttons */
.share-buttons{display:flex;flex-direction:column;gap:12px;width:100%;max-width:360px;margin-bottom:20px}
.share-btn{width:100%;padding:18px 24px;background:linear-gradient(135deg,var(--orange) 0%,var(--pink) 100%);border:none;border-radius:16px;font-size:17px;font-weight:700;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;box-shadow:0 8px 32px rgba(255,60,172,0.4);transition:all 0.3s cubic-bezier(0.16,1,0.3,1);position:relative;overflow:hidden}
.share-btn::before{content:'';position:absolute;inset:-3px;background:var(--grad-primary-vivid);border-radius:19px;z-index:-1;filter:blur(15px);opacity:0.3;animation:sharePulse 2s ease-in-out infinite;pointer-events:none}
.share-btn::after{content:'';position:absolute;top:0;left:-100%;width:50%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent)}
@keyframes sharePulse{0%,100%{opacity:0.3;filter:blur(15px)}50%{opacity:0.5;filter:blur(20px)}}
.share-btn:hover{transform:translateY(-3px);box-shadow:0 12px 40px rgba(255,60,172,0.5)}
.share-btn:hover::after{left:150%;transition:left 0.5s ease-out}
.share-btn:active{transform:translateY(-1px)}
.share-btn-icon{font-size:20px}
.share-btn-secondary{width:100%;padding:14px 24px;background:transparent;border:2px solid var(--border);border-radius:14px;font-size:15px;font-weight:600;color:var(--muted);cursor:pointer;transition:all 0.25s ease}
.share-btn-secondary:hover{border-color:var(--pink);color:var(--text);background:rgba(255,60,172,0.1)}
.start-playing-btn{padding:16px 48px;background:linear-gradient(135deg,var(--gold),var(--orange));border:none;border-radius:14px;font-size:17px;font-weight:700;color:#fff;cursor:pointer;transition:all 0.25s ease;box-shadow:0 4px 20px rgba(247,201,72,0.4);margin-bottom:12px;position:relative;overflow:hidden}
.start-playing-btn::before{content:'';position:absolute;top:0;left:-100%;width:50%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);animation:btnShine 2.5s ease-in-out infinite;pointer-events:none}
.start-playing-btn:hover{transform:translateY(-2px);box-shadow:0 6px 28px rgba(247,201,72,0.5)}
/* Shareable Card Modal */
.share-card-modal{position:fixed;inset:0;background:rgba(13,10,26,0.95);display:none;align-items:center;justify-content:center;z-index:400;padding:24px;opacity:0;transition:opacity 0.3s ease}
.share-card-modal.active{display:flex;animation:modalFadeIn 0.4s cubic-bezier(0.16,1,0.3,1) forwards}
@keyframes modalFadeIn{to{opacity:1}}
.share-card{width:100%;max-width:380px;aspect-ratio:1/1.2;background:linear-gradient(165deg,#1e1a2e 0%,#13101f 100%);border-radius:28px;padding:28px;position:relative;box-shadow:0 8px 60px rgba(255,60,172,0.3),0 0 0 1px rgba(255,255,255,0.08);display:flex;flex-direction:column}
.share-card::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle at 30% 30%,rgba(255,107,53,0.1) 0%,transparent 50%),radial-gradient(circle at 70% 70%,rgba(120,75,160,0.12) 0%,transparent 50%);pointer-events:none}
.share-card-header{display:flex;justify-content:space-between;align-items:flex-start;position:relative;z-index:1}
.share-card-logo{font-size:12px;font-weight:700;letter-spacing:2px;color:var(--muted);text-transform:uppercase}
.share-card-label{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--pink);background:rgba(255,60,172,0.15);padding:6px 12px;border-radius:20px}
.share-card-center{text-align:center;flex:1;display:flex;flex-direction:column;justify-content:center;position:relative;z-index:1;padding:16px 0}
.share-card-icon{font-size:60px;margin-bottom:14px;filter:drop-shadow(0 6px 20px rgba(0,0,0,0.3))}
.share-card-name{font-size:24px;font-weight:800;margin-bottom:10px;background:linear-gradient(135deg,var(--orange),var(--pink),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.share-card-tagline{font-size:14px;color:var(--text);line-height:1.5;font-style:italic;opacity:0.9}
.share-card-stats{display:flex;justify-content:center;gap:36px;padding-top:20px;border-top:1px solid var(--border);position:relative;z-index:1}
.share-card-stat{text-align:center}
.share-card-stat-value{font-size:26px;font-weight:800;color:var(--text)}
.share-card-stat-label{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-top:4px;font-weight:600}
.share-card-cta{text-align:center;margin-top:18px;position:relative;z-index:1}
.share-card-cta-q{font-size:14px;color:var(--text);font-weight:600}
.share-card-cta-url{font-size:12px;color:var(--pink);margin-top:4px;font-weight:700}
.share-card-actions{display:flex;gap:12px;margin-top:20px;width:100%;max-width:380px}
.share-card-btn{flex:1;padding:16px;border:none;border-radius:14px;font-size:15px;font-weight:600;cursor:pointer;transition:all 0.25s cubic-bezier(0.16,1,0.3,1)}
.share-card-btn.primary{background:linear-gradient(135deg,var(--orange),var(--pink));color:#fff;box-shadow:0 4px 20px rgba(255,60,172,0.4)}
.share-card-btn.primary:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(255,60,172,0.5)}
.share-card-btn.secondary{background:var(--card);color:var(--text);border:1px solid var(--border)}
.share-card-btn.secondary:hover{background:rgba(255,255,255,0.08);border-color:var(--pink)}
.share-card-close{position:absolute;top:16px;right:16px;width:40px;height:40px;border-radius:50%;background:var(--card);border:1px solid var(--border);color:var(--muted);font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;z-index:10}
.share-card-close:hover{background:rgba(255,255,255,0.1);color:var(--text)}
/* Coaching Bridge */
.coaching-bridge{display:none;background:var(--card);border:2px solid var(--purple);border-radius:20px;padding:24px;margin-bottom:16px;position:relative;overflow:hidden;box-shadow:0 4px 30px rgba(120,75,160,0.2)}
.coaching-bridge::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--orange),var(--pink),var(--purple));pointer-events:none}
.coaching-bridge::after{content:'';position:absolute;top:-50%;right:-30%;width:80%;height:80%;background:radial-gradient(circle,rgba(120,75,160,0.1) 0%,transparent 70%);pointer-events:none}
.coaching-bridge.show{display:block;animation:bridgeSlideIn 0.5s cubic-bezier(0.16,1,0.3,1)}
@keyframes bridgeSlideIn{from{opacity:0;transform:translateY(-16px)}to{opacity:1;transform:translateY(0)}}
.bridge-header{display:flex;align-items:center;gap:12px;margin-bottom:16px;position:relative;z-index:1}
.bridge-icon{font-size:28px}
.bridge-label{font-size:11px;text-transform:uppercase;letter-spacing:1.5px;color:var(--pink);font-weight:700}
.bridge-title{font-size:20px;font-weight:800;margin-bottom:10px;color:var(--text);position:relative;z-index:1}
.bridge-pattern-count{display:inline-flex;align-items:center;gap:8px;background:rgba(255,60,172,0.12);border:1px solid rgba(255,60,172,0.3);border-radius:20px;padding:8px 14px;font-size:13px;color:var(--pink);margin-bottom:16px;font-weight:600;position:relative;z-index:1}
.bridge-insight{font-size:14px;color:var(--muted);line-height:1.7;margin-bottom:16px;position:relative;z-index:1}
.bridge-insight strong{color:var(--text);font-weight:600}
.bridge-cta{font-size:15px;color:var(--text);margin-bottom:20px;line-height:1.6;position:relative;z-index:1}
.bridge-btns{display:flex;flex-direction:column;gap:10px;position:relative;z-index:1}
.bridge-btn{padding:16px 20px;border:none;border-radius:14px;font-size:15px;font-weight:700;cursor:pointer;text-decoration:none;text-align:center;transition:all 0.25s cubic-bezier(0.16,1,0.3,1)}
.bridge-btn.primary{background:linear-gradient(135deg,var(--orange),var(--pink));color:#fff;box-shadow:0 4px 20px rgba(255,60,172,0.4)}
.bridge-btn.primary:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(255,60,172,0.5)}
.bridge-btn.secondary{background:rgba(255,255,255,0.05);color:var(--text);border:1px solid var(--border)}
.bridge-btn.secondary:hover{background:rgba(255,255,255,0.08);border-color:var(--pink)}
.bridge-dismiss{text-align:center;margin-top:14px;position:relative;z-index:1}
.bridge-dismiss a{color:var(--muted);font-size:13px;text-decoration:none;transition:color 0.2s ease}
.bridge-dismiss a:hover{color:var(--text)}
@keyframes fadeUp{to{opacity:1;transform:translateY(0)}}
.onboard{position:fixed;inset:0;background:linear-gradient(180deg,#1a1035 0%,#0d0a1a 100%);display:none;flex-direction:column;align-items:center;justify-content:center;z-index:200;overflow-y:auto}
.onboard.active{display:flex}
.onboard-screen{display:none;flex-direction:column;align-items:center;justify-content:center;min-height:auto;width:100%;max-width:700px;padding:40px 30px;text-align:center}
.onboard-screen.active{display:flex}
.onboard-title{font-size:32px;font-weight:800;text-align:center;margin:20px 0 16px;background:linear-gradient(135deg,var(--orange),var(--pink),var(--purple),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.onboard-sub{text-align:center;color:var(--muted);font-size:17px;margin-bottom:20px}
.onboard-text{text-align:center;color:var(--muted);font-size:17px;line-height:1.6;margin-bottom:6px}
.onboard-text2{text-align:center;color:var(--text);font-size:16px;margin-bottom:6px}
.onboard-highlight{text-align:center;color:var(--text);font-size:17px;font-weight:600}
.onboard-highlight strong{color:var(--pink)}
.onboard-spacer{height:16px}
.onboard-levels{display:flex;flex-direction:column;gap:8px;margin-bottom:20px;width:100%}
.onboard-level{display:flex;align-items:center;gap:14px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px 16px}
.onboard-num{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700;color:#000;flex-shrink:0}
.onboard-info{flex:1}
.onboard-name{font-size:16px;font-weight:600}
.onboard-desc{font-size:14px;color:var(--muted)}
.onboard-dots{display:flex;justify-content:center;gap:8px;margin:20px 0}
.dot{width:8px;height:8px;border-radius:50%;background:var(--border)}
.dot.active{background:var(--pink)}
.onboard-btns{display:flex;gap:12px;width:100%;max-width:700px;padding:20px 30px;margin-top:24px}
.onboard-skip{padding:18px 28px;background:transparent;border:none;color:var(--muted);font-size:16px;cursor:pointer;transition:var(--transition-fast)}
.onboard-skip:hover{color:var(--text)}
.onboard-next,.onboard-start{flex:1;padding:18px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:12px;color:#fff;font-size:17px;font-weight:700;cursor:pointer;position:relative;overflow:hidden;box-shadow:0 4px 20px rgba(255,60,172,0.4)}
.onboard-next::before,.onboard-start::before{content:'';position:absolute;top:0;left:-100%;width:50%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.25),transparent);animation:btnShine 3s ease-in-out infinite;pointer-events:none}
.onboard-next:hover,.onboard-start:hover{transform:translateY(-2px);box-shadow:0 6px 25px rgba(255,60,172,0.5)}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;animation:fadeIn 0.3s ease}
.logo{font-size:22px;font-weight:800;background:linear-gradient(135deg,var(--orange),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;cursor:pointer;transition:var(--transition-fast)}
.logo:hover{transform:scale(1.05);filter:brightness(1.1)}
.controls{display:flex;gap:8px}
.ctrl-btn{animation:fadeIn 0.3s ease backwards}
.ctrl-btn:nth-child(1){animation-delay:0.05s}
.ctrl-btn:nth-child(2){animation-delay:0.1s}
.ctrl-btn:nth-child(3){animation-delay:0.15s}
.ctrl-btn:nth-child(4){animation-delay:0.2s}
.ctrl-btn:nth-child(5){animation-delay:0.25s}
.ctrl-btn{width:40px;height:40px;border-radius:50%;background:var(--card);border:1px solid var(--border);color:var(--muted);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--transition-fast);position:relative;overflow:hidden}
.ctrl-btn::before{content:'';position:absolute;inset:0;background:radial-gradient(circle at center,rgba(255,60,172,0.15),transparent 70%);opacity:0;transition:var(--transition-normal);pointer-events:none}
.ctrl-btn:hover{transform:translateY(-2px);box-shadow:var(--shadow-sm)}
.ctrl-btn:hover::before{opacity:1}
.ctrl-btn:active{transform:scale(0.95)}
.ctrl-btn.on{background:linear-gradient(135deg,var(--orange),var(--pink));color:#fff;border:none}
.ctrl-btn.qa-btn{background:linear-gradient(135deg,var(--purple),var(--blue));color:#fff;border:none;box-shadow:0 2px 8px rgba(120,75,160,0.4)}
.ctrl-btn.heart-btn{background:linear-gradient(135deg,#FF4757,#FF6B81);color:#fff;border:none;box-shadow:0 2px 8px rgba(255,71,87,0.4)}
.ctrl-btn.founder-btn{background:linear-gradient(135deg,var(--gold),var(--orange));color:#fff;border:none;box-shadow:0 2px 8px rgba(255,215,0,0.4)}
.login-bonus{background-color:rgba(40,30,20,0.95);background-image:linear-gradient(135deg,rgba(255,215,0,0.15),rgba(255,107,53,0.15));border:2px solid var(--gold);border-radius:12px;padding:14px;margin-bottom:16px;text-align:center;cursor:pointer;display:none;transition:var(--transition-fast);-webkit-backdrop-filter:none;backdrop-filter:none}
.login-bonus:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(255,215,0,0.3)}
.login-bonus.show{display:block;animation:glow 2s ease-in-out infinite}
@keyframes glow{0%,100%{box-shadow:0 0 5px var(--gold)}50%{box-shadow:0 0 20px var(--gold)}}
.login-title{font-size:14px;font-weight:700;color:var(--gold);margin-bottom:4px;text-shadow:0 0 8px rgba(255,215,0,0.3);pointer-events:none}
.login-title *{pointer-events:none}
.login-sub{font-size:12px;color:var(--muted);transition:var(--transition-fast);pointer-events:none}
.login-sub *{pointer-events:none}
.login-bonus:hover .login-sub{color:var(--text)}
.streak-warning{background-color:rgba(60,30,30,0.95);background-image:linear-gradient(135deg,rgba(255,71,87,0.2),rgba(255,107,53,0.2));border:2px solid var(--red);border-radius:12px;padding:12px;margin-bottom:16px;text-align:center;display:none;animation:shake 0.5s ease;cursor:pointer;transition:var(--transition-fast)}
.streak-warning:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(255,71,87,0.3)}
.streak-warning.show{display:block}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
.streak-warning-text{font-size:13px;color:var(--red);font-weight:600}
.hero{text-align:center;margin-bottom:20px;animation:fadeIn 0.5s ease}
.hero h1{font-size:26px;font-weight:800;margin-bottom:8px;background:linear-gradient(135deg,var(--orange),var(--pink),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero p{color:var(--muted);font-size:14px}
/* ULTIMATE Challenge Card */
.challenge{background:var(--card);border:2px solid var(--pink);border-radius:var(--radius-xl);padding:20px;margin-bottom:16px;cursor:pointer;transition:var(--transition-normal);box-shadow:var(--shadow-glow-pink),var(--shadow-card);position:relative;overflow:hidden;animation:fadeIn 0.4s var(--ease-out-expo);text-align:center}
.challenge::after{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--grad-primary-vivid)}
.challenge:hover{box-shadow:var(--shadow-glow-pink),var(--shadow-lg);transform:translateY(-4px);border-color:var(--pink)}
.challenge:active{transform:translateY(-2px) scale(0.99);transition:var(--transition-fast)}
/* ═══════════════════════════════════════════════════════════════════════
   LEGENDARY BADGE SYSTEM - Polished micro-badges
   ═══════════════════════════════════════════════════════════════════════ */
.badge{display:inline-flex;align-items:center;gap:6px;background:var(--grad-primary-vivid);color:#fff;font-size:10px;font-weight:700;padding:6px 12px;border-radius:var(--radius-full);margin-bottom:10px;box-shadow:0 2px 8px rgba(255,60,172,0.3);position:relative;overflow:hidden}
.badge::before{content:'';position:absolute;top:0;left:0;width:50%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);animation:badgeShine 3s ease-in-out infinite;transform:translateX(-200%);pointer-events:none}
@keyframes badgeShine{0%{transform:translateX(-200%)}50%,100%{transform:translateX(300%)}
@keyframes arrowGlow{0%,100%{color:#FFD700;text-shadow:0 0 8px rgba(255,215,0,0.7),0 0 16px rgba(255,215,0,0.5)}50%{color:#FFF176;text-shadow:0 0 12px rgba(255,215,0,1),0 0 24px rgba(255,215,0,0.8),0 0 36px rgba(255,215,0,0.4)}}}
.badge-dot{width:8px;height:8px;background:var(--green);border-radius:50%;animation:livePulse 2s ease-in-out infinite;box-shadow:0 0 8px rgba(0,210,106,0.6)}
@keyframes pulseDot{0%,100%{opacity:1;transform:scale(1);box-shadow:0 0 8px rgba(255,255,255,0.5)}50%{opacity:0.6;transform:scale(0.7);box-shadow:0 0 4px rgba(255,255,255,0.3)}}
.challenge h2{font-size:20px;font-weight:700;margin-bottom:6px;transition:var(--transition-normal);color:var(--text)}
.challenge:hover h2{color:var(--pink)}
.challenge p{color:var(--muted);font-size:13px;margin-bottom:12px;line-height:1.5;transition:var(--transition-normal)}
.challenge:hover p{color:var(--text-secondary)}
.challenge-footer{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);align-items:center}
.challenge.done{opacity:0.7;border-color:var(--green);box-shadow:0 0 20px rgba(0,210,106,0.25),var(--shadow-card)}
.challenge.done .badge{background:var(--grad-success)}
/* ULTIMATE XP Container */
.xp-container{background:var(--card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:16px;margin-bottom:16px;box-shadow:var(--shadow-card);position:relative;transition:var(--transition-normal);overflow:hidden}
.xp-container::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;border-radius:var(--radius-lg);opacity:0;transition:opacity 0.5s ease;pointer-events:none;box-shadow:inset 0 0 30px rgba(255,215,0,0.1),0 0 20px rgba(255,215,0,0.08)}
.xp-container::after{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:conic-gradient(from 0deg,transparent,rgba(255,215,0,0.03),transparent 30%);opacity:0;transition:var(--transition-slow);animation:xpRotate 8s linear infinite paused}
.xp-container:hover::after{opacity:1;animation-play-state:running}
@keyframes xpRotate{to{transform:rotate(360deg)}}
.xp-container.lit::before{opacity:1}
.xp-container.lit{border-color:var(--gold);animation:xpContainerPulse 3s ease-in-out infinite}
@keyframes xpContainerPulse{0%,100%{box-shadow:0 0 15px rgba(255,215,0,0.2),inset 0 0 15px rgba(255,215,0,0.05),var(--shadow-card)}50%{box-shadow:0 0 30px rgba(255,215,0,0.35),inset 0 0 20px rgba(255,215,0,0.08),var(--shadow-card)}}
.xp-container:hover{border-color:var(--gold);box-shadow:var(--shadow-card)}
.xp-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;animation:fadeIn 0.3s ease}
.xp-level{font-size:15px;font-weight:700;color:var(--gold);text-shadow:0 0 15px rgba(255,215,0,0.4);display:flex;align-items:center;gap:8px;transition:var(--transition-normal)}
.xp-level:hover{text-shadow:0 0 25px rgba(255,215,0,0.7);transform:scale(1.02)}
.xp-text{font-size:12px;color:var(--muted);margin-top:8px;display:flex;justify-content:space-between;transition:var(--transition-normal)}
.xp-container:hover .xp-text{color:var(--text-secondary)}
.xp-bar{height:10px;background:var(--border);border-radius:var(--radius-sm);overflow:hidden;box-shadow:var(--shadow-inner);position:relative;transition:var(--transition-normal)}
.xp-bar:hover{box-shadow:var(--shadow-inner),0 0 12px rgba(255,215,0,0.2)}
.xp-fill{height:100%;background:var(--grad-warning);border-radius:var(--radius-sm);transition:width 0.6s var(--ease-out-expo);box-shadow:0 0 15px rgba(255,215,0,0.5);position:relative;overflow:hidden}
.xp-fill::before{content:'';position:absolute;top:0;left:0;width:50%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.4),transparent);animation:xpShimmer 2.5s ease-in-out infinite;transform:translateX(-200%);pointer-events:none}
.xp-fill::after{content:'';position:absolute;top:-2px;right:-2px;bottom:-2px;width:14px;background:radial-gradient(circle at right,rgba(255,215,0,0.9),transparent);border-radius:0 var(--radius-sm) var(--radius-sm) 0;animation:xpPulse 1.5s ease-in-out infinite}
@keyframes xpShimmer{0%{transform:translateX(-200%)}50%,100%{transform:translateX(400%)}}
@keyframes xpPulse{0%,100%{opacity:0.5;transform:scaleX(1)}50%{opacity:1;transform:scaleX(1.3)}}
@keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
.xp-coins{display:flex;align-items:center;gap:4px;font-size:14px;color:var(--gold);font-weight:600;transition:var(--transition-normal);cursor:pointer;padding:10px 14px;border-radius:var(--radius-sm);background:rgba(255,215,0,0.08);border:1px solid rgba(255,215,0,0.15);position:relative;min-height:44px;min-width:44px;z-index:2}
.xp-coins::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,var(--gold),var(--orange));border-radius:10px;z-index:-1;filter:blur(8px);opacity:0.25;pointer-events:none}
@keyframes coinsGlow{0%,100%{box-shadow:0 0 8px rgba(255,215,0,0.3)}50%{box-shadow:0 0 20px rgba(255,215,0,0.6),0 0 30px rgba(255,215,0,0.3)}}
@keyframes coinsPulse{0%,100%{opacity:0.3;filter:blur(8px)}50%{opacity:0.6;filter:blur(12px)}}
.xp-coins:hover{background:rgba(255,215,0,0.15);border-color:rgba(255,215,0,0.3)}
/* ULTIMATE Coin Shop Styles */
.coin-reward{display:flex;justify-content:space-between;align-items:center;padding:16px;background:var(--card);border:2px solid var(--border);border-radius:var(--radius-lg);cursor:pointer;transition:var(--transition-normal);position:relative;overflow:hidden}
.coin-reward::before{content:'';position:absolute;top:0;left:-100%;width:50%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,215,0,0.08),transparent);pointer-events:none}
.coin-reward:hover{border-color:var(--gold);transform:translateY(-3px);box-shadow:var(--shadow-glow-gold)}
.coin-reward:hover::before{left:150%;transition:left 0.5s ease-out}
.coin-reward.affordable{border-color:var(--green);background:rgba(0,210,106,0.04)}
.coin-reward.affordable:hover{box-shadow:0 4px 20px rgba(0,210,106,0.35)}
.coin-reward.legendary{border-color:var(--gold);background:linear-gradient(135deg,rgba(255,215,0,0.08),rgba(255,107,53,0.05))}
.coin-reward.legendary:hover{box-shadow:var(--shadow-glow-gold)}
.coin-reward.redeemed{opacity:0.5;pointer-events:none}
.coin-reward.needs-foundation{opacity:0.7;border-style:dashed}
.coin-reward.needs-foundation .coin-reward-foundation{display:block!important}
.coin-reward-left{display:flex;align-items:center;gap:12px}
.coin-reward-icon{font-size:24px}
.coin-reward-info{display:flex;flex-direction:column;gap:2px}
.coin-reward-name{font-size:14px;font-weight:700;color:var(--text)}
.coin-reward-desc{font-size:11px;color:var(--muted)}
.coin-reward-cost{font-size:14px;font-weight:700;color:var(--gold);white-space:nowrap}
.coin-cost-amount{font-size:16px}
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:16px}
.stat{animation:fadeIn 0.3s ease backwards}
.stat:nth-child(1){animation-delay:0.05s}
.stat:nth-child(2){animation-delay:0.1s}
.stat:nth-child(3){animation-delay:0.15s}
.stat:nth-child(4){animation-delay:0.2s}
.stat{background:var(--card);border:2px solid var(--pink);border-radius:12px;padding:12px 4px;text-align:center;transition:var(--transition-fast);box-shadow:0 0 12px rgba(255,60,172,0.2);cursor:pointer;position:relative;overflow:visible}
.stat::before{content:'';position:absolute;inset:0;background:radial-gradient(circle at 50% 0%,rgba(255,60,172,0.12),transparent 60%);opacity:0;transition:var(--transition-normal);pointer-events:none}
.stat::after{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.15),transparent);opacity:0;transition:var(--transition-normal)}
.stat:hover::before,.stat:hover::after{opacity:1}
.stat:hover{transform:translateY(-4px);box-shadow:0 0 20px rgba(255,60,172,0.4)}
.stat-val{font-size:24px;font-weight:800;background:var(--grad-primary);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.stat-label{font-size:8px;font-weight:700;color:var(--muted);text-transform:uppercase;margin-top:4px;letter-spacing:0.3px;white-space:nowrap}
.insights-stat{cursor:pointer;border:2px solid var(--pink);box-shadow:0 0 12px rgba(255,60,172,0.3)}
.insights-stat:hover{box-shadow:0 0 20px rgba(255,60,172,0.5)}
.pattern-card{display:none;background:linear-gradient(135deg,rgba(120,75,160,0.2),rgba(255,60,172,0.1));border:2px solid var(--purple);border-radius:16px;padding:18px;margin-bottom:16px;cursor:pointer;transition:var(--transition-normal);position:relative;overflow:hidden}
.pattern-card::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg,transparent,rgba(255,255,255,0.03),transparent);transform:rotate(45deg);animation:patternShimmer 3s infinite;pointer-events:none}
.pattern-card::after{content:'';position:absolute;inset:0;background:radial-gradient(circle at 70% 30%,rgba(120,75,160,0.15),transparent 60%);opacity:0;transition:var(--transition-normal)}
@keyframes patternShimmer{0%{transform:translateX(-100%) rotate(45deg)}100%{transform:translateX(100%) rotate(45deg)}}
.pattern-card:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(120,75,160,0.3)}
.pattern-card:hover::after{opacity:1}
.pattern-card:active{transform:scale(0.98)}
.pattern-card.show{display:block}
.pattern-header{display:flex;align-items:center;gap:10px;margin-bottom:12px;animation:fadeIn 0.3s ease}
.pattern-icon{font-size:28px;transition:var(--transition-fast)}
.pattern-card:hover .pattern-icon{transform:scale(1.15) rotate(5deg)}
.pattern-label{font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--purple);font-weight:700;transition:var(--transition-fast)}
.pattern-card:hover .pattern-label{color:var(--pink)}
.pattern-archetype{font-size:20px;font-weight:800;background:linear-gradient(135deg,var(--purple),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:8px;transition:var(--transition-fast)}
.pattern-card:hover .pattern-archetype{filter:brightness(1.2)}
.pattern-edge{font-size:14px;color:var(--text);line-height:1.5;margin-bottom:12px;transition:var(--transition-fast)}
.pattern-card:hover .pattern-edge{color:#fff}
.pattern-challenge{background:rgba(0,0,0,0.3);border-radius:10px;padding:12px;border-left:3px solid var(--gold);transition:var(--transition-fast)}
.pattern-challenge:hover{background:rgba(0,0,0,0.4);border-left-width:5px}
.pattern-challenge-label{font-size:9px;text-transform:uppercase;letter-spacing:1px;color:var(--gold);font-weight:700;margin-bottom:6px}
.pattern-challenge-text{font-size:13px;color:var(--text);line-height:1.5}
.pattern-tap{font-size:11px;color:var(--muted);text-align:center;margin-top:12px}
/* ========== COACHING OFFER STYLES ========== */
.coaching-offer{background:linear-gradient(165deg,rgba(30,26,46,0.98) 0%,rgba(20,17,35,0.98) 100%);border:1px solid rgba(120,75,160,0.4);border-radius:20px;padding:24px 20px;margin-bottom:20px;position:relative;overflow:hidden;box-shadow:0 8px 40px rgba(120,75,160,0.2)}
.coaching-offer::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--orange),var(--pink),var(--purple));pointer-events:none}
.coaching-offer-header{text-align:center;margin-bottom:20px;position:relative;z-index:1}
.coaching-offer-photo{width:72px;height:72px;border-radius:50%;object-fit:cover;border:3px solid var(--pink);margin-bottom:14px;box-shadow:0 4px 20px rgba(255,60,172,0.3)}
.coaching-offer-label{display:inline-block;font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--pink);background:rgba(255,60,172,0.15);padding:6px 14px;border-radius:20px;margin-bottom:14px}
.coaching-offer-title{font-size:24px;font-weight:800;margin-bottom:6px;background:linear-gradient(135deg,var(--orange),var(--pink),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.coaching-offer-subtitle{font-size:13px;color:var(--muted)}
.coaching-cta{display:block;width:100%;padding:16px 20px;background:linear-gradient(135deg,var(--orange),var(--pink));border:3px solid var(--pink);border-radius:14px;color:#fff;font-size:16px;font-weight:700;text-decoration:none;text-align:center;cursor:pointer;box-shadow:0 0 24px rgba(255,60,172,0.5);transition:all 0.3s cubic-bezier(0.16,1,0.3,1);position:relative;z-index:1;overflow:hidden}
.coaching-cta::before{content:'';position:absolute;inset:-4px;background:var(--grad-primary-vivid);border-radius:18px;z-index:-1;filter:blur(15px);opacity:0.4;animation:ctaPulse 2s ease-in-out infinite;pointer-events:none}
.coaching-cta::after{content:'';position:absolute;top:0;left:-100%;width:50%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent)}
@keyframes ctaPulse{0%,100%{opacity:0.4;filter:blur(15px)}50%{opacity:0.6;filter:blur(20px)}}
.coaching-cta:hover{transform:translateY(-3px);box-shadow:0 10px 32px rgba(255,60,172,0.6)}
.coaching-cta:hover::after{left:150%;transition:left 0.5s ease-out}
.coaching-cta:active{transform:translateY(-1px)}
.coaching-note{text-align:center;margin-top:14px;font-size:12px;color:var(--muted);position:relative;z-index:1}
.coaching-note strong{color:var(--text)}
/* Transform Button */
.transform-btn{width:100%;margin-top:20px;padding:18px 20px;background:linear-gradient(135deg,rgba(255,107,53,0.15),rgba(255,60,172,0.15));border:2px solid var(--pink);border-radius:16px;cursor:pointer;transition:all 0.3s ease;display:flex;align-items:center;justify-content:center;gap:12px;position:relative;overflow:hidden}
.transform-btn::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--orange),var(--pink),var(--purple));pointer-events:none}
.transform-btn:hover{background:linear-gradient(135deg,rgba(255,107,53,0.25),rgba(255,60,172,0.25));transform:translateY(-2px);box-shadow:0 8px 30px rgba(255,60,172,0.3)}
.transform-btn:active{transform:translateY(0)}
.transform-btn-icon{font-size:24px;transition:var(--transition-fast)}
.transform-btn:hover .transform-btn-icon{transform:scale(1.2) rotate(10deg)}
.transform-btn-text{font-size:16px;font-weight:700;background:linear-gradient(135deg,var(--orange),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;transition:var(--transition-fast)}
.transform-btn:hover .transform-btn-text{filter:brightness(1.2)}
.transform-btn-sub{font-size:12px;color:var(--muted);font-weight:500}
/* Coaching Modal */
.coaching-modal-content{max-height:90vh;overflow-y:auto;position:relative;padding-top:40px}
/* Coach Profile Overlay */
.coach-profile-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:10001;align-items:center;justify-content:center;padding:20px;animation:fadeIn 0.2s ease}
.coach-profile-overlay.active{display:flex}
.coach-profile-card{background:linear-gradient(165deg,rgba(30,26,46,0.99) 0%,rgba(20,17,35,0.99) 100%);border:1px solid rgba(120,75,160,0.4);border-radius:20px;max-width:420px;width:100%;max-height:85vh;overflow-y:auto;padding:24px;position:relative;animation:slideUp 0.3s cubic-bezier(0.16,1,0.3,1)}
.coach-profile-card .cp-photo{width:80px;height:80px;border-radius:50%;object-fit:cover;border:3px solid var(--pink);display:block;margin:0 auto 12px;box-shadow:0 4px 20px rgba(255,60,172,0.3)}
.coach-profile-card .cp-name{font-size:22px;font-weight:800;color:var(--text);margin-bottom:4px;text-align:center}
.coach-profile-card .cp-location{font-size:13px;color:var(--muted);margin-bottom:12px;text-align:center}
.coach-profile-card .cp-langs{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;margin-bottom:16px}
.coach-profile-card .cp-lang{font-size:11px;background:rgba(255,255,255,0.08);border:1px solid var(--border);padding:4px 10px;border-radius:8px;color:var(--text)}
.coach-profile-card .cp-price{font-size:28px;font-weight:800;color:var(--green);margin-bottom:16px;text-align:center}
.coach-profile-card .cp-price span{font-size:14px;color:var(--muted);font-weight:400}
.coach-profile-card .cp-divider{height:1px;background:var(--border);margin:16px 0}
.coach-profile-card .cp-section-title{font-size:11px;text-transform:uppercase;letter-spacing:1.5px;color:var(--pink);font-weight:700;margin-bottom:10px;text-align:left}
.coach-profile-card .cp-specialties{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px}
.coach-profile-card .cp-specialty{font-size:12px;background:rgba(255,60,172,0.1);border:1px solid rgba(255,60,172,0.25);color:var(--pink);padding:6px 12px;border-radius:20px;font-weight:600}
.coach-profile-card .cp-bio{font-size:14px;color:var(--text-secondary);line-height:1.7;text-align:left;margin-bottom:20px}
.coach-profile-card .cp-actions{display:flex;gap:10px}
.coach-profile-card .cp-actions a{flex:1;padding:14px;border-radius:12px;text-align:center;font-size:14px;font-weight:700;text-decoration:none;color:#fff}
.coach-profile-card .cp-close{position:absolute;top:12px;right:12px;width:32px;height:32px;border-radius:50%;background:rgba(255,255,255,0.1);border:none;color:#fff;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:2}
.coach-profile-card .cp-close:hover{background:rgba(255,255,255,0.2)}
.modal-close-x{position:absolute;top:12px;left:12px;width:40px;height:40px;background:linear-gradient(135deg,var(--pink),var(--purple));border:none;border-radius:50%;color:#fff;font-size:18px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s;z-index:10;box-shadow:0 4px 15px rgba(255,60,172,0.4)}
.modal-close-x:hover{transform:scale(1.1);box-shadow:0 6px 20px rgba(255,60,172,0.6)}
/* ========== END COACHING OFFER STYLES ========== */

/* ALWAYS-ON BORDERS: Coaches = Pink, Lily = Purple */
.coaching-modal-content img[alt="Laurie Van Werde"],
.coaching-modal-content img[alt="Aurora Maier"],
.coaching-modal-content img[alt="Heghine Manukyan"],
.coaching-modal-content img[alt="Roger Walter"]{border:2px solid var(--pink)!important;box-shadow:0 0 12px rgba(255,60,172,0.3)}
.coaching-modal-content img[alt="Lily"],
.coaching-modal-content img[alt="Lily - Self-Awareness Coach"],
#lilyBtn img{border:2px solid #a855f7!important;box-shadow:0 0 12px rgba(168,85,247,0.4)}
#lilyBtn{border:2px solid #a855f7!important}

.modes{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px}
.mode{animation:fadeIn 0.4s ease backwards}
.mode:nth-child(1){animation-delay:0.1s}
.mode:nth-child(2){animation-delay:0.2s}
.mode{background:var(--card);border:2px solid var(--pink);border-radius:16px;padding:20px 14px;text-align:center;cursor:pointer;position:relative;transition:var(--transition-fast);box-shadow:0 4px 20px rgba(255,60,172,0.15)}
.mode:hover{box-shadow:0 8px 30px rgba(255,60,172,0.25);transform:translateY(-4px)}
.mode:active{transform:scale(0.97)}
.mode.locked{opacity:0.5;border-color:var(--border);box-shadow:0 2px 10px rgba(0,0,0,0.15);cursor:not-allowed}
.mode.locked:hover{box-shadow:0 2px 10px rgba(0,0,0,0.15);transform:none}
.mode.locked::after{content:'🔒';position:absolute;top:10px;right:10px;font-size:16px}
.mode.newly-unlocked{border-color:var(--pink);box-shadow:0 0 20px rgba(255,60,172,0.5);animation:unlockPulse 2s ease-in-out infinite}
.level.newly-unlocked{border:2px solid var(--pink);box-shadow:0 0 15px rgba(255,60,172,0.4);animation:unlockPulse 2s ease-in-out infinite;overflow:visible}
@keyframes unlockPulse{0%,100%{box-shadow:0 0 15px rgba(255,60,172,0.4)}50%{box-shadow:0 0 25px rgba(255,60,172,0.7)}}
/* First-time user pulse on Mirror Game */
.mode.start-here{animation:startHerePulse 1.5s ease-in-out infinite;position:relative}
.mode.start-here::before{content:'Start Here';position:absolute;top:-10px;left:50%;transform:translateX(-50%);background:var(--gold);color:#000;font-size:10px;font-weight:700;padding:4px 10px;border-radius:12px;white-space:nowrap;z-index:5;pointer-events:none}
@keyframes startHerePulse{0%,100%{box-shadow:0 0 20px rgba(247,201,72,0.5),0 4px 20px rgba(255,60,172,0.15)}50%{box-shadow:0 0 35px rgba(247,201,72,0.8),0 4px 20px rgba(255,60,172,0.15)}}
/* Deep Insight ready badge */
.ai-ready{position:relative;overflow:visible}
.ai-ready::after{content:'Ready!';position:absolute;top:-6px;right:-6px;background:linear-gradient(135deg,var(--pink),var(--purple));color:#fff;font-size:8px;font-weight:700;padding:3px 6px;border-radius:8px;animation:aiBadgePulse 1.5s ease-in-out infinite}
@keyframes aiBadgePulse{0%,100%{transform:scale(1);box-shadow:0 0 8px rgba(255,60,172,0.5)}50%{transform:scale(1.1);box-shadow:0 0 15px rgba(255,60,172,0.8)}}
/* Insights stat pulse when new */
.insights-stat.new-insight{animation:insightPulse 0.6s ease-out}
@keyframes insightPulse{0%{transform:scale(1)}50%{transform:scale(1.15)}100%{transform:scale(1)}}
/* Streak risk pulsing fire */
.streak-risk{position:absolute;top:-8px;right:-8px;font-size:20px;animation:streakPulse 1s ease-in-out infinite}
@keyframes streakPulse{0%,100%{transform:scale(1);filter:brightness(1)}50%{transform:scale(1.2);filter:brightness(1.3)}}
/* Challenge stat active glow */
.challenge-active{background:linear-gradient(135deg,rgba(255,107,53,0.15),rgba(255,60,172,0.1))!important;border:1px solid var(--orange)!important;border-radius:10px}
.challenge-active .stat-val{color:var(--orange)!important}
/* NEW badge for recently unlocked content */
.new-badge{position:absolute;top:-6px;right:-6px;background:linear-gradient(135deg,var(--green),#00B85D);color:#fff;font-size:9px;font-weight:800;padding:3px 6px;border-radius:8px;text-transform:uppercase;letter-spacing:0.5px;animation:newBadgePop 0.5s ease-out,newBadgeGlow 2s ease-in-out infinite 0.5s;z-index:5}
/* Offline indicator */
.offline-badge{display:none;position:fixed;top:10px;left:50%;transform:translateX(-50%);background:var(--orange);color:#fff;font-size:11px;font-weight:700;padding:6px 14px;border-radius:20px;z-index:9999;box-shadow:0 4px 15px rgba(255,107,53,0.4)}
.offline-badge.show{display:block;animation:fadeIn 0.3s ease}
@keyframes newBadgePop{0%{transform:scale(0);opacity:0}50%{transform:scale(1.2)}100%{transform:scale(1);opacity:1}}
@keyframes newBadgeGlow{0%,100%{box-shadow:0 0 5px rgba(0,210,106,0.5)}50%{box-shadow:0 0 15px rgba(0,210,106,0.8)}}
/* Scroll to top button */
.scroll-top-btn{position:fixed;bottom:80px;right:20px;width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,var(--pink),var(--purple));border:none;color:#fff;font-size:22px;font-weight:bold;cursor:pointer;display:none;align-items:center;justify-content:center;z-index:100;box-shadow:0 4px 20px rgba(255,60,172,0.5);transition:all 0.3s ease}
.scroll-top-btn.show{display:flex;animation:fadeInUp 0.3s ease}
.scroll-top-btn:hover{transform:translateY(-5px) scale(1.1);box-shadow:0 8px 30px rgba(255,60,172,0.6)}
.scroll-bottom-btn{width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,var(--pink),var(--purple));border:none;color:#fff;font-size:22px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 20px rgba(255,60,172,0.5);transition:all 0.3s ease;margin:0 auto 16px;animation:pulse-glow 2s infinite}
.scroll-bottom-btn:hover{transform:translateY(3px) scale(1.1);box-shadow:0 8px 30px rgba(255,60,172,0.6)}
.modal-scroll-top{position:sticky;bottom:12px;margin:12px auto 0;width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,var(--pink),var(--purple));border:none;color:#fff;font-size:18px;cursor:pointer;display:none;align-items:center;justify-content:center;z-index:10;box-shadow:0 4px 15px rgba(255,60,172,0.4);transition:all 0.2s;flex-shrink:0}
.modal-scroll-top.show{display:flex}
.modal-scroll-top:hover{transform:scale(1.1);box-shadow:0 6px 20px rgba(255,60,172,0.6)}
@keyframes pulse-glow{0%,100%{box-shadow:0 4px 20px rgba(255,60,172,0.5)}50%{box-shadow:0 4px 30px rgba(255,60,172,0.8)}}
@keyframes fadeInUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.mode-icon{font-size:40px;margin-bottom:12px;line-height:1;transition:var(--transition-fast)}
.mode:hover .mode-icon{transform:scale(1.1)}
.mode-name{font-size:16px;font-weight:700;margin-bottom:6px;transition:var(--transition-fast)}
.mode:hover .mode-name{color:var(--pink)}
.mode-desc{font-size:12px;color:var(--muted);line-height:1.4;transition:var(--transition-fast)}
.mode:hover .mode-desc{color:var(--text)}
.mode-unlock{font-size:10px;color:var(--gold);margin-top:8px;font-weight:600}
.section-title{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:2px;margin-bottom:14px;transition:var(--transition-fast)}
.section-title:hover{color:var(--pink)}
.levels{display:flex;flex-direction:column;gap:8px;margin-bottom:20px}
.level{animation:fadeIn 0.4s ease backwards}
.level:nth-child(1){animation-delay:0.05s}
.level:nth-child(2){animation-delay:0.1s}
.level:nth-child(3){animation-delay:0.15s}
.level:nth-child(4){animation-delay:0.2s}
.level:nth-child(5){animation-delay:0.25s}
.level:nth-child(6){animation-delay:0.3s}
.level:nth-child(7){animation-delay:0.35s}
.level{display:flex;align-items:center;gap:14px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;cursor:pointer;transition:all 0.2s;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.level.unlocked{border:2px solid var(--pink);box-shadow:0 2px 12px rgba(255,60,172,0.25)}
.level:hover{border-color:var(--pink);transform:translateX(4px);box-shadow:0 4px 12px rgba(0,0,0,0.15)}
.level:active{transform:scale(0.98)}
.level.locked{opacity:0.5;cursor:pointer}
.level.locked:hover{transform:none;border-color:var(--border)}
.level-num{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:15px;font-weight:800;color:#000;flex-shrink:0;box-shadow:0 2px 8px rgba(0,0,0,0.2);transition:var(--transition-fast)}
.level:hover .level-num{transform:scale(1.1);box-shadow:0 4px 12px rgba(0,0,0,0.3)}
.level-info{flex:1}
.level-name{font-size:15px;font-weight:600;transition:var(--transition-fast)}
.level:hover .level-name{color:var(--pink)}
.level-desc{font-size:12px;color:var(--muted);margin-top:2px;transition:var(--transition-fast)}
.level-progress{height:4px;background:rgba(255,255,255,0.1);border-radius:2px;margin-top:6px;overflow:hidden}
.level-progress-bar{height:100%;background:linear-gradient(90deg,var(--green),var(--cyan));border-radius:2px;transition:width 0.5s ease}
.level-progress-text{font-size:10px;color:var(--green);margin-top:3px;font-weight:600}
.level.has-play{position:relative}
.level.has-play::before{content:'Play';position:absolute;top:-10px;left:50%;transform:translateX(-50%);background:var(--gold);color:#000;font-size:10px;font-weight:700;padding:4px 10px;border-radius:12px;white-space:nowrap;z-index:5;pointer-events:none}
.level:hover .level-desc{color:var(--text)}
.action-btns{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px}
.action-btn{animation:fadeIn 0.3s ease backwards}
.action-btns .action-btn:nth-child(1){animation-delay:0.1s}
.action-btns .action-btn:nth-child(2){animation-delay:0.2s}
.action-btn{display:flex;align-items:center;justify-content:center;gap:8px;background:var(--card);border:2px solid var(--border);border-radius:12px;padding:14px;cursor:pointer;text-decoration:none;color:var(--text);transition:all 0.2s;box-shadow:0 2px 8px rgba(0,0,0,0.1);position:relative;overflow:hidden}
.action-btn::before{content:'';position:absolute;inset:0;background:radial-gradient(circle at 50% 0%,rgba(255,255,255,0.08),transparent 60%);opacity:0;transition:var(--transition-normal);pointer-events:none}
.action-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.2)}
.action-btn:hover::before{opacity:1}
.action-btn:active{transform:scale(0.97)}
.action-btn-icon{font-size:20px;transition:var(--transition-fast)}
.action-btn:hover .action-btn-icon{transform:scale(1.15)}
.action-btn-text{font-size:14px;font-weight:600;transition:var(--transition-fast)}
.action-btn:hover .action-btn-text{color:var(--pink)}
.action-btn.assess{border-color:var(--blue);background:linear-gradient(135deg,rgba(47,128,237,0.1),rgba(47,128,237,0.05))}
.action-btn.assess:hover{border-color:var(--blue);box-shadow:0 4px 15px rgba(47,128,237,0.3)}
.action-btn.share{border-color:var(--green);background:linear-gradient(135deg,rgba(0,210,106,0.1),rgba(0,210,106,0.05))}
.action-btn.share:hover{border-color:var(--green);box-shadow:0 4px 15px rgba(0,210,106,0.3)}
.action-btn.breakthrough{border-color:var(--orange);background:linear-gradient(135deg,rgba(255,87,34,0.15),rgba(255,87,34,0.05))}
.action-btn.breakthrough:hover{border-color:var(--orange);box-shadow:0 4px 15px rgba(255,87,34,0.4)}
.action-btn.team{border-color:var(--gold);background:linear-gradient(135deg,rgba(255,208,0,0.2),rgba(255,208,0,0.05))}
.action-btn.team:hover{border-color:var(--gold);box-shadow:0 4px 15px rgba(255,208,0,0.5)}
.footer{text-align:center;padding:8px 0 0 0;animation:fadeIn 0.5s ease 0.4s backwards}
.footer-btns{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px}
.footer-btn{animation:fadeIn 0.3s ease backwards}
.footer-btns .footer-btn:nth-child(1){animation-delay:0.1s}
.footer-btns .footer-btn:nth-child(2){animation-delay:0.2s}
.footer-btn{display:block;padding:14px 24px;background:var(--card);border:2px solid var(--pink);border-radius:12px;color:var(--text);text-decoration:none;font-size:14px;font-weight:600;transition:var(--transition-fast);position:relative;overflow:hidden}
.footer-btn::before{content:'';position:absolute;top:0;left:-100%;width:50%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,60,172,0.1),transparent);pointer-events:none}
.footer-btn:hover{background:rgba(255,60,172,0.15);transform:translateY(-2px);box-shadow:0 4px 15px rgba(255,60,172,0.2)}
.footer-btn:hover::before{left:150%;transition:left 0.5s ease-out}
.footer-btn.primary{background:var(--grad-primary);border:none;color:#fff}
.footer-btn.primary::before{background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent)}
.footer-btn.primary:hover{box-shadow:0 4px 20px rgba(255,60,172,0.4)}
.game{display:none;overflow-x:hidden}
.game.active{display:block;animation:slideUp 0.3s ease}
@keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.home.hidden{display:none}
.game-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;animation:fadeIn 0.3s ease}
.game-info{font-size:14px;animation:fadeIn 0.3s ease}
.game-mode{color:var(--muted);font-size:11px;text-transform:uppercase;letter-spacing:1px;transition:var(--transition-fast)}
.game-mode:hover{color:var(--pink)}
.game-combo{font-size:12px;color:var(--gold);font-weight:700;display:flex;align-items:center;gap:4px;transition:var(--transition-fast)}
.game-combo.active{animation:comboPulse 0.3s ease}
.quit{width:40px;height:40px;border-radius:50%;background:rgba(255,71,87,0.15);border:2px solid var(--red);color:var(--red);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--transition-fast)}
.music-toggle{width:36px;height:36px;border-radius:50%;background:var(--card);border:1px solid var(--border);color:var(--muted);font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--transition-fast);margin-right:8px}
.music-toggle:hover{transform:translateY(-2px);box-shadow:var(--shadow-sm)}
.music-toggle:active{transform:scale(0.95)}
.music-toggle.on{background:linear-gradient(135deg,var(--orange),var(--pink));color:#fff;border:none}
.quit:hover{transform:rotate(90deg);background:rgba(255,71,87,0.25)}
.timer{height:6px;background:var(--border);border-radius:3px;margin-bottom:16px;overflow:hidden;position:relative;animation:fadeIn 0.3s ease}
.timer.hidden{display:none}
.timer-fill{height:100%;width:100%;background:var(--green);transition:width 0.1s linear;position:relative}
.timer-fill::after{content:'';position:absolute;top:0;right:0;bottom:0;width:4px;background:rgba(255,255,255,0.5);animation:pulse 1s infinite}
.timer-fill.warn{background:var(--yellow);animation:timerWarn 0.5s ease infinite}
.timer-fill.danger{background:var(--red);animation:timerWarn 0.3s ease infinite}
.scenario{background:var(--card);border:2px solid var(--pink);border-radius:14px;padding:18px;margin-bottom:14px;position:relative;animation:fadeIn 0.3s ease;min-height:100px}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.scenario-cat{display:inline-block;background:var(--border);padding:5px 10px;border-radius:16px;font-size:10px;text-transform:uppercase;margin-bottom:12px;font-weight:600;letter-spacing:0.5px;transition:var(--transition-fast)}
.scenario-text{font-size:16px;line-height:1.6}
.scenario-text.loading{color:var(--muted);animation:textPulse 1.5s ease-in-out infinite}
@keyframes textPulse{0%,100%{opacity:0.4}50%{opacity:1}}
.choices{display:flex;flex-direction:column;gap:10px;animation:fadeIn 0.3s ease;min-height:280px}
.choice{width:100%;padding:16px;background:var(--card);border:2px solid var(--border);border-radius:12px;color:var(--text);font-size:15px;text-align:left;cursor:pointer;line-height:1.5;transition:var(--transition-fast);box-shadow:var(--shadow-sm);animation:choiceSlide 0.3s ease backwards;position:relative;overflow:hidden;min-height:60px;display:flex;align-items:center}
.choice::before{content:'';position:absolute;top:0;left:-100%;width:50%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,60,172,0.08),transparent);transition:none;pointer-events:none}
.choice:hover::before{left:150%;transition:left 0.5s ease-out}
.choice:nth-child(1){animation-delay:0.05s}
.choice:nth-child(2){animation-delay:0.1s}
.choice:nth-child(3){animation-delay:0.15s}
.choice:nth-child(4){animation-delay:0.2s}
@keyframes choiceSlide{from{opacity:0;transform:translateX(-10px)}to{opacity:1;transform:translateX(0)}}
.choice:hover{border-color:var(--pink);box-shadow:0 4px 12px rgba(255,60,172,0.2),0 0 20px rgba(255,60,172,0.1)}
.choice:active{transform:scale(0.98);border-color:var(--pink)}
.choice:disabled{cursor:default;transform:none;animation:none}
.choice.selected{border-color:var(--pink);background:rgba(255,60,172,0.15);box-shadow:0 0 15px rgba(255,60,172,0.2)}
.choice.correct{border-color:var(--green);background:rgba(0,210,106,0.15);box-shadow:0 0 15px rgba(0,210,106,0.2)}
.choice.wrong{border-color:var(--yellow);background:rgba(247,201,72,0.15);box-shadow:0 0 15px rgba(247,201,72,0.2)}
.choice.selected-mirror{border-color:var(--cyan);background:rgba(0,216,255,0.15);box-shadow:0 0 15px rgba(0,216,255,0.2)}
.choice.dim-neutral{opacity:0.5}
.choice.dim{opacity:0.25}
.results{display:none;text-align:center;padding-top:40px;padding-bottom:100px;overflow-x:hidden}
.results.active{display:block;animation:slideUp 0.4s ease}
.results h2{font-size:26px;margin-bottom:16px;font-weight:800;background:var(--grad-primary);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:fadeIn 0.4s ease}
.score{font-size:72px;font-weight:900;color:var(--text);margin:20px 0;text-shadow:0 0 40px rgba(255,60,172,0.3);animation:scoreBounce 1s ease;position:relative}
.score::before{content:'';position:absolute;inset:-20px;background:radial-gradient(circle,rgba(255,60,172,0.15) 0%,transparent 70%);animation:scoreGlow 2s ease-in-out infinite;pointer-events:none}
@keyframes scoreGlow{0%,100%{opacity:0.5;transform:scale(0.95)}50%{opacity:1;transform:scale(1.05)}}
@keyframes scoreBounce{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
@keyframes toastBounce{0%{transform:translateX(-50%) translateY(20px);opacity:0}50%{transform:translateX(-50%) translateY(-15px)}100%{transform:translateX(-50%) translateY(-10px);opacity:1}}
@keyframes comboPulse{0%{transform:scale(1)}50%{transform:scale(1.3)}100%{transform:scale(1)}}
@keyframes wrongShake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-5px)}40%,80%{transform:translateX(5px)}}
@keyframes timerWarn{0%,100%{opacity:1}50%{opacity:0.7}}
.result-msg{font-size:17px;color:var(--muted);margin-bottom:24px;line-height:1.6;padding:0 20px;animation:fadeIn 0.5s ease 0.2s backwards}
.results-btn{width:100%;padding:18px;background:var(--grad-primary);border:none;border-radius:14px;color:#fff;font-size:16px;font-weight:700;cursor:pointer;margin-bottom:12px;box-shadow:0 4px 15px rgba(255,60,172,0.3);transition:var(--transition-fast);animation:fadeIn 0.4s ease 0.3s backwards;position:relative;overflow:hidden}
.results-btn::before{content:'';position:absolute;top:0;left:-100%;width:50%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);animation:btnShine 3s ease-in-out infinite;pointer-events:none}
@keyframes btnShine{0%{left:-100%}30%,100%{left:150%}}
.results-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(255,60,172,0.4)}
.results-btn:active{transform:scale(0.98)}
.results-share{width:100%;padding:16px;background:var(--card);border:2px solid var(--green);border-radius:14px;color:var(--green);font-size:15px;font-weight:700;cursor:pointer;transition:var(--transition-fast);animation:fadeIn 0.4s ease 0.4s backwards}
.results-share:hover{background:rgba(0,210,106,0.1);box-shadow:0 4px 15px rgba(0,210,106,0.2)}
.results-share:active{transform:scale(0.98)}
.player-count{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--green);margin-bottom:10px;font-weight:600}
.player-dot{width:8px;height:8px;border-radius:50%;background:var(--green);animation:livePulse 2s ease-in-out infinite}
@keyframes livePulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.5;transform:scale(1.2)}}
.share-platform-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:12px;animation:fadeIn 0.4s ease 0.5s backwards}
.share-platform-btn{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;padding:14px 8px;background:var(--card);border:1px solid var(--border);border-radius:12px;cursor:pointer;transition:var(--transition-fast)}
.share-platform-btn:hover{border-color:var(--pink);transform:translateY(-2px)}
.share-platform-btn:active{transform:scale(0.95)}
.share-platform-btn .icon{font-size:22px}
.share-platform-btn .label{font-size:10px;font-weight:600;color:var(--muted)}
.insights-list{text-align:left;margin:20px 0;max-height:350px;overflow-y:auto;scroll-behavior:smooth;animation:fadeIn 0.5s ease 0.3s backwards}
.insight-item{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px 14px;margin-bottom:8px;font-size:14px;line-height:1.5;transition:var(--transition-fast);position:relative;overflow:hidden}
.insight-item::before{content:'';position:absolute;left:0;top:0;bottom:0;width:2px;background:var(--grad-primary);opacity:0;transition:var(--transition-normal);pointer-events:none}
.insight-item:hover{border-color:var(--pink);transform:translateX(4px)}
.insight-item:hover::before{opacity:1}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.92);display:none;align-items:center;justify-content:center;padding:20px;z-index:100;backdrop-filter:blur(12px) saturate(180%);-webkit-backdrop-filter:blur(12px) saturate(180%);animation:modalFadeIn 0.3s ease;overflow-y:auto;overscroll-behavior:contain}
@keyframes modalFadeIn{from{opacity:0;backdrop-filter:blur(0)}to{opacity:1;backdrop-filter:blur(12px)}}
.modal.active{display:flex}
.modal-content{background:linear-gradient(180deg,rgba(40,35,60,0.98),rgba(25,20,40,0.98));border:1px solid var(--border);border-radius:20px;padding:28px;max-width:360px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,0.5),0 0 0 1px rgba(255,255,255,0.05),0 0 80px rgba(255,60,172,0.08);animation:modalSlide 0.4s var(--ease-out-back);max-height:calc(100vh - 40px);overflow-y:auto;overscroll-behavior:contain;position:relative}
.modal-content::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.1),transparent);pointer-events:none}
@keyframes modalSlide{from{transform:translateY(30px) scale(0.95);opacity:0}to{transform:translateY(0) scale(1);opacity:1}}
.modal-icon{font-size:48px;text-align:center;margin-bottom:12px;animation:iconBounce 2s infinite}
@keyframes iconBounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
.modal-title{font-size:24px;font-weight:800;text-align:center;margin-bottom:18px;background:var(--grad-primary);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:fadeIn 0.4s ease}
.feedback-box{background:rgba(0,0,0,0.4);border-radius:12px;padding:16px;margin-bottom:18px;border:1px solid var(--border);animation:fadeIn 0.3s ease}
.feedback-label{font-size:10px;color:var(--purple);text-transform:uppercase;margin-bottom:10px;font-weight:700;letter-spacing:1px;animation:fadeIn 0.3s ease}
.feedback-text{font-size:15px;line-height:1.6;animation:fadeIn 0.4s ease 0.1s backwards}
.modal-btn{width:100%;padding:16px;background:var(--grad-primary);border:none;border-radius:12px;color:#fff;font-size:16px;font-weight:700;cursor:pointer;transition:var(--transition-fast);box-shadow:0 4px 15px rgba(255,60,172,0.3);position:relative;overflow:hidden}
.modal-btn::before{content:'';position:absolute;inset:-2px;background:var(--grad-legendary);border-radius:14px;opacity:0;z-index:-1;filter:blur(8px);transition:var(--transition-normal);pointer-events:none}
.modal-btn::after{content:'';position:absolute;top:0;left:-100%;width:50%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent)}
.modal-btn:hover::before{opacity:0.5}
.modal-btn:hover::after{left:150%;transition:left 0.5s ease-out}
.modal-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(255,60,172,0.4)}
.modal-btn:active{transform:scale(0.98)}
.bonus-popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);background:var(--grad-warning);border-radius:20px;padding:30px;text-align:center;z-index:400;box-shadow:0 0 40px rgba(255,215,0,0.5)}
.bonus-popup.show{transform:translate(-50%,-50%) scale(1);animation:bonusPop 0.5s ease}
@keyframes bonusPop{0%{transform:translate(-50%,-50%) scale(0)}50%{transform:translate(-50%,-50%) scale(1.1)}100%{transform:translate(-50%,-50%) scale(1)}}
.bonus-icon{font-size:60px;margin-bottom:10px;animation:spinOnce 1s ease}
@keyframes spinOnce{from{transform:rotate(0)}to{transform:rotate(360deg)}}
.bonus-title{font-size:24px;font-weight:800;color:#000;margin-bottom:8px}
.bonus-sub{font-size:16px;color:rgba(0,0,0,0.7)}
.levelup-popup{position:fixed;inset:0;background:rgba(0,0,0,0.95);display:none;align-items:center;justify-content:center;z-index:500;backdrop-filter:blur(15px) saturate(200%)}
.levelup-popup::before{content:'';position:absolute;inset:0;background:radial-gradient(circle at 50% 50%,rgba(255,215,0,0.15) 0%,transparent 50%);animation:levelGlowPulse 2s ease-in-out infinite;pointer-events:none}
@keyframes levelGlowPulse{0%,100%{opacity:0.3;transform:scale(0.8)}50%{opacity:1;transform:scale(1.2)}}
.levelup-popup.show{display:flex}
.levelup-content{text-align:center;animation:levelUpAnim 1s ease;position:relative;z-index:1}
@keyframes levelUpAnim{0%{transform:scale(0) rotate(-10deg);opacity:0}50%{transform:scale(1.2) rotate(5deg)}100%{transform:scale(1) rotate(0);opacity:1}}
.levelup-icon{font-size:80px;margin-bottom:20px;animation:iconBounce 2s infinite;filter:drop-shadow(0 0 30px rgba(255,215,0,0.5))}
.levelup-title{font-size:36px;font-weight:900;background:linear-gradient(135deg,var(--gold),var(--orange));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:10px;text-shadow:0 0 40px rgba(255,215,0,0.3)}
.levelup-sub{font-size:18px;color:var(--muted);margin-bottom:20px}
.levelup-unlock{font-size:14px;color:var(--green);margin-bottom:20px}
.levelup-btn{padding:16px 40px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:12px;color:#fff;font-size:16px;font-weight:700;cursor:pointer;position:relative;overflow:hidden;box-shadow:0 4px 20px rgba(255,107,53,0.4)}
.levelup-btn::before{content:'';position:absolute;top:0;left:-100%;width:50%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);animation:btnShine 2s ease-in-out infinite;pointer-events:none}
.combo-display{position:fixed;top:100px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,var(--orange),var(--pink));padding:10px 20px;border-radius:20px;font-size:16px;font-weight:800;color:#fff;opacity:0;z-index:50}
.combo-display.show{opacity:1;animation:comboPop 0.5s ease}
@keyframes comboPop{0%{transform:translateX(-50%) scale(0.5)}50%{transform:translateX(-50%) scale(1.2)}100%{transform:translateX(-50%) scale(1)}}
.toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%);background:var(--grad-success);color:#fff;padding:14px 28px;border-radius:14px;font-size:14px;font-weight:600;opacity:0;transition:var(--transition-normal);z-index:500;pointer-events:none;box-shadow:0 4px 20px rgba(0,210,106,0.4),0 0 0 1px rgba(255,255,255,0.1)}
.toast::before{content:'';position:absolute;inset:-2px;background:linear-gradient(135deg,rgba(0,210,106,0.5),rgba(0,200,240,0.3));border-radius:16px;z-index:-1;filter:blur(10px);opacity:0;transition:var(--transition-normal);pointer-events:none}
.toast.show{opacity:1;transform:translateX(-50%) translateY(-10px);animation:toastBounce 0.4s ease}
.toast.show::before{opacity:1}
.qa-item{border-bottom:1px solid var(--border);padding:10px 0;transition:var(--transition-fast);position:relative}
.qa-item::before{content:'';position:absolute;left:0;top:0;bottom:0;width:2px;background:var(--grad-primary);opacity:0;transition:var(--transition-normal);pointer-events:none}
.qa-item:hover{background:rgba(255,60,172,0.03);margin:0 -10px;padding:10px}
.qa-item:hover::before{opacity:1}
.qa-item:last-of-type{border:none}
.qa-question{font-size:14px;font-weight:600;cursor:pointer;padding:6px 0;display:flex;justify-content:space-between;align-items:center;color:var(--text);gap:12px;transition:var(--transition-fast)}
.qa-question:hover{color:var(--pink)}
.qa-question::after{content:'+';color:var(--pink);font-size:20px;font-weight:700;width:28px;height:28px;background:rgba(255,60,172,0.15);border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:var(--transition-normal)}
.qa-item.open .qa-question::after{content:'−';background:rgba(255,60,172,0.3)}
.qa-answer{font-size:13px;color:var(--muted);line-height:1.7;max-height:0;overflow:hidden;transition:max-height 0.4s cubic-bezier(0.4,0,0.2,1),padding 0.3s ease,opacity 0.3s ease;opacity:0}
.qa-item.open .qa-answer{max-height:1500px;padding-top:12px;opacity:1}
.archetype-expand-item{background:var(--card);border-radius:8px;overflow:hidden;cursor:pointer;transition:all 0.2s ease}
.archetype-expand-item:hover{background:rgba(255,60,172,0.1)}
.archetype-expand-item.open{background:rgba(255,60,172,0.15)}
.archetype-expand-header{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;font-size:13px;font-weight:600;color:var(--text)}
.archetype-arrow{color:var(--pink);font-size:10px;transition:transform 0.2s ease}
.archetype-expand-item.open .archetype-arrow{transform:rotate(90deg)}
.archetype-expand-content{max-height:0;overflow:hidden;padding:0 12px;font-size:12px;color:var(--muted);line-height:1.6;transition:all 0.3s ease;opacity:0}
.archetype-expand-item.open .archetype-expand-content{max-height:150px;padding:0 12px 12px;opacity:1}
#confetti{position:fixed;inset:0;pointer-events:none;z-index:1000}
.install-banner{position:fixed;bottom:0;left:0;right:0;background:var(--grad-secondary);padding:16px 20px;display:none;align-items:center;justify-content:space-between;gap:12px;z-index:600;box-shadow:0 -4px 20px rgba(0,0,0,0.4);animation:slideUp 0.3s ease}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.install-banner.show{display:flex}
.install-banner-text{flex:1}
.install-banner-title{font-size:14px;font-weight:700;margin-bottom:2px}
.install-banner-sub{font-size:12px;color:rgba(255,255,255,0.8)}
.install-banner-btn{padding:10px 20px;background:#fff;color:var(--purple);border:none;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;white-space:nowrap}
.install-banner-close{background:none;border:none;color:rgba(255,255,255,0.6);font-size:20px;cursor:pointer;padding:4px}
.ios-modal{position:fixed;inset:0;background:rgba(0,0,0,0.92);display:none;align-items:flex-end;justify-content:center;padding:20px;z-index:700}
.ios-modal.active{display:flex}
.ios-modal-content{background:var(--card);border:1px solid var(--border);border-radius:20px 20px 0 0;padding:24px;width:100%;max-width:400px;text-align:center;animation:slideUp 0.3s ease}
.ios-modal-title{font-size:18px;font-weight:700;margin-bottom:16px}
.ios-modal-steps{text-align:left;margin:16px 0}
.ios-modal-step{display:flex;align-items:center;gap:12px;margin-bottom:12px;font-size:14px}
.ios-modal-icon{font-size:24px}
.ios-modal-btn{width:100%;padding:14px;background:var(--grad-primary);border:none;border-radius:12px;color:#fff;font-size:15px;font-weight:700;cursor:pointer;margin-top:8px;transition:var(--transition-fast)}
.ios-modal-btn:hover{transform:translateY(-2px);box-shadow:0 4px 20px rgba(255,60,172,0.3)}

/* ========== RESPONSIVE DESIGN SYSTEM ========== */
/* Mobile Small (iPhone SE, older devices) */
@media(max-width:375px){
  .hook-line{font-size:24px}
  .hook-question-title{font-size:20px}
  .hook-btn{padding:14px 36px;font-size:16px}
  .hero h1{font-size:20px}
  .score{font-size:48px}
  .stats{grid-template-columns:repeat(2,1fr);gap:8px}
  .stat-val{font-size:20px}
  .stat-label{font-size:10px}
  .action-btns{grid-template-columns:1fr}
  .ctrl-btn{width:40px;height:40px;font-size:18px}
  .controls{gap:4px}
  .mode{padding:16px}
  .mode-icon{font-size:28px}
  .mode-name{font-size:14px}
  .challenge{padding:16px}
  .challenge h2{font-size:18px}
  .recognition-item,.voice-option{padding:12px 14px;font-size:13px}
  .level-compact{padding:8px 12px}
  .level-compact-name{font-size:12px}
  .modal-content{padding:20px;margin:0;max-width:100%!important;width:100%;border-radius:16px 16px 0 0;max-height:95vh;position:fixed;bottom:0;left:0;right:0;animation:modalSlideUp 0.3s ease forwards}
  .modal{align-items:flex-end;padding:0}
  @keyframes modalSlideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
  .coaching-modal-content{border-radius:16px 16px 0 0!important;max-width:100%!important}
}
@media(max-width:340px){
  .stats{gap:4px}
  .stat{padding:10px 2px;border-radius:10px}
  .stat-val{font-size:16px}
  .stat-label{font-size:7px;letter-spacing:0}
  .modes{gap:8px}
  .mode{padding:14px 10px}
  .mode-icon{font-size:28px}
  .mode-name{font-size:12px}
  .ctrl-btn{width:32px;height:32px;font-size:14px}
  .controls{gap:6px}
}
/* Mobile Standard (iPhone, most Android) */
@media(max-width:480px){
  .hook-line{font-size:28px}
  .onboard-title{font-size:24px}
  .hero h1{font-size:22px}
  .score{font-size:56px}
  .stats{grid-template-columns:repeat(4,1fr);gap:6px}
  .stat-val{font-size:18px}
  .stat-label{font-size:9px}
  .action-btns{grid-template-columns:1fr}
  .ctrl-btn{width:44px;height:44px;font-size:20px}
  .controls{gap:6px}
}
/* Mobile Large / Phablet */
@media(min-width:481px) and (max-width:767px){
  .app{max-width:540px;padding:20px}
  .hook-line{font-size:34px}
  .hero h1{font-size:26px}
  .stats{gap:12px}
  .stat-val{font-size:26px}
  .mode{padding:22px}
  .challenge{padding:22px}
}
/* Tablet */
@media(min-width:768px){
  .app{max-width:600px;padding:24px}
  .hook-line{font-size:clamp(32px,5vw,42px)}
  .hook-question-title{font-size:28px}
  .hook-btn{padding:20px 56px;font-size:19px}
  .hero h1{font-size:28px}
  .hero p{font-size:16px}
  .stats{gap:16px}
  .stat-val{font-size:28px}
  .stat-label{font-size:11px}
  .mode{padding:24px}
  .mode-icon{font-size:40px}
  .mode-name{font-size:18px}
  .challenge{padding:24px}
  .challenge h2{font-size:22px}
  .ctrl-btn{width:48px;height:48px;font-size:22px}
  .modal-content{max-width:500px;padding:32px}
  .recognition-item,.voice-option{padding:18px 22px;font-size:15px}
}
/* iPad Portrait */
@media(min-width:768px) and (max-width:1024px) and (orientation:portrait){
  .app{max-width:560px}
  .hook-container{max-width:500px}
  .modal-content{max-width:480px}
  .levels-compact{max-width:450px}
}
/* Desktop */
@media(min-width:1024px){
  .app{max-width:640px}
  .hook-container{max-width:540px}
  .modal-content{max-width:540px}
  /* Enhanced hover states for desktop */
  .mode:hover{transform:translateY(-4px) scale(1.01)}
  .challenge:hover{transform:translateY(-3px)}
  .ctrl-btn:hover{transform:translateY(-3px) scale(1.05)}
  .recognition-item:hover,.voice-option:hover{transform:translateY(-3px)}
}
/* Large Desktop / Ultrawide */
@media(min-width:1440px){
  body{padding:40px;background:#05030a}
  .app{max-width:520px;padding:32px;border-radius:32px;margin:0 auto}
  .hook{background:linear-gradient(180deg,#0d0a1a 0%,#05030a 100%)}
  .hook-container{max-width:480px}
}
/* Extra large monitors */
@media(min-width:1800px){
  body{padding:60px}
  .app{max-width:540px}
}
/* Ultra-wide / 4K monitors */
@media(min-width:2400px){
  body{padding:80px}
  .app{max-width:560px;min-height:calc(100vh - 160px)}
}
/* Touch device optimizations */
@media(hover:none) and (pointer:coarse){
  .mode:active{transform:scale(0.98)}
  .challenge:active{transform:scale(0.99)}
  .ctrl-btn:active{transform:scale(0.92)}
  .hook-btn:active{transform:scale(0.97)}
  /* Larger touch targets */
  .ctrl-btn{min-width:44px;min-height:44px}
  .recognition-item,.voice-option{min-height:54px}
}
/* High DPI / Retina displays */
@media(-webkit-min-device-pixel-ratio:2),(min-resolution:192dpi){
  .pattern-card-share,.share-card{box-shadow:0 12px 60px rgba(255,60,172,0.25),0 0 0 0.5px rgba(255,255,255,0.1)}
}
/* Reduced motion preference */
@media(prefers-reduced-motion:reduce){
  *,*::before,*::after{animation-duration:0.01ms!important;animation-iteration-count:1!important;transition-duration:0.01ms!important}
  .hook-line,.hook-btn,.recognition-item,.voice-option{animation:none!important;opacity:1!important;transform:none!important}
}
/* Dark mode enhancements */
@media(prefers-color-scheme:dark){
  .modal-content{background:rgba(20,16,35,0.98)}
  .card{background:rgba(25,20,42,0.95)}
}
/* Landscape mobile */
@media(max-height:500px) and (orientation:landscape){
  .hook-container{padding-top:12px;padding-bottom:12px}
  .hook-screen{padding:12px 0}
  .hook-line{font-size:24px;margin-bottom:2px}
  .hook-btn{padding:12px 32px}
  .recognition-grid,.voice-options{max-height:40vh;overflow-y:auto}
}
/* Small screen height fix for intro screens */
@media(max-height:700px){
  .hook-screen-scrollable{padding-top:16px;padding-bottom:24px}
  .hook-container{justify-content:flex-start;padding-top:16px}
  .levels-compact{max-height:50vh;overflow-y:auto}
  .hook-question-title{font-size:20px;margin-bottom:4px}
  .hook-question-sub{font-size:13px;margin-bottom:12px}
  .level-compact{padding:8px 12px}
  .level-detail{padding:8px 10px;font-size:11px}
}

/* Safe area insets for notched devices */
@supports(padding:max(0px)){
  .app{padding-left:max(16px,env(safe-area-inset-left));padding-right:max(16px,env(safe-area-inset-right));padding-bottom:max(40px,env(safe-area-inset-bottom))}
  .hook{padding:max(24px,env(safe-area-inset-top)) max(24px,env(safe-area-inset-right)) max(24px,env(safe-area-inset-bottom)) max(24px,env(safe-area-inset-left))}
}

/* Utility Classes */
.hidden{display:none!important}
.fade-in{animation:fadeIn 0.5s ease}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}

/* Skip Link for Accessibility */
.skip-link{position:absolute;top:-50px;left:16px;background:var(--pink);color:#fff;padding:12px 20px;border-radius:8px;font-weight:600;z-index:99999;transition:top 0.3s ease;text-decoration:none}
.skip-link:focus{top:16px}

/* Focus-visible states for keyboard accessibility */
.choice:focus-visible,.hook-btn:focus-visible,.modal-btn:focus-visible,.recognition-item:focus-visible,.voice-option:focus-visible{outline:2px solid var(--pink);outline-offset:2px}
.ctrl-btn:focus-visible,.level:focus-visible,.mode:focus-visible{outline:2px solid var(--pink);outline-offset:2px}

/* ========== ONBOARDING TOOLTIPS ========== */
.onboard-tooltip{position:fixed;top:-9999px;left:-9999px;background:linear-gradient(135deg,var(--orange),var(--pink));color:#fff;padding:12px 16px;border-radius:12px;font-size:13px;font-weight:600;z-index:10000;opacity:0;visibility:hidden;transition:opacity 0.3s cubic-bezier(0.16,1,0.3,1),visibility 0.3s;pointer-events:none;max-width:200px;text-align:center;box-shadow:0 4px 20px rgba(255,60,172,0.4)}
.onboard-tooltip.show{opacity:1;visibility:visible;pointer-events:auto}
.onboard-tooltip::after{content:'';position:absolute;width:0;height:0;border:8px solid transparent}
.onboard-tooltip.arrow-up::after{top:-16px;left:50%;transform:translateX(-50%);border-bottom-color:var(--orange)}
.onboard-tooltip.arrow-down::after{bottom:-16px;left:50%;transform:translateX(-50%);border-top-color:var(--pink)}
.onboard-tooltip.arrow-left::after{left:-16px;top:50%;transform:translateY(-50%);border-right-color:var(--orange)}
.onboard-tooltip.arrow-right::after{right:-16px;top:50%;transform:translateY(-50%);border-left-color:var(--pink)}
.onboard-tooltip-btn{display:inline-block;margin-top:10px;padding:8px 16px;background:rgba(255,255,255,0.2);border:none;border-radius:8px;color:#fff;font-size:12px;font-weight:700;cursor:pointer;transition:all 0.2s}
.onboard-tooltip-btn:hover{background:rgba(255,255,255,0.3)}
.onboard-overlay{position:fixed;inset:0;background:rgba(13,10,26,0.7);z-index:9998;opacity:0;visibility:hidden;transition:opacity 0.3s ease,visibility 0.3s ease;pointer-events:none}
.onboard-overlay.show{opacity:1;visibility:visible;pointer-events:auto}
.onboard-highlight{position:relative;z-index:9999;animation:highlightPulse 1.5s ease-in-out infinite}
@keyframes highlightPulse{0%,100%{box-shadow:0 0 0 4px rgba(255,60,172,0.4)}50%{box-shadow:0 0 0 8px rgba(255,60,172,0.2)}}

/* Press Ticker - Scrolling "As Seen On" */
.press-ticker{margin-top:24px;overflow:hidden;opacity:0;animation:fadeInTicker 1s ease 2s forwards;max-width:100%;position:relative}
@keyframes fadeInTicker{to{opacity:1}}
.press-ticker-label{text-align:center;font-size:10px;color:rgba(255,255,255,0.4);text-transform:uppercase;letter-spacing:2px;margin-bottom:8px}
.press-ticker-track{display:flex;width:max-content;animation:tickerScroll 20s linear infinite}
@keyframes tickerScroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
.press-ticker-track:hover{animation-play-state:paused}
.press-ticker-item{display:flex;align-items:center;justify-content:center;padding:0 20px;height:24px}
.press-ticker-item img{height:18px;width:auto;opacity:0.7;transition:opacity 0.3s}
.press-ticker-item img:hover{opacity:0.9}
#hookScreen1{padding-bottom:10px}

/* ============ PRINT STYLES ============ */
#printContainer{display:none;position:absolute;left:-9999px}
@media print{
  *{-webkit-print-color-adjust:exact!important;print-color-adjust:exact!important;color-adjust:exact!important}
  html,body{background:#fff!important;margin:0!important;padding:0!important}
  /* Hide everything except print container */
  body>*:not(#printContainer){display:none!important;visibility:hidden!important}
  #printContainer{display:block!important;visibility:visible!important;position:static!important;left:0!important;padding:0!important;margin:0!important;background:#fff!important}
  #printContainer *{display:block!important;visibility:visible!important}
  .print-page{display:block!important;padding:40px;max-width:100%;font-family:'Inter',system-ui,-apple-system,sans-serif;color:#1a1a1a;background:#fff}
  .print-header{display:block!important;text-align:center;margin-bottom:32px;padding-bottom:24px;border-bottom:3px solid #784BA0}
  .print-header-icon{display:block!important;font-size:40px;margin-bottom:8px}
  .print-logo{display:block!important;font-size:32px;font-weight:900;color:#784BA0;letter-spacing:2px}
  .print-subtitle{display:block!important;font-size:14px;color:#666;margin-top:4px}
  .print-date{display:block!important;font-size:12px;color:#999;margin-top:8px}
  .print-archetype-box{display:block!important;background:linear-gradient(135deg,#f8f5ff,#fff5f8);border:2px solid #784BA0;border-radius:16px;padding:24px;margin-bottom:24px;text-align:center}
  .print-archetype-icon{display:block!important;font-size:48px;margin-bottom:12px}
  .print-archetype-name{display:block!important;font-size:22px;font-weight:800;color:#FF3CAC;margin-bottom:4px}
  .print-archetype-subtitle{display:block!important;font-size:12px;color:#666;text-transform:uppercase;letter-spacing:1px}
  .print-archetype-edge{display:block!important;font-size:14px;color:#444;line-height:1.6;margin-top:12px;font-style:italic}
  .print-stats-row{display:flex!important;gap:16px;margin-bottom:24px;flex-wrap:wrap}
  .print-stat-box{display:block!important;flex:1;min-width:100px;background:#f8f5ff;border-radius:12px;padding:16px;text-align:center;border:1px solid #e0d8f0}
  .print-stat-value{display:block!important;font-size:28px;font-weight:800;color:#784BA0}
  .print-stat-label{display:block!important;font-size:11px;color:#666;text-transform:uppercase;letter-spacing:0.5px;margin-top:4px}
  .print-section{display:block!important;margin-bottom:24px;page-break-inside:avoid}
  .print-section-title{display:flex!important;font-size:14px;font-weight:700;color:#784BA0;margin-bottom:12px;padding-bottom:8px;border-bottom:2px solid #e0d8f0;align-items:center;gap:8px}
  .print-insights-level{display:block!important;background:#f8f5ff;border-radius:12px;padding:16px;margin-bottom:16px;border-left:4px solid #784BA0}
  .print-insights-level-header{display:flex!important;font-size:13px;font-weight:700;color:#333;margin-bottom:10px;justify-content:space-between;align-items:center}
  .print-insights-level-count{display:inline-block!important;background:#784BA0;color:#fff;padding:2px 8px;border-radius:10px;font-size:11px}
  .print-insight-item{display:block!important;font-size:12px;color:#444;padding:6px 0;border-bottom:1px solid #eee;line-height:1.5}
  .print-insight-item:last-child{border-bottom:none}
  .print-insight-fav{color:#FF3CAC}
  .print-more-insights{display:block!important;font-size:11px;color:#999;font-style:italic;margin-top:8px}
  .print-favorites{display:block!important;background:#fff5f8;border:2px solid #FF3CAC;border-radius:12px;padding:16px;margin-top:24px}
  .print-favorites-title{display:block!important;font-size:14px;font-weight:700;color:#FF3CAC;margin-bottom:12px}
  .print-favorite-item{display:block!important;font-size:13px;color:#333;padding:8px 12px;background:#fff;border-radius:8px;margin-bottom:8px;border-left:3px solid #FF3CAC}
  .print-footer{display:block!important;text-align:center;margin-top:40px;padding-top:24px;border-top:2px solid #e0d8f0}
  .print-footer-brand{display:block!important;font-size:12px;color:#666}
  .print-footer-tagline{display:block!important;font-size:11px;color:#999;margin-top:4px;font-style:italic}
  .print-themes-row{display:flex!important;flex-wrap:wrap;gap:8px;margin-bottom:16px}
  .print-theme-tag{display:inline-block!important;padding:6px 12px;border-radius:20px;font-size:11px;font-weight:600}
  .print-wounds{display:block!important;margin-bottom:16px}
  .print-wound-item{display:block!important;background:#fff0f0;border-left:3px solid #FF4757;padding:10px 12px;margin-bottom:8px;font-size:12px;border-radius:0 8px 8px 0}
  .print-wound-theme{display:block!important;font-size:10px;color:#999;margin-top:4px}
  .print-coaching-section{display:block!important;background:#f0f9ff;border:2px solid #2F80ED;border-radius:12px;padding:16px;margin-top:24px;page-break-inside:avoid}
  .print-coaching-title{display:block!important;font-size:14px;font-weight:700;color:#2F80ED;margin-bottom:12px}
  .print-coaching-notes{display:block!important;font-size:12px;color:#333;line-height:1.6}
  .print-challenge-box{display:block!important;background:#fffbeb;border:2px solid #F7C948;border-radius:12px;padding:16px;margin-top:16px}
  .print-challenge-title{display:block!important;font-size:12px;font-weight:700;color:#F7C948;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px}
  .print-challenge-text{display:block!important;font-size:13px;color:#333;line-height:1.6}
  .print-contradiction{display:block!important;background:#f0fdff;border:2px solid #00D8FF;border-radius:12px;padding:16px;margin-bottom:16px}
  .print-contradiction-title{display:block!important;font-size:12px;font-weight:700;color:#00D8FF;margin-bottom:8px}
  .print-contradiction-text{display:block!important;font-size:13px;color:#333;line-height:1.6}
  .print-summary-box{display:block!important;background:linear-gradient(135deg,rgba(120,75,160,0.1),rgba(255,60,172,0.05));border:2px solid #784BA0;border-radius:12px;padding:16px;margin-bottom:24px}
  .print-summary-text{display:block!important;font-size:14px;color:#333;line-height:1.7}
}
#langDropdown.open{display:block!important;animation:fadeIn 0.15s ease}
</style></head>
<body>
<a href="#main-content" class="skip-link">Skip to content</a>
<div id="printContainer" style="display:none;"></div>
<canvas id="confetti"></canvas>
<div class="install-banner" id="installBanner">
<button class="install-banner-close" id="installClose" aria-label="Close install banner">×</button>
<div class="install-banner-text">
<div class="install-banner-title">📲 Add to Home Screen</div>
<div class="install-banner-sub">Play daily without opening browser</div>
</div>
<button class="install-banner-btn" id="installBtn" aria-label="Install Level Up app">Install</button>
</div>
<div class="ios-modal" id="iosModal">
<div class="ios-modal-content">
<div class="ios-modal-title">Add Level Up to Home Screen</div>
<div class="ios-modal-steps">
<div class="ios-modal-step"><span class="ios-modal-icon">📤</span><span>Tap the <strong>Share</strong> button below</span></div>
<div class="ios-modal-step"><span class="ios-modal-icon">➕</span><span>Scroll and tap <strong>"Add to Home Screen"</strong></span></div>
<div class="ios-modal-step"><span class="ios-modal-icon">✓</span><span>Tap <strong>Add</strong> in the top right</span></div>
</div>
<button class="ios-modal-btn" id="iosClose">Got it!</button>
</div>
</div>
<audio id="introMusic" loop><source src="intro.mp3" type="audio/mpeg"></audio>
<audio id="music" loop><source src="level-up.mp3" type="audio/mpeg"></audio>
<div class="toast" id="toast">+10 XP!</div>
<div class="combo-display" id="comboDisplay">🔥 3x COMBO!</div>
<div class="bonus-popup" id="bonusPopup"><div class="bonus-icon">🎁</div><div class="bonus-title">BONUS!</div><div class="bonus-sub" id="bonusText">+25 XP</div></div>
<div class="levelup-popup" id="levelupPopup"><div class="levelup-content"><div class="levelup-icon" id="levelupIcon">⭐</div><div class="levelup-title">LEVEL UP!</div><div class="levelup-sub" id="levelupText">You're now Level 2</div><div class="levelup-unlock" id="levelupUnlock"></div><div style="display:flex;gap:10px;width:100%;"><button class="levelup-btn" id="levelupBtn" style="flex:1;" aria-label="Continue playing">Continue</button><button class="levelup-btn" id="levelupShareBtn" style="flex:1;background:linear-gradient(135deg,var(--green),#00B85D);" aria-label="Share your level up">📤 Share</button></div></div></div>

<div class="hook" id="hook">
<!-- Logo Splash - positioned relative to hook overlay, not container -->
<div class="hook-logo" id="hookLogo">
<img src="icon-512.png" alt="Levels of Self" width="320" height="320">
</div>
<div class="hook-container">
<!-- Screen 1: The Hook -->
<div class="hook-screen active" id="hookScreen1">
<div class="hook-line" id="line1">See the patterns</div>
<div class="hook-line" id="line2">that quietly run<br>your life.</div>
<div class="hook-sub" id="hookSub" style="color:var(--gold);font-weight:600;">Get clarity. Save time. Stop the cycle.</div>
<button class="hook-btn" id="hookBtn" aria-label="Start the experience">Prove it</button>
<div class="press-ticker">
<div class="press-ticker-label">As Seen On</div>
<div class="press-ticker-track">
<div class="press-ticker-item"><img src="ap.svg" alt="AP News" loading="lazy" width="60" height="18"></div>
<div class="press-ticker-item"><img src="google.svg" alt="Google News" loading="lazy" width="60" height="18"></div>
<div class="press-ticker-item"><img src="yahoo.svg" alt="Yahoo" loading="lazy" width="60" height="18"></div>
<div class="press-ticker-item"><img src="bloomberg.svg" alt="Bloomberg" loading="lazy" width="60" height="18"></div>
<div class="press-ticker-item"><img src="ap.svg" alt="AP News" loading="lazy" width="60" height="18"></div>
<div class="press-ticker-item"><img src="google.svg" alt="Google News" loading="lazy" width="60" height="18"></div>
<div class="press-ticker-item"><img src="yahoo.svg" alt="Yahoo" loading="lazy" width="60" height="18"></div>
<div class="press-ticker-item"><img src="bloomberg.svg" alt="Bloomberg" loading="lazy" width="60" height="18"></div>
</div>
</div>
<div class="lang-toggle" id="langToggle" style="display:flex;justify-content:center;margin-top:16px;position:relative;opacity:0;transition:opacity 0.5s ease;">
<button id="langDropBtn" onclick="document.getElementById('langDropdown').classList.toggle('open')" style="padding:8px 18px;border-radius:20px;border:1px solid var(--border);background:linear-gradient(135deg,var(--blue),var(--purple));color:#fff;font-size:13px;font-weight:700;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:6px;">🇺🇸 English <span style="font-size:10px;opacity:0.8;">▼</span></button>
<div id="langDropdown" style="display:none;position:absolute;bottom:100%;left:50%;transform:translateX(-50%);margin-bottom:6px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:6px;min-width:180px;z-index:100;box-shadow:0 8px 24px rgba(0,0,0,0.4);">
<div onclick="setLanguage('en');document.getElementById('langDropdown').classList.remove('open')" class="lang-opt" data-lang="en" style="padding:10px 14px;border-radius:8px;cursor:pointer;font-size:13px;font-weight:600;color:var(--text);text-align:center;margin-bottom:2px;">🇺🇸 English</div>
<div onclick="setLanguage('nl');document.getElementById('langDropdown').classList.remove('open')" class="lang-opt" data-lang="nl" style="padding:10px 14px;border-radius:8px;cursor:pointer;font-size:13px;font-weight:600;color:var(--text);text-align:center;margin-bottom:2px;">🇳🇱 Nederlands</div>
<div onclick="setLanguage('es');document.getElementById('langDropdown').classList.remove('open')" class="lang-opt" data-lang="es" style="padding:10px 14px;border-radius:8px;cursor:pointer;font-size:13px;font-weight:600;color:var(--text);text-align:center;margin-bottom:2px;">🇪🇸 Español</div>
<div style="height:1px;background:var(--border);margin:4px 8px;"></div>
<div onclick="setLanguage('ko');document.getElementById('langDropdown').classList.remove('open')" style="padding:10px 14px;border-radius:8px;cursor:pointer;font-size:13px;color:var(--muted);text-align:center;opacity:0.5;">🇰🇷 한국어 <span style="font-size:10px;">coming soon</span></div>
<div onclick="setLanguage('hy');document.getElementById('langDropdown').classList.remove('open')" style="padding:10px 14px;border-radius:8px;cursor:pointer;font-size:13px;color:var(--muted);text-align:center;opacity:0.5;">🇦🇲 Հայdelays <span style="font-size:10px;">coming soon</span></div>
<div onclick="setLanguage('ru');document.getElementById('langDropdown').classList.remove('open')" style="padding:10px 14px;border-radius:8px;cursor:pointer;font-size:13px;color:var(--muted);text-align:center;opacity:0.5;">🇷🇺 Русский <span style="font-size:10px;">coming soon</span></div>
</div>
</div>
</div>
<div class="hook-screen" id="hookScreen2">
<div class="hook-music-controls" id="hookMusicControls">
<button class="hook-music-btn on" id="hookMusicToggle" onclick="toggleHookMusic()" title="Toggle game music">🎵</button>
<button class="hook-music-btn spotify" onclick="openSpotify()" title="Open Spotify"><svg class="hook-music-logo" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/></svg></button>
<button class="hook-music-btn apple" onclick="openAppleMusic()" title="Open Apple Music"><svg class="hook-music-logo" viewBox="0 0 24 24" fill="currentColor"><path d="M23.994 6.124a9.23 9.23 0 00-.24-2.19c-.317-1.31-1.062-2.31-2.18-3.043a5.022 5.022 0 00-1.877-.726 10.496 10.496 0 00-1.564-.15c-.04-.003-.083-.01-.124-.013H5.986c-.152.01-.303.017-.455.026-.747.043-1.49.123-2.193.401-1.336.53-2.3 1.452-2.865 2.78-.192.448-.292.925-.363 1.408-.056.392-.088.785-.1 1.18 0 .032-.007.062-.01.093v12.223c.01.14.017.283.027.424.05.815.154 1.624.497 2.373.65 1.42 1.738 2.353 3.234 2.801.42.127.856.187 1.293.228.555.053 1.11.06 1.667.06h11.03c.525 0 1.048-.034 1.57-.1.823-.106 1.597-.35 2.296-.81.84-.553 1.472-1.287 1.88-2.208.186-.42.293-.87.37-1.324.113-.675.138-1.358.137-2.04-.002-3.8 0-7.595-.003-11.393zm-6.423 3.99v5.712c0 .417-.058.827-.244 1.206-.29.59-.76.962-1.388 1.14-.35.1-.706.157-1.07.173-.95.042-1.785-.455-2.105-1.392-.223-.657-.098-1.272.344-1.81.38-.463.9-.713 1.486-.81.543-.09 1.09-.14 1.635-.212.207-.03.4-.09.555-.232.168-.155.212-.357.212-.57v-5.478c0-.098-.027-.152-.127-.172-.376-.074-.75-.154-1.124-.232l-3.89-.804c-.076-.016-.155-.026-.235-.026-.096 0-.126.036-.127.132-.003.25 0 .5 0 .75v8.133c0 .504-.065.998-.283 1.46-.306.65-.822 1.04-1.524 1.203-.34.08-.686.12-1.034.13-1.022.025-1.907-.53-2.18-1.526-.165-.603-.082-1.177.305-1.69.376-.498.888-.763 1.47-.87.508-.094 1.022-.144 1.533-.217.32-.046.617-.14.835-.393.146-.17.2-.373.2-.59V6.266c0-.305.048-.39.34-.453l5.727-1.185c.206-.043.413-.085.622-.1.186-.014.234.028.234.215v5.37z"/></svg></button>
</div>
<div class="hook-progress"><span class="h-dot active"></span><span class="h-dot"></span><span class="h-dot"></span></div>
<div class="hook-question-title">Have you ever<br>felt like...</div>
<div class="hook-question-sub">Select all that feel true</div>
<div class="recognition-grid" id="recognitionGrid">
<div class="recognition-item" data-pattern="success-empty" onclick="toggleRecognition(this)">You're successful on paper, but something essential is missing?</div>
<div class="recognition-item" data-pattern="repeat" onclick="toggleRecognition(this)">You've tried everything, but the same patterns keep repeating?</div>
<div class="recognition-item" data-pattern="help-others" onclick="toggleRecognition(this)">You're great at helping others, but can't seem to help yourself?</div>
<div class="recognition-item" data-pattern="more" onclick="toggleRecognition(this)">There has to be more to life than this?</div>
<div class="recognition-item" data-pattern="dying-inside" onclick="toggleRecognition(this)">Everyone thinks you're doing great... but you're dying inside?</div>
</div>
<button class="hook-btn show" onclick="continueFromRecognition()">Continue</button>
<div class="validation-hint" id="recognitionHint">Please select at least one</div>
</div>
<!-- Screen 3: Inner Voice -->
<div class="hook-screen" id="hookScreen3">
<div class="hook-progress"><span class="h-dot done"></span><span class="h-dot active"></span><span class="h-dot"></span></div>
<div class="hook-question-title">Do you ever<br>ask yourself...</div>
<div class="hook-question-sub">Select all that resonate with you</div>
<div class="voice-options" id="voiceOptions">
<div class="voice-option" data-voice="not-enough" onclick="toggleVoice(this)">"Why am I not enough, no matter how much I achieve?"</div>
<div class="voice-option" data-voice="alone" onclick="toggleVoice(this)">"Why do I feel so alone, even when surrounded by people?"</div>
<div class="voice-option" data-voice="success-unhappy" onclick="toggleVoice(this)">"What's the point of all this success if I'm still unhappy?"</div>
<div class="voice-option" data-voice="made-it" onclick="toggleVoice(this)">"When will I finally feel like I've made it?"</div>
<div class="voice-option" data-voice="all-there-is" onclick="toggleVoice(this)">"Is this really all there is?"</div>
</div>
<div class="hook-btn-row">
<button class="hook-btn-secondary" onclick="showHookScreen(2)"><span class="back-arrow">⬅</span> Back</button>
<button class="hook-btn show" onclick="continueFromVoice()">Continue</button>
</div>
<div class="validation-hint" id="voiceHint">Please select at least one</div>
</div>
<!-- Screen 4: The Explanation -->
<div class="hook-screen hook-screen-scrollable" id="hookScreen4">
<div class="hook-progress"><span class="h-dot done"></span><span class="h-dot done"></span><span class="h-dot active"></span><span class="h-dot"></span></div>
<div class="hook-question-title">This isn't a flaw.</div>
<div class="hook-question-sub">It's a signal you're solving the problem at the wrong level.</div>
<button class="scroll-bottom-btn" onclick="document.querySelector('.levels-compact').scrollIntoView({behavior:'smooth',block:'start'})">⬇</button>
<div class="levels-intro">Tap each level to learn more:</div>
<div class="levels-compact">
<div class="level-compact" onclick="toggleLevelInfo(this, 1)" data-level="1"><div class="level-dot" style="background:#FF6B35">1</div><div class="level-compact-info"><span class="level-compact-name">Individual</span><span class="level-compact-desc">Self for yourself</span></div></div>
<div class="level-detail" id="levelDetail1">Self for yourself: your feelings, your life, your beliefs, your needs, your wants. Before you can show up for anyone else, you have to show up for yourself. This means having non-negotiables, things you do for yourself every day, no matter what. It's not selfish. It's required. If this level isn't solid, everything above it is unstable.</div>
<div class="level-compact" onclick="toggleLevelInfo(this, 2)" data-level="2"><div class="level-dot" style="background:#FF3CAC">2</div><div class="level-compact-info"><span class="level-compact-name">Family</span><span class="level-compact-desc">Your created or immediate family</span></div></div>
<div class="level-detail" id="levelDetail2">Self for family: either the family you were born into OR the family you have created (spouse, kids). If you've created your own family, they become Level 2, and your family of origin moves to Level 3. These are the people who see you at your best and worst. You can't skip to community impact if things are incomplete here.</div>
<div class="level-compact" onclick="toggleLevelInfo(this, 3)" data-level="3"><div class="level-dot" style="background:#784BA0">3</div><div class="level-compact-info"><span class="level-compact-name">Groups</span><span class="level-compact-desc">Extended family, friends, coworkers</span></div></div>
<div class="level-detail" id="levelDetail3">Self for group: extended family members, friends, relatives, coworkers, and groups you belong to. If you've created your own family, your parents and siblings now live here. The question: Are you being yourself, or performing a version of yourself to fit in, or hiding entirely? The first 3 levels represent 90% of everyday life.</div>
<div class="level-compact" onclick="toggleLevelInfo(this, 4)" data-level="4"><div class="level-dot" style="background:#2F80ED">4</div><div class="level-compact-info"><span class="level-compact-name">Community</span><span class="level-compact-desc">Activities and events</span></div></div>
<div class="level-detail" id="levelDetail4">Self for community: mostly seen as activities, events, and classes of people you identify with: musicians, business people, athletes, artists, your industry. Where you belong beyond personal relationships. Do you have a role, and do you respect the roles of others?</div>
<div class="level-compact" onclick="toggleLevelInfo(this, 5)" data-level="5"><div class="level-dot" style="background:#00D26A">5</div><div class="level-compact-info"><span class="level-compact-name">Society</span><span class="level-compact-desc">Nation & systems</span></div></div>
<div class="level-detail" id="levelDetail5">Self for society: the people of your nation and its systems: government, economy, culture, laws. This level is about seeing reality clearly. Not what you wish was true. Not what you're fighting against. What actually is. You can't change what you won't first accept.</div>
<div class="level-compact" onclick="toggleLevelInfo(this, 6)" data-level="6"><div class="level-dot" style="background:#F7C948">6</div><div class="level-compact-info"><span class="level-compact-name">World</span><span class="level-compact-desc">Global stage</span></div></div>
<div class="level-detail" id="levelDetail6">Self for world: the global stage: international politics, global events, other nations, other cultures, humanity as a whole. How connected do you feel to what happens outside your borders? This isn't about being an activist. It's about recognizing you're part of something larger than your own life.</div>
<div class="level-compact" onclick="toggleLevelInfo(this, 7)" data-level="7"><div class="level-dot" style="background:#C0C0C0">7</div><div class="level-compact-info"><span class="level-compact-name">Generations</span><span class="level-compact-desc">Those before you and after</span></div></div>
<div class="level-detail" id="levelDetail7">Self for generations: the people who came before you (ancestors) and those who will come after. This is legacy. What cycles did you inherit? What cycles will you break? What will you build that outlasts you? Legacy isn't always a building. Sometimes it's a pattern you refused to repeat.</div>
</div>
<div class="reveal-cta">The game shows you which level your pattern lives on, so you can finally change it.</div>
<div class="hook-btn-row">
<button class="hook-btn-secondary" onclick="showHookScreen(3)"><span class="back-arrow">⬅</span> Back</button>
<button class="hook-btn show" onclick="showHookScreen(5)">See My Pattern</button>
</div>
</div>
<!-- Screen 5: The Shareable Pattern Card -->
<div class="hook-screen" id="hookScreen5">
<div class="hook-progress"><span class="h-dot done"></span><span class="h-dot done"></span><span class="h-dot done"></span><span class="h-dot active"></span></div>
<div class="reveal-label-top">Your Pattern</div>
<div class="pattern-card-container">
<div class="pattern-card-share">
<div class="card-glow"></div>
<div class="card-content-share">
<div class="pattern-icon-share" id="revealIcon">🪞</div>
<div class="pattern-name-share" id="revealPattern">The Honest Avoider</div>
<div class="pattern-tagline-share" id="revealInsight">"I see myself clearly but struggle to act on what I see."</div>
<div class="card-divider"></div>
<div class="card-footer-share">
<span class="footer-question">What's yours?</span>
<span class="footer-url">100levelup.com</span>
</div>
</div>
</div>
</div>
<button class="start-playing-btn" id="startGameBtn">Start Playing →</button>
<div class="share-buttons">
<button class="share-btn" onclick="shareEntryPattern()"><span class="share-btn-icon">📤</span> Share My Pattern</button>
</div>
</div>
</div>
</div>

<div class="offline-badge" id="offlineBadge">📡 Offline Mode</div>
<!-- Onboarding Overlay - outside .app to prevent scroll interference -->
<div class="onboard-overlay" id="onboardOverlay"></div>
<div class="app" id="main-content">
<div class="home" id="home">
<div class="header"><div class="logo" role="banner" id="logoRateBtn" title="⭐ Rate Level Up">LEVEL UP</div><div class="controls"><button class="ctrl-btn" id="musicBtn" aria-label="Toggle Music">🎵</button><button class="ctrl-btn heart-btn" id="aiBtn" aria-label="Deep Insight Analysis">❤️</button><button class="ctrl-btn qa-btn" id="qaBtn" aria-label="Help and FAQ">❓</button><button class="ctrl-btn" id="lilyBtn" onclick="openLily()" aria-label="Lily - Self-Awareness Coach" title="Lily - Self-Awareness Coach" style="background:linear-gradient(135deg,#a855f7,#ec4899);color:#fff;border:none;padding:0;overflow:hidden;"><img src="Lily_Bot.jpg" alt="Lily" style="width:100%;height:100%;object-fit:cover;border-radius:inherit;"></button><button class="ctrl-btn founder-btn" id="founderBtn" aria-label="Meet the Founder">👤</button></div></div>

<div class="login-bonus" id="loginBonus"><div class="login-title">🎁 Daily Login Bonus!</div><div class="login-sub">Tap to claim <span id="loginReward">+20 XP</span></div></div>
<div class="streak-warning" id="streakWarning"><div class="streak-warning-text">⚠️ Play today or lose your <span id="streakCount">0</span>-day streak!</div></div>

<!-- Coaching Bridge (injected dynamically) -->
<div class="coaching-bridge" id="coachingBridge">
<div class="bridge-header">
<span class="bridge-icon">🔄</span>
<span class="bridge-label">Pattern Detected</span>
</div>
<div class="bridge-title">This keeps showing up.</div>
<div class="bridge-pattern-count" id="bridgePatternCount">
<span>⚡</span>
<span id="bridgePatternText">Self-worth pattern appeared 3 times recently</span>
</div>
<div class="bridge-insight">
<strong>You're seeing it clearly now.</strong> That's the first step. But seeing a pattern and breaking it are two different things.
</div>
<div class="bridge-cta">Most people can't break lifelong patterns alone. That's not weakness. It's how patterns work.</div>
<div class="bridge-btns">
<a href="https://wa.me/+18184399770?text=Hi%20Arthur%2C%20I%27ve%20been%20playing%20Level%20Up%20and%20I%20keep%20seeing%20the%20same%20patterns.%20Can%20we%20talk%3F" target="_blank" class="bridge-btn primary">Talk to Arthur →</a>
<button class="bridge-btn secondary" onclick="dismissCoachingBridge()">Keep Playing</button>
</div>
<div class="bridge-dismiss"><a href="#" onclick="dismissCoachingBridge();return false;">Remind me later</a></div>
</div>

<div class="hero">
<div id="welcomeMessage" style="display:none;font-size:14px;font-weight:600;color:var(--gold);margin-bottom:8px;"></div>
<div id="dailyWisdom" style="display:none;font-size:13px;font-style:italic;color:var(--muted);margin-bottom:12px;padding:10px 16px;background:rgba(255,255,255,0.03);border-radius:10px;border-left:3px solid var(--pink);max-width:320px;margin-left:auto;margin-right:auto;"></div>
<h1>See Your Patterns</h1><p style="max-width:320px;margin:0 auto;line-height:1.4;">The game that reveals<br>what's really running your life.</p></div>

<div class="challenge" id="dailyCard" role="button" aria-label="Play Worldwide Challenge - Same 3 scenarios for everyone on Earth"><h2>Worldwide Challenge</h2><div class="player-count" style="justify-content:center;"><span class="player-dot"></span>Trending Globally</div><p>Same 3 scenarios for everyone on Earth. One chance daily.</p><div class="challenge-footer"><span id="dailyCta">Tap to join the global movement</span><span id="dailyTimer" style="color:var(--gold);font-weight:700;">Resets in --:--:--</span></div></div>

<div class="modes"><div class="mode" id="mirrorMode" role="button" aria-label="Play Mirror Game - See yourself honestly"><div class="mode-icon" style="font-family:'Apple Color Emoji','Segoe UI Emoji','Noto Color Emoji',sans-serif;">🪞</div><div class="mode-name">Mirror Game</div><div class="mode-desc" style="color:var(--gold);">See yourself honestly</div><div class="mode-unlock" id="mirrorUnlock"></div></div><div class="mode" id="agreementMode" role="button" aria-label="Play Agreement Game - Practice acceptance vs judgment"><div class="mode-icon" style="font-family:'Apple Color Emoji','Segoe UI Emoji','Noto Color Emoji',sans-serif;">⚖️</div><div class="mode-name">Agreement Game</div><div class="mode-desc">Acceptance vs Judgment</div><div class="mode-unlock" id="agreementUnlock"></div></div></div>

<div class="xp-container" onclick="showXpDetails()" style="cursor:pointer;"><div class="xp-header"><div class="xp-level" id="playerLevel">Level 1</div><div class="xp-coins" onclick="event.stopPropagation();showCoinShop();"><span id="coinCount">0</span> <span style="color:var(--gold);">coins</span></div></div><div class="xp-bar"><div class="xp-fill" id="xpFill" style="width:0%"></div></div><div class="xp-text"><span id="xpCurrent">0</span> / <span id="xpNeeded">750</span> XP</div></div>

<div class="stats"><div class="stat" onclick="showStatDetails('played')" style="cursor:pointer;"><div class="stat-val" id="statPlayed">0</div><div class="stat-label">Played</div></div><div class="stat" onclick="showStatDetails('streak')" style="cursor:pointer;"><div class="stat-val" id="statStreak">0</div><div class="stat-label">Streak 🔥</div></div><div class="stat" onclick="showStatDetails('acceptance')" style="cursor:pointer;"><div class="stat-val" id="statAcceptRate">0%</div><div class="stat-label">Acceptance</div></div><div class="stat insights-stat" id="insightsStat"><div class="stat-val" id="statInsights">0</div><div class="stat-label">Insights</div></div></div>

<div class="pattern-card" id="patternCard" style="display:none;">
<div class="pattern-header"><span class="pattern-icon" id="patternIcon">🔮</span><span class="pattern-label">Your Pattern</span></div>
<div class="pattern-archetype" id="patternArchetype">The Aware One</div>
<div class="pattern-edge" id="patternEdge">You see yourself clearly. Now the question is: what will you do with what you see?</div>
<div class="pattern-challenge">
<div class="pattern-challenge-label">Today's Practice</div>
<div class="pattern-challenge-text" id="patternChallenge">Notice one moment today when a pattern you recognized shows up. You don't have to change it. Just notice.</div>
</div>
<div class="pattern-tap">Tap for full profile →</div>
</div>

<div class="section-title">Your Journey</div>
<div class="levels" id="levelMap"></div>

<div class="action-btns"><button class="action-btn breakthrough" id="breakthroughBtn" onclick="document.getElementById('breakthroughModal').classList.add('active')" aria-label="Breakthrough Work exercises"><span class="action-btn-icon">🔥</span><span class="action-btn-text">Breakthrough Work</span></button><button class="action-btn team" id="teamBtn" onclick="document.getElementById('teamModal').classList.add('active')" aria-label="Join Our Team"><span class="action-btn-icon">🤝</span><span class="action-btn-text">Join Our Team</span></button></div>

<div class="footer">
<div class="footer-btns">
<a class="footer-btn primary" href="https://www.levelsofself.com/post/the-7-levels-of-self-explained" target="_blank" rel="noopener">Learn the Full Framework</a>
<a class="footer-btn" href="https://www.levelsofself.com" target="_blank" rel="noopener">LevelsOfSelf.com</a>
</div>
<button class="transform-btn" id="transformBtn" onclick="if(typeof trackEvent==='function')trackEvent('coaching_modal_open');document.getElementById('coachingModal').classList.add('active')">
<span class="transform-btn-icon">✨</span>
<span class="transform-btn-text">Get Coaching</span>
<span class="transform-btn-sub">1-on-1 Integration</span>
</button>
<div style="margin-top:16px;padding-top:20px;text-align:center;">
<p style="font-size:clamp(9px,2.5vw,11px);color:var(--muted);line-height:1.3;white-space:nowrap;text-align:center;margin:0;padding:0;">Built by <span style="color:var(--gold);font-weight:600;cursor:pointer;text-decoration:underline;" onclick="document.getElementById('founderModal').classList.add('active')">Arthur Palyan</span> on the framework he uses with founders, leaders, and clients worldwide.</p>
</div>
</div>
</div>

<div class="game" id="game" role="main" aria-label="Game screen"><div class="game-header"><div class="game-info"><div class="game-mode" id="gameMode">Mirror</div><div id="gameProgress" aria-live="polite">1/5</div><div class="game-combo" id="gameCombo" aria-live="polite"></div></div><button class="music-toggle" id="gameMusicToggle" title="Toggle music" aria-label="Toggle background music">🎵</button><button class="quit" id="quitBtn" aria-label="Quit game and return home">✕</button></div><div class="timer" id="timerBar" role="progressbar" aria-label="Time remaining"><div class="timer-fill" id="timerFill"></div></div><div class="scenario" role="region" aria-label="Current scenario"><div class="scenario-cat" id="scenarioCat">Level 1: Individual</div><div class="scenario-text loading" id="scenarioText" aria-live="polite">Loading...</div></div><div class="choices" id="choices" role="group" aria-label="Answer choices"></div></div>

<div class="results" id="results"><h2 id="resultsTitle">Game Complete</h2><div class="score" id="finalScore">0</div><div class="results-xp" id="resultsXP" style="display:none;background:linear-gradient(135deg,rgba(255,215,0,0.15),rgba(255,107,53,0.1));border:1px solid var(--gold);border-radius:10px;padding:12px 16px;margin:12px 0;text-align:center;"><div style="font-size:24px;font-weight:800;color:var(--gold);">+<span id="sessionXP">0</span> XP</div><div style="font-size:12px;color:var(--muted);margin-top:4px;">This session</div></div><p class="result-msg" id="resultMsg">Keep going!</p><div class="insights-list" id="insightsList"></div><div id="deepestInsight" style="display:none;background:linear-gradient(135deg,rgba(255,60,172,0.1),rgba(120,75,160,0.1));border:1px solid var(--pink);border-radius:12px;padding:16px;margin:16px 0;text-align:center;"><div style="font-size:12px;color:var(--pink);font-weight:600;margin-bottom:8px;">💡 Pattern that stood out</div><div id="deepestInsightText" style="font-size:15px;color:var(--text);font-style:italic;line-height:1.5;margin-bottom:8px;"></div><div id="deepestInsightMessage" style="font-size:13px;color:var(--muted);line-height:1.5;margin-bottom:12px;padding:10px;background:rgba(0,0,0,0.1);border-radius:8px;"></div><div style="display:flex;gap:10px;justify-content:center;"><button onclick="saveDeepestInsight()" style="padding:8px 16px;background:var(--card);border:1px solid var(--pink);border-radius:8px;color:var(--pink);font-size:13px;font-weight:600;cursor:pointer;">❤️ Save</button><button onclick="shareDeepestInsight()" style="padding:8px 16px;background:linear-gradient(135deg,var(--pink),var(--purple));border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;">📤 Share</button></div></div>

<!-- VALUE REMINDER -->
<div style="background:linear-gradient(135deg,rgba(168,85,247,0.1),rgba(236,72,153,0.1));border:1px solid #a855f7;border-radius:10px;padding:12px;margin:16px 0;text-align:center;">
<div style="font-size:11px;color:#a855f7;font-weight:600;text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;">You're building</div>
<div style="font-size:13px;color:var(--text);line-height:1.5;">✨ Clarity · 💰 Saved money · ⏰ Saved time · 🔄 Breaking the cycle</div>
</div>

<!-- SHARE WITH LILY -->
<button onclick="shareWithLily()" style="width:100%;padding:14px 24px;background:linear-gradient(135deg,#a855f7,#ec4899);border:2px solid #a855f7;border-radius:12px;color:#fff;font-size:15px;font-weight:700;cursor:pointer;margin-bottom:12px;display:flex;align-items:center;justify-content:center;gap:10px;box-shadow:0 4px 15px rgba(168,85,247,0.4);transition:all 0.2s;" onmouseover="this.style.transform='scale(1.02)';this.style.boxShadow='0 6px 20px rgba(168,85,247,0.5)'" onmouseout="this.style.transform='scale(1)';this.style.boxShadow='0 4px 15px rgba(168,85,247,0.4)'">
<img src="Lily_Bot.jpg" alt="Lily" style="width:24px;height:24px;border-radius:50%;border:2px solid #fff;">
<span>Share with Lily</span>
</button>

<div class="results-actions" style="display:flex;flex-direction:column;gap:10px;margin-top:16px;"><button class="results-btn" id="keepPlayingBtn" style="background:linear-gradient(135deg,var(--green),#00B85D);display:none;" aria-label="Keep playing 10 more scenarios">🔄 Keep Playing (+10 more)</button><button class="results-btn" id="endlessModeBtn" style="background:linear-gradient(135deg,var(--purple),var(--blue));display:none;" aria-label="Start endless mode">♾️ Endless Mode</button><button class="results-btn" id="homeBtn" style="background:linear-gradient(135deg,var(--pink),var(--purple));border:none;" aria-label="Return to home screen">🏠 Back to Home</button></div><div class="share-platform-grid"><button class="share-platform-btn" onclick="shareWhatsApp()" aria-label="Share on WhatsApp"><span class="icon">💬</span><span class="label">WhatsApp</span></button><button class="share-platform-btn" onclick="shareTwitter()" aria-label="Share on Twitter"><span class="icon">𝕏</span><span class="label">Twitter</span></button><button class="share-platform-btn" onclick="copyShareLink()" aria-label="Copy link to clipboard"><span class="icon">📋</span><span class="label">Copy</span></button><button class="share-platform-btn" onclick="shareNative()" aria-label="More sharing options"><span class="icon">📤</span><span class="label">More</span></button></div><div id="resultsCoachingCta" style="display:none;margin-top:20px;padding-top:20px;border-top:1px solid var(--border);text-align:center;"><p style="font-size:13px;color:var(--muted);margin-bottom:12px;">Ready to break these patterns for good?</p><button onclick="document.getElementById('results').style.display='none';document.getElementById('coachingModal').classList.add('active');" style="padding:12px 24px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:10px;color:#fff;font-size:14px;font-weight:700;cursor:pointer;box-shadow:0 2px 12px rgba(255,107,53,0.3);">✨ Get Coaching</button></div></div>
</div>

<div class="modal" id="qaModal" role="dialog" aria-label="Help and FAQ"><div class="modal-content" id="qaContent" style="max-height:85vh;overflow-y:auto;position:relative;scroll-behavior:smooth;">
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
<button onclick="document.getElementById('qaModal').classList.remove('active')" style="width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--pink),var(--purple));border:none;color:#fff;font-size:18px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 15px rgba(255,60,172,0.4);transition:all 0.2s;flex-shrink:0;" onmouseover="this.style.transform='scale(1.1)';this.style.boxShadow='0 6px 20px rgba(255,60,172,0.6)'" onmouseout="this.style.transform='scale(1)';this.style.boxShadow='0 4px 15px rgba(255,60,172,0.4)'">✕</button>
<div class="modal-title" style="margin:0;flex:1;text-align:center;">Help & FAQ</div>
<button onclick="document.getElementById('qaContent').scrollTo({top:document.getElementById('qaContent').scrollHeight,behavior:'smooth'})" style="width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--pink),var(--purple));border:none;color:#fff;font-size:18px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 15px rgba(255,60,172,0.4);transition:all 0.2s;flex-shrink:0;" onmouseover="this.style.transform='scale(1.1)';this.style.boxShadow='0 6px 20px rgba(255,60,172,0.6)'" onmouseout="this.style.transform='scale(1)';this.style.boxShadow='0 4px 15px rgba(255,60,172,0.4)'" title="Scroll to bottom">⬇</button>
</div>

<!-- 0. WHAT YOU GET -->
<div class="qa-item"><div class="qa-question">✨ What will this help me with?</div><div class="qa-answer">
<strong style="color:var(--gold);">3 things people get from playing:</strong><br><br>
<div style="background:var(--card);border-radius:10px;padding:14px;margin-bottom:12px;">
<div style="display:flex;flex-direction:column;gap:10px;">
<div style="display:flex;align-items:flex-start;gap:10px;">
<span style="font-size:20px;">🎯</span>
<div><strong style="color:var(--green);">Results in life</strong><br><span style="font-size:13px;color:var(--muted);">Better relationships, career decisions, and understanding of why things keep happening</span></div>
</div>
<div style="display:flex;align-items:flex-start;gap:10px;">
<span style="font-size:20px;">💫</span>
<div><strong style="color:var(--pink);">Feeling good</strong><br><span style="font-size:13px;color:var(--muted);">Peace, clarity, and self-acceptance instead of confusion and self-judgment</span></div>
</div>
<div style="display:flex;align-items:flex-start;gap:10px;">
<span style="font-size:20px;">🩹</span>
<div><strong style="color:var(--purple);">Pain relief</strong><br><span style="font-size:13px;color:var(--muted);">Stop the cycles that keep repeating: the same arguments, the same mistakes, the same feelings</span></div>
</div>
</div>
</div>
<div style="font-size:12px;text-transform:uppercase;letter-spacing:1px;color:var(--gold);font-weight:600;margin:16px 0 10px;">What you save:</div>
<div style="background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(255,107,53,0.05));border:1px solid var(--gold);border-radius:10px;padding:14px;">
<div style="display:flex;flex-wrap:wrap;gap:12px;justify-content:center;text-align:center;">
<div style="flex:1;min-width:80px;"><div style="font-size:20px;">💰</div><div style="font-size:12px;color:var(--text);font-weight:600;">Money</div><div style="font-size:11px;color:var(--muted);">Therapy, impulse buying,<br>bad relationships</div></div>
<div style="flex:1;min-width:80px;"><div style="font-size:20px;">⏰</div><div style="font-size:12px;color:var(--text);font-weight:600;">Time</div><div style="font-size:11px;color:var(--muted);">Stuck in the same<br>patterns for years</div></div>
<div style="flex:1;min-width:80px;"><div style="font-size:20px;">⚡</div><div style="font-size:12px;color:var(--text);font-weight:600;">Energy</div><div style="font-size:11px;color:var(--muted);">Drained by anxiety<br>& overthinking</div></div>
</div>
</div>
<div style="margin-top:14px;font-size:12px;color:var(--muted);text-align:center;font-style:italic;">6,854 scenarios. 16 themes. Your patterns revealed in under 2 minutes.</div>
</div></div>

<!-- 1. GETTING STARTED -->
<div class="qa-item"><div class="qa-question">🎮 How do I play?</div><div class="qa-answer">
<strong style="color:var(--pink);">3 game modes, one goal: see your patterns.</strong><br><br>
<div style="background:var(--card);border-radius:10px;padding:12px;margin-bottom:12px;">
<strong style="color:var(--pink);">🪞 Mirror Game</strong><br>
<span style="font-size:13px;color:var(--muted);">Self-reflection. "That's Me" or "That's Not Me", no right or wrong, just honest recognition.</span>
</div>
<div style="background:var(--card);border-radius:10px;padding:12px;margin-bottom:12px;">
<strong style="color:var(--purple);">⚖️ Agreement Game</strong><br>
<span style="font-size:13px;color:var(--muted);">Train acceptance over judgment. Timed responses build instinct. Unlocks at Level 2.</span>
</div>
<div style="background:var(--card);border-radius:10px;padding:12px;">
<strong style="color:var(--orange);">🌍 Worldwide Challenge</strong><br>
<span style="font-size:13px;color:var(--muted);">Same 3 scenarios for everyone globally. One attempt daily. Build your streak!</span>
</div>
</div></div>

<!-- 2. WHAT THIS ADDRESSES -->
<div class="qa-item"><div class="qa-question">💔 What wounds does this address?</div><div class="qa-answer">
This game was built to help heal real human pain.<br><br>
<div style="background:var(--card);padding:14px;border-radius:10px;margin-bottom:12px;">
<strong style="color:var(--pink);font-size:14px;">Core Wounds</strong><br>
<span style="font-size:13px;color:var(--text);line-height:1.8;">Addiction • Abuse • Self-harm • Not being enough • Not belonging • Loneliness</span>
</div>
<div style="background:var(--card);padding:14px;border-radius:10px;">
<strong style="color:var(--orange);font-size:14px;">16 Themes Tracked</strong>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px 16px;margin-top:10px;font-size:13px;">
<span>🛡️ Boundaries</span><span>🚪 Abandonment</span>
<span>💎 Self-Worth</span><span>🗡️ Betrayal</span>
<span>🪞 Honesty</span><span>🔥 Resentment</span>
<span>🎯 Control</span><span>✨ Perfectionism</span>
<span>💞 Connection</span><span>🎭 People-Pleasing</span>
<span>🌿 Rest</span><span>🙈 Avoidance</span>
<span>☯️ Acceptance</span><span>🥀 Grief</span>
<span>🔒 Withholding</span><span>🔗 Codependency</span>
</div>
</div>
</div></div>

<!-- 3. ARCHETYPES - EXPANDABLE -->
<div class="qa-item"><div class="qa-question">🎭 What are the 19 Archetypes?</div><div class="qa-answer">
Based on your gameplay patterns, you're matched with a growth personality.<br><br>
<div style="background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(255,107,53,0.1));border:1px solid var(--gold);border-radius:10px;padding:12px;margin-bottom:12px;">
<strong style="color:var(--gold);">⚡ This is a snapshot, not a permanent label.</strong><br>
<span style="font-size:12px;color:var(--muted);">As you grow and transform, your archetype evolves with you.</span>
</div>
<div style="font-size:11px;color:var(--muted);margin-bottom:10px;text-align:center;">Tap any archetype to learn more ↓</div>

<div id="archetypesList" style="display:flex;flex-direction:column;gap:6px;">

<div class="archetype-expand-item" onclick="this.classList.toggle('open')">
<div class="archetype-expand-header"><span>📒 Silent Scorekeeper</span><span class="archetype-arrow">▶</span></div>
<div class="archetype-expand-content">You remember every slight, every broken promise. The ledger in your head is exhausting. <em>Forgiveness isn't about them. It's about putting down the weight.</em></div>
</div>

<div class="archetype-expand-item" onclick="this.classList.toggle('open')">
<div class="archetype-expand-header"><span>🥀 Grief Holder</span><span class="archetype-arrow">▶</span></div>
<div class="archetype-expand-content">You've experienced loss that changed you. Holding onto grief forever isn't honoring what you lost. <em>Letting go isn't forgetting.</em></div>
</div>

<div class="archetype-expand-item" onclick="this.classList.toggle('open')">
<div class="archetype-expand-header"><span>🏝️ Crowded Loner</span><span class="archetype-arrow">▶</span></div>
<div class="archetype-expand-content">Surrounded by people yet completely alone. The loneliness isn't about numbers. <em>It's about how much of yourself you let them see.</em></div>
</div>

<div class="archetype-expand-item" onclick="this.classList.toggle('open')">
<div class="archetype-expand-header"><span>🦎 Identity Chameleon</span><span class="archetype-arrow">▶</span></div>
<div class="archetype-expand-content">So good at being what others need, you've lost track of who you are. <em>Your identity isn't supposed to be a group project.</em></div>
</div>

<div class="archetype-expand-item" onclick="this.classList.toggle('open')">
<div class="archetype-expand-header"><span>🔋 Burned Out Achiever</span><span class="archetype-arrow">▶</span></div>
<div class="archetype-expand-content">Run yourself into the ground being everything for everyone. <em>Rest isn't a reward for finishing. It's fuel for continuing.</em></div>
</div>

<div class="archetype-expand-item" onclick="this.classList.toggle('open')">
<div class="archetype-expand-header"><span>🐺 Once Bitten</span><span class="archetype-arrow">▶</span></div>
<div class="archetype-expand-content">Learned the hard way that people can hurt you. Now you see threats everywhere. <em>Hypervigilance keeps out the good along with the bad.</em></div>
</div>

<div class="archetype-expand-item" onclick="this.classList.toggle('open')">
<div class="archetype-expand-header"><span>🚧 Strategic Avoider</span><span class="archetype-arrow">▶</span></div>
<div class="archetype-expand-content">Very good at not dealing with things by staying busy with other things. <em>What you avoid doesn't go away. It grows in the dark.</em></div>
</div>

<div class="archetype-expand-item" onclick="this.classList.toggle('open')">
<div class="archetype-expand-header"><span>🌫️ Numbing Navigator</span><span class="archetype-arrow">▶</span></div>
<div class="archetype-expand-content">Found ways to take the edge off, but the edge is there for a reason. <em>What you numb, you can't heal.</em></div>
</div>

<div class="archetype-expand-item" onclick="this.classList.toggle('open')">
<div class="archetype-expand-header"><span>💔 Boundary-Breaker</span><span class="archetype-arrow">▶</span></div>
<div class="archetype-expand-content">Your empathy is a gift, but you give it away too freely. <em>Protecting your energy isn't selfish, it's sustainable.</em></div>
</div>

<div class="archetype-expand-item" onclick="this.classList.toggle('open')">
<div class="archetype-expand-header"><span>⚡ Self-Critical Achiever</span><span class="archetype-arrow">▶</span></div>
<div class="archetype-expand-content">Accomplished more than most by being hard on yourself, but the cost is invisible. <em>The next level isn't more effort, it's more self-compassion.</em></div>
</div>

<div class="archetype-expand-item" onclick="this.classList.toggle('open')">
<div class="archetype-expand-header"><span>🎛️ Control Seeker</span><span class="archetype-arrow">▶</span></div>
<div class="archetype-expand-content">Your need for control protects against chaos. But the tighter you grip, the less you control. <em>Real power comes from trusting yourself to handle uncertainty.</em></div>
</div>

<div class="archetype-expand-item" onclick="this.classList.toggle('open')">
<div class="archetype-expand-header"><span>🫣 Shame Carrier</span><span class="archetype-arrow">▶</span></div>
<div class="archetype-expand-content">You carry a weight that was never yours to hold. <em>The shame often belongs to someone else's actions or your younger self's circumstances.</em></div>
</div>

<div class="archetype-expand-item" onclick="this.classList.toggle('open')">
<div class="archetype-expand-header"><span>🔐 Trust Rebuilder</span><span class="archetype-arrow">▶</span></div>
<div class="archetype-expand-content">Past betrayals taught you trust is dangerous. But walls that protected you then now keep out what you need. <em>Learning to trust is learning to risk. Wisely.</em></div>
</div>

<div class="archetype-expand-item" onclick="this.classList.toggle('open')">
<div class="archetype-expand-header"><span>🪞 Honest Avoider</span><span class="archetype-arrow">▶</span></div>
<div class="archetype-expand-content">You see yourself with unusual clarity, but seeing isn't doing. <em>Your next step is bridging the gap between recognition and action.</em></div>
</div>

<div class="archetype-expand-item" onclick="this.classList.toggle('open')">
<div class="archetype-expand-header"><span>⏳ Aware Procrastinator</span><span class="archetype-arrow">▶</span></div>
<div class="archetype-expand-content">You've done the inner work to understand your patterns. Now stop preparing and start doing. <em>Insight without action is sophisticated avoidance.</em></div>
</div>

<div class="archetype-expand-item" onclick="this.classList.toggle('open')">
<div class="archetype-expand-header"><span>🕊️ Peaceful Avoider</span><span class="archetype-arrow">▶</span></div>
<div class="archetype-expand-content">Mastered accepting others, but using acceptance to avoid your own mirror. <em>Peace that comes from avoidance isn't real peace.</em></div>
</div>

<div class="archetype-expand-item" onclick="this.classList.toggle('open')">
<div class="archetype-expand-header"><span>🌱 Growth Seeker</span><span class="archetype-arrow">▶</span></div>
<div class="archetype-expand-content">Doing the rare work of seeing yourself clearly AND accepting what you see. <em>Your next edge isn't more insight. It's deeper integration.</em></div>
</div>

<div class="archetype-expand-item" onclick="this.classList.toggle('open')">
<div class="archetype-expand-header"><span>👁️ Emerging Observer</span><span class="archetype-arrow">▶</span></div>
<div class="archetype-expand-content">Building a powerful new habit: paying attention to yourself. <em>Consistency now matters more than depth. Keep showing up.</em></div>
</div>

<div class="archetype-expand-item" onclick="this.classList.toggle('open')">
<div class="archetype-expand-header"><span>🔮 The Aware One</span><span class="archetype-arrow">▶</span></div>
<div class="archetype-expand-content">You've started the journey of self-knowledge. <em>Every question you ask yourself creates space for growth.</em></div>
</div>

</div>
<br><em style="color:var(--muted);font-size:12px;">Each archetype includes daily challenges and coaching notes. Keep playing and watch yourself transform.</em>
</div></div>

<!-- 4. 7 LEVELS -->
<div class="qa-item"><div class="qa-question">📊 What is the 7 Levels framework?</div><div class="qa-answer">
The 7 Levels of Self maps human growth across 7 dimensions. You can't skip levels. Each must be mastered before climbing higher.<br><br>

<div style="background:var(--card);border-radius:12px;padding:14px;margin-bottom:10px;border-left:3px solid #FF6B35;">
<div style="font-weight:700;color:#FF6B35;margin-bottom:6px;">1. Individual: Self for yourself</div>
<div style="font-size:13px;color:var(--muted);line-height:1.5;">Your feelings, your life, your beliefs, your needs, your wants. Before you can show up for anyone else, you have to show up for yourself. Non-negotiables, things you do for yourself every day. It's not selfish. It's required. If this level isn't solid, everything above it is unstable.</div>
</div>

<div style="background:var(--card);border-radius:12px;padding:14px;margin-bottom:10px;border-left:3px solid #FF3CAC;">
<div style="font-weight:700;color:#FF3CAC;margin-bottom:6px;">2. Family: Created or immediate</div>
<div style="font-size:13px;color:var(--muted);line-height:1.5;">Either the family you were born into OR the family you have created (spouse, kids). If you've created your own family, they become Level 2, and your family of origin moves to Level 3. These are the people who see you at your best and worst.</div>
</div>

<div style="background:var(--card);border-radius:12px;padding:14px;margin-bottom:10px;border-left:3px solid #784BA0;">
<div style="font-weight:700;color:#784BA0;margin-bottom:6px;">3. Groups: Extended family, friends</div>
<div style="font-size:13px;color:var(--muted);line-height:1.5;">Extended family members, friends, relatives, coworkers, and groups you belong to. If you've created your own family, your parents and siblings now live here. Are you being yourself, or performing a version of yourself to fit in?</div>
</div>

<div style="text-align:center;padding:8px 0;margin-bottom:10px;"><em style="color:var(--pink);font-size:12px;">↑ The first 3 levels represent 90% of everyday life ↑</em></div>

<div style="background:var(--card);border-radius:12px;padding:14px;margin-bottom:10px;border-left:3px solid #2F80ED;">
<div style="font-weight:700;color:#2F80ED;margin-bottom:6px;">4. Community: Activities and events</div>
<div style="font-size:13px;color:var(--muted);line-height:1.5;">Activities, events, and classes of people you identify with: musicians, business people, athletes, artists, your industry. Where you belong beyond personal relationships. Do you have a role, and do you respect the roles of others?</div>
</div>

<div style="background:var(--card);border-radius:12px;padding:14px;margin-bottom:10px;border-left:3px solid #00D26A;">
<div style="font-weight:700;color:#00D26A;margin-bottom:6px;">5. Society: Nation and systems</div>
<div style="font-size:13px;color:var(--muted);line-height:1.5;">The people of your nation and its systems: government, economy, culture, laws. This level is about seeing reality clearly. Not what you wish was true. Not what you're fighting against. What actually is. You can't change what you won't first accept.</div>
</div>

<div style="background:var(--card);border-radius:12px;padding:14px;margin-bottom:10px;border-left:3px solid #F7C948;">
<div style="font-weight:700;color:#F7C948;margin-bottom:6px;">6. World: Global stage</div>
<div style="font-size:13px;color:var(--muted);line-height:1.5;">The global stage: international politics, global events, other nations, other cultures, humanity as a whole. How connected do you feel to what happens outside your borders? It's about recognizing you're part of something larger than your own life.</div>
</div>

<div style="background:var(--card);border-radius:12px;padding:14px;margin-bottom:10px;border-left:3px solid #C0C0C0;">
<div style="font-weight:700;color:#C0C0C0;margin-bottom:6px;">7. Generations: Before and after you</div>
<div style="font-size:13px;color:var(--muted);line-height:1.5;">The people who came before you (ancestors) and those who will come after. This is legacy. What cycles did you inherit? What cycles will you break? What will you build that outlasts you? Legacy isn't always a building. Sometimes it's a pattern you refused to repeat.</div>
</div>

<strong style="color:var(--pink);">5,000+ scenarios</strong> across all 7 levels.
</div></div>

<!-- 5. XP & PROGRESSION -->
<div class="qa-item"><div class="qa-question">⭐ How do XP, coins & streaks work?</div><div class="qa-answer">
<strong>XP & Leveling:</strong> Every answer earns XP. 750 XP = 1 level.<br><br>
<strong>Level Unlocks:</strong><br>
<span style="font-size:13px;">
Lvl 2 → Agreement Game + Family theme<br>
Lvl 3 → Groups theme<br>
Lvl 5 → Community theme<br>
Lvl 7 → Society theme<br>
Lvl 10 → World theme<br>
Lvl 15 → Generations theme</span><br><br>
<strong>💰 Coins:</strong> Earn 25% of XP as coins. Redeem in the Reward Shop for discounts or save up for a FREE coaching session!<br><br>
<strong>🔥 Streaks:</strong> Complete Worldwide Challenge daily. Miss a day = reset.<br><br>
<strong>⚡ Combos:</strong> Consecutive correct answers = extra XP (5x = +10, 10x = +20).
</div></div>

<!-- 6. CORE PHILOSOPHY -->
<div class="qa-item"><div class="qa-question">☯️ What does "Acceptance ≠ Agreement" mean?</div><div class="qa-answer">
This is the core philosophy.<br><br>
<strong>Acceptance</strong> = acknowledging reality as it is.<br>
<strong>Agreement</strong> = endorsing it.<br><br>
You can accept that something <em>IS</em> without agreeing it <em>SHOULD BE</em>.<br><br>
<em style="color:var(--muted);">Acceptance is the first step to change. You can't transform what you won't acknowledge.</em>
</div></div>

<!-- 7. INSIGHTS -->
<div class="qa-item"><div class="qa-question">💡 What are Insights & Deep Insights?</div><div class="qa-answer">
<strong>💡 Insights:</strong> Every pattern you recognize gets saved. Tap the Insights stat to review them anytime.<br><br>
<strong>❤️ Deep Insights:</strong> After 10 games, unlock a personalized summary showing:<br>
• Your growth pattern & self-awareness scores<br>
• Recurring themes in your responses<br>
• Your current archetype & daily challenges<br>
• Coaching notes based on your patterns
</div></div>

<!-- 8. COACHING -->
<div class="qa-item"><div class="qa-question">🎯 Can I work with a coach?</div><div class="qa-answer" style="text-align:center;">
<strong style="color:var(--pink);">Yes!</strong> Go deeper with 1-on-1 coaching.<br><br>
<div style="background:var(--card);border-radius:12px;padding:16px;margin:12px 0;text-align:left;">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
<span style="font-weight:600;">Arthur Palyan</span>
<span style="color:var(--gold);font-weight:700;">$900</span>
</div>
<div style="font-size:12px;color:var(--muted);margin-bottom:12px;">Founder · English</div>
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
<span style="font-weight:600;display:inline-flex;align-items:center;gap:4px;"><img src="Lily_Bot.jpg" alt="Lily" style="width:18px;height:18px;border-radius:50%;object-fit:cover;border:1px solid #a855f7;"> Lily (Self-Awareness Coach)</span>
<span style="color:var(--green);font-weight:700;">FREE</span>
</div>
<div style="font-size:12px;color:var(--muted);margin-bottom:12px;">Instant pattern analysis · 24/7 · Tap Lily's icon in header</div>
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
<span style="font-weight:600;">Head Coach (Certified)</span>
<span style="color:var(--green);font-weight:700;">$250</span>
</div>
<div style="font-size:12px;color:var(--muted);margin-bottom:8px;">English · Dutch</div>
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
<span style="font-weight:600;">Coaches</span>
<span style="color:var(--green);font-weight:700;">$100</span>
</div>
<div style="font-size:12px;color:var(--muted);">English · Spanish · Portuguese · Korean · Armenian · Russian</div>
</div>
<button onclick="document.getElementById('qaModal').classList.remove('active');document.getElementById('coachingModal').classList.add('active');" style="padding:12px 24px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:10px;color:#fff;font-size:14px;font-weight:700;cursor:pointer;width:100%;">Meet Our Coaches</button>
</div></div>

<!-- LILY SELF-AWARENESS COACH FAQ -->
<div class="qa-item"><div class="qa-question"><span style="display:inline-flex;align-items:center;gap:6px;"><img src="Lily_Bot.jpg" alt="Lily" style="width:22px;height:22px;border-radius:50%;object-fit:cover;border:2px solid #a855f7;"> Who is Lily?</span></div><div class="qa-answer">
<strong style="color:#a855f7;">Lily is your self-awareness coach.</strong><br><br>
She lives inside the game and reads your actual gameplay patterns: what you recognize, what you avoid, which themes keep showing up. Then she helps you understand what those patterns mean.<br><br>
<div style="background:var(--card);border-radius:10px;padding:12px;margin-bottom:12px;">
<strong>What Lily can do:</strong><br>
• Analyze your patterns across all 7 levels<br>
• Explain why the same themes keep appearing<br>
• Suggest specific exercises for your patterns<br>
• Help you prepare for a session with a human coach<br>
• Answer questions about the 7 Levels framework
</div>
<div style="background:linear-gradient(135deg,rgba(168,85,247,0.1),rgba(236,72,153,0.1));border:1px solid #a855f7;border-radius:10px;padding:12px;margin-bottom:12px;">
<strong style="color:#a855f7;">🆕 Share with Lily</strong><br>
<span style="font-size:13px;color:var(--muted);">After each game, tap "Share with Lily" to send her your results. She'll receive your archetype, themes, and patterns, then give you personalized insight.</span>
</div>
<div style="font-size:12px;color:var(--muted);margin-bottom:12px;">Lily is free and available 24/7. She's not a replacement for human coaching. She's the bridge between recognizing a pattern and breaking it.</div>
<button onclick="document.getElementById('qaModal').classList.remove('active');openLily();" style="padding:12px 24px;background:linear-gradient(135deg,#a855f7,#ec4899);border:none;border-radius:10px;color:#fff;font-size:14px;font-weight:700;cursor:pointer;width:100%;">💬 Talk to Lily</button>
</div></div>

<!-- BREAKTHROUGH WORK FAQ -->
<div class="qa-item"><div class="qa-question">🔥 What is Breakthrough Work?</div><div class="qa-answer">
<strong style="color:var(--orange);">9 exercises to shift perspective and move stuck energy.</strong><br><br>
<div style="background:var(--card);border-radius:10px;padding:12px;margin-bottom:12px;">
<strong>Three Levels:</strong><br>
<span style="font-size:13px;color:var(--muted);">
• <span style="color:var(--green);">STARTER</span> Build the habit: Breathwork, Center Tap, Daily Check-In, Power of Context<br>
• <span style="color:var(--blue);">INTERMEDIATE</span> Shift perspective: "Have To → Get To → Blessed To", Blessings Letter<br>
• <span style="color:var(--pink);">DEEP WORK</span> Move stuck energy: Forgiveness Letter, Most Painful Memory, Ultimate Acknowledgment
</span>
</div>
<em style="color:var(--muted);font-size:12px;">Complete exercises to earn XP. Deep work exercises unlock coaching CTA.</em><br><br>
<button onclick="document.getElementById('qaModal').classList.remove('active');document.getElementById('breakthroughModal').classList.add('active');" style="padding:12px 24px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:10px;color:#fff;font-size:14px;font-weight:700;cursor:pointer;width:100%;">Start Breakthrough Work</button>
</div></div>

<!-- JOIN OUR TEAM FAQ -->
<div class="qa-item"><div class="qa-question">🤝 How can I partner with you?</div><div class="qa-answer">
<strong style="color:var(--gold);">Work with an Award-Winning Life Coach.</strong><br>
<span style="font-size:13px;color:var(--muted);">I'm looking for coaches, translators, affiliates, and connectors.</span><br>
<span style="font-size:12px;color:var(--text-secondary);">Google <strong>"Arthur Palyan"</strong> or <strong>"Level Up Levels of Self"</strong> to see results.</span><br><br>
<div style="background:var(--card);border-radius:10px;padding:12px;margin-bottom:12px;">
<span style="font-size:13px;color:var(--muted);">
• <strong>COACHES</strong> Teach the 7 Levels of Self framework. Help people break patterns. Work remotely.<br>
• <strong>TRANSLATORS</strong> Bring the game to Spanish, French, Portuguese, Tagalog, Hindi, Arabic, or other languages. I handle tech, marketing, and advertising.<br>
• <strong>AFFILIATES</strong> Refer clients or coaches. No coaching required.<br>
• <strong>CONNECTORS</strong> Know someone in education, corporate, rehab, government, or investment? One introduction can change everything.
</span>
</div>
<div style="background:linear-gradient(135deg,rgba(168,85,247,0.1),rgba(120,75,160,0.1));border:1px solid var(--purple);border-radius:10px;padding:10px;margin-bottom:12px;text-align:center;">
<span style="font-size:12px;color:var(--purple);font-weight:600;">Now booking Corporate Sponsorships · Educational Conferences · Federal Grants</span>
</div>
<div style="font-size:12px;color:var(--green);margin-bottom:8px;">✅ No experience required · ✅ No setup cost · ✅ Work from ANYWHERE in the world</div>
<em style="color:var(--muted);font-size:12px;">Created by Arthur Palyan, Best Life Coach California 2025. As seen on AP News, Bloomberg, Yahoo Finance, and 200+ outlets.</em><br><br>
<button onclick="document.getElementById('qaModal').classList.remove('active');document.getElementById('teamModal').classList.add('active');" style="padding:12px 24px;background:linear-gradient(135deg,var(--gold),var(--orange));border:none;border-radius:10px;color:#000;font-size:14px;font-weight:700;cursor:pointer;width:100%;">Message Arthur →</button>
</div></div>

<!-- REWARD SHOP FAQ -->
<div class="qa-item"><div class="qa-question">🛒 What is the Reward Shop?</div><div class="qa-answer">
<strong style="color:var(--gold);">Turn your coins into real rewards.</strong><br><br>
<div style="background:var(--card);border-radius:10px;padding:12px;margin-bottom:12px;">
<strong>Discounts & Sessions:</strong><br>
<span style="font-size:13px;color:var(--muted);">
• <span style="color:var(--green);">500</span> 20% Off Workshop<br>
• <span style="color:var(--blue);">1,000</span> 20% Off Coaching<br>
• <span style="color:var(--pink);">5,000</span> 50% Off Coaching<br>
• <span style="color:var(--gold);">10,000</span> FREE Coaching Session
</span>
</div>
<div style="background:linear-gradient(135deg,rgba(168,85,247,0.1),rgba(120,75,160,0.1));border:1px solid var(--purple);border-radius:10px;padding:12px;margin-bottom:12px;">
<strong style="color:var(--purple);">🔮 Level Access Passes:</strong><br>
<span style="font-size:13px;color:var(--muted);">
Curious what's ahead? Buy 10-day full access to higher levels:<br>
• Level 3-4: 300-400 coins<br>
• Level 5-6: 500-600 coins<br>
• Level 7: 1,000 coins
</span>
</div>
<em style="color:var(--muted);font-size:12px;">Earn coins by playing games (25% of XP earned). More rewards coming soon!</em><br><br>
<button onclick="document.getElementById('qaModal').classList.remove('active');document.getElementById('coinShopModal').classList.add('active');" style="padding:12px 24px;background:linear-gradient(135deg,var(--gold),var(--orange));border:none;border-radius:10px;color:#000;font-size:14px;font-weight:700;cursor:pointer;width:100%;">Open Reward Shop</button>
</div></div>

<!-- WORKSHOP -->
<div class="qa-item"><div class="qa-question">💑 Workshops & Retreats</div><div class="qa-answer">
<div style="background:linear-gradient(135deg,rgba(255,60,172,0.1),rgba(120,75,160,0.1));border:1px solid var(--pink);border-radius:12px;padding:16px;margin-bottom:12px;text-align:center;">
<div style="font-size:20px;margin-bottom:8px;">🌴</div>
<div style="font-size:16px;font-weight:700;color:var(--pink);margin-bottom:4px;">Live Events Coming Soon</div>
<div style="font-size:13px;color:var(--muted);line-height:1.6;">Multi-day workshops and retreats for deeper breakthrough work. Message Arthur to get on the list.</div>
</div>
<em style="color:var(--muted);font-size:12px;">Use your coins to unlock workshop discounts! 500 coins = 20% off.</em><br><br>
<a href="https://wa.me/+18184399770?text=Hi%20Arthur%2C%20I%27m%20interested%20in%20upcoming%20workshops%20and%20retreats." target="_blank" style="display:inline-block;padding:12px 24px;background:linear-gradient(135deg,var(--pink),var(--purple));border:none;border-radius:10px;color:#fff;font-size:14px;font-weight:700;text-decoration:none;">Get on the List →</a>
</div></div>

<!-- FREE MASTERMIND -->
<div class="qa-item"><div class="qa-question">🤝 Free Monthly Mastermind</div><div class="qa-answer">
<strong style="color:var(--green);">First Sunday of every month</strong>, join live for free!<br><br>
<div style="background:var(--card);border-radius:10px;padding:12px;margin-bottom:12px;">
<strong>What happens:</strong><br>
<span style="font-size:13px;color:var(--muted);">• Focus on Individual Self (Level 1)<br>• Real conversations, no fluff<br>• Connect with others on the same path<br>• English and Armenian sessions available</span>
</div>
<em style="color:var(--muted);font-size:12px;">No cost. No spam. Just real growth.</em><br><br>
<a href="https://www.levelsofself.com/booking-calendar/free-mastermind-english" target="_blank" style="display:inline-block;padding:12px 24px;background:linear-gradient(135deg,var(--green),#00B85D);border:none;border-radius:10px;color:#fff;font-size:14px;font-weight:700;text-decoration:none;">Register Free</a>
</div></div>

<!-- 9. SHARE -->
<div class="qa-item"><div class="qa-question">📤 Why should I share this?</div><div class="qa-answer">
<strong style="color:var(--pink);">Because someone you know needs this.</strong><br><br>
Who in your life is stuck in the same patterns? Struggling with boundaries? Carrying grief or shame they won't talk about?<br><br>
This game helps people see themselves without judgment. It's <strong>free</strong>, <strong>private</strong>, and takes <strong>2 minutes</strong> to play.<br><br>
<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:12px;">
<button onclick="shareToInstagram()" style="display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;padding:14px 8px;background:linear-gradient(135deg,#833AB4,#FD1D1D,#F77737);border:none;border-radius:12px;cursor:pointer;transition:all 0.2s;"><svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg><span style="font-size:10px;font-weight:600;color:#fff;">Instagram</span></button>
<button onclick="shareToFacebook()" style="display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;padding:14px 8px;background:#1877F2;border:none;border-radius:12px;cursor:pointer;transition:all 0.2s;"><svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg><span style="font-size:10px;font-weight:600;color:#fff;">Facebook</span></button>
<button onclick="shareToTwitter()" style="display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;padding:14px 8px;background:#000;border:none;border-radius:12px;cursor:pointer;transition:all 0.2s;"><svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg><span style="font-size:10px;font-weight:600;color:#fff;">X</span></button>
<button onclick="shareToWhatsApp()" style="display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;padding:14px 8px;background:#25D366;border:none;border-radius:12px;cursor:pointer;transition:all 0.2s;"><svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg><span style="font-size:10px;font-weight:600;color:#fff;">WhatsApp</span></button>
</div>
</div></div>

<!-- 10. PRIVACY -->
<div class="qa-item"><div class="qa-question">🔒 Is my data private?</div><div class="qa-answer">
<strong style="color:var(--green);">Yes.</strong> All data is stored locally on your device only. Nothing is sent to any server.<br><br>
<em style="color:var(--muted);">Clearing browser data will reset your progress.</em>
</div></div>

<!-- 11. THERAPY DISCLAIMER -->
<div class="qa-item"><div class="qa-question">⚠️ Is this a substitute for therapy?</div><div class="qa-answer">
<strong style="color:var(--yellow);">No.</strong> This game is for self-reflection and personal growth, not therapy, diagnosis, or treatment.<br><br>
<div style="background:var(--card);border-radius:10px;padding:12px;">
<strong style="color:var(--green);">🆘 Crisis Resources</strong><br>
<span style="font-size:13px;">
• <strong>988</strong> Suicide & Crisis Lifeline (US)<br>
• <strong>Text HOME to 741741</strong> Crisis Text Line<br>
• <a href="https://findahelpline.com" target="_blank" style="color:var(--blue);">findahelpline.com</a> International
</span>
</div>
<br><em style="color:var(--muted);">You are not alone. Help is available.</em>
</div></div>

<!-- 12. SETTINGS -->
<div class="qa-item"><div class="qa-question">⚙️ Settings & Options</div><div class="qa-answer" style="text-align:center;">
<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;">
<div>
<strong>💀 Hard Mode</strong><br>
<span style="font-size:11px;color:var(--muted);">5s timer on ALL games</span><br>
<button id="faqHardMode" onclick="hardMode=!hardMode;this.textContent=hardMode?'ON':'OFF';this.style.background=hardMode?'var(--red)':'var(--card)';this.style.border=hardMode?'none':'2px solid var(--red)';this.style.color=hardMode?'#fff':'var(--red)'" style="padding:8px 16px;background:var(--card);border:2px solid var(--red);border-radius:8px;color:var(--red);font-size:13px;font-weight:600;cursor:pointer;margin-top:6px;">OFF</button>
</div>
<div>
<strong>⚡ Quick Mode</strong><br>
<span style="font-size:11px;color:var(--muted);">Faster transitions</span><br>
<button id="faqQuickMode" onclick="quickMode=!quickMode;this.textContent=quickMode?'ON':'OFF';this.style.background=quickMode?'var(--orange)':'var(--card)';this.style.border=quickMode?'none':'2px solid var(--orange)';this.style.color=quickMode?'#fff':'var(--orange)';document.documentElement.style.setProperty('--transition-fast',quickMode?'all 0.1s ease':'all 0.2s ease');document.documentElement.style.setProperty('--transition-normal',quickMode?'all 0.15s ease':'all 0.3s ease');showToast(quickMode?'⚡ Quick Mode ON':'⚡ Quick Mode OFF')" style="padding:8px 16px;background:var(--card);border:2px solid var(--orange);border-radius:8px;color:var(--orange);font-size:13px;font-weight:600;cursor:pointer;margin-top:6px;">OFF</button>
</div>
<div>
<strong>🔊 Sound</strong><br>
<span style="font-size:11px;color:var(--muted);">Effects & feedback</span><br>
<button onclick="soundOn=!soundOn;this.textContent=soundOn?'ON':'OFF';this.style.background=soundOn?'var(--green)':'var(--card)';this.style.border=soundOn?'none':'2px solid var(--green)';this.style.color=soundOn?'#fff':'var(--green)'" style="padding:8px 16px;background:var(--green);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;margin-top:6px;">ON</button>
</div>
<div>
<strong>🖨️ Print</strong><br>
<span style="font-size:11px;color:var(--muted);">Save Your Progress</span><br>
<button onclick="printProgress()" style="padding:8px 16px;background:linear-gradient(135deg,var(--cyan),var(--blue));border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;margin-top:6px;">Print</button>
</div>
</div>
<div style="border-top:1px solid var(--border);padding-top:12px;">
<strong>💾 Backup & Restore</strong><br>
<span style="font-size:11px;color:var(--muted);">Never lose your progress. Export your data to a file, then import it on any device.</span><br>
<div style="display:flex;gap:8px;justify-content:center;margin-top:8px;">
<button onclick="exportData()" style="padding:8px 16px;background:linear-gradient(135deg,var(--green),#00B85D);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;">📥 Export</button>
<button onclick="document.getElementById('importFileInput').click()" style="padding:8px 16px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;">📤 Import</button>
<input type="file" id="importFileInput" accept=".json" style="display:none;" onchange="importData(event)">
</div>
</div>
<div style="border-top:1px solid var(--border);padding-top:12px;">
<strong>📋 Assessments</strong><br>
<div style="display:flex;gap:8px;justify-content:center;margin-top:8px;">
<a href="https://selfcheck.100levelup.com/assessment.html" target="_blank" style="padding:10px 16px;background:linear-gradient(135deg,var(--pink),var(--purple));border-radius:8px;color:#fff;font-size:12px;font-weight:600;text-decoration:none;">📝 Full</a>
<a href="https://selfcheck.100levelup.com/quick.html" target="_blank" style="padding:10px 16px;background:linear-gradient(135deg,var(--purple),var(--blue));border-radius:8px;color:#fff;font-size:12px;font-weight:600;text-decoration:none;">⚡ Quick</a>
</div>
</div>
</div></div>

<!-- 13. MUSIC -->
<div class="qa-item"><div class="qa-question">🎵 Music</div><div class="qa-answer">
<strong style="color:var(--pink);">Listen to our songs or play your own.</strong><br><br>
<div style="background:var(--card);border-radius:12px;padding:16px;margin-bottom:12px;">
<div style="font-size:13px;color:var(--muted);margin-bottom:12px;">Game music by <a href="https://music.apple.com/us/artist/the-palyans/1120205357" target="_blank" style="color:var(--gold);font-weight:600;text-decoration:none;">The Palyans</a>, the family behind Level Up</div>
<div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
<button id="faqMusicToggle" onclick="toggleFaqMusic()" title="Toggle game music" style="width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,var(--orange),var(--pink));color:#fff;border:none;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;">🎵</button>
<button onclick="openPalyansSpotify()" title="The Palyans on Spotify" style="width:44px;height:44px;border-radius:50%;background:var(--card);border:1px solid #1DB954;color:#1DB954;cursor:pointer;display:flex;align-items:center;justify-content:center;"><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/></svg></button>
<button onclick="openPalyansAppleMusic()" title="The Palyans on Apple Music" style="width:44px;height:44px;border-radius:50%;background:var(--card);border:1px solid #FC3C44;color:#FC3C44;cursor:pointer;display:flex;align-items:center;justify-content:center;"><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M23.994 6.124a9.23 9.23 0 00-.24-2.19c-.317-1.31-1.062-2.31-2.18-3.043a5.022 5.022 0 00-1.877-.726 10.496 10.496 0 00-1.564-.15c-.04-.003-.083-.01-.124-.013H5.986c-.152.01-.303.017-.455.026-.747.043-1.49.123-2.193.401-1.336.53-2.3 1.452-2.865 2.78-.192.448-.292.925-.363 1.408-.056.392-.088.785-.1 1.18 0 .032-.007.062-.01.093v12.223c.01.14.017.283.027.424.05.815.154 1.624.497 2.373.65 1.42 1.738 2.353 3.234 2.801.42.127.856.187 1.293.228.555.053 1.11.06 1.667.06h11.03c.525 0 1.048-.034 1.57-.1.823-.106 1.597-.35 2.296-.81.84-.553 1.472-1.287 1.88-2.208.186-.42.293-.87.37-1.324.113-.675.138-1.358.137-2.04-.002-3.8 0-7.595-.003-11.393zm-6.423 3.99v5.712c0 .417-.058.827-.244 1.206-.29.59-.76.962-1.388 1.14-.35.1-.706.157-1.07.173-.95.042-1.785-.455-2.105-1.392-.223-.657-.098-1.272.344-1.81.38-.463.9-.713 1.486-.81.543-.09 1.09-.14 1.635-.212.207-.03.4-.09.555-.232.168-.155.212-.357.212-.57v-5.478c0-.098-.027-.152-.127-.172-.376-.074-.75-.154-1.124-.232l-3.89-.804c-.076-.016-.155-.026-.235-.026-.096 0-.126.036-.127.132-.003.25 0 .5 0 .75v8.133c0 .504-.065.998-.283 1.46-.306.65-.822 1.04-1.524 1.203-.34.08-.686.12-1.034.13-1.022.025-1.907-.53-2.18-1.526-.165-.603-.082-1.177.305-1.69.376-.498.888-.763 1.47-.87.508-.094 1.022-.144 1.533-.217.32-.046.617-.14.835-.393.146-.17.2-.373.2-.59V6.266c0-.305.048-.39.34-.453l5.727-1.185c.206-.043.413-.085.622-.1.186-.014.234.028.234.215v5.37z"/></svg></button>
</div>
</div>
<em style="color:var(--muted);font-size:12px;">Tap the music note to toggle game music, or listen to The Palyans on your favorite platform.</em>
</div></div>

<!-- 14. KEYBOARD SHORTCUTS -->
<div class="qa-item"><div class="qa-question">⌨️ Keyboard shortcuts</div><div class="qa-answer">
<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;font-size:13px;">
<div>
<strong style="color:var(--cyan);">Home</strong><br>
<span style="font-family:monospace;background:var(--card);padding:2px 6px;border-radius:4px;">M</span> Mirror<br>
<span style="font-family:monospace;background:var(--card);padding:2px 6px;border-radius:4px;">A</span> Agreement<br>
<span style="font-family:monospace;background:var(--card);padding:2px 6px;border-radius:4px;">D</span> Daily<br>
<span style="font-family:monospace;background:var(--card);padding:2px 6px;border-radius:4px;">?</span> Help
</div>
<div>
<strong style="color:var(--pink);">In Game</strong><br>
<span style="font-family:monospace;background:var(--card);padding:2px 6px;border-radius:4px;">1-4</span> Select<br>
<span style="font-family:monospace;background:var(--card);padding:2px 6px;border-radius:4px;">Esc</span> Quit<br>
<span style="font-family:monospace;background:var(--card);padding:2px 6px;border-radius:4px;">Enter</span> Continue
</div>
</div>
</div></div>

<!-- 14. NEW FEATURES v11.4 -->
<div class="qa-item"><div class="qa-question">✨ New Features</div><div class="qa-answer">
<div style="display:flex;flex-direction:column;gap:12px;">

<div style="background:rgba(0,200,240,0.1);border-left:3px solid var(--cyan);padding:10px 12px;border-radius:0 8px 8px 0;">
<strong style="color:var(--cyan);">❄️ Streak Freeze</strong><br>
<span style="font-size:12px;color:var(--muted);">Protect your streak without playing! One freeze available per week. Look for the Freeze button when your streak is at risk.</span>
</div>

<div style="background:rgba(255,60,172,0.1);border-left:3px solid var(--pink);padding:10px 12px;border-radius:0 8px 8px 0;">
<strong style="color:var(--pink);">💭 Daily Wisdom</strong><br>
<span style="font-size:12px;color:var(--muted);">After 5 games, you'll see a personalized daily quote based on your dominant themes. Changes every day.</span>
</div>

<div style="background:rgba(255,215,0,0.1);border-left:3px solid var(--gold);padding:10px 12px;border-radius:0 8px 8px 0;">
<strong style="color:var(--gold);">⭐ Rate the App</strong><br>
<span style="font-size:12px;color:var(--muted);">Tap the "LEVEL UP" logo in the header to rate us on the App Store!</span>
</div>

<div style="background:rgba(0,210,106,0.1);border-left:3px solid var(--green);padding:10px 12px;border-radius:0 8px 8px 0;">
<strong style="color:var(--green);">📳 Haptic Feedback</strong><br>
<span style="font-size:12px;color:var(--muted);">Feel combos, level ups, and achievements on mobile devices with enhanced vibration patterns.</span>
</div>

</div>
</div></div>

<div style="display:flex;flex-direction:column;gap:12px;margin-top:16px;">
<button onclick="document.getElementById('qaModal').classList.remove('active');document.getElementById('founderModal').classList.add('active');" style="padding:14px;background:linear-gradient(135deg,var(--gold),var(--orange));border:none;border-radius:12px;color:#fff;font-size:15px;font-weight:600;cursor:pointer;box-shadow:0 2px 12px rgba(255,215,0,0.3);">👤 Meet the Founder</button>
<button id="resetBtn" style="padding:14px;background:transparent;border:2px solid var(--red);border-radius:12px;color:var(--red);font-size:14px;font-weight:600;cursor:pointer;">🔄 Reset All Progress</button>
</div>
<div id="qaBottom"></div>
</div></div>

<div class="modal" id="feedbackModal"><div class="modal-content"><div class="modal-icon" id="fbIcon">💡</div><div class="modal-title" id="fbTitle">Insight</div><div class="feedback-box"><div class="feedback-label" id="fbLabel">Reflection</div><div class="feedback-text" id="fbText">...</div></div><button class="modal-btn" id="nextBtn">Next</button></div></div>

<div class="modal" id="insightsModal" role="dialog" aria-label="Your collected insights"><div class="modal-content" id="insightsContent" style="max-height:80vh;overflow-y:auto;scroll-behavior:smooth;position:relative;">
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
<button onclick="document.getElementById('insightsModal').classList.remove('active')" style="width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--pink),var(--purple));border:none;color:#fff;font-size:18px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 15px rgba(255,60,172,0.4);transition:all 0.2s;flex-shrink:0;" onmouseover="this.style.transform='scale(1.1)';this.style.boxShadow='0 6px 20px rgba(255,60,172,0.6)'" onmouseout="this.style.transform='scale(1)';this.style.boxShadow='0 4px 15px rgba(255,60,172,0.4)'">✕</button>
<div class="modal-title" style="margin:0;flex:1;text-align:center;">Your Insights</div>
<div style="width:40px;"></div>
</div>
<div id="insightsFilter" style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px;justify-content:center;"></div>
<button class="scroll-bottom-btn" onclick="document.getElementById('insightsBottom').scrollIntoView({behavior:'smooth'})">⬇</button>
<div id="insightsListModal" style="text-align:left;"></div><div id="insightsBottom"></div></div></div>

<div class="modal" id="levelSelectModal"><div class="modal-content" style="position:relative;max-height:85vh;overflow-y:auto;">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
<button onclick="document.getElementById('levelSelectModal').classList.remove('active')" style="width:36px;height:36px;min-width:36px;border-radius:50%;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;color:#fff;font-size:16px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(255,107,53,0.4);transition:all 0.2s;flex-shrink:0;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">✕</button>
<div style="flex:1;">
<div class="modal-title" id="levelSelectTitle" style="margin:0;text-align:left;font-size:20px;">Level 1: Individual</div>
<div style="color:var(--muted);font-size:13px;" id="levelSelectDesc">Your relationship with yourself</div>
</div>
</div>
<div style="display:flex;flex-direction:column;gap:12px;">
<button class="modal-btn" id="levelMirrorBtn" style="background:linear-gradient(135deg,var(--gold),var(--orange));border:2px solid var(--pink);box-shadow:0 0 12px rgba(255,60,172,0.3);">🪞 Mirror Game<br><span style="font-size:12px;font-weight:400;opacity:0.9;">See yourself honestly</span></button>
<button class="modal-btn" id="levelAgreementBtn" style="background:linear-gradient(135deg,var(--gold),var(--orange));border:2px solid var(--border);opacity:0.5;">⚖️ Agreement Game<br><span style="font-size:12px;font-weight:400;opacity:0.8;">Practice acceptance</span></button>
<button class="modal-btn" id="levelMixedBtn" style="background:linear-gradient(135deg,var(--gold),var(--orange));border:2px solid var(--border);opacity:0.5;">🎲 Mixed Mode<br><span style="font-size:12px;font-weight:400;opacity:0.8;">Both games shuffled</span></button>
<button class="modal-btn" id="level30DayBtn" onclick="document.getElementById('levelSelectModal').classList.remove('active');showChallengeModal();" style="background:linear-gradient(135deg,var(--gold),var(--orange));border:2px solid var(--pink);box-shadow:0 0 12px rgba(255,60,172,0.3);">🎯 30-Day Challenge<br><span style="font-size:12px;font-weight:400;opacity:0.9;" id="level30DayStatus">1,000 breakthroughs</span></button>
<button class="modal-btn" id="levelInsightsBtn" style="background:linear-gradient(135deg,var(--gold),var(--orange));border:2px solid var(--pink);box-shadow:0 0 12px rgba(255,60,172,0.3);">💡 Your Insights<br><span style="font-size:12px;font-weight:400;opacity:0.9;" id="levelInsightsCount">0 collected</span></button>
</div>
<div id="levelProgress" style="margin-top:16px;padding:12px;background:var(--card);border-radius:10px;text-align:center;font-size:12px;color:var(--muted);"></div>
</div></div>

<div class="modal" id="patternModal"><div class="modal-content" id="patternContent" style="max-height:85vh;overflow-y:auto;scroll-behavior:smooth;position:relative;">
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
<button onclick="document.getElementById('patternModal').classList.remove('active')" style="width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--purple),var(--blue));border:none;color:#fff;font-size:18px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 15px rgba(120,75,160,0.4);transition:all 0.2s;flex-shrink:0;" onmouseover="this.style.transform='scale(1.1)';this.style.boxShadow='0 6px 20px rgba(120,75,160,0.6)'" onmouseout="this.style.transform='scale(1)';this.style.boxShadow='0 4px 15px rgba(120,75,160,0.4)'">✕</button>
<div class="modal-title" style="margin:0;flex:1;text-align:center;">Your Growth Profile</div>
<div style="width:40px;"></div>
</div>
<button class="scroll-bottom-btn" onclick="document.getElementById('patternBottom').scrollIntoView({behavior:'smooth'})">⬇</button>
<div id="patternProfile"></div>
<div id="patternBottom"></div>
</div></div>

<div class="modal" id="aiModal"><div class="modal-content" id="aiContent" style="max-height:85vh;overflow-y:auto;scroll-behavior:smooth;position:relative;">
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
<button onclick="document.getElementById('aiModal').classList.remove('active')" style="width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#FF4757,#FF6B81);border:none;color:#fff;font-size:18px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 15px rgba(255,71,87,0.4);transition:all 0.2s;flex-shrink:0;" onmouseover="this.style.transform='scale(1.1)';this.style.boxShadow='0 6px 20px rgba(255,71,87,0.6)'" onmouseout="this.style.transform='scale(1)';this.style.boxShadow='0 4px 15px rgba(255,71,87,0.4)'">✕</button>
<div style="flex:1;text-align:center;">
<div class="modal-icon" style="margin:0;">❤️</div>
<div class="modal-title" style="margin:0;background:linear-gradient(135deg,#FF4757,#FF6B81);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">Deep Insight</div>
</div>
<div style="width:40px;"></div>
</div>
<div style="display:flex;gap:8px;margin-bottom:12px;">
<button onclick="printDeepInsight()" style="flex:1;padding:10px 14px;background:linear-gradient(135deg,#FF4757,#FF6B81);border:none;border-radius:10px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;">🖨️ Print / Save</button>
<button onclick="document.getElementById('aiBottom').scrollIntoView({behavior:'smooth'})" style="padding:10px 14px;background:linear-gradient(135deg,#FF4757,#FF6B81);border:none;border-radius:10px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;">⬇ Scroll</button>
</div>
<div id="aiAnalysisContent" style="background:linear-gradient(135deg,rgba(255,71,87,0.1),rgba(255,107,129,0.1));border:2px solid #FF4757;border-radius:12px;padding:16px;margin-bottom:16px;text-align:left;">
<p style="color:var(--muted);text-align:center;">Play more games to generate personalized analysis!</p>
</div>
<div id="aiBottom"></div>
</div></div>

<div class="modal" id="founderModal"><div class="modal-content" id="founderContent" style="max-height:85vh;overflow-y:auto;scroll-behavior:smooth;position:relative;">
<div style="display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:16px;">
<button onclick="document.getElementById('founderModal').classList.remove('active')" style="width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--orange));border:none;color:#fff;font-size:18px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 15px rgba(255,215,0,0.4);transition:all 0.2s;flex-shrink:0;" onmouseover="this.style.transform='scale(1.1)';this.style.boxShadow='0 6px 20px rgba(255,215,0,0.6)'" onmouseout="this.style.transform='scale(1)';this.style.boxShadow='0 4px 15px rgba(255,215,0,0.4)'">✕</button>
<div style="flex:1;text-align:center;">
<img src="arthur.jpg" alt="Arthur Palyan" style="width:100px;height:100px;border-radius:50%;object-fit:cover;border:3px solid var(--gold);box-shadow:0 4px 20px rgba(255,215,0,0.4);margin-bottom:16px;">
<div style="font-size:20px;font-weight:800;background:linear-gradient(135deg,var(--gold),var(--orange));-webkit-background-clip:text;-webkit-text-fill-color:transparent;white-space:nowrap;">Meet Arthur Palyan</div>
<div style="font-size:13px;color:var(--muted);margin-top:4px;">Creator of the 7 Levels of Self</div>
</div>
<div style="width:40px;"></div>
</div>
<button class="scroll-bottom-btn" onclick="document.getElementById('founderBottom').scrollIntoView({behavior:'smooth'})">⬇</button>

<div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:16px;margin-bottom:16px;border-left:3px solid var(--gold);">
<div style="font-size:14px;color:var(--text);line-height:1.7;font-style:italic;">"I built this because I watched brilliant people destroy their lives solving the wrong level. The pattern you can't see is the pattern running your life. This game makes it visible. What you do next is up to you."</div>
</div>

<div style="font-size:13px;color:var(--muted);line-height:1.7;margin-bottom:16px;">
After 10 years of deep transformational work (Landmark, MITT, Insight Seminars, Ancestral Medicine), Arthur discovered the 7 Levels of Self framework that finally made sense of the journey from broken to whole.
</div>

<div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:16px;">
<div style="font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--gold);font-weight:700;margin-bottom:10px;">Training & Experience</div>
<div style="font-size:12px;color:var(--muted);line-height:1.8;">
• 20+ years transforming relationships with money<br>
• Landmark Worldwide<br>
• MITT (Mastery in Transformational Training)<br>
• Insight Seminars<br>
• Ancestral Medicine<br>
• Creator of 20+ subconscious exercises
</div>
</div>

<div style="background:linear-gradient(135deg,rgba(255,107,53,0.1),rgba(255,60,172,0.1));border:2px solid var(--pink);border-radius:12px;padding:16px;margin-bottom:16px;">
<div style="font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--pink);font-weight:700;margin-bottom:8px;">1-on-1 Integration</div>
<div style="font-size:16px;color:var(--text);margin-bottom:12px;">
<strong style="color:var(--gold);">$900</strong>/session
</div>
<a href="https://www.levelsofself.com/_paylink/AZusoyiq" target="_blank" style="display:block;width:100%;padding:14px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:10px;color:#fff;font-size:14px;font-weight:700;text-decoration:none;text-align:center;">💬 Book a Session</a>
<div style="text-align:center;margin-top:8px;font-size:11px;color:var(--muted);">If you need a discount, just ask.</div>
</div>

<div id="founderBottom"></div>
</div></div>

<div class="modal" id="archetypeModal"><div class="modal-content" style="text-align:center;">
<div class="modal-icon" id="archetypeModalIcon">🎭</div>
<div class="modal-title">Your Archetype</div>
<div style="background:var(--card);border:2px solid var(--pink);border-radius:16px;padding:20px;margin-bottom:16px;">
<div style="font-size:48px;margin-bottom:12px;" id="archetypeIcon">🔮</div>
<div style="font-size:24px;font-weight:800;color:var(--pink);margin-bottom:8px;" id="archetypeName">The Wise Observer</div>
<div style="color:var(--muted);font-size:14px;line-height:1.6;margin-bottom:16px;" id="archetypeDesc">You see patterns others miss and understand that true strength comes from understanding rather than control.</div>
<div id="archetypeTraits" style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center;"></div>
</div>
<button class="modal-btn" id="archetypeClose">Amazing!</button>
</div></div>

<!-- XP Details Modal -->
<div class="modal" id="xpDetailsModal"><div class="modal-content" style="max-height:80vh;overflow-y:auto;position:relative;padding-top:16px;">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
<button onclick="document.getElementById('xpDetailsModal').classList.remove('active')" style="width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--orange));border:none;color:#fff;font-size:16px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(255,215,0,0.4);transition:all 0.2s;flex-shrink:0;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">✕</button>
<div style="font-size:22px;font-weight:800;color:var(--gold);">⭐ XP Breakdown</div>
</div>
<div id="xpDetailsContent" style="text-align:left;"></div>
<div style="margin-top:16px;text-align:center;">
<div style="font-size:13px;color:var(--muted);margin-bottom:12px;">Ways to earn XP:</div>
<div style="font-size:12px;color:var(--text);line-height:1.8;text-align:left;background:var(--card);padding:12px;border-radius:8px;">• <strong>Mirror Game:</strong> 15 XP per reflection<br>• <strong>Agreement Game:</strong> 10 XP (correct) / 2 XP (wrong)<br>• <strong>Worldwide Challenge:</strong> 12 XP (correct) / 2 XP (wrong)<br>• <strong>Combos:</strong> 5x=+10, 10x=+20, 15x=+30, 20x=+50 XP<br>• <strong>Perfect Game:</strong> +25 XP (10/10) or +30 XP (3/3 daily)<br>• <strong>Daily Login:</strong> 10-50 XP (increases each day)</div>
</div>
</div></div>

<!-- Stats Details Modal -->
<div class="modal" id="statDetailsModal"><div class="modal-content" style="max-height:80vh;overflow-y:auto;position:relative;">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
<button onclick="document.getElementById('statDetailsModal').classList.remove('active')" style="width:36px;height:36px;min-width:36px;border-radius:50%;background:linear-gradient(135deg,var(--purple),var(--blue));border:none;color:#fff;font-size:16px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(120,75,160,0.4);transition:all 0.2s;flex-shrink:0;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">✕</button>
<div id="statDetailsTitle" style="font-size:20px;font-weight:800;color:var(--text);flex:1;">Stat Details</div>
</div>
<div id="statDetailsContent" style="text-align:left;"></div>
</div></div>

<!-- 30-Day Challenge Modal -->
<div class="modal" id="challengeModal"><div class="modal-content" style="max-height:85vh;overflow-y:auto;position:relative;padding-top:16px;">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
<button onclick="document.getElementById('challengeModal').classList.remove('active')" style="width:36px;height:36px;min-width:36px;border-radius:50%;background:linear-gradient(135deg,var(--orange),var(--pink));border:2px solid var(--gold);color:#fff;font-size:16px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(255,215,0,0.4);transition:all 0.2s;flex-shrink:0;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">✕</button>
<div style="flex:1;">
<div style="font-size:22px;font-weight:800;color:var(--orange);">🎯 30-Day Challenge</div>
<div style="font-size:12px;color:var(--muted);">1,000 Breakthroughs in 30 Days</div>
</div>
</div>

<div id="challengeNotStarted" style="display:none;">
<div style="background:linear-gradient(135deg,rgba(255,107,53,0.1),rgba(255,60,172,0.1));border:2px solid var(--orange);border-radius:16px;padding:24px;text-align:center;margin-bottom:20px;">
<div style="font-size:48px;margin-bottom:12px;">🚀</div>
<div style="font-size:18px;font-weight:700;color:var(--text);margin-bottom:8px;">Ready to Transform?</div>
<div style="font-size:13px;color:var(--muted);line-height:1.6;margin-bottom:16px;">Commit to 15-20 minutes daily.<br>5 games per day. 30 days.<br>1,000 breakthroughs. Real transformation.</div>
<button class="modal-btn" onclick="startChallenge()" style="background:linear-gradient(135deg,var(--orange),var(--pink));font-size:16px;padding:14px 32px;">Start My Challenge</button>
</div>
</div>

<div id="challengeActive" style="display:none;">
<div style="background:var(--card);border-radius:16px;padding:20px;margin-bottom:16px;">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
<div style="font-size:14px;color:var(--muted);">Day <span id="challengeDay" style="color:var(--orange);font-weight:700;">1</span> of 30</div>
<div id="challengeStatus" style="font-size:12px;font-weight:600;padding:4px 10px;border-radius:12px;background:var(--green);color:#fff;">ON TRACK</div>
</div>
<div style="font-size:42px;font-weight:800;text-align:center;color:var(--text);margin-bottom:8px;"><span id="challengeBreakthroughs">0</span><span style="font-size:20px;color:var(--muted);font-weight:400;">/1,000</span></div>
<div style="height:12px;background:var(--border);border-radius:6px;overflow:hidden;margin-bottom:8px;">
<div id="challengeProgress" style="height:100%;background:linear-gradient(90deg,var(--orange),var(--pink));border-radius:6px;width:0%;transition:width 0.5s;"></div>
</div>
<div style="display:flex;justify-content:space-between;font-size:11px;color:var(--muted);">
<span>Today: <strong id="challengeToday" style="color:var(--green);">0</strong></span>
<span>Need: <strong id="challengeNeeded" style="color:var(--orange);">34/day</strong></span>
</div>
</div>

<div style="font-size:12px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;">Breakdown</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px;">
<div style="background:var(--card);border-radius:10px;padding:12px;text-align:center;">
<div style="font-size:20px;margin-bottom:4px;">🪞</div>
<div style="font-size:18px;font-weight:700;color:var(--text);" id="challengeMirror">0</div>
<div style="font-size:10px;color:var(--muted);">Mirror</div>
</div>
<div style="background:var(--card);border-radius:10px;padding:12px;text-align:center;">
<div style="font-size:20px;margin-bottom:4px;">⚖️</div>
<div style="font-size:18px;font-weight:700;color:var(--text);" id="challengeAgreement">0</div>
<div style="font-size:10px;color:var(--muted);">Agreement</div>
</div>
<div style="background:var(--card);border-radius:10px;padding:12px;text-align:center;">
<div style="font-size:20px;margin-bottom:4px;">🌍</div>
<div style="font-size:18px;font-weight:700;color:var(--text);" id="challengeDaily">0</div>
<div style="font-size:10px;color:var(--muted);">Daily</div>
</div>
<div style="background:var(--card);border-radius:10px;padding:12px;text-align:center;">
<div style="font-size:20px;margin-bottom:4px;">❤️</div>
<div style="font-size:18px;font-weight:700;color:var(--text);" id="challengeDeep">0</div>
<div style="font-size:10px;color:var(--muted);">Deep</div>
</div>
</div>

<div style="background:linear-gradient(135deg,rgba(255,107,53,0.1),rgba(255,60,172,0.05));border-radius:12px;padding:14px;text-align:center;font-size:12px;color:var(--muted);line-height:1.6;">
<strong style="color:var(--orange);">💡 Tip:</strong> Play 5 games daily to stay on track!
</div>

<div style="text-align:center;margin-top:16px;">
<button onclick="resetChallenge()" style="background:none;border:none;color:var(--muted);font-size:11px;cursor:pointer;text-decoration:underline;">Reset Challenge</button>
</div>
</div>

<div id="challengeComplete" style="display:none;">
<div style="background:linear-gradient(135deg,rgba(255,215,0,0.2),rgba(255,107,53,0.1));border:2px solid var(--gold);border-radius:16px;padding:24px;text-align:center;margin-bottom:20px;">
<div style="font-size:64px;margin-bottom:12px;">🏆</div>
<div style="font-size:22px;font-weight:800;color:var(--gold);margin-bottom:8px;">CHALLENGE COMPLETE!</div>
<div style="font-size:14px;color:var(--text);margin-bottom:4px;">You achieved <strong>1,000 Breakthroughs</strong></div>
<div style="font-size:12px;color:var(--muted);">in <span id="challengeCompletedDays">30</span> days</div>
</div>

<!-- BREAKTHROUGH LETTER SECTION -->
<div id="breakthroughLetterSection" style="background:linear-gradient(135deg,rgba(255,60,172,0.08),rgba(120,75,160,0.08));border:1px solid var(--pink);border-radius:16px;padding:20px;margin-bottom:20px;text-align:left;">
<div style="text-align:center;margin-bottom:16px;">
<div style="font-size:11px;text-transform:uppercase;letter-spacing:2px;color:var(--pink);font-weight:600;">Your Personal</div>
<div style="font-size:20px;font-weight:800;color:var(--text);">Breakthrough Letter</div>
</div>
<div id="breakthroughLetterContent" style="font-size:14px;line-height:1.7;color:var(--text);"></div>

<!-- Coaching CTA -->
<div style="margin-top:20px;padding:16px;background:linear-gradient(135deg,rgba(255,107,53,0.1),rgba(255,60,172,0.1));border-radius:12px;text-align:center;">
<div style="font-size:13px;color:var(--text);margin-bottom:12px;"><strong>Ready to break these patterns for good?</strong></div>
<a href="https://wa.me/+18184399770?text=Hi%20Arthur%2C%20I%20just%20completed%20the%2030-Day%20Challenge%20and%20received%20my%20Breakthrough%20Letter.%20I%E2%80%99d%20love%20to%20explore%20going%20deeper." target="_blank" style="display:inline-block;padding:12px 24px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:10px;color:#fff;font-size:14px;font-weight:700;text-decoration:none;box-shadow:0 4px 15px rgba(255,107,53,0.3);">💬 Talk to Arthur</a>
</div>

<div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border);text-align:center;">
<button onclick="printBreakthroughLetter()" style="padding:10px 20px;background:var(--card);border:1px solid var(--pink);border-radius:8px;color:var(--pink);font-size:13px;font-weight:600;cursor:pointer;margin-right:8px;">🖨️ Print</button>
<button onclick="shareBreakthroughLetter()" style="padding:10px 20px;background:linear-gradient(135deg,var(--pink),var(--purple));border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;">📤 Share</button>
</div>
</div>

<div style="background:var(--card);border-radius:12px;padding:16px;margin-bottom:16px;text-align:center;">
<div style="font-size:14px;color:var(--text);margin-bottom:8px;">You've earned a <strong style="color:var(--gold);">FREE Coaching Session</strong> with Arthur!</div>
<div style="font-size:12px;color:var(--muted);">Check your coins in the Reward Shop to redeem.</div>
</div>
<button class="modal-btn" onclick="shareChallenge()" style="background:linear-gradient(135deg,var(--gold),var(--orange));margin-bottom:10px;">Share Achievement 🎉</button>
<button class="modal-btn" onclick="startChallenge()" style="background:var(--card);color:var(--text);">Start New Challenge</button>
</div>

</div></div>

<!-- Coin Shop Modal -->
<div class="modal" id="coinShopModal"><div class="modal-content" style="max-height:85vh;overflow-y:auto;position:relative;">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
<button onclick="document.getElementById('coinShopModal').classList.remove('active')" style="width:36px;height:36px;min-width:36px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--orange));border:none;color:#fff;font-size:16px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(255,215,0,0.4);transition:all 0.2s;flex-shrink:0;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">✕</button>
<div style="flex:1;">
<div style="font-size:22px;font-weight:800;color:var(--gold);">💰 Reward Shop</div>
<div style="font-size:12px;color:var(--muted);"><span id="shopCoinCount">0</span> coins earned</div>
</div>
</div>

<div style="font-size:11px;color:var(--muted);text-align:center;margin-bottom:16px;padding:10px;background:var(--card);border-radius:8px;">
Earn coins every game you play. Redeem for real rewards!
</div>

<div style="display:flex;flex-direction:column;gap:12px;">

<!-- 🏆 30-DAY CHALLENGE REWARD -->
<div style="font-size:11px;color:var(--gold);text-transform:uppercase;letter-spacing:1px;margin:0 0 4px;text-align:center;font-weight:700;">🏆 30-Day Challenge Reward</div>

<div class="coin-reward legendary" id="rewardChallenge" onclick="redeemReward('challengeFree', 0, 'FREE Coaching Session (30-Day)')">
<div class="coin-reward-left">
<div class="coin-reward-icon">👑</div>
<div class="coin-reward-info">
<div class="coin-reward-name">FREE Coaching Session</div>
<div class="coin-reward-desc">Complete 1,000 breakthroughs to unlock</div>
</div>
</div>
</div>

<!-- COIN REWARDS -->
<div style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin:12px 0 4px;text-align:center;">Coin Rewards</div>

<div class="coin-reward" id="reward0" onclick="redeemReward('workshop20', 500, '20% Off Workshop')" style="border:2px solid var(--green);">
<div class="coin-reward-left">
<div class="coin-reward-icon">🎟️</div>
<div class="coin-reward-info">
<div class="coin-reward-name">20% Off Workshop</div>
<div class="coin-reward-desc">Your first reward!</div>
</div>
</div>
<div class="coin-reward-cost"><span class="coin-cost-amount">500</span> coins</div>
</div>

<div class="coin-reward" id="reward1" onclick="redeemReward('session20', 1000, '20% Off Coaching')">
<div class="coin-reward-left">
<div class="coin-reward-icon">💬</div>
<div class="coin-reward-info">
<div class="coin-reward-name">20% Off Coaching</div>
<div class="coin-reward-desc">1-on-1 session ($180 off)</div>
</div>
</div>
<div class="coin-reward-cost"><span class="coin-cost-amount">1,000</span> coins</div>
</div>

<div class="coin-reward" id="reward2" onclick="redeemReward('session50', 5000, '50% Off Coaching')">
<div class="coin-reward-left">
<div class="coin-reward-icon">✨</div>
<div class="coin-reward-info">
<div class="coin-reward-name">50% Off Coaching</div>
<div class="coin-reward-desc">1-on-1 session ($450 off)</div>
</div>
</div>
<div class="coin-reward-cost"><span class="coin-cost-amount">5,000</span> coins</div>
</div>

<div class="coin-reward" id="reward3" onclick="redeemReward('workshop50', 7500, '50% Off Workshop')">
<div class="coin-reward-left">
<div class="coin-reward-icon">🎓</div>
<div class="coin-reward-info">
<div class="coin-reward-name">50% Off Workshop</div>
<div class="coin-reward-desc">Any Level Up workshop</div>
</div>
</div>
<div class="coin-reward-cost"><span class="coin-cost-amount">7,500</span> coins</div>
</div>

<div class="coin-reward" id="reward4" onclick="redeemReward('sessionFree', 10000, 'FREE Coaching Session')">
<div class="coin-reward-left">
<div class="coin-reward-icon">👑</div>
<div class="coin-reward-info">
<div class="coin-reward-name">FREE Coaching Session</div>
<div class="coin-reward-desc">1-on-1 with Arthur ($900 value)</div>
</div>
</div>
<div class="coin-reward-cost"><span class="coin-cost-amount">10,000</span> coins</div>
</div>

<div class="coin-reward" id="reward5" onclick="redeemReward('workshopFree', 12500, 'FREE Workshop')">
<div class="coin-reward-left">
<div class="coin-reward-icon">🎁</div>
<div class="coin-reward-info">
<div class="coin-reward-name">FREE Workshop</div>
<div class="coin-reward-desc">Any Level Up workshop</div>
</div>
</div>
<div class="coin-reward-cost"><span class="coin-cost-amount">12,500</span> coins</div>
</div>

<!-- LEVEL PREVIEWS -->
<div style="font-size:11px;color:var(--purple);text-transform:uppercase;letter-spacing:1px;margin:20px 0 4px;text-align:center;font-weight:700;">🔮 Level Access Passes</div>
<div style="font-size:11px;color:var(--muted);text-align:center;margin-bottom:8px;">Unlock full access to higher levels for 10 days. Explore everything!</div>

<div class="coin-reward" id="previewL3" onclick="redeemLevelPreview(3, 300)" style="border-color:var(--blue);">
<div class="coin-reward-left">
<div class="coin-reward-icon">👥</div>
<div class="coin-reward-info">
<div class="coin-reward-name">Level 3: Family Self</div>
<div class="coin-reward-desc">10 days full access</div>
</div>
</div>
<div class="coin-reward-cost"><span class="coin-cost-amount">300</span> coins</div>
</div>

<div class="coin-reward" id="previewL4" onclick="redeemLevelPreview(4, 400)" style="border-color:var(--purple);">
<div class="coin-reward-left">
<div class="coin-reward-icon">💼</div>
<div class="coin-reward-info">
<div class="coin-reward-name">Level 4: Professional Self</div>
<div class="coin-reward-desc">10 days full access</div>
</div>
</div>
<div class="coin-reward-cost"><span class="coin-cost-amount">400</span> coins</div>
</div>

<div class="coin-reward" id="previewL5" onclick="redeemLevelPreview(5, 500)" style="border-color:var(--pink);">
<div class="coin-reward-left">
<div class="coin-reward-icon">🌍</div>
<div class="coin-reward-info">
<div class="coin-reward-name">Level 5: Societal Self</div>
<div class="coin-reward-desc">10 days full access</div>
</div>
</div>
<div class="coin-reward-cost"><span class="coin-cost-amount">500</span> coins</div>
</div>

<div class="coin-reward" id="previewL6" onclick="redeemLevelPreview(6, 600)" style="border-color:var(--orange);">
<div class="coin-reward-left">
<div class="coin-reward-icon">🌀</div>
<div class="coin-reward-info">
<div class="coin-reward-name">Level 6: Existential Self</div>
<div class="coin-reward-desc">10 days full access</div>
</div>
</div>
<div class="coin-reward-cost"><span class="coin-cost-amount">600</span> coins</div>
</div>

<div class="coin-reward" id="previewL7" onclick="redeemLevelPreview(7, 1000)" style="border-color:var(--gold);background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(255,107,53,0.05));">
<div class="coin-reward-left">
<div class="coin-reward-icon">✨</div>
<div class="coin-reward-info">
<div class="coin-reward-name">Level 7: Transcendent Self</div>
<div class="coin-reward-desc">10 days full access</div>
</div>
</div>
<div class="coin-reward-cost"><span class="coin-cost-amount">1,000</span> coins</div>
</div>

</div>

<div id="redeemedCodes" style="margin-top:20px;display:none;">
<div style="font-size:13px;font-weight:600;color:var(--text);margin-bottom:8px;">Your Rewards:</div>
<div id="redeemedList" style="font-size:12px;color:var(--muted);"></div>
</div>

</div></div>

<div class="modal" id="resetModal"><div class="modal-content" style="text-align:center;">
<div style="font-size:48px;margin-bottom:12px;">⚠️</div>
<div class="modal-title" style="color:var(--red);">Reset All Progress?</div>
<div style="color:var(--muted);font-size:14px;line-height:1.6;margin-bottom:20px;">This will permanently delete:<br>• All XP and levels<br>• Your streak<br>• All collected insights<br>• Your pattern profile<br>• Cached files (forces fresh download)<br><br><strong style="color:var(--text);">This cannot be undone.</strong></div>
<div style="display:flex;gap:12px;">
<button id="resetCancel" style="flex:1;padding:14px;background:var(--card);border:1px solid var(--border);border-radius:12px;color:var(--muted);font-size:15px;font-weight:600;cursor:pointer;">Cancel</button>
<button id="resetConfirm" style="flex:1;padding:14px;background:var(--red);border:none;border-radius:12px;color:#fff;font-size:15px;font-weight:700;cursor:pointer;">Reset</button>
</div>
</div></div>

<!-- Milestone Share Prompt Modal -->
<div class="modal" id="milestoneShareModal"><div class="modal-content" style="text-align:center;">
<div style="font-size:56px;margin-bottom:12px;" id="milestoneShareIcon">🏆</div>
<div class="modal-title" id="milestoneShareTitle">Achievement Unlocked!</div>
<div style="color:var(--gold);font-size:18px;font-weight:700;margin-bottom:12px;" id="milestoneShareMsg">10 Games Played!</div>
<div style="color:var(--muted);font-size:14px;line-height:1.6;margin-bottom:20px;">Share your progress and challenge your friends to discover their patterns!</div>
<div style="display:flex;gap:10px;">
<button onclick="document.getElementById('milestoneShareModal').classList.remove('active')" style="flex:1;padding:14px;background:var(--card);border:1px solid var(--border);border-radius:12px;color:var(--muted);font-size:15px;font-weight:600;cursor:pointer;">Maybe Later</button>
<button onclick="shareMilestone();document.getElementById('milestoneShareModal').classList.remove('active')" style="flex:1;padding:14px;background:linear-gradient(135deg,var(--green),#00B85D);border:none;border-radius:12px;color:#fff;font-size:15px;font-weight:700;cursor:pointer;">📤 Share Now</button>
</div>
</div></div>

<!-- Take a Break Modal -->
<div class="modal" id="takeBreakModal"><div class="modal-content" style="text-align:center;">
<div style="font-size:48px;margin-bottom:12px;">🌿</div>
<div class="modal-title" style="color:var(--green);">You've been reflecting deeply</div>
<div style="color:var(--muted);font-size:14px;line-height:1.6;margin-bottom:20px;">Take a moment to breathe.<br>This work isn't meant to be rushed.<br><br><em style="color:var(--text);">What you've uncovered today will still be here tomorrow.</em></div>
<div style="display:flex;gap:10px;">
<button onclick="document.getElementById('takeBreakModal').classList.remove('active');goHome();" style="flex:1;padding:14px;background:linear-gradient(135deg,var(--green),#00B85D);border:none;border-radius:12px;color:#fff;font-size:15px;font-weight:700;cursor:pointer;">🌿 Take a Break</button>
<button onclick="document.getElementById('takeBreakModal').classList.remove('active');sessionBreakShown=true;" style="flex:1;padding:14px;background:var(--card);border:1px solid var(--border);border-radius:12px;color:var(--muted);font-size:15px;font-weight:600;cursor:pointer;">Keep Going</button>
</div>
</div></div>

<!-- Weekly Summary Modal -->
<div class="modal" id="weeklySummaryModal"><div class="modal-content" style="text-align:center;">
<div style="font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Your Week in Patterns</div>
<div style="font-size:14px;color:var(--text);margin-bottom:16px;" id="weeklyDateRange"></div>
<div style="background:var(--card);border-radius:12px;padding:16px;margin-bottom:16px;text-align:left;">
<div style="display:flex;justify-content:space-between;margin-bottom:12px;"><span style="color:var(--muted);font-size:13px;">Scenarios explored</span><span style="color:var(--text);font-weight:700;" id="weeklyScenarios">0</span></div>
<div style="display:flex;justify-content:space-between;margin-bottom:12px;"><span style="color:var(--muted);font-size:13px;">New insights collected</span><span style="color:var(--text);font-weight:700;" id="weeklyInsights">0</span></div>
<div style="display:flex;justify-content:space-between;"><span style="color:var(--muted);font-size:13px;">Acceptance rate</span><span style="color:var(--text);font-weight:700;" id="weeklyAcceptance">--%</span></div>
</div>
<div style="background:linear-gradient(135deg,rgba(255,60,172,0.1),rgba(120,75,160,0.1));border:1px solid var(--pink);border-radius:12px;padding:16px;margin-bottom:16px;">
<div style="font-size:12px;color:var(--muted);margin-bottom:8px;">Your growth theme this week</div>
<div style="font-size:24px;margin-bottom:4px;" id="weeklyThemeIcon">🛡️</div>
<div style="font-size:18px;font-weight:700;color:var(--pink);" id="weeklyThemeName">BOUNDARIES</div>
<div style="font-size:13px;color:var(--muted);font-style:italic;" id="weeklyThemeDesc">Learning when to say no</div>
</div>
<div style="display:flex;gap:10px;">
<button onclick="shareWeeklySummary()" style="flex:1;padding:14px;background:linear-gradient(135deg,var(--pink),var(--purple));border:none;border-radius:12px;color:#fff;font-size:15px;font-weight:700;cursor:pointer;">📤 Share</button>
<button onclick="dismissWeeklySummary()" style="flex:1;padding:14px;background:var(--card);border:1px solid var(--border);border-radius:12px;color:var(--muted);font-size:15px;font-weight:600;cursor:pointer;">Continue</button>
</div>
</div></div>

<!-- Shareable Pattern Card Modal -->
<div class="share-card-modal" id="shareCardModal">
<button class="share-card-close" onclick="document.getElementById('shareCardModal').classList.remove('active')">✕</button>
<div style="display:flex;flex-direction:column;align-items:center;">
<div class="share-card" id="shareCard">
<div class="share-card-header">
<div class="share-card-logo">Level Up</div>
<div class="share-card-label">My Pattern</div>
</div>
<div class="share-card-center">
<div class="share-card-icon" id="shareCardIcon">🪞</div>
<div class="share-card-name" id="shareCardName">The Honest Avoider</div>
<div class="share-card-tagline" id="shareCardTagline">"I see myself clearly but struggle to act on what I see."</div>
</div>
<div class="share-card-stats">
<div class="share-card-stat"><div class="share-card-stat-value" id="shareCardRecognition">72%</div><div class="share-card-stat-label">Self-Recognition</div></div>
<div class="share-card-stat"><div class="share-card-stat-value" id="shareCardAcceptance">48%</div><div class="share-card-stat-label">Acceptance</div></div>
</div>
<div class="share-card-cta">
<div class="share-card-cta-q">What's your pattern?</div>
<div class="share-card-cta-url">100levelup.com</div>
</div>
</div>
<div class="share-card-actions">
<button class="share-card-btn secondary" onclick="copyPatternLink()">📋 Copy Link</button>
<button class="share-card-btn primary" onclick="sharePatternCard()">📤 Share</button>
</div>
</div>
</div>

<!-- Coaching Offer Modal -->
<div class="modal" id="coachingModal" role="dialog" aria-label="Meet Our Coaches"><div class="modal-content coaching-modal-content" style="max-width:480px;">
<button class="modal-close-x" onclick="document.getElementById('coachingModal').classList.remove('active')">✕</button>
<div style="text-align:center;margin-bottom:24px;">
<span class="coaching-offer-label">1-on-1 Integration</span>
<h2 class="coaching-offer-title" style="margin-top:12px;">Meet Our Coaches</h2>
<p style="font-size:13px;color:var(--muted);margin-top:8px;">Transform insights into lasting change</p>
</div>

<!-- Arthur - Founder -->
<div style="background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(255,107,53,0.05));border:2px solid var(--gold);border-radius:16px;padding:20px;margin-bottom:16px;">
<div style="display:flex;align-items:center;gap:16px;margin-bottom:16px;">
<img src="arthur.jpg" alt="Arthur Palyan" style="width:72px;height:72px;min-width:72px;border-radius:50%;object-fit:cover;border:3px solid var(--gold);box-shadow:0 4px 15px rgba(255,215,0,0.3);">
<div style="flex:1;min-width:0;">
<div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;flex-wrap:wrap;">
<span style="font-size:18px;font-weight:800;color:var(--text);">Arthur Palyan</span>
<span style="font-size:10px;font-weight:700;background:var(--gold);color:#000;padding:3px 8px;border-radius:10px;">FOUNDER</span>
</div>
<div style="font-size:12px;color:var(--muted);margin-bottom:6px;">Creator of the 7 Levels of Self</div>
<div style="display:flex;gap:6px;">
<span style="font-size:11px;background:rgba(255,255,255,0.1);border:1px solid var(--border);padding:3px 8px;border-radius:6px;">🇺🇸 English</span>
</div>
</div>
</div>
<div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;">
<div><span style="font-size:24px;font-weight:800;color:var(--gold);">$900</span><span style="font-size:13px;color:var(--muted);"> /session</span></div>
<div style="display:flex;gap:8px;flex-wrap:wrap;">
<a href="https://wa.me/+18184399770?text=Hi%20Arthur,%20I've%20been%20playing%20Level%20Up%20and%20have%20some%20questions%20about%20coaching." target="_blank" style="padding:12px 16px;background:#25D366;border:none;border-radius:10px;color:#fff;font-size:14px;font-weight:700;text-decoration:none;display:flex;align-items:center;gap:6px;">💬 Chat</a>
<a href="https://www.levelsofself.com/_paylink/AZusoyiq" target="_blank" style="padding:12px 20px;background:linear-gradient(135deg,var(--gold),var(--orange));border:none;border-radius:10px;color:#000;font-size:14px;font-weight:700;text-decoration:none;box-shadow:0 4px 15px rgba(255,215,0,0.3);">Book Now</a>
</div>
</div>
</div>

<!-- Lily - Self-Awareness Coach -->
<div style="background:var(--card);border:2px solid #a855f7;border-radius:14px;padding:16px;margin-bottom:12px;margin-top:16px;box-shadow:0 0 12px rgba(168,85,247,0.2);cursor:pointer;" onclick="document.getElementById('coachingModal').classList.remove('active');openLily();">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
<img src="Lily_Bot.jpg" alt="Lily - Self-Awareness Coach" style="width:56px;height:56px;min-width:56px;min-height:56px;border-radius:50%;object-fit:cover;border:2px solid #a855f7;box-shadow:0 0 12px rgba(168,85,247,0.4);" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
<div style="flex:1;min-width:0;">
<div style="font-size:15px;font-weight:700;color:var(--text);margin-bottom:4px;">Lily <span style="font-size:10px;background:linear-gradient(135deg,#a855f7,#ec4899);color:#fff;padding:2px 6px;border-radius:4px;font-weight:700;vertical-align:middle;">SELF-AWARENESS COACH</span></div>
<div style="display:flex;gap:4px;flex-wrap:wrap;">
<span style="font-size:11px;background:rgba(255,255,255,0.1);border:1px solid var(--border);padding:3px 8px;border-radius:6px;color:var(--text);">Pattern Analysis</span>
<span style="font-size:11px;background:rgba(255,255,255,0.1);border:1px solid var(--border);padding:3px 8px;border-radius:6px;color:var(--text);">24/7</span>
</div>
</div>
</div>
<div style="display:flex;align-items:center;justify-content:space-between;">
<div style="font-size:20px;font-weight:800;color:var(--green);">FREE</div>
<div style="padding:10px 20px;background:linear-gradient(135deg,#a855f7,#ec4899);border-radius:8px;color:#fff;font-size:13px;font-weight:700;">💬 Talk to Lily</div>
</div>
</div>

<!-- Certified Coaches Section -->
<div style="font-size:11px;text-transform:uppercase;letter-spacing:1.5px;color:var(--pink);font-weight:700;margin:24px 0 16px;text-align:center;">Certified Coaches</div>

<!-- Laurie -->
<div style="background:var(--card);border:2px solid var(--pink);border-radius:14px;padding:16px;margin-bottom:12px;box-shadow:0 0 12px rgba(255,60,172,0.2);">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
<img src="laurie.jpg" alt="Laurie Van Werde" onclick="document.getElementById('coachProfileLaurie').classList.add('active')" style="width:56px;height:56px;min-width:56px;min-height:56px;border-radius:50%;object-fit:cover;object-position:center;border:2px solid var(--pink);cursor:pointer;box-shadow:0 0 12px rgba(255,60,172,0.4);" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
<div style="flex:1;min-width:0;">
<div style="font-size:15px;font-weight:700;color:var(--text);margin-bottom:4px;">Laurie Van Werde <span style="font-size:10px;background:var(--gold);color:#000;padding:2px 6px;border-radius:4px;font-weight:700;vertical-align:middle;">HEAD COACH</span></div>
<div style="display:flex;gap:4px;flex-wrap:wrap;">
<span style="font-size:11px;background:rgba(255,255,255,0.1);border:1px solid var(--border);padding:3px 8px;border-radius:6px;color:var(--text);">🇺🇸 English</span>
<span style="font-size:11px;background:rgba(255,255,255,0.1);border:1px solid var(--border);padding:3px 8px;border-radius:6px;color:var(--text);">🇳🇱 Dutch</span>
</div>
</div>
</div>
<div style="display:flex;align-items:center;justify-content:space-between;">
<div style="font-size:20px;font-weight:800;color:var(--green);">$250</div>
<div style="display:flex;gap:8px;">
<a href="https://wa.me/+34613734121?text=Hi%20Laurie,%20I've%20been%20playing%20Level%20Up%20and%20have%20some%20questions%20about%20coaching." target="_blank" style="padding:10px 14px;background:#25D366;border-radius:8px;color:#fff;font-size:12px;font-weight:700;text-decoration:none;">💬</a>
<a href="https://www.levelsofself.com/_paylink/AZusz5dC" target="_blank" style="padding:10px 20px;background:linear-gradient(135deg,var(--pink),var(--purple));border-radius:8px;color:#fff;font-size:13px;font-weight:700;text-decoration:none;">Book</a>
</div>
</div>
</div>

<!-- Aurora -->
<div style="background:var(--card);border:2px solid var(--pink);border-radius:14px;padding:16px;margin-bottom:12px;box-shadow:0 0 12px rgba(255,60,172,0.2);">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
<img src="aurora.jpg" alt="Aurora Maier" onclick="document.getElementById('coachProfileAurora').classList.add('active')" style="width:56px;height:56px;min-width:56px;min-height:56px;border-radius:50%;object-fit:cover;object-position:center;border:2px solid var(--pink);cursor:pointer;box-shadow:0 0 12px rgba(255,60,172,0.4);" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
<div style="flex:1;min-width:0;">
<div style="font-size:15px;font-weight:700;color:var(--text);margin-bottom:4px;">Aurora Maier <span style="font-size:10px;background:var(--pink);color:#fff;padding:2px 6px;border-radius:4px;font-weight:700;vertical-align:middle;">COACH</span></div>
<div style="display:flex;gap:4px;flex-wrap:wrap;">
<span style="font-size:11px;background:rgba(255,255,255,0.1);border:1px solid var(--border);padding:3px 8px;border-radius:6px;color:var(--text);">🇺🇸 English</span>
<span style="font-size:11px;background:rgba(255,255,255,0.1);border:1px solid var(--border);padding:3px 8px;border-radius:6px;color:var(--text);">🇰🇷 Korean</span>
</div>
</div>
</div>
<div style="display:flex;align-items:center;justify-content:space-between;">
<div style="font-size:20px;font-weight:800;color:var(--green);">$100</div>
<div style="display:flex;gap:8px;">
<a href="https://wa.me/+19105261160?text=Hi%20Aurora,%20I've%20been%20playing%20Level%20Up%20and%20have%20some%20questions%20about%20coaching." target="_blank" style="padding:10px 14px;background:#25D366;border-radius:8px;color:#fff;font-size:12px;font-weight:700;text-decoration:none;">💬</a>
<a href="https://www.levelsofself.com/_paylink/AZwqmg6N" target="_blank" style="padding:10px 20px;background:linear-gradient(135deg,var(--pink),var(--purple));border-radius:8px;color:#fff;font-size:13px;font-weight:700;text-decoration:none;">Book</a>
</div>
</div>
</div>

<!-- Heghine -->
<div style="background:var(--card);border:2px solid var(--pink);border-radius:14px;padding:16px;margin-bottom:16px;box-shadow:0 0 12px rgba(255,60,172,0.2);">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
<img src="heghine.jpg" alt="Heghine Manukyan" onclick="document.getElementById('coachProfileHeghine').classList.add('active')" style="width:56px;height:56px;min-width:56px;min-height:56px;border-radius:50%;object-fit:cover;object-position:center;border:2px solid var(--pink);cursor:pointer;box-shadow:0 0 12px rgba(255,60,172,0.4);" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
<div style="flex:1;min-width:0;">
<div style="font-size:15px;font-weight:700;color:var(--text);margin-bottom:4px;">Heghine Manukyan <span style="font-size:10px;background:var(--pink);color:#fff;padding:2px 6px;border-radius:4px;font-weight:700;vertical-align:middle;">COACH</span></div>
<div style="display:flex;gap:4px;flex-wrap:wrap;">
<span style="font-size:11px;background:rgba(255,255,255,0.1);border:1px solid var(--border);padding:3px 8px;border-radius:6px;color:var(--text);">🇦🇲 Armenian</span>
<span style="font-size:11px;background:rgba(255,255,255,0.1);border:1px solid var(--border);padding:3px 8px;border-radius:6px;color:var(--text);">🇷🇺 Russian</span>
</div>
</div>
</div>
<div style="display:flex;align-items:center;justify-content:space-between;">
<div style="font-size:20px;font-weight:800;color:var(--green);">$100</div>
<div style="display:flex;gap:8px;">
<a href="https://wa.me/+37477449962?text=Hi%20Heghine,%20I've%20been%20playing%20Level%20Up%20and%20have%20some%20questions%20about%20coaching." target="_blank" style="padding:10px 14px;background:#25D366;border-radius:8px;color:#fff;font-size:12px;font-weight:700;text-decoration:none;">💬</a>
<a href="https://www.levelsofself.com/_paylink/AZwqmRJr" target="_blank" style="padding:10px 20px;background:linear-gradient(135deg,var(--pink),var(--purple));border-radius:8px;color:#fff;font-size:13px;font-weight:700;text-decoration:none;">Book</a>
</div>
</div>
</div>

<!-- Roger -->
<div style="background:var(--card);border:2px solid var(--pink);border-radius:14px;padding:16px;margin-bottom:16px;box-shadow:0 0 12px rgba(255,60,172,0.2);">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
<img src="roger.jpg" alt="Roger Walter" onclick="document.getElementById('coachProfileRoger').classList.add('active')" style="width:56px;height:56px;min-width:56px;min-height:56px;border-radius:50%;object-fit:cover;object-position:center;border:2px solid var(--pink);cursor:pointer;box-shadow:0 0 12px rgba(255,60,172,0.4);" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
<div style="flex:1;min-width:0;">
<div style="font-size:15px;font-weight:700;color:var(--text);margin-bottom:4px;">Roger Walter <span style="font-size:10px;background:var(--pink);color:#fff;padding:2px 6px;border-radius:4px;font-weight:700;vertical-align:middle;">COACH</span></div>
<div style="display:flex;gap:4px;flex-wrap:wrap;">
<span style="font-size:11px;background:rgba(255,255,255,0.1);border:1px solid var(--border);padding:3px 8px;border-radius:6px;color:var(--text);">🇺🇸 English</span>
<span style="font-size:11px;background:rgba(255,255,255,0.1);border:1px solid var(--border);padding:3px 8px;border-radius:6px;color:var(--text);">🇪🇸 Spanish</span>
<span style="font-size:11px;background:rgba(255,255,255,0.1);border:1px solid var(--border);padding:3px 8px;border-radius:6px;color:var(--text);">🇧🇷 Portuguese</span>
</div>
</div>
</div>
<div style="display:flex;align-items:center;justify-content:space-between;">
<div style="font-size:20px;font-weight:800;color:var(--green);">$100</div>
<div style="display:flex;gap:8px;">
<a href="https://wa.me/+19738730425?text=Hi%20Roger,%20I've%20been%20playing%20Level%20Up%20and%20have%20some%20questions%20about%20coaching." target="_blank" style="padding:10px 14px;background:#25D366;border-radius:8px;color:#fff;font-size:12px;font-weight:700;text-decoration:none;">💬</a>
<a href="https://www.levelsofself.com/_paylink/AZwqnSCH" target="_blank" style="padding:10px 20px;background:linear-gradient(135deg,var(--pink),var(--purple));border-radius:8px;color:#fff;font-size:13px;font-weight:700;text-decoration:none;">Book</a>
</div>
</div>
</div>

<p style="text-align:center;font-size:12px;color:var(--muted);margin-top:8px;">Questions? Contact us anytime.</p>
</div></div>

<!-- Join Our Team Modal -->
<div class="modal" id="teamModal" role="dialog" aria-label="Join Our Team">
<div class="modal-content coaching-modal-content" style="max-width:480px;">
<button class="modal-close-x" onclick="document.getElementById('teamModal').classList.remove('active')">✕</button>
<div style="text-align:center;margin-bottom:24px;">
<span style="display:inline-block;font-size:12px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--gold);background:rgba(255,208,0,0.15);padding:6px 16px;border-radius:20px;margin-bottom:12px;">🤝 Partner With Me</span>
<h2 style="font-size:22px;font-weight:800;color:var(--text);margin-bottom:4px;">Work with an</h2>
<h2 style="font-size:24px;font-weight:800;background:linear-gradient(135deg,var(--gold),var(--orange));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:12px;">Award-Winning Life Coach</h2>
<p style="font-size:14px;color:var(--muted);line-height:1.6;">I'm looking for coaches, translators, affiliates, and connectors.</p>
<p style="font-size:12px;color:var(--text-secondary);margin-top:8px;">Google <strong>"Arthur Palyan"</strong> or <strong>"Level Up Levels of Self"</strong> to see results.</p>
</div>

<!-- Coaches Role -->
<div style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:12px;">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:10px;">
<div style="width:44px;height:44px;background:linear-gradient(135deg,var(--pink),var(--purple));border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;">🎓</div>
<div style="font-size:17px;font-weight:700;color:var(--text);">COACHES</div>
</div>
<p style="font-size:13px;color:var(--text-secondary);line-height:1.6;">Teach the 7 Levels of Self framework. Help people break patterns. Work remotely.</p>
</div>

<!-- Translators Role -->
<div style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:12px;">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:10px;">
<div style="width:44px;height:44px;background:linear-gradient(135deg,var(--blue),var(--cyan));border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;">🌍</div>
<div style="font-size:17px;font-weight:700;color:var(--text);">TRANSLATORS</div>
</div>
<p style="font-size:13px;color:var(--text-secondary);line-height:1.6;">Bring the game to Spanish, French, Portuguese, Tagalog, Hindi, Arabic, or other languages. I handle tech, marketing, and advertising.</p>
</div>

<!-- Affiliates Role -->
<div style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:12px;">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:10px;">
<div style="width:44px;height:44px;background:linear-gradient(135deg,var(--green),#00B85D);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;">💰</div>
<div style="font-size:17px;font-weight:700;color:var(--text);">AFFILIATES</div>
</div>
<p style="font-size:13px;color:var(--text-secondary);line-height:1.6;">Refer clients or coaches. No coaching required.</p>
</div>

<!-- Connectors Role -->
<div style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:12px;">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:10px;">
<div style="width:44px;height:44px;background:linear-gradient(135deg,var(--orange),var(--gold));border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;">🔗</div>
<div style="font-size:17px;font-weight:700;color:var(--text);">CONNECTORS</div>
</div>
<p style="font-size:13px;color:var(--text-secondary);line-height:1.6;">Know someone in education, corporate, rehab, government, or investment? One introduction can change everything.</p>
</div>

<!-- Now Booking -->
<div style="background:linear-gradient(135deg,rgba(255,208,0,0.15),rgba(255,107,53,0.1));border:1px solid var(--gold);border-radius:12px;padding:14px;margin-bottom:16px;text-align:center;">
<p style="font-size:12px;font-weight:700;color:var(--gold);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;">Now Booking</p>
<p style="font-size:13px;color:var(--text);line-height:1.6;">Corporate Sponsorships · Educational Conferences (Board of Education, Board of Psychology, The Bar) · Federal Grants</p>
</div>

<!-- Selling Points -->
<div style="background:linear-gradient(135deg,rgba(255,208,0,0.1),rgba(255,107,53,0.05));border:1px solid var(--gold);border-radius:12px;padding:16px;margin-bottom:20px;">
<div style="display:flex;flex-wrap:wrap;gap:12px;justify-content:center;">
<span style="font-size:13px;color:var(--text);font-weight:600;">✅ No experience required</span>
<span style="font-size:13px;color:var(--text);font-weight:600;">✅ No setup cost</span>
<span style="font-size:13px;color:var(--text);font-weight:600;">✅ Work from ANYWHERE in the world</span>
</div>
</div>

<!-- Credibility -->
<div style="text-align:center;margin-bottom:20px;">
<p style="font-size:12px;color:var(--gold);font-weight:600;margin-bottom:4px;">Created by Arthur Palyan - Best Life Coach California 2025</p>
<p style="font-size:11px;color:var(--muted);">As seen on AP News, Bloomberg, Yahoo Finance, and 200+ outlets</p>
</div>

<!-- Links as Buttons -->
<div style="display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-bottom:20px;">
<a href="https://apps.apple.com/app/id6757724858" target="_blank" style="padding:10px 16px;background:var(--card);border:1px solid var(--pink);border-radius:8px;font-size:13px;color:var(--text);text-decoration:none;font-weight:600;transition:all 0.2s;">App Store</a>
<a href="https://t.me/LevelsOfSelfBot/game" target="_blank" style="padding:10px 16px;background:var(--card);border:1px solid var(--blue);border-radius:8px;font-size:13px;color:var(--text);text-decoration:none;font-weight:600;transition:all 0.2s;">Telegram</a>
<a href="https://100levelup.com" target="_blank" style="padding:10px 16px;background:var(--card);border:1px solid var(--pink);border-radius:8px;font-size:13px;color:var(--text);text-decoration:none;font-weight:600;transition:all 0.2s;">100levelup.com</a>
</div>

<!-- CTA Button -->
<a href="https://calendly.com/levelsofself/zoom" target="_blank" style="display:block;width:100%;padding:16px;background:linear-gradient(135deg,var(--gold),var(--orange));border:none;border-radius:12px;color:#000;font-size:16px;font-weight:800;text-decoration:none;text-align:center;box-shadow:0 4px 20px rgba(255,208,0,0.4);">Apply Now →</a>
</div>
</div>

<!-- Breakthrough Work Modal -->
<div class="modal" id="breakthroughModal" role="dialog" aria-label="Breakthrough Work Exercises">
<div class="modal-content coaching-modal-content" style="max-width:520px;">
<button class="modal-close-x" onclick="document.getElementById('breakthroughModal').classList.remove('active')">✕</button>
<div style="text-align:center;margin-bottom:24px;">
<span style="display:inline-block;font-size:12px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--orange);background:rgba(255,87,34,0.15);padding:6px 16px;border-radius:20px;margin-bottom:12px;">🔥 Deep Work</span>
<h2 style="font-size:24px;font-weight:800;color:var(--text);margin-bottom:8px;">Breakthrough Work</h2>
<p style="font-size:14px;color:var(--muted);line-height:1.6;">9 exercises to shift perspective and move stuck energy</p>
</div>

<!-- STARTER LEVEL -->
<div style="font-size:11px;text-transform:uppercase;letter-spacing:1.5px;color:var(--green);font-weight:700;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
<span style="flex:1;height:1px;background:var(--border);"></span>
<span>STARTER LEVEL</span>
<span style="flex:1;height:1px;background:var(--border);"></span>
</div>

<!-- Exercise 1: Breathwork -->
<div class="breakthrough-exercise" data-exercise="1" style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:10px;cursor:pointer;transition:all 0.2s;" onclick="toggleExercise(this)">
<div style="display:flex;align-items:center;justify-content:space-between;">
<div style="display:flex;align-items:center;gap:12px;">
<div style="width:36px;height:36px;background:rgba(0,192,96,0.15);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;">🌬️</div>
<div>
<div style="font-size:15px;font-weight:700;color:var(--text);">Breathwork / Grounding</div>
<div style="font-size:11px;color:var(--muted);">Grounding • 2-5 min</div>
</div>
</div>
<span class="exercise-toggle" style="color:var(--gold);font-size:18px;transition:transform 0.2s;">+</span>
</div>
<div class="exercise-content" style="display:none;margin-top:14px;padding-top:14px;border-top:1px solid var(--border);">
<p style="font-size:13px;color:var(--text-secondary);line-height:1.7;">Anytime you need help focusing or getting grounded, listen to your breath. Slow down the breathing. Listen as you pull air inside and push air outside. Focus entirely on your breath until your thoughts have no more control over your body. You are now grounded in the present moment.</p>
<button class="exercise-complete-btn" onclick="event.stopPropagation();completeExercise(1)" style="margin-top:12px;padding:10px 20px;background:linear-gradient(135deg,var(--green),#00B85D);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;width:100%;">✓ Mark Complete (+25 XP)</button>
</div>
</div>

<!-- Exercise 2: Center Tap -->
<div class="breakthrough-exercise" data-exercise="2" style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:10px;cursor:pointer;transition:all 0.2s;" onclick="toggleExercise(this)">
<div style="display:flex;align-items:center;justify-content:space-between;">
<div style="display:flex;align-items:center;gap:12px;">
<div style="width:36px;height:36px;background:rgba(0,192,96,0.15);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;">👊</div>
<div>
<div style="font-size:15px;font-weight:700;color:var(--text);">Center Tap</div>
<div style="font-size:11px;color:var(--muted);">Physical/Qigong • 1-3 min</div>
</div>
</div>
<span class="exercise-toggle" style="color:var(--gold);font-size:18px;transition:transform 0.2s;">+</span>
</div>
<div class="exercise-content" style="display:none;margin-top:14px;padding-top:14px;border-top:1px solid var(--border);">
<p style="font-size:13px;color:var(--text-secondary);line-height:1.7;">Tap your core/stomach with a closed fist, thumbs inside. Best with music. Gets you connected and grounded. A quick reset exercise.</p>
<button class="exercise-complete-btn" onclick="event.stopPropagation();completeExercise(2)" style="margin-top:12px;padding:10px 20px;background:linear-gradient(135deg,var(--green),#00B85D);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;width:100%;">✓ Mark Complete (+25 XP)</button>
</div>
</div>

<!-- Exercise 3: Daily Check-In -->
<div class="breakthrough-exercise" data-exercise="3" style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:10px;cursor:pointer;transition:all 0.2s;" onclick="toggleExercise(this)">
<div style="display:flex;align-items:center;justify-content:space-between;">
<div style="display:flex;align-items:center;gap:12px;">
<div style="width:36px;height:36px;background:rgba(0,192,96,0.15);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;">🪞</div>
<div>
<div style="font-size:15px;font-weight:700;color:var(--text);">Daily Check-In</div>
<div style="font-size:11px;color:var(--muted);">Reflection/Acceptance • 5 min</div>
</div>
</div>
<span class="exercise-toggle" style="color:var(--gold);font-size:18px;transition:transform 0.2s;">+</span>
</div>
<div class="exercise-content" style="display:none;margin-top:14px;padding-top:14px;border-top:1px solid var(--border);">
<p style="font-size:13px;color:var(--text-secondary);line-height:1.7;">Close your eyes at the start or end of each day. Ask yourself: "Was there anything I needed to say that I didn't get to say? Was there anything I needed to feel that I didn't get to feel?" Say what you need to say. Feel what you need to feel. End with "Thank you."</p>
<p style="font-size:12px;color:var(--muted);font-style:italic;margin-top:8px;">This is a practice of acceptance. Even when you don't agree with yourself, you can count on you to hear you, get you, feel you, and be heard.</p>
<button class="exercise-complete-btn" onclick="event.stopPropagation();completeExercise(3)" style="margin-top:12px;padding:10px 20px;background:linear-gradient(135deg,var(--green),#00B85D);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;width:100%;">✓ Mark Complete (+25 XP)</button>
</div>
</div>

<!-- Exercise 4: Power of Context -->
<div class="breakthrough-exercise" data-exercise="4" style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px;cursor:pointer;transition:all 0.2s;" onclick="toggleExercise(this)">
<div style="display:flex;align-items:center;justify-content:space-between;">
<div style="display:flex;align-items:center;gap:12px;">
<div style="width:36px;height:36px;background:rgba(0,192,96,0.15);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;">👁️</div>
<div>
<div style="font-size:15px;font-weight:700;color:var(--text);">The Power of Context</div>
<div style="font-size:11px;color:var(--muted);">Awareness/Perspective • 5-10 min</div>
</div>
</div>
<span class="exercise-toggle" style="color:var(--gold);font-size:18px;transition:transform 0.2s;">+</span>
</div>
<div class="exercise-content" style="display:none;margin-top:14px;padding-top:14px;border-top:1px solid var(--border);">
<p style="font-size:13px;color:var(--text-secondary);line-height:1.7;margin-bottom:10px;"><strong>Three practices:</strong></p>
<p style="font-size:13px;color:var(--text-secondary);line-height:1.7;margin-bottom:6px;"><strong>1. Location:</strong> Walk into a store or location. Imagine you own it. Notice what shifts.</p>
<p style="font-size:13px;color:var(--text-secondary);line-height:1.7;margin-bottom:6px;"><strong>2. Reading:</strong> Read any text. Imagine your favorite person wrote it, then your parent, then a friend, then a stranger. Notice what shifts.</p>
<p style="font-size:13px;color:var(--text-secondary);line-height:1.7;margin-bottom:10px;"><strong>3. Listening:</strong> When someone speaks to you, listen as if they're a friend, then stranger, then mom/dad. Notice what happens.</p>
<p style="font-size:12px;color:var(--gold);font-weight:600;font-style:italic;">💡 Lesson: Same words, same place, same conversation, completely different experience. Just notice the power of context.</p>
<button class="exercise-complete-btn" onclick="event.stopPropagation();completeExercise(4)" style="margin-top:12px;padding:10px 20px;background:linear-gradient(135deg,var(--green),#00B85D);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;width:100%;">✓ Mark Complete (+25 XP)</button>
</div>
</div>

<!-- INTERMEDIATE LEVEL -->
<div style="font-size:11px;text-transform:uppercase;letter-spacing:1.5px;color:var(--blue);font-weight:700;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
<span style="flex:1;height:1px;background:var(--border);"></span>
<span>INTERMEDIATE LEVEL</span>
<span style="flex:1;height:1px;background:var(--border);"></span>
</div>

<!-- Exercise 5: Have To → Get To → Blessed To -->
<div class="breakthrough-exercise" data-exercise="5" style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:10px;cursor:pointer;transition:all 0.2s;" onclick="toggleExercise(this)">
<div style="display:flex;align-items:center;justify-content:space-between;">
<div style="display:flex;align-items:center;gap:12px;">
<div style="width:36px;height:36px;background:rgba(30,111,224,0.15);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;">✨</div>
<div>
<div style="font-size:15px;font-weight:700;color:var(--text);">Have To → Get To → Blessed To</div>
<div style="font-size:11px;color:var(--muted);">Journaling/Reframe • 10-15 min</div>
</div>
</div>
<span class="exercise-toggle" style="color:var(--gold);font-size:18px;transition:transform 0.2s;">+</span>
</div>
<div class="exercise-content" style="display:none;margin-top:14px;padding-top:14px;border-top:1px solid var(--border);">
<p style="font-size:13px;color:var(--text-secondary);line-height:1.7;margin-bottom:10px;"><strong>Three-part reframe exercise:</strong></p>
<p style="font-size:13px;color:var(--text-secondary);line-height:1.7;margin-bottom:6px;"><strong>1.</strong> "I have to..." List all the things you have to do</p>
<p style="font-size:13px;color:var(--text-secondary);line-height:1.7;margin-bottom:6px;"><strong>2.</strong> "I get to..." Rewrite the same list (shifts energy)</p>
<p style="font-size:13px;color:var(--text-secondary);line-height:1.7;margin-bottom:10px;"><strong>3.</strong> "I am blessed to... because..." Rewrite again (creates wonder)</p>
<p style="font-size:12px;color:var(--gold);font-weight:600;font-style:italic;">💡 Watch what opens up at each level.</p>
<button class="exercise-complete-btn" onclick="event.stopPropagation();completeExercise(5)" style="margin-top:12px;padding:10px 20px;background:linear-gradient(135deg,var(--green),#00B85D);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;width:100%;">✓ Mark Complete (+50 XP)</button>
</div>
</div>

<!-- Exercise 6: Blessings Letter -->
<div class="breakthrough-exercise" data-exercise="6" style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px;cursor:pointer;transition:all 0.2s;" onclick="toggleExercise(this)">
<div style="display:flex;align-items:center;justify-content:space-between;">
<div style="display:flex;align-items:center;gap:12px;">
<div style="width:36px;height:36px;background:rgba(30,111,224,0.15);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;">💝</div>
<div>
<div style="font-size:15px;font-weight:700;color:var(--text);">Blessings Letter</div>
<div style="font-size:11px;color:var(--muted);">Writing + Gratitude • 15-20 min</div>
</div>
</div>
<span class="exercise-toggle" style="color:var(--gold);font-size:18px;transition:transform 0.2s;">+</span>
</div>
<div class="exercise-content" style="display:none;margin-top:14px;padding-top:14px;border-top:1px solid var(--border);">
<p style="font-size:13px;color:var(--text-secondary);line-height:1.7;">Write to yourself first (always). Start with "The blessings I see in you are..." Go all out until there is nothing left. This is a creation and gratitude exercise. You begin to trust and hear yourself.</p>
<p style="font-size:12px;color:var(--muted);font-style:italic;margin-top:8px;">Note: No mirror reading. This is about self-trust and gratitude.</p>
<button class="exercise-complete-btn" onclick="event.stopPropagation();completeExercise(6)" style="margin-top:12px;padding:10px 20px;background:linear-gradient(135deg,var(--green),#00B85D);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;width:100%;">✓ Mark Complete (+50 XP)</button>
</div>
</div>

<!-- DEEP WORK LEVEL -->
<div style="font-size:11px;text-transform:uppercase;letter-spacing:1.5px;color:var(--pink);font-weight:700;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
<span style="flex:1;height:1px;background:var(--border);"></span>
<span>DEEP WORK LEVEL</span>
<span style="flex:1;height:1px;background:var(--border);"></span>
</div>

<!-- Exercise 7: Forgiveness Letter -->
<div class="breakthrough-exercise" data-exercise="7" style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:10px;cursor:pointer;transition:all 0.2s;" onclick="toggleExercise(this)">
<div style="display:flex;align-items:center;justify-content:space-between;">
<div style="display:flex;align-items:center;gap:12px;">
<div style="width:36px;height:36px;background:rgba(255,60,172,0.15);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;">💔</div>
<div>
<div style="font-size:15px;font-weight:700;color:var(--text);">Forgiveness Letter</div>
<div style="font-size:11px;color:var(--muted);">Writing + Mirror • 30-45 min</div>
</div>
</div>
<span class="exercise-toggle" style="color:var(--gold);font-size:18px;transition:transform 0.2s;">+</span>
</div>
<div class="exercise-content" style="display:none;margin-top:14px;padding-top:14px;border-top:1px solid var(--border);">
<p style="font-size:13px;color:var(--text-secondary);line-height:1.7;margin-bottom:10px;">Write a letter to yourself. Start with "I forgive me for..." and keep writing until there is nothing left. Then "I forgive you for..." and keep writing until there is nothing left.</p>
<p style="font-size:13px;color:var(--text-secondary);line-height:1.7;margin-bottom:10px;">When done, read it to yourself in the mirror 4 times. It will loosen its grip on you and move any stuck energy out of your body.</p>
<p style="font-size:12px;color:var(--orange);font-weight:600;margin-bottom:8px;">⚠️ Important: Language matters. If something happened to you as a child, even if you write it in English, read it in your native language to yourself in the mirror.</p>
<p style="font-size:12px;color:var(--muted);font-style:italic;">This is deep work. Please be patient with yourself and go all out like you do for everyone else.</p>
<button class="exercise-complete-btn" onclick="event.stopPropagation();completeExercise(7)" style="margin-top:12px;padding:10px 20px;background:linear-gradient(135deg,var(--green),#00B85D);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;width:100%;">✓ Mark Complete (+100 XP)</button>
</div>
</div>

<!-- Exercise 8: Most Painful Memory -->
<div class="breakthrough-exercise" data-exercise="8" style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:10px;cursor:pointer;transition:all 0.2s;" onclick="toggleExercise(this)">
<div style="display:flex;align-items:center;justify-content:space-between;">
<div style="display:flex;align-items:center;gap:12px;">
<div style="width:36px;height:36px;background:rgba(255,60,172,0.15);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;">🩹</div>
<div>
<div style="font-size:15px;font-weight:700;color:var(--text);">Most Painful Memory</div>
<div style="font-size:11px;color:var(--muted);">Writing + Mirror • 30-60 min</div>
</div>
</div>
<span class="exercise-toggle" style="color:var(--gold);font-size:18px;transition:transform 0.2s;">+</span>
</div>
<div class="exercise-content" style="display:none;margin-top:14px;padding-top:14px;border-top:1px solid var(--border);">
<p style="font-size:13px;color:var(--text-secondary);line-height:1.7;margin-bottom:10px;">Start with "My most painful memory is..." Write until there is nothing left. Read to yourself in mirror 4 times. Use your native language, especially for childhood memories.</p>
<p style="font-size:12px;color:var(--muted);font-style:italic;">Same deep work guidance. Be patient, go all out for yourself.</p>
<button class="exercise-complete-btn" onclick="event.stopPropagation();completeExercise(8)" style="margin-top:12px;padding:10px 20px;background:linear-gradient(135deg,var(--green),#00B85D);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;width:100%;">✓ Mark Complete (+100 XP)</button>
</div>
</div>

<!-- Exercise 9: Ultimate Acknowledgment -->
<div class="breakthrough-exercise" data-exercise="9" style="background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px;cursor:pointer;transition:all 0.2s;" onclick="toggleExercise(this)">
<div style="display:flex;align-items:center;justify-content:space-between;">
<div style="display:flex;align-items:center;gap:12px;">
<div style="width:36px;height:36px;background:rgba(255,60,172,0.15);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;">🙏</div>
<div>
<div style="font-size:15px;font-weight:700;color:var(--text);">Ultimate Acknowledgment</div>
<div style="font-size:11px;color:var(--muted);">Movement/Presence • 10-30 min</div>
</div>
</div>
<span class="exercise-toggle" style="color:var(--gold);font-size:18px;transition:transform 0.2s;">+</span>
</div>
<div class="exercise-content" style="display:none;margin-top:14px;padding-top:14px;border-top:1px solid var(--border);">
<p style="font-size:13px;color:var(--text-secondary);line-height:1.7;margin-bottom:10px;">Stand. Begin to raise your arms from the sides, palms toward you. Halfway up, switch your palms up. Imagine pulling energy from the ground and connecting it to the sky above. Make your way up to connect your hands together above your head. Bring your hands straight down the center to your heart. Bow.</p>
<p style="font-size:12px;color:var(--gold);font-weight:600;margin-bottom:8px;">🔑 The Secret: Move at half the speed you think you need. Then keep reducing, slower and slower. One bow can take 30 minutes. Move so slow it seems you're not moving at all. It connects you to layers of self you don't normally see. A busy mind cannot move slowly. This is great practice for presence.</p>
<p style="font-size:12px;color:var(--muted);font-style:italic;">You'll sweat doing just one. It opens up a whole new world you never knew existed.</p>
<button class="exercise-complete-btn" onclick="event.stopPropagation();completeExercise(9)" style="margin-top:12px;padding:10px 20px;background:linear-gradient(135deg,var(--green),#00B85D);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;width:100%;">✓ Mark Complete (+100 XP)</button>
</div>
</div>

<!-- Deep Work CTA (shown after completing deep work exercises) -->
<div id="deepWorkCTA" style="display:none;background:linear-gradient(135deg,rgba(255,107,53,0.15),rgba(255,60,172,0.1));border:2px solid var(--orange);border-radius:16px;padding:20px;text-align:center;">
<p style="font-size:16px;color:var(--text);font-weight:700;margin-bottom:8px;">You've done the work. Ready to go deeper?</p>
<p style="font-size:13px;color:var(--muted);margin-bottom:16px;">Work 1-on-1 with Arthur to integrate your breakthroughs</p>
<a href="https://calendly.com/levelsofself/zoom" target="_blank" style="display:inline-block;padding:14px 28px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:12px;color:#fff;font-size:15px;font-weight:700;text-decoration:none;box-shadow:0 4px 20px rgba(255,87,34,0.4);">Book a Session with Arthur</a>
</div>

<p style="text-align:center;font-size:12px;color:var(--muted);margin-top:16px;">Complete exercises to earn XP and track your growth</p>
</div>
</div>

<!-- Agreement Game Onboarding Modal -->
<div class="modal" id="agreementOnboardModal" role="dialog" aria-label="Agreement Game Introduction">
<div class="modal-content" style="max-width:400px;text-align:center;padding:24px;">
<div id="agreementOnboardScreen1" class="agreement-onboard-screen">
<div style="font-size:48px;margin-bottom:16px;">🔓</div>
<div style="font-size:22px;font-weight:800;color:var(--text);margin-bottom:12px;">New Game Unlocked!</div>
<div style="font-size:15px;color:var(--muted);line-height:1.6;margin-bottom:20px;">
You've been <strong style="color:var(--pink);">seeing yourself</strong> in Mirror Mode.<br><br>
Now it's time to practice <strong style="color:var(--green);">responding differently</strong>.
</div>
<div style="display:flex;gap:8px;justify-content:center;">
<span style="width:8px;height:8px;border-radius:50%;background:var(--pink);"></span>
<span style="width:8px;height:8px;border-radius:50%;background:var(--border);"></span>
<span style="width:8px;height:8px;border-radius:50%;background:var(--border);"></span>
</div>
<button onclick="showAgreementOnboard(2)" style="margin-top:20px;padding:14px 32px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:12px;color:#fff;font-size:16px;font-weight:700;cursor:pointer;width:100%;">Next →</button>
</div>

<div id="agreementOnboardScreen2" class="agreement-onboard-screen" style="display:none;">
<div style="font-size:48px;margin-bottom:16px;">⚖️</div>
<div style="font-size:22px;font-weight:800;color:var(--text);margin-bottom:12px;">Same Situation, Two Choices</div>
<div style="font-size:15px;color:var(--muted);line-height:1.6;margin-bottom:20px;">
Each scenario shows a moment from life.<br><br>
You choose: <strong style="color:var(--green);">Accept</strong> (see reality as it is)<br>
or <strong style="color:var(--red);">Judge</strong> (resist what is)
</div>
<div style="background:var(--card);padding:16px;border-radius:12px;margin-bottom:16px;text-align:left;">
<div style="font-size:12px;color:var(--muted);margin-bottom:8px;">💡 Key insight:</div>
<div style="font-size:14px;color:var(--text);font-style:italic;">Acceptance ≠ Agreement.<br>You can accept that something IS without agreeing that it SHOULD be.</div>
</div>
<div style="display:flex;gap:8px;justify-content:center;">
<span style="width:8px;height:8px;border-radius:50%;background:var(--border);"></span>
<span style="width:8px;height:8px;border-radius:50%;background:var(--pink);"></span>
<span style="width:8px;height:8px;border-radius:50%;background:var(--border);"></span>
</div>
<div style="display:flex;gap:10px;margin-top:20px;">
<button onclick="showAgreementOnboard(1)" style="flex:1;padding:14px;background:var(--grad-secondary);border:none;border-radius:12px;color:#fff;font-size:14px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;">← Back</button>
<button onclick="showAgreementOnboard(3)" style="flex:2;padding:14px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:12px;color:#fff;font-size:16px;font-weight:700;cursor:pointer;">Next →</button>
</div>
</div>

<div id="agreementOnboardScreen3" class="agreement-onboard-screen" style="display:none;">
<div style="font-size:48px;margin-bottom:16px;">🧠</div>
<div style="font-size:22px;font-weight:800;color:var(--text);margin-bottom:12px;">Why This Matters</div>
<div style="font-size:15px;color:var(--muted);line-height:1.6;margin-bottom:20px;">
Judgment is your brain's default. It feels protective.<br><br>
But <strong style="color:var(--text);">judgment blocks possibility</strong>.<br><br>
When you practice acceptance, you create space for change.
</div>
<div style="display:flex;gap:8px;justify-content:center;">
<span style="width:8px;height:8px;border-radius:50%;background:var(--border);"></span>
<span style="width:8px;height:8px;border-radius:50%;background:var(--border);"></span>
<span style="width:8px;height:8px;border-radius:50%;background:var(--pink);"></span>
</div>
<div style="display:flex;gap:10px;margin-top:20px;">
<button onclick="showAgreementOnboard(2)" style="flex:1;padding:14px;background:var(--grad-secondary);border:none;border-radius:12px;color:#fff;font-size:14px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;">← Back</button>
<button onclick="finishAgreementOnboard()" style="flex:2;padding:14px;background:linear-gradient(135deg,var(--green),#00B85D);border:none;border-radius:12px;color:#fff;font-size:16px;font-weight:700;cursor:pointer;">Let's Play! ✨</button>
</div>
</div>
</div>
</div>

<!-- Scroll to top button -->
<button class="scroll-top-btn" id="scrollTopBtn" onclick="window.scrollTo({top:0,behavior:'smooth'})">⬆</button>


<!-- EMBEDDED SCENARIO DATA -->
<script src="scenarios.js"></script>
<script>
// Combine all Mirror scenarios
const MIRROR_SCENARIOS=[...(typeof LEVEL_1_INDIVIDUAL!=='undefined'?LEVEL_1_INDIVIDUAL:[]),...(typeof LEVEL_2_FAMILY!=='undefined'?LEVEL_2_FAMILY:[]),...(typeof LEVEL_3_GROUPS!=='undefined'?LEVEL_3_GROUPS:[]),...(typeof LEVEL_4_COMMUNITY!=='undefined'?LEVEL_4_COMMUNITY:[]),...(typeof LEVEL_5_SOCIETY!=='undefined'?LEVEL_5_SOCIETY:[]),...(typeof LEVEL_6_WORLD!=='undefined'?LEVEL_6_WORLD:[]),...(typeof LEVEL_7_GENERATIONS!=='undefined'?LEVEL_7_GENERATIONS:[])];

// Combine all Decision scenarios (original + expanded)
const DECISION_SCENARIOS_EXPANDED=[
  ...(typeof DECISION_SCENARIOS!=='undefined'?DECISION_SCENARIOS:[]),
  ...(typeof DECISION_LEVEL_1!=='undefined'?DECISION_LEVEL_1:[]),
  ...(typeof DECISION_LEVEL_2!=='undefined'?DECISION_LEVEL_2:[]),
  ...(typeof DECISION_LEVEL_3!=='undefined'?DECISION_LEVEL_3:[]),
  ...(typeof DECISION_LEVEL_4!=='undefined'?DECISION_LEVEL_4:[]),
  ...(typeof DECISION_LEVEL_5!=='undefined'?DECISION_LEVEL_5:[]),
  ...(typeof DECISION_LEVEL_6!=='undefined'?DECISION_LEVEL_6:[]),
  ...(typeof DECISION_LEVEL_7!=='undefined'?DECISION_LEVEL_7:[])
];
// Override DECISION_SCENARIOS with expanded version
if(DECISION_SCENARIOS_EXPANDED.length>0){window.DECISION_SCENARIOS=DECISION_SCENARIOS_EXPANDED;}
const LEVELS=[{id:1,name:'Individual',color:'#FF6B35',desc:'Self for yourself'},{id:2,name:'Family',color:'#FF3CAC',desc:'Your created or immediate family'},{id:3,name:'Groups',color:'#784BA0',desc:'Extended family, friends, coworkers'},{id:4,name:'Community',color:'#2F80ED',desc:'Activities and events'},{id:5,name:'Society',color:'#00D26A',desc:'Nation & systems'},{id:6,name:'World',color:'#F7C948',desc:'Global stage, politics, humanity'},{id:7,name:'Generations',color:'#C0C0C0',desc:'Those before you and after'}];
// Get translated level name/desc
function tLevel(lv){if(!lv)return lv;return{...lv,name:typeof t==='function'?t(lv.name):lv.name,desc:typeof t==='function'?t(lv.desc):lv.desc};}
function tLevelLabel(level){let lv=LEVELS.find(l=>l.id===level);let tlv=tLevel(lv);return(typeof t==='function'?t('Level'):'Level')+' '+level+': '+(tlv?tlv.name:'');}
const XP_PER_LEVEL=750;
let music=document.getElementById('music');music.volume=0.4;
let musicOn=false,soundOn=true,quickMode=false,hardMode=false,currentCombo=0;
function truncateText(text,maxLen=80){
  if(!quickMode||!text||text.length<=maxLen)return text;
  return text.substring(0,maxLen).trim()+'...';
}

// UI Version - increment this to force UI refresh for all users
const UI_VERSION = 12;
let storedUIVersion = parseInt(localStorage.getItem('levelup_ui_version') || '0');

// Check if user needs UI refresh (keeps their progress, just refreshes UI state)
if(storedUIVersion < UI_VERSION){
  // Clear UI-specific flags but keep progress
  localStorage.removeItem('installDismissed');
  localStorage.removeItem('tourComplete');
  localStorage.setItem('levelup_ui_version', UI_VERSION.toString());
  
  // If user has old data, migrate
  let existingData = JSON.parse(localStorage.getItem('levelup_v7') || 'null');
  if(existingData){
    // Reset challenge data to fix timezone bugs (keeps all earned progress)
    existingData.challenge = null;
    existingData.seenOnboarding = false; // Reset onboarding flag for new flow
    localStorage.setItem('levelup_v7', JSON.stringify(existingData));
  }
}

let data=JSON.parse(localStorage.getItem('levelup_v7'))||{xp:0,level:1,coins:0,games:0,mirrorRecognized:0,mirrorTotal:0,agreementAccepted:0,agreementTotal:0,streak:0,lastDaily:null,lastLogin:null,loginDay:0,unlockedLevels:[1],unlockedAgreement:false,seenIntro:false,insightsCollection:[],newlyUnlockedLevels:[],seenAgreementUnlock:false,seenScenarios:{mirror:[],agreement:[],decision:[]},favoriteInsights:[],firstTimeHints:{deepInsight:false,insights:false,pattern:false},unlockTimestamps:{}};
// Migrate old data if needed
if(!data.seenScenarios)data.seenScenarios={mirror:[],agreement:[],decision:[]};
if(!data.favoriteInsights)data.favoriteInsights=[];
if(!data.unlockTimestamps)data.unlockTimestamps={};
if(typeof data.seenOnboarding==='undefined')data.seenOnboarding=false;
// MIGRATION: Recalculate level based on current XP_PER_LEVEL (fixes users from old 500 XP/level)
let correctLevel=Math.floor(data.xp/XP_PER_LEVEL)+1;
if(data.level!==correctLevel){
  data.level=correctLevel;
  // Recalculate unlocks based on correct level
  data.unlockedLevels=[1];
  if(correctLevel>=2){data.unlockedLevels.push(2);data.unlockedAgreement=true;}
  if(correctLevel>=3)data.unlockedLevels.push(3);
  if(correctLevel>=5)data.unlockedLevels.push(4);
  if(correctLevel>=7)data.unlockedLevels.push(5);
  if(correctLevel>=10)data.unlockedLevels.push(6);
  if(correctLevel>=15)data.unlockedLevels.push(7);
  localStorage.setItem('levelup_v7',JSON.stringify(data));
}
// MIGRATION: Add challenge data if not present
if(!data.challenge){
  data.challenge={active:false,startDate:null,breakthroughs:0,todayBreakthroughs:0,lastBreakthroughDate:null,mirror:0,agreement:0,daily:0,deep:0,completed:false,completedDate:null};
}
// MIGRATION: Add foundation plays tracking
if(typeof data.foundationPlays==='undefined'){
  // Estimate from existing play data (mirrorTotal + agreementTotal covers L1-3 plays roughly)
  data.foundationPlays=Math.min((data.mirrorTotal||0)+(data.agreementTotal||0),150);
}
const FOUNDATION_REQUIRED=150; // Plays in L1-3 before unlocking L4+ and rewards
let game={mode:null,scenarios:[],idx:0,answers:[],timer:null,timeLeft:15,useTimer:true,timerDuration:15,levelFilter:null,endlessMode:false,sessionXP:0,sessionInsights:0,sessionGames:0};
let sessionStartTime=Date.now();
let sessionBreakShown=false;
let currentDeepestInsight=null;

// IMMEDIATE STATS PAINT: Show real stats on load instead of zeros
(function(){
  try {
    var lx=(data.level-1)*XP_PER_LEVEL,cx=data.xp-lx,pc=(cx/XP_PER_LEVEL)*100;
    var e;
    e=document.getElementById('playerLevel');if(e)e.textContent='Level '+data.level;
    e=document.getElementById('xpFill');if(e)e.style.width=pc+'%';
    e=document.getElementById('xpCurrent');if(e)e.textContent=cx;
    e=document.getElementById('xpNeeded');if(e)e.textContent=XP_PER_LEVEL;
    e=document.getElementById('coinCount');if(e)e.textContent=data.coins;
    e=document.getElementById('statPlayed');if(e)e.textContent=data.games;
    e=document.getElementById('statStreak');if(e)e.textContent=data.streak||0;
    e=document.getElementById('statInsights');if(e)e.textContent=data.insightsCollection?data.insightsCollection.length:0;
    e=document.getElementById('statAcceptRate');if(e){var ar=data.agreementTotal>0?Math.round((data.agreementAccepted/data.agreementTotal)*100):0;e.textContent=ar+'%';}
    e=document.querySelector('.xp-container');if(e&&data.xp>0)e.classList.add('lit');
  } catch(x){}
})();

// Haptic feedback for mobile
function haptic(style='light'){
  if(navigator.vibrate){
    const patterns = {
      light: 8,
      medium: 15,
      heavy: [50,30,50],
      success: [10,40,15],
      combo: [8,30,8,30,12],
      celebration: [20,40,20,40,30,50,40],
      error: 100
    };
    try { navigator.vibrate(patterns[style] || 8); } catch(e){}
  }
}

// Track seen scenarios to prioritize fresh content
function markScenarioSeen(type,id){
  if(!data.seenScenarios[type])data.seenScenarios[type]=[];
  if(!data.seenScenarios[type].includes(id)){
    data.seenScenarios[type].push(id);
    // Keep only last 2000 to prevent storage bloat
    if(data.seenScenarios[type].length>2000)data.seenScenarios[type]=data.seenScenarios[type].slice(-2000);
    save();
  }
}

// Prioritize unseen scenarios in shuffle
function smartShuffle(arr,type){
  // DEDUPE: Remove scenarios with duplicate text (keep first occurrence)
  let seenTexts=new Set();
  let dedupedArr=arr.filter(s=>{
    let key=s.text||s.scenario||s.id;
    if(seenTexts.has(key))return false;
    seenTexts.add(key);
    return true;
  });
  
  let seen=data.seenScenarios[type]||[];
  let unseen=dedupedArr.filter(s=>!seen.includes(s.text||s.scenario||s.id));
  let seenArr=dedupedArr.filter(s=>seen.includes(s.text||s.scenario||s.id));
  
  // CORE WEIGHTING: For players under 50 games, prioritize first 500 scenarios
  if(data.games < 50 && type === 'mirror') {
    let coreUnseen = unseen.filter((s, idx) => dedupedArr.indexOf(s) < 500);
    let deepUnseen = unseen.filter((s, idx) => dedupedArr.indexOf(s) >= 500);
    let shuffledCore = shuffle(coreUnseen);
    let shuffledDeep = shuffle(deepUnseen);
    unseen = [...shuffledCore, ...shuffledDeep];
  } else {
    unseen = shuffle(unseen);
  }
  
  let shuffledSeen=shuffle(seenArr);
  return [...unseen,...shuffledSeen];
}

// Error handling for external scripts
window.onerror=function(msg,url,line,col,error){
  console.error('Game Error:',msg,url,line);
  if(msg.includes('MIRROR_SCENARIOS')||msg.includes('DECISION_SCENARIOS')||msg.includes('SCENARIOS')){
    showToast('⚠️ Loading scenarios... Please wait');
  }
  return false;
};

// Track script loading status
let scriptsLoaded={mirror:false,decision:false,agreement:false};
function checkScriptsReady(){
  if(typeof MIRROR_SCENARIOS!=='undefined'&&MIRROR_SCENARIOS.length>0)scriptsLoaded.mirror=true;
  if(typeof DECISION_SCENARIOS!=='undefined'&&DECISION_SCENARIOS.length>0)scriptsLoaded.agreement=true;
  if(typeof window.SCENARIOS!=='undefined')scriptsLoaded.decision=true;
  return scriptsLoaded;
}

function save(){localStorage.setItem('levelup_v7',JSON.stringify(data))}

// ============ PRINT FUNCTIONS ============

// Print Progress - Full game progress report (for FAQ)
function printProgress(){
  let container=document.getElementById('printContainer');
  container.style.display='block';
  container.style.position='static';
  let levelNames={1:'Individual',2:'Family',3:'Groups',4:'Community',5:'Society',6:'World',7:'Generations'};
  let levelColors={1:'#FF6B35',2:'#FF3CAC',3:'#784BA0',4:'#2F80ED',5:'#00D26A',6:'#F7C948',7:'#C0C0C0'};
  
  // Get analysis data (may be null if <10 games)
  let analysis=data.games>=10?analyzePatterns():null;
  let p=analysis?analysis.profile:null;
  let recPct=p?Math.round(p.mirrorRecognition*100):(data.mirrorTotal>0?Math.round((data.mirrorRecognized/data.mirrorTotal)*100):0);
  let accPct=p?Math.round(p.acceptanceRate*100):(data.agreementTotal>0?Math.round((data.agreementAccepted/data.agreementTotal)*100):0);
  
  let html='<div class="print-page">';
  
  // Header with game controller
  html+='<div class="print-header">';
  html+='<div class="print-header-icon">🎮</div>';
  html+='<div class="print-logo">LEVEL UP</div>';
  html+='<div class="print-subtitle">Your Growth Progress Report</div>';
  html+='<div class="print-date">'+new Date().toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'})+'</div>';
  html+='</div>';
  
  // Archetype (or placeholder if not unlocked)
  html+='<div class="print-archetype-box">';
  if(analysis){
    html+='<div class="print-archetype-icon">'+analysis.archetype.icon+'</div>';
    html+='<div class="print-archetype-name">'+analysis.archetype.name+'</div>';
    html+='<div class="print-archetype-subtitle">Your Growth Archetype</div>';
  }else{
    html+='<div class="print-archetype-icon">🔒</div>';
    html+='<div class="print-archetype-name" style="color:#999;">Archetype Locked</div>';
    html+='<div class="print-archetype-subtitle">Play '+Math.max(0,10-(data.games||0))+' more games to unlock</div>';
  }
  html+='</div>';
  
  // Stats row
  html+='<div class="print-stats-row">';
  html+='<div class="print-stat-box"><div class="print-stat-value">🪞 '+recPct+'%</div><div class="print-stat-label">Mirror Recognition Rate</div></div>';
  html+='<div class="print-stat-box"><div class="print-stat-value">🎯 '+accPct+'%</div><div class="print-stat-label">Agreement Acceptance Rate</div></div>';
  html+='</div>';
  
  // Game Stats
  html+='<div class="print-stats-row">';
  html+='<div class="print-stat-box"><div class="print-stat-value">'+(data.level||1)+'</div><div class="print-stat-label">Level</div></div>';
  html+='<div class="print-stat-box"><div class="print-stat-value">'+(data.games||0)+'</div><div class="print-stat-label">Games Played</div></div>';
  html+='<div class="print-stat-box"><div class="print-stat-value">'+((data.xp||0).toLocaleString())+'</div><div class="print-stat-label">Total XP</div></div>';
  html+='</div>';
  
  // Unlocked Levels, Streak, Coins
  html+='<div class="print-section">';
  html+='<div class="print-section-title">🔓 Unlocked Levels</div>';
  let unlockedNames=(data.unlockedLevels||[1]).map(id=>levelNames[id]).join(', ');
  html+='<p style="font-size:14px;color:#333;margin-bottom:8px;"><strong>'+unlockedNames+'</strong></p>';
  html+='<p style="font-size:13px;color:#666;">🔥 Current Streak: <strong>'+(data.streak||0)+'</strong> days</p>';
  html+='<p style="font-size:13px;color:#666;">💰 Coins: <strong>'+(data.coins||0)+'</strong></p>';
  html+='</div>';
  
  // All Insights grouped by level
  let insights=data.insightsCollection||[];
  html+='<div class="print-section">';
  html+='<div class="print-section-title">💡 All Insights ('+insights.length+')</div>';
  
  if(insights.length===0){
    html+='<div class="print-insights-level" style="border-left-color:#ccc;background:#f9f9f9;">';
    html+='<p style="color:#999;font-style:italic;text-align:center;padding:20px 0;">No insights collected yet. Play Mirror Mode or the Worldwide Challenge to start collecting insights!</p>';
    html+='</div>';
  }else{
    // Group by level
    let byLevel={};
    insights.forEach(i=>{
      if(!byLevel[i.level])byLevel[i.level]=[];
      byLevel[i.level].push(i);
    });
    
    // Display each level
    Object.keys(byLevel).sort((a,b)=>a-b).forEach(lvl=>{
      let lvlInsights=byLevel[lvl];
      let lvlName=levelNames[lvl]||'Unknown';
      let lvlColor=levelColors[lvl]||'#666';
      
      html+='<div class="print-insights-level" style="border-left-color:'+lvlColor+'">';
      html+='<div class="print-insights-level-header">';
      html+='<span>Level '+lvl+': '+lvlName+'</span>';
      html+='<span class="print-insights-level-count" style="background:'+lvlColor+'">'+lvlInsights.length+'</span>';
      html+='</div>';
      
      // Show first 8 insights, then "more"
      let showCount=Math.min(8,lvlInsights.length);
      lvlInsights.slice(0,showCount).forEach(insight=>{
        let isFav=data.favoriteInsights&&data.favoriteInsights.includes(insight.text);
        html+='<div class="print-insight-item'+(isFav?' print-insight-fav':'')+'">'+(isFav?'❤️ ':'')+insight.text+'</div>';
      });
      
      if(lvlInsights.length>showCount){
        html+='<div class="print-more-insights">+ '+(lvlInsights.length-showCount)+' more insights...</div>';
      }
      html+='</div>';
    });
  }
  html+='</div>';
  
  // Favorite Insights
  let favorites=data.favoriteInsights||[];
  html+='<div class="print-favorites"'+(favorites.length===0?' style="border-color:#ccc;background:#f9f9f9;"':'')+'>';
  html+='<div class="print-favorites-title"'+(favorites.length===0?' style="color:#999;"':'')+'">❤️ Favorite Insights ('+favorites.length+')</div>';
  if(favorites.length===0){
    html+='<p style="color:#999;font-style:italic;font-size:13px;">No favorites yet. Tap the star on any insight to add it to your favorites!</p>';
  }else{
    favorites.forEach(fav=>{
      html+='<div class="print-favorite-item">'+fav+'</div>';
    });
  }
  html+='</div>';
  
  // Deep Insight teaser if not unlocked
  if(!analysis){
    html+='<div class="print-section" style="margin-top:24px;">';
    html+='<div style="background:linear-gradient(135deg,#fff5f8,#f8f5ff);border:2px dashed #FF3CAC;border-radius:12px;padding:20px;text-align:center;">';
    html+='<div style="font-size:24px;margin-bottom:8px;">❤️</div>';
    html+='<div style="font-size:16px;font-weight:700;color:#FF3CAC;margin-bottom:8px;">Deep Insight Unlocks at 10 Games</div>';
    html+='<div style="font-size:13px;color:#666;">You\'ve played <strong>'+(data.games||0)+'</strong> games. Play <strong>'+Math.max(0,10-(data.games||0))+'</strong> more to unlock:</div>';
    html+='<ul style="text-align:left;font-size:12px;color:#666;margin:12px auto;max-width:280px;line-height:1.8;">';
    html+='<li>Your Growth Archetype</li>';
    html+='<li>Core Wound Detection</li>';
    html+='<li>Pattern Contradictions</li>';
    html+='<li>Personalized Coaching Notes</li>';
    html+='<li>Daily Growth Challenges</li>';
    html+='</ul>';
    html+='</div>';
    html+='</div>';
  }
  
  // Call to Action
  html+='<div class="print-section" style="margin-top:24px;">';
  html+='<div style="background:linear-gradient(135deg,#784BA0,#FF3CAC);border-radius:16px;padding:24px;text-align:center;color:#fff;">';
  html+='<div style="font-size:20px;font-weight:800;margin-bottom:8px;">Ready to Go Deeper?</div>';
  html+='<div style="font-size:13px;opacity:0.9;margin-bottom:16px;">Your patterns are showing you something. A coach can help you understand what.</div>';
  html+='<div style="font-size:14px;font-weight:600;">🌐 levelsofself.com/coaching</div>';
  html+='</div>';
  html+='</div>';
  
  // Footer with coach contact info
  html+='<div class="print-footer">';
  html+='<div class="print-footer-brand">Level Up by Arthur Palyan | 100levelup.com | levelsofself.com</div>';
  html+='<div style="font-size:11px;color:#666;margin-top:8px;line-height:1.6;">';
  html+='💜 Talk to Lily (free): t.me/LevelsOfSelfBot<br>';
  html+='📅 Book coaching: calendly.com/levelsofself/zoom<br>';
  html+='💬 WhatsApp Arthur: wa.me/+18184399770';
  html+='</div>';
  html+='<div class="print-footer-tagline">"Pattern recognition changes lives." Keep playing. Keep growing.</div>';
  html+='</div>';
  
  html+='</div>';
  
  container.innerHTML=html;
  setTimeout(function(){
    window.print();
    setTimeout(function(){container.style.display='none';},500);
  },100);
}

// ========== DATA EXPORT / IMPORT ==========
function exportData(){
  let exportObj={
    version:'12.2.0',
    exportDate:new Date().toISOString(),
    source:'100levelup.com',
    data:JSON.parse(JSON.stringify(data))
  };
  let blob=new Blob([JSON.stringify(exportObj,null,2)],{type:'application/json'});
  let url=URL.createObjectURL(blob);
  let a=document.createElement('a');
  a.href=url;
  let dateStr=new Date().toISOString().slice(0,10);
  a.download='levelup-backup-'+dateStr+'.json';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  showToast('📥 Backup saved! Keep this file safe.');
}

function importData(event){
  let file=event.target.files[0];
  if(!file){return;}
  let reader=new FileReader();
  reader.onload=function(e){
    try{
      let imported=JSON.parse(e.target.result);
      let importedData=imported.data||imported;
      // Validate it looks like real Level Up data
      if(typeof importedData.xp==='undefined'&&typeof importedData.games==='undefined'){
        showToast('⚠️ This file doesn\'t look like a Level Up backup.');
        return;
      }
      // Confirm before overwriting
      let games=importedData.games||0;
      let level=importedData.level||1;
      let insights=(importedData.insightsCollection||[]).length;
      if(!confirm('Import this backup?\n\nLevel: '+level+'\nGames: '+games+'\nInsights: '+insights+'\n\nThis will replace your current progress.')){
        return;
      }
      // Merge imported data over current data
      Object.keys(importedData).forEach(key=>{
        data[key]=importedData[key];
      });
      save();
      showToast('✅ Progress restored! Reloading...');
      setTimeout(()=>location.reload(),1000);
    }catch(err){
      showToast('⚠️ Could not read this file. Make sure it\'s a Level Up backup.');
    }
  };
  reader.readAsText(file);
  // Reset input so same file can be selected again
  event.target.value='';
}

// Print Deep Insight - Coaching-focused analysis
function printDeepInsight(){
  let container=document.getElementById('printContainer');
  container.style.display='block';
  container.style.position='static';
  let levelNames={1:'Individual',2:'Family',3:'Groups',4:'Community',5:'Society',6:'World',7:'Generations'};
  
  if(data.games<10){
    showToast('⚠️ Play at least 10 games to print Deep Insight');
    container.style.display='none';
    return;
  }
  
  let analysis=analyzePatterns();
  if(!analysis){
    showToast('⚠️ Unable to analyze patterns');
    container.style.display='none';
    return;
  }
  
  let p=analysis.profile;
  let recPct=Math.round(p.mirrorRecognition*100);
  let accPct=Math.round(p.acceptanceRate*100);
  let insights=data.insightsCollection||[];
  
  let html='<div class="print-page">';
  
  // Header
  html+='<div class="print-header">';
  html+='<div class="print-header-icon">❤️</div>';
  html+='<div class="print-logo">DEEP INSIGHT</div>';
  html+='<div class="print-subtitle">Coaching & Growth Analysis</div>';
  html+='<div class="print-date">'+new Date().toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'})+'</div>';
  html+='</div>';
  
  // Archetype with coaching notes
  html+='<div class="print-archetype-box">';
  html+='<div class="print-archetype-icon">'+analysis.archetype.icon+'</div>';
  html+='<div class="print-archetype-name">'+analysis.archetype.name+'</div>';
  html+='<div class="print-archetype-subtitle">Growth Archetype</div>';
  html+='<div class="print-archetype-edge">'+analysis.archetype.edge+'</div>';
  html+='</div>';
  
  // Growth Pattern Summary
  let summary='';
  if(recPct>=75&&accPct>=75){
    summary='This person sees themselves clearly AND accepts what they see. This combination is rare and powerful. They are ready for integration work, not more insight gathering.';
  }else if(recPct>=75&&accPct<45){
    summary='High self-awareness with harsh self-judgment. The inner critic is strong. Focus on self-compassion before pushing for more insight. They see enough already.';
  }else if(recPct<45&&accPct>=75){
    summary='Gentle with self and others, possibly using acceptance to avoid deeper examination. May need gentle challenges to look more closely at patterns they\'re protecting.';
  }else if(recPct>=55&&accPct>=55){
    summary='Building both awareness and acceptance. A healthy foundation. Ready for deeper work on specific themes that emerge from their patterns.';
  }else if(recPct<45&&accPct<45){
    summary='Early in the journey. Focus on safety and building trust. Don\'t rush toward wounds. Let patterns reveal themselves organically through consistent engagement.';
  }else{
    summary='Patterns are still emerging. Encourage continued exploration. Watch for which themes begin to cluster. That\'s where the real work will be.';
  }
  
  html+='<div class="print-summary-box">';
  html+='<div class="print-section-title">📊 Growth Pattern Analysis</div>';
  html+='<div class="print-summary-text">'+summary+'</div>';
  html+='</div>';
  
  // Stats
  html+='<div class="print-stats-row">';
  html+='<div class="print-stat-box"><div class="print-stat-value">'+recPct+'%</div><div class="print-stat-label">Self-Awareness</div></div>';
  html+='<div class="print-stat-box"><div class="print-stat-value">'+accPct+'%</div><div class="print-stat-label">Self-Acceptance</div></div>';
  html+='<div class="print-stat-box"><div class="print-stat-value">'+data.games+'</div><div class="print-stat-label">Games Played</div></div>';
  html+='<div class="print-stat-box"><div class="print-stat-value">'+insights.length+'</div><div class="print-stat-label">Insights</div></div>';
  html+='</div>';
  
  // Recurring Themes - All 16 Primary Themes
  let themes=[
    {k:'Boundaries',v:p.boundaryTheme||0,icon:'🛡️',color:'#FF3CAC'},
    {k:'Abandonment',v:p.abandonmentTheme||0,icon:'🚪',color:'#FF6B35'},
    {k:'Self-Worth',v:p.worthTheme||0,icon:'💎',color:'#2F80ED'},
    {k:'Betrayal',v:p.betrayalTheme||0,icon:'🗡️',color:'#FF4757'},
    {k:'Honesty',v:p.authenticityTheme||0,icon:'🪞',color:'#00D26A'},
    {k:'Resentment',v:p.resentmentTheme||0,icon:'🔥',color:'#FF4757'},
    {k:'Control',v:p.controlTheme||0,icon:'🎯',color:'#784BA0'},
    {k:'Perfectionism',v:p.perfectionismTheme||0,icon:'✨',color:'#F7C948'},
    {k:'Connection',v:p.connectionTheme||0,icon:'💞',color:'#FF3CAC'},
    {k:'People-Pleasing',v:p.peoplePleasingTheme||0,icon:'🎭',color:'#00D8FF'},
    {k:'Rest',v:p.restTheme||0,icon:'🌿',color:'#00D26A'},
    {k:'Avoidance',v:p.avoidanceTheme||0,icon:'🙈',color:'#C0C0C0'},
    {k:'Grief',v:p.griefTheme||0,icon:'🥀',color:'#8B5CF6'},
    {k:'Withholding',v:p.withholdingTheme||0,icon:'🔒',color:'#784BA0'},
    {k:'Codependency',v:p.codependencyTheme||0,icon:'🔗',color:'#F7C948'},
    {k:'Loneliness',v:p.lonelinessTheme||0,icon:'😔',color:'#2F80ED'}
  ];
  themes.sort((a,b)=>b.v-a.v);
  let activeThemes=themes.filter(t=>t.v>0.08);
  
  if(activeThemes.length>0){
    html+='<div class="print-section">';
    html+='<div class="print-section-title">🎯 Recurring Themes</div>';
    html+='<div class="print-themes-row">';
    activeThemes.forEach(t=>{
      html+='<span class="print-theme-tag" style="background:'+t.color+'22;color:'+t.color+';border:1px solid '+t.color+'">'+t.icon+' '+t.k+' ('+Math.round(t.v*100)+'%)</span>';
    });
    html+='</div>';
    html+='</div>';
  }
  
  // Core Wounds - Updated for 16 themes
  let wounds=[];
  if((p.boundaryTheme||0)>0.15)wounds.push({wound:'Fear of rejection if setting limits',theme:'Boundaries',coaching:'Watch for people-pleasing. Ask about early experiences of setting boundaries.'});
  if((p.abandonmentTheme||0)>0.15)wounds.push({wound:'Everyone leaves eventually',theme:'Abandonment',coaching:'Build trust slowly. They\'re watching for signs you\'ll leave too.'});
  if((p.worthTheme||0)>0.15)wounds.push({wound:'Belief that worth must be earned',theme:'Self-Worth',coaching:'Achievement may be armor. Explore unconditional worth carefully.'});
  if((p.betrayalTheme||0)>0.15)wounds.push({wound:'Trust was weaponized against them',theme:'Betrayal',coaching:'Don\'t ask for trust. Demonstrate it consistently over time.'});
  if((p.shameTheme||0)>0.15)wounds.push({wound:'Something is fundamentally wrong with me',theme:'Shame',coaching:'Shame is pre-verbal. Create safety. Don\'t push for insight. Model acceptance.'});
  if((p.trustTheme||0)>0.15)wounds.push({wound:'Past betrayals made trust dangerous',theme:'Trust',coaching:'Be consistent. Small breaks in reliability will be magnified.'});
  if((p.resentmentTheme||0)>0.15)wounds.push({wound:'Carrying a ledger of unpaid debts',theme:'Resentment',coaching:'Help them see the cost of carrying the grudge. Forgiveness is for them.'});
  if((p.controlTheme||0)>0.2)wounds.push({wound:'Fear that relaxing means everything falls apart',theme:'Control',coaching:'Don\'t challenge control directly. Explore what fear it protects against.'});
  if((p.perfectionismTheme||0)>0.15)wounds.push({wound:'Mistakes feel like identity threats',theme:'Perfectionism',coaching:'Model imperfection. Let them see you make mistakes without catastrophe.'});
  if((p.peoplePleasingTheme||0)>0.15)wounds.push({wound:'Self was sacrificed for approval',theme:'People-Pleasing',coaching:'Help them identify their own wants. Start with small preferences.'});
  if((p.codependencyTheme||0)>0.15)wounds.push({wound:'Identity is defined by others',theme:'Codependency',coaching:'Who are they when no one is watching? Help them excavate authentic self.'});
  if((p.griefTheme||0)>0.15)wounds.push({wound:'Loss that never fully healed',theme:'Grief',coaching:'Moving forward isn\'t betrayal. Give permission to feel joy again.'});
  if((p.lonelinessTheme||0)>0.15)wounds.push({wound:'Surrounded by people but unseen',theme:'Loneliness',coaching:'Loneliness is often a withholding problem. What are they hiding?'});
  if((p.addictionTheme||0)>0.1)wounds.push({wound:'Numbing to survive',theme:'Addiction',coaching:'Zero judgment. Focus on what\'s underneath. Professional referral if needed.'});
  if(accPct<40)wounds.push({wound:'Harsh inner critic blocks self-acceptance',theme:'Judgment',coaching:'Self-compassion work needed before deeper exploration.'});
  
  if(wounds.length>0){
    html+='<div class="print-section">';
    html+='<div class="print-section-title">💔 Core Wounds Detected</div>';
    html+='<div class="print-wounds">';
    wounds.forEach(w=>{
      html+='<div class="print-wound-item">';
      html+='<strong>'+w.wound+'</strong>';
      html+='<div class="print-wound-theme">Theme: '+w.theme+'</div>';
      html+='<div style="font-size:11px;color:#2F80ED;margin-top:6px;font-style:italic;">💡 '+w.coaching+'</div>';
      html+='</div>';
    });
    html+='</div>';
    html+='</div>';
  }
  
  // Contradiction Detection
  if(insights.length>=10){
    let allText=insights.map(i=>((i.text||'')+(i.insight||'')).toLowerCase()).join(' ');
    let contradictions=[];
    let contraPairs=[
      {p1:['avoid conflict','people please','say yes','keep peace'],p2:['anger','resentment','frustrated','bitter'],insight:'Avoids conflict on surface while anger builds beneath. The peace kept has a cost.',theme:'Suppressed Anger',coaching:'Help name the anger without judgment. Explore what needs aren\'t being met.'},
      {p1:['control','perfect','plan','organize','certain'],p2:['anxious','worry','fear','panic','overwhelm'],insight:'Control is response to anxiety, not cure. Tighter grip increases anxiety.',theme:'Control-Anxiety Loop',coaching:'Don\'t try to fix the control. Help them see the anxiety underneath.'},
      {p1:['independent','don\'t need','alone','self-sufficient'],p2:['lonely','abandoned','disconnected','want connection'],insight:'Independence protects from rejection but creates the loneliness feared.',theme:'False Independence',coaching:'Gently explore what connection feels dangerous. Don\'t push togetherness.'},
      {p1:['achieve','success','prove','accomplish'],p2:['not enough','imposter','fraud','worthless'],insight:'No achievement silences the "not enough" voice. Worth can\'t be earned.',theme:'Achievement Trap',coaching:'Separate achievement from worth. Explore who first told them they weren\'t enough.'},
      {p1:['help others','give','support','caretake'],p2:['neglect self','exhausted','burned out','empty'],insight:'Gives to others what won\'t give to self. Helping has become hiding.',theme:'Caretaker Depletion',coaching:'Explore what receiving feels like. Watch for belief that needs make them burden.'}
    ];
    contraPairs.forEach(cp=>{
      if(cp.p1.some(p=>allText.includes(p))&&cp.p2.some(p=>allText.includes(p)))contradictions.push(cp);
    });
    
    if(contradictions.length>0){
      html+='<div class="print-section">';
      html+='<div class="print-section-title">🔄 Pattern Contradictions</div>';
      contradictions.slice(0,2).forEach(c=>{
        html+='<div class="print-contradiction">';
        html+='<div class="print-contradiction-title">'+c.theme+'</div>';
        html+='<div class="print-contradiction-text">'+c.insight+'</div>';
        html+='<div style="font-size:11px;color:#2F80ED;margin-top:8px;font-style:italic;">💡 '+c.coaching+'</div>';
        html+='</div>';
      });
      html+='</div>';
    }
  }
  
  // Coaching Notes
  if(analysis.archetype.coachingNotes){
    html+='<div class="print-coaching-section">';
    html+='<div class="print-coaching-title">📋 Coaching Notes for '+analysis.archetype.name+'</div>';
    html+='<div class="print-coaching-notes">'+analysis.archetype.coachingNotes+'</div>';
    html+='</div>';
  }
  
  // Today's Challenge
  html+='<div class="print-challenge-box">';
  html+='<div class="print-challenge-title">⭐ Today\'s Challenge</div>';
  html+='<div class="print-challenge-text">'+getDailyChallenge(analysis.archetype)+'</div>';
  html+='</div>';
  
  // Level Focus
  let levelCounts=Object.entries(p.topLevels||{}).sort((a,b)=>b[1]-a[1]);
  if(levelCounts.length>0){
    html+='<div class="print-section" style="margin-top:24px;">';
    html+='<div class="print-section-title">📍 Level Focus</div>';
    html+='<p style="font-size:13px;color:#444;line-height:1.6;">';
    levelCounts.slice(0,3).forEach(([lvl,count])=>{
      html+='<strong>Level '+lvl+' ('+levelNames[lvl]+'):</strong> '+count+' patterns<br>';
    });
    html+='</p>';
    html+='</div>';
  }
  
  // Coaching Call to Action
  html+='<div class="print-section" style="margin-top:24px;page-break-inside:avoid;">';
  html+='<div style="background:linear-gradient(135deg,#FF3CAC,#784BA0);border-radius:16px;padding:28px;text-align:center;color:#fff;">';
  html+='<div style="font-size:24px;font-weight:800;margin-bottom:12px;">Your Next Step</div>';
  html+='<div style="font-size:14px;opacity:0.95;margin-bottom:16px;line-height:1.6;">This analysis reveals patterns running beneath the surface.<br>A coach can help you transform insight into lasting change.</div>';
  html+='<div style="display:inline-block;background:#fff;color:#784BA0;padding:12px 24px;border-radius:30px;font-weight:700;font-size:14px;margin-top:8px;">Book a Session: levelsofself.com/coaching</div>';
  html+='</div>';
  html+='</div>';
  
  // What's Next Section
  html+='<div class="print-section" style="margin-top:20px;">';
  html+='<div class="print-section-title">🚀 What\'s Next</div>';
  html+='<div style="display:flex;gap:16px;flex-wrap:wrap;">';
  html+='<div style="flex:1;min-width:200px;background:#f8f5ff;padding:16px;border-radius:12px;border-left:3px solid #784BA0;">';
  html+='<div style="font-size:13px;font-weight:700;color:#784BA0;margin-bottom:6px;">Keep Playing</div>';
  html+='<div style="font-size:12px;color:#666;line-height:1.5;">More games = deeper patterns. Your archetype will refine over time.</div>';
  html+='</div>';
  html+='<div style="flex:1;min-width:200px;background:#fff5f8;padding:16px;border-radius:12px;border-left:3px solid #FF3CAC;">';
  html+='<div style="font-size:13px;font-weight:700;color:#FF3CAC;margin-bottom:6px;">Share This Report</div>';
  html+='<div style="font-size:12px;color:#666;line-height:1.5;">Send to a therapist, coach, or trusted person for deeper conversation.</div>';
  html+='</div>';
  html+='</div>';
  html+='</div>';
  
  // Footer
  html+='<div class="print-footer">';
  html+='<div class="print-footer-brand">Level Up by Arthur Palyan | 100levelup.com | levelsofself.com</div>';
  html+='<div style="font-size:11px;color:#666;margin-top:8px;line-height:1.6;">';
  html+='💜 Talk to Lily (free): t.me/LevelsOfSelfBot<br>';
  html+='📅 Book coaching: calendly.com/levelsofself/zoom<br>';
  html+='💬 WhatsApp Arthur: wa.me/+18184399770';
  html+='</div>';
  html+='<div class="print-footer-tagline">"The patterns you recognize are the patterns you can change."</div>';
  html+='</div>';
  
  html+='</div>';
  
  container.innerHTML=html;
  setTimeout(function(){
    window.print();
    setTimeout(function(){container.style.display='none';},500);
  },100);
}

function shuffle(a){let arr=[...a];for(let i=arr.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]}return arr}
function hashDate(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h=h&h}return Math.abs(h)}

// Shared AudioContext for consistent sound playback
let audioCtx = null;
function getAudioContext(){
  if(!audioCtx){try{audioCtx=new(window.AudioContext||window.webkitAudioContext)()}catch(e){return null}}
  if(audioCtx.state==='suspended')audioCtx.resume();
  return audioCtx;
}

function playSound(f,d){if(!soundOn)return;try{let c=getAudioContext();if(!c)return;let o=c.createOscillator(),g=c.createGain();o.frequency.value=f;o.connect(g);g.connect(c.destination);g.gain.setValueAtTime(0.15,c.currentTime);g.gain.exponentialRampToValueAtTime(0.001,c.currentTime+d);o.start();o.stop(c.currentTime+d)}catch(e){}}
function positiveSound(){haptic('light');[523,659,784].forEach((f,i)=>setTimeout(()=>playSound(f,0.15),i*80))}
function neutralSound(){playSound(330,0.2)}
function coinSound(){playSound(988,0.05);setTimeout(()=>playSound(1319,0.3),60)}
function multiCoinSound(n){for(let i=0;i<Math.min(n,5);i++){setTimeout(()=>{playSound(988+i*100,0.05);setTimeout(()=>playSound(1319+i*100,0.2),40)},i*80)}}
function levelUpSound(){haptic('success');[523,659,784,1047].forEach((f,i)=>setTimeout(()=>playSound(f,0.2),i*100))}
function bonusSound(){haptic('medium');[784,988,1175,1568].forEach((f,i)=>setTimeout(()=>playSound(f,0.15),i*60))}
function milestoneSound(){haptic('heavy');[659,784,988,1175,1319].forEach((f,i)=>setTimeout(()=>playSound(f,0.25),i*120))}
function legendarySound(){haptic('heavy');[523,659,784,988,1175,1319,1568].forEach((f,i)=>setTimeout(()=>playSound(f,0.3),i*100))}
function comboSound(n){let base=523;for(let i=0;i<Math.min(n,5);i++){setTimeout(()=>playSound(base+i*50,0.1),i*50)}}
// v9.4 new sounds
function whooshSound(){if(!soundOn)return;try{let c=getAudioContext();if(!c)return;let o=c.createOscillator(),g=c.createGain();o.type='sine';o.frequency.setValueAtTime(400,c.currentTime);o.frequency.exponentialRampToValueAtTime(150,c.currentTime+0.15);o.connect(g);g.connect(c.destination);g.gain.setValueAtTime(0.08,c.currentTime);g.gain.exponentialRampToValueAtTime(0.001,c.currentTime+0.15);o.start();o.stop(c.currentTime+0.15)}catch(e){}}
function correctSound(){if(!soundOn)return;haptic('light');[880,1175,1397].forEach((f,i)=>setTimeout(()=>playSound(f,0.12),i*60))}
function wrongSound(){if(!soundOn)return;haptic('medium');playSound(220,0.25);setTimeout(()=>playSound(185,0.3),100)}
function tickSound(){if(!soundOn)return;try{let c=getAudioContext();if(!c)return;let o=c.createOscillator(),g=c.createGain();o.type='square';o.frequency.value=800;o.connect(g);g.connect(c.destination);g.gain.setValueAtTime(0.05,c.currentTime);g.gain.exponentialRampToValueAtTime(0.001,c.currentTime+0.03);o.start();o.stop(c.currentTime+0.03)}catch(e){}}
function selectSound(){if(!soundOn)return;playSound(660,0.05)}

function addXP(amount, source){
  data.xp+=amount;data.coins+=Math.floor(amount/4);
  game.sessionXP+=amount; // Track session XP
  // Track XP history
  if(!data.xpHistory) data.xpHistory = [];
  data.xpHistory.push({amount: amount, source: source || 'Game', date: Date.now()});
  if(data.xpHistory.length > 100) data.xpHistory = data.xpHistory.slice(-100); // Keep last 100
  let newLevel=Math.floor(data.xp/XP_PER_LEVEL)+1;
  let hasFoundation=(data.foundationPlays||0)>=FOUNDATION_REQUIRED;
  if(newLevel>data.level){
    data.level=newLevel;levelUpSound();triggerConfetti();
    let unlockMsg='';
    if(newLevel===2){data.unlockedAgreement=true;data.seenAgreementUnlock=false;if(!data.unlockedLevels.includes(2)){data.unlockedLevels.push(2);if(!data.newlyUnlockedLevels)data.newlyUnlockedLevels=[];data.newlyUnlockedLevels.push(2);data.unlockTimestamps.agreement=Date.now();data.unlockTimestamps.level2=Date.now();}unlockMsg='🔓 Agreement Game unlocked!';updateAgreementButton();}
    if(newLevel===3&&!data.unlockedLevels.includes(3)){data.unlockedLevels.push(3);if(!data.newlyUnlockedLevels)data.newlyUnlockedLevels=[];data.newlyUnlockedLevels.push(3);data.unlockTimestamps.level3=Date.now();unlockMsg='🔓 Level 3 unlocked!';}
    // Levels 4+ require foundation exploration
    if(newLevel>=5&&hasFoundation&&!data.unlockedLevels.includes(4)){data.unlockedLevels.push(4);if(!data.newlyUnlockedLevels)data.newlyUnlockedLevels=[];data.newlyUnlockedLevels.push(4);data.unlockTimestamps.level4=Date.now();}
    if(newLevel>=7&&hasFoundation&&!data.unlockedLevels.includes(5)){data.unlockedLevels.push(5);if(!data.newlyUnlockedLevels)data.newlyUnlockedLevels=[];data.newlyUnlockedLevels.push(5);data.unlockTimestamps.level5=Date.now();}
    if(newLevel>=10&&hasFoundation&&!data.unlockedLevels.includes(6)){data.unlockedLevels.push(6);if(!data.newlyUnlockedLevels)data.newlyUnlockedLevels=[];data.newlyUnlockedLevels.push(6);data.unlockTimestamps.level6=Date.now();}
    if(newLevel>=15&&hasFoundation&&!data.unlockedLevels.includes(7)){data.unlockedLevels.push(7);if(!data.newlyUnlockedLevels)data.newlyUnlockedLevels=[];data.newlyUnlockedLevels.push(7);data.unlockTimestamps.level7=Date.now();}
    showLevelUp(newLevel,unlockMsg);
  }
  save();updateXPBar();
}

// Update Agreement button immediately when unlocked
function updateAgreementButton(){
  let agreementEl=document.getElementById('agreementMode');
  if(!agreementEl)return;
  agreementEl.classList.remove('locked');
  agreementEl.classList.add('newly-unlocked');
  document.getElementById('agreementUnlock').textContent='';
  // Add NEW badge
  let existingBadge=agreementEl.querySelector('.new-badge');
  if(existingBadge)existingBadge.remove();
  let badge=document.createElement('span');
  badge.className='new-badge';
  badge.textContent='NEW';
  agreementEl.style.position='relative';
  agreementEl.appendChild(badge);
  // Also update level select modal buttons
  let levelAgreementBtn=document.getElementById('levelAgreementBtn');
  let levelMixedBtn=document.getElementById('levelMixedBtn');
  if(levelAgreementBtn){
    levelAgreementBtn.style.opacity='1';
    levelAgreementBtn.style.border='2px solid var(--pink)';
    levelAgreementBtn.style.boxShadow='0 0 12px rgba(255,60,172,0.3)';
  }
  if(levelMixedBtn){
    levelMixedBtn.style.opacity='1';
    levelMixedBtn.style.border='2px solid var(--pink)';
    levelMixedBtn.style.boxShadow='0 0 12px rgba(255,60,172,0.3)';
  }
}

const GROWTH_ICONS=['🌱','🌿','🪻','🌳','🌲','🌍','⭐'];
function updateXPBar(){
  let levelXP=(data.level-1)*XP_PER_LEVEL;let currentLevelXP=data.xp-levelXP;let pct=(currentLevelXP/XP_PER_LEVEL)*100;
  let icon=GROWTH_ICONS[Math.min(data.level-1,6)];
  document.getElementById('playerLevel').innerHTML=icon+' '+(typeof t==='function'?t('Level'):'Level')+' '+data.level;
  document.getElementById('xpFill').style.width=pct+'%';
  document.getElementById('xpCurrent').textContent=currentLevelXP;
  document.getElementById('xpNeeded').textContent=XP_PER_LEVEL;
  document.getElementById('coinCount').textContent=data.coins;
  // Light up XP container when user has XP
  let xpContainer=document.querySelector('.xp-container');
  if(data.xp>0){xpContainer.classList.add('lit')}else{xpContainer.classList.remove('lit')}
}
function showLevelUp(level,unlockMsg){
  let icon=GROWTH_ICONS[Math.min(level-1,6)];
  document.getElementById('levelupIcon').textContent=icon;
  document.getElementById('levelupText').textContent=(typeof t==='function'?t("You're now Level"):"You're now Level")+' '+level+'!';
  document.getElementById('levelupUnlock').textContent=unlockMsg||'';
  document.getElementById('levelupPopup').classList.add('show');
}
document.getElementById('levelupBtn').onclick=function(){document.getElementById('levelupPopup').classList.remove('show')};
document.getElementById('levelupShareBtn').onclick=function(){
  document.getElementById('levelupPopup').classList.remove('show');
  shareLevelUpCard();
};

function shareLevelUpCard(){
  let level=data.level;
  let icon=GROWTH_ICONS[Math.min(level-1,6)];
  let games=data.games;
  let insights=(data.insightsCollection||[]).length;
  
  // Get a recent insight if available
  let recentInsight='';
  if(data.insightsCollection&&data.insightsCollection.length>0){
    let recent=data.insightsCollection[data.insightsCollection.length-1];
    recentInsight=recent.text;
  }
  
  let text=icon+' I just reached Level '+level+' on Level Up!\n\n';
  text+='🎮 '+games+' games played\n';
  text+='💡 '+insights+' insights collected\n';
  if(data.streak>0)text+='🔥 '+data.streak+'-day streak\n';
  if(recentInsight)text+='\nMy latest insight:\n"'+recentInsight.substring(0,100)+(recentInsight.length>100?'...':'')+'"';
  text+='\n\nWhat\'s YOUR pattern?\n100levelup.com';
  
  if(navigator.share){
    navigator.share({title:'Level Up - I reached Level '+level+'!',text:text,url:'https://100levelup.com'}).catch(()=>copyToClipboard(text));
  }else{
    copyToClipboard(text);
  }
}

function addCombo(){
  currentCombo++;
  if(currentCombo>=3){
    haptic('combo');
    let el=document.getElementById('comboDisplay');el.textContent='🔥 '+currentCombo+'x COMBO!';el.classList.add('show');comboSound(currentCombo);
    setTimeout(()=>el.classList.remove('show'),1500);
    // Reduced combo bonuses for balanced progression
    if(currentCombo===5){showBonusPopup('🔥 +10 XP Combo!');addXP(10, '5x Combo');}
    else if(currentCombo===10){showBonusPopup('🔥🔥 +20 XP Mega Combo!');addXP(20, '10x Combo');}
    else if(currentCombo===15){showBonusPopup('🔥🔥🔥 +30 XP Ultra Combo!');addXP(30, '15x Combo');triggerConfetti();}
    else if(currentCombo===20){showBonusPopup('⭐ +50 XP LEGENDARY!');addXP(50, '20x Combo');triggerConfetti();}
  }
  document.getElementById('gameCombo').textContent=currentCombo>1?'🔥'+currentCombo+'x':'';
}
function resetCombo(){currentCombo=0;document.getElementById('gameCombo').textContent='';}

function showToast(msg,duration){let t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),duration||2000)}

// ========== HOOK MUSIC CONTROLS ==========
let hookMusicPlaying = true;

function toggleHookMusic() {
  const btn = document.getElementById('hookMusicToggle');
  const introAudio = document.getElementById('introMusic');
  
  if (hookMusicPlaying) {
    // Turn off music
    if (introAudio) introAudio.pause();
    hookMusicPlaying = false;
    btn.classList.remove('on');
    btn.classList.add('off');
    showToast('Music off');
  } else {
    // Turn on music
    if (introAudio) introAudio.play();
    hookMusicPlaying = true;
    btn.classList.remove('off');
    btn.classList.add('on');
    showToast('Music on');
  }
}

function openSpotify() {
  // Pause game music first
  const introAudio = document.getElementById('introMusic');
  if (introAudio) introAudio.pause();
  hookMusicPlaying = false;
  const btn = document.getElementById('hookMusicToggle');
  if (btn) {
    btn.classList.remove('on');
    btn.classList.add('off');
  }
  showToast('Opening Spotify...');
  
  // Detect platform and use appropriate URL
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  const isAndroid = /Android/.test(navigator.userAgent);
  
  if (isIOS) {
    // iOS: Use universal link that opens app if installed, App Store if not
    window.location.href = 'spotify://';
    setTimeout(() => { window.location.href = 'https://open.spotify.com'; }, 1500);
  } else if (isAndroid) {
    // Android: Intent URL for app, fallback to web
    window.location.href = 'intent://open.spotify.com/#Intent;scheme=https;package=com.spotify.music;end';
    setTimeout(() => { window.open('https://open.spotify.com', '_blank'); }, 1500);
  } else {
    // Desktop: Just open web player
    window.open('https://open.spotify.com', '_blank');
  }
}

function openAppleMusic() {
  // Pause game music first
  const introAudio = document.getElementById('introMusic');
  if (introAudio) introAudio.pause();
  hookMusicPlaying = false;
  const btn = document.getElementById('hookMusicToggle');
  if (btn) {
    btn.classList.remove('on');
    btn.classList.add('off');
  }
  showToast('Opening Apple Music...');
  
  // Detect platform and use appropriate URL
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  const isAndroid = /Android/.test(navigator.userAgent);
  
  if (isIOS) {
    // iOS: Direct to Apple Music app
    window.location.href = 'music://';
    setTimeout(() => { window.location.href = 'https://music.apple.com'; }, 1500);
  } else if (isAndroid) {
    // Android: Apple Music app or web
    window.location.href = 'intent://music.apple.com/#Intent;scheme=https;package=com.apple.android.music;end';
    setTimeout(() => { window.open('https://music.apple.com', '_blank'); }, 1500);
  } else {
    // Desktop: Just open web player
    window.open('https://music.apple.com', '_blank');
  }
}

// ========== SOCIAL MEDIA SHARING ==========
const shareCaption = "See the patterns running your life. Everyone sees your pattern except you. 🎮 Free self-awareness game\n\n100levelup.com";

function shareToInstagram() {
  // Step 1: Create and download shareable image
  createShareImage().then(blob => {
    // Download the image
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'levelup-share.png';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    // Step 2: Copy caption to clipboard
    navigator.clipboard.writeText(shareCaption).then(() => {
      showToast('📸 Image saved & caption copied!', 3000);
      
      // Step 3: Open Instagram after short delay
      setTimeout(() => {
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const isAndroid = /Android/.test(navigator.userAgent);
        
        if (isIOS) {
          window.location.href = 'instagram://app';
        } else if (isAndroid) {
          window.location.href = 'intent://instagram.com/#Intent;scheme=https;package=com.instagram.android;end';
        } else {
          window.open('https://instagram.com', '_blank');
        }
      }, 500);
    }).catch(() => {
      // Clipboard failed, just show toast and open Instagram
      showToast('📸 Image saved! Copy caption manually', 3000);
      setTimeout(() => {
        window.open('https://instagram.com', '_blank');
      }, 500);
    });
  });
}

function createShareImage() {
  return new Promise((resolve) => {
    const canvas = document.createElement('canvas');
    canvas.width = 1080;
    canvas.height = 1080;
    const ctx = canvas.getContext('2d');
    
    // Background gradient
    const gradient = ctx.createLinearGradient(0, 0, 1080, 1080);
    gradient.addColorStop(0, '#1a1035');
    gradient.addColorStop(1, '#0d0a1a');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, 1080, 1080);
    
    // Add decorative circles
    ctx.beginPath();
    ctx.arc(200, 200, 300, 0, Math.PI * 2);
    ctx.fillStyle = 'rgba(255, 107, 53, 0.1)';
    ctx.fill();
    
    ctx.beginPath();
    ctx.arc(880, 880, 400, 0, Math.PI * 2);
    ctx.fillStyle = 'rgba(120, 75, 160, 0.1)';
    ctx.fill();
    
    // Main text
    ctx.fillStyle = '#ffffff';
    ctx.font = 'bold 72px -apple-system, BlinkMacSystemFont, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('Everyone sees', 540, 380);
    ctx.fillText('your pattern.', 540, 460);
    
    // Pink accent text
    ctx.fillStyle = '#FF3CAC';
    ctx.font = 'bold 80px -apple-system, BlinkMacSystemFont, sans-serif';
    ctx.fillText('Except you.', 540, 580);
    
    // Subtext
    ctx.fillStyle = '#888888';
    ctx.font = '36px -apple-system, BlinkMacSystemFont, sans-serif';
    ctx.fillText('Free self-awareness game • 6,854 scenarios', 540, 700);
    
    // URL
    ctx.fillStyle = '#FF3CAC';
    ctx.font = 'bold 48px -apple-system, BlinkMacSystemFont, sans-serif';
    ctx.fillText('100levelup.com', 540, 900);
    
    canvas.toBlob(resolve, 'image/png');
  });
}

function shareToFacebook() {
  const url = encodeURIComponent('https://100levelup.com');
  const text = encodeURIComponent('See the patterns running your life. Free self-awareness game 🎮');
  window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`, '_blank', 'width=600,height=400');
}

function shareToTwitter() {
  const text = encodeURIComponent('Everyone sees your pattern. Except you. 🎮\n\nFree self-awareness game with 6,854 scenarios.\n\n100levelup.com');
  window.open(`https://twitter.com/intent/tweet?text=${text}`, '_blank', 'width=600,height=400');
}

function shareToWhatsApp() {
  const text = encodeURIComponent('See the patterns running your life. Everyone sees your pattern except you. 🎮 Free game, 2 min/day.\n\n100levelup.com');
  window.open(`https://wa.me/?text=${text}`, '_blank');
}

// FAQ Music Toggle - toggles game music
function toggleFaqMusic() {
  const btn = document.getElementById('faqMusicToggle');
  const musicBtn = document.getElementById('musicBtn');
  
  if (musicOn) {
    music.pause();
    musicOn = false;
    if (musicBtn) musicBtn.classList.remove('on');
    btn.style.background = 'var(--card)';
    btn.style.border = '1px solid var(--border)';
    btn.style.color = 'var(--muted)';
    showToast('Music off');
  } else {
    music.play().catch(() => {});
    musicOn = true;
    if (musicBtn) musicBtn.classList.add('on');
    btn.style.background = 'linear-gradient(135deg,var(--orange),var(--pink))';
    btn.style.border = 'none';
    btn.style.color = '#fff';
    showToast('Music on');
  }
}

// Open The Palyans on Spotify
function openPalyansSpotify() {
  showToast('Opening The Palyans on Spotify...');
  window.open('https://open.spotify.com/artist/0yFLDbCEe6yev6uuG5TmUU', '_blank');
}

// Open The Palyans on Apple Music
function openPalyansAppleMusic() {
  showToast('Opening The Palyans on Apple Music...');
  window.open('https://music.apple.com/us/artist/the-palyans/1120205357', '_blank');
}

// ========== BREAKTHROUGH EXERCISES ==========
function toggleExercise(el) {
  const content = el.querySelector('.exercise-content');
  const toggle = el.querySelector('.exercise-toggle');
  const isOpen = content.style.display === 'block';
  
  // Close all other exercises
  document.querySelectorAll('.breakthrough-exercise').forEach(ex => {
    ex.querySelector('.exercise-content').style.display = 'none';
    ex.querySelector('.exercise-toggle').textContent = '+';
    ex.style.borderColor = 'var(--border)';
  });
  
  // Toggle current
  if (!isOpen) {
    content.style.display = 'block';
    toggle.textContent = '−';
    el.style.borderColor = 'var(--pink)';
  }
}

function completeExercise(exerciseNum) {
  // Initialize exercises data if needed
  if (!data.completedExercises) data.completedExercises = [];
  
  // Check if already completed today
  const today = new Date().toDateString();
  const alreadyDone = data.completedExercises.find(e => e.num === exerciseNum && new Date(e.date).toDateString() === today);
  
  if (alreadyDone) {
    showToast('Already completed today! Come back tomorrow.');
    return;
  }
  
  // XP rewards by exercise
  const xpRewards = {1: 25, 2: 25, 3: 25, 4: 25, 5: 50, 6: 50, 7: 100, 8: 100, 9: 100};
  const xpAmount = xpRewards[exerciseNum] || 25;
  
  // Award XP
  data.xp += xpAmount;
  data.coins += Math.floor(xpAmount / 5);
  
  // Track completion
  data.completedExercises.push({num: exerciseNum, date: new Date().toISOString(), xp: xpAmount});
  
  // Update XP history
  if (!data.xpHistory) data.xpHistory = [];
  data.xpHistory.push({date: new Date().toISOString(), amount: xpAmount, source: 'Exercise ' + exerciseNum});
  
  // Check for level up
  const newLevel = Math.floor(data.xp / XP_PER_LEVEL) + 1;
  if (newLevel > data.level) {
    data.level = newLevel;
    showToast('🎉 LEVEL UP! You are now Level ' + data.level + '!', 3000);
  } else {
    showToast('✅ +' + xpAmount + ' XP earned!');
  }
  
  // Update button to show completed
  const btn = event.target;
  btn.textContent = '✓ Completed Today';
  btn.style.background = 'var(--card)';
  btn.style.border = '2px solid var(--green)';
  btn.style.color = 'var(--green)';
  btn.disabled = true;
  
  // Check if deep work exercises completed
  const deepWorkNums = [7, 8, 9];
  const completedDeep = deepWorkNums.filter(n => data.completedExercises.some(e => e.num === n)).length;
  if (completedDeep >= 2) {
    document.getElementById('deepWorkCTA').style.display = 'block';
  }
  
  // Update displays
  updateAllDisplays();
  save();
}

function initBreakthroughExercises() {
  if (!data.completedExercises) return;
  const today = new Date().toDateString();
  
  document.querySelectorAll('.breakthrough-exercise').forEach(ex => {
    const num = parseInt(ex.dataset.exercise);
    const completedToday = data.completedExercises.find(e => e.num === num && new Date(e.date).toDateString() === today);
    
    if (completedToday) {
      const btn = ex.querySelector('.exercise-complete-btn');
      if (btn) {
        btn.textContent = '✓ Completed Today';
        btn.style.background = 'var(--card)';
        btn.style.border = '2px solid var(--green)';
        btn.style.color = 'var(--green)';
        btn.disabled = true;
      }
    }
  });
  
  // Show deep work CTA if earned
  const deepWorkNums = [7, 8, 9];
  const completedDeep = deepWorkNums.filter(n => data.completedExercises.some(e => e.num === n)).length;
  if (completedDeep >= 2) {
    const cta = document.getElementById('deepWorkCTA');
    if (cta) cta.style.display = 'block';
  }
}

function showXpDetails() {
  if(tourActive)return;
  const content = document.getElementById('xpDetailsContent');
  const history = data.xpHistory || [];
  const recentHistory = history.slice(-20).reverse();
  
  let html = '<div style="margin-bottom:16px;">';
  html += '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">';
  html += '<span style="font-size:24px;font-weight:700;color:var(--gold);">' + data.xp + ' XP</span>';
  html += '<span style="font-size:14px;color:var(--muted);">Level ' + data.level + '</span>';
  html += '</div>';
  html += '<div style="font-size:12px;color:var(--muted);">' + (XP_PER_LEVEL - (data.xp % XP_PER_LEVEL)) + ' XP to next level</div>';
  html += '</div>';
  
  if (recentHistory.length > 0) {
    html += '<div style="font-size:13px;font-weight:600;margin-bottom:8px;color:var(--text);">Recent Activity</div>';
    html += '<div style="max-height:200px;overflow-y:auto;">';
    recentHistory.forEach(item => {
      const date = new Date(item.date);
      const timeStr = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
      html += '<div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border);font-size:12px;">';
      html += '<span style="color:var(--text);">' + (item.source || 'Game') + '</span>';
      html += '<span style="color:var(--green);font-weight:600;">+' + item.amount + ' XP</span>';
      html += '</div>';
    });
    html += '</div>';
  } else {
    html += '<div style="text-align:center;padding:20px;color:var(--muted);font-size:13px;">Play games to start earning XP!</div>';
  }
  
  content.innerHTML = html;
  document.getElementById('xpDetailsModal').classList.add('active');
}

function showStatDetails(stat) {
  if(tourActive)return;
  const title = document.getElementById('statDetailsTitle');
  const content = document.getElementById('statDetailsContent');
  let html = '';
  
  if (stat === 'played') {
    title.textContent = '🎮 Games Played';
    const mirrorGames = data.mirrorTotal || 0;
    const agreementGames = data.agreementTotal || 0;
    const totalGames = data.games || 0;
    
    html = '<div style="text-align:center;margin-bottom:20px;">';
    html += '<div style="font-size:48px;font-weight:700;color:var(--pink);">' + totalGames + '</div>';
    html += '<div style="color:var(--muted);font-size:14px;">total games completed</div>';
    html += '</div>';
    
    html += '<div style="background:var(--card);border-radius:12px;padding:16px;margin-bottom:16px;">';
    html += '<div style="display:flex;justify-content:space-between;margin-bottom:12px;"><span style="color:var(--muted);">🪞 Mirror Game</span><span style="color:var(--text);font-weight:600;">' + mirrorGames + '</span></div>';
    html += '<div style="display:flex;justify-content:space-between;"><span style="color:var(--muted);">⚖️ Agreement Game</span><span style="color:var(--text);font-weight:600;">' + agreementGames + '</span></div>';
    html += '</div>';
    
    html += '<div style="font-size:12px;color:var(--muted);text-align:center;line-height:1.6;">';
    html += 'Every game you complete adds to your growth journey. The more you play, the deeper your self-awareness becomes.';
    html += '</div>';
    
  } else if (stat === 'streak') {
    title.textContent = '🔥 Daily Streak';
    const streak = data.streak || 0;
    const bestStreak = data.bestStreak || streak;
    
    html = '<div style="text-align:center;margin-bottom:20px;">';
    html += '<div style="font-size:48px;font-weight:700;color:var(--orange);">' + streak + '</div>';
    html += '<div style="color:var(--muted);font-size:14px;">day streak</div>';
    html += '</div>';
    
    html += '<div style="background:var(--card);border-radius:12px;padding:16px;margin-bottom:16px;">';
    html += '<div style="display:flex;justify-content:space-between;margin-bottom:12px;"><span style="color:var(--muted);">Current streak</span><span style="color:var(--orange);font-weight:600;">' + streak + ' days</span></div>';
    html += '<div style="display:flex;justify-content:space-between;"><span style="color:var(--muted);">Best streak</span><span style="color:var(--gold);font-weight:600;">' + bestStreak + ' days</span></div>';
    html += '</div>';
    
    html += '<div style="background:linear-gradient(135deg,rgba(255,107,53,0.1),rgba(255,60,172,0.1));border:1px solid var(--orange);border-radius:12px;padding:16px;">';
    html += '<div style="font-size:13px;font-weight:600;color:var(--orange);margin-bottom:8px;">Keep the fire burning!</div>';
    html += '<div style="font-size:12px;color:var(--muted);line-height:1.6;">';
    html += 'Complete the Worldwide Challenge each day to build your streak. Miss a day and it resets!';
    html += '</div></div>';
    
  } else if (stat === 'acceptance') {
    title.textContent = '💚 Acceptance Rate';
    const accepted = data.agreementAccepted || 0;
    const total = data.agreementTotal || 0;
    const rate = total > 0 ? Math.round((accepted / total) * 100) : 0;
    
    html = '<div style="text-align:center;margin-bottom:20px;">';
    html += '<div style="font-size:48px;font-weight:700;color:var(--green);">' + rate + '%</div>';
    html += '<div style="color:var(--muted);font-size:14px;">acceptance rate</div>';
    html += '</div>';
    
    html += '<div style="background:var(--card);border-radius:12px;padding:16px;margin-bottom:16px;">';
    html += '<div style="display:flex;justify-content:space-between;margin-bottom:12px;"><span style="color:var(--muted);">Accepting answers</span><span style="color:var(--green);font-weight:600;">' + accepted + '</span></div>';
    html += '<div style="display:flex;justify-content:space-between;"><span style="color:var(--muted);">Total scenarios</span><span style="color:var(--text);font-weight:600;">' + total + '</span></div>';
    html += '</div>';
    
    html += '<div style="background:linear-gradient(135deg,rgba(0,210,106,0.1),rgba(0,180,90,0.1));border:1px solid var(--green);border-radius:12px;padding:16px;">';
    html += '<div style="font-size:13px;font-weight:600;color:var(--green);margin-bottom:8px;">Acceptance ≠ Agreement</div>';
    html += '<div style="font-size:12px;color:var(--muted);line-height:1.6;">';
    html += 'Acceptance means acknowledging reality as it is. You can accept something IS without agreeing it SHOULD BE. This is the first step to real change.';
    html += '</div></div>';
  }
  
  content.innerHTML = html;
  document.getElementById('statDetailsModal').classList.add('active');
}

// 30-Day Challenge Functions
function showChallengeModal(){
  if(tourActive)return;
  updateChallengeUI();
  document.getElementById('challengeModal').classList.add('active');
}

function resetChallenge(){
  if(!confirm('Are you sure you want to reset your 30-Day Challenge? This cannot be undone.'))return;
  data.challenge=null;
  save();
  updateChallengeUI();
  updateChallengeDisplay();
  showToast('Challenge reset. Ready to start fresh!');
}

function startChallenge(){
  // Mark that they've started playing (hides Start Here, shows Play badges)
  if(!data.hasStartedPlaying){data.hasStartedPlaying=true;}
  // Get local date string (YYYY-MM-DD) to avoid timezone issues
  let now=new Date();
  let localDate=now.getFullYear()+'-'+String(now.getMonth()+1).padStart(2,'0')+'-'+String(now.getDate()).padStart(2,'0');
  data.challenge={
    active:true,
    startDate:localDate,
    breakthroughs:0,
    todayBreakthroughs:0,
    lastBreakthroughDate:null,
    mirror:0,
    agreement:0,
    daily:0,
    deep:0,
    completed:false,
    completedDate:null
  };
  save();
  updateChallengeUI();
  showToast('🎯 30-Day Challenge started!');
  triggerConfetti();
}

function addBreakthrough(type,count=1){
  if(!data.challenge||!data.challenge.active)return;
  // Get local date string to match startDate format
  let now=new Date();
  let today=now.getFullYear()+'-'+String(now.getMonth()+1).padStart(2,'0')+'-'+String(now.getDate()).padStart(2,'0');
  if(data.challenge.lastBreakthroughDate!==today){
    data.challenge.todayBreakthroughs=0;
    data.challenge.lastBreakthroughDate=today;
  }
  data.challenge.breakthroughs+=count;
  data.challenge.todayBreakthroughs+=count;
  if(type==='mirror')data.challenge.mirror+=count;
  else if(type==='agreement')data.challenge.agreement+=count;
  else if(type==='daily')data.challenge.daily+=count;
  else if(type==='deep')data.challenge.deep+=count;
  
  // Check for completion
  if(data.challenge.breakthroughs>=1000&&!data.challenge.completed){
    data.challenge.completed=true;
    data.challenge.completedDate=today;
    setTimeout(()=>{
      showChallengeModal();
      triggerConfetti();
      legendarySound();
      showToast('🏆 CHALLENGE COMPLETE! 1000 BREAKTHROUGHS!', 5000);
      // Multiple confetti bursts for epic celebration
      setTimeout(()=>triggerConfetti(),500);
      setTimeout(()=>triggerConfetti(),1000);
      setTimeout(()=>triggerConfetti(),1500);
    },500);
  }
  save();
  updateChallengeDisplay();
}

function getChallengeDay(){
  if(!data.challenge||!data.challenge.startDate)return 1;
  // Parse start date carefully to avoid timezone issues
  let startParts=data.challenge.startDate.split('-');
  let start=new Date(parseInt(startParts[0]),parseInt(startParts[1])-1,parseInt(startParts[2]));
  let today=new Date();
  start.setHours(0,0,0,0);
  today.setHours(0,0,0,0);
  let daysDiff=Math.floor((today-start)/(1000*60*60*24));
  return Math.max(1,daysDiff+1); // Always at least day 1
}

function updateChallengeUI(){
  let notStarted=document.getElementById('challengeNotStarted');
  let active=document.getElementById('challengeActive');
  let complete=document.getElementById('challengeComplete');
  
  if(!data.challenge||!data.challenge.active){
    notStarted.style.display='block';
    active.style.display='none';
    complete.style.display='none';
    return;
  }
  
  if(data.challenge.completed){
    notStarted.style.display='none';
    active.style.display='none';
    complete.style.display='block';
    let days=getChallengeDay();
    document.getElementById('challengeCompletedDays').textContent=days;
    updateBreakthroughLetter(); // Generate personalized letter
    return;
  }
  
  notStarted.style.display='none';
  active.style.display='block';
  complete.style.display='none';
  
  let day=getChallengeDay();
  let b=data.challenge.breakthroughs;
  // Get local date string to match stored format
  let now=new Date();
  let today=now.getFullYear()+'-'+String(now.getMonth()+1).padStart(2,'0')+'-'+String(now.getDate()).padStart(2,'0');
  let todayB=data.challenge.lastBreakthroughDate===today?data.challenge.todayBreakthroughs:0;
  let pct=Math.min(100,(b/1000)*100);
  let daysLeft=Math.max(1,31-day);
  let needed=Math.ceil((1000-b)/daysLeft);
  
  document.getElementById('challengeDay').textContent=Math.min(day,30);
  document.getElementById('challengeBreakthroughs').textContent=b;
  document.getElementById('challengeProgress').style.width=pct+'%';
  document.getElementById('challengeToday').textContent=todayB;
  document.getElementById('challengeNeeded').textContent=needed+'/day';
  document.getElementById('challengeMirror').textContent=data.challenge.mirror;
  document.getElementById('challengeAgreement').textContent=data.challenge.agreement;
  document.getElementById('challengeDaily').textContent=data.challenge.daily;
  document.getElementById('challengeDeep').textContent=data.challenge.deep;
  
  // Status - be forgiving on day 1, then check pace (1000 breakthroughs / 30 days ≈ 34/day)
  let status=document.getElementById('challengeStatus');
  let expectedB=Math.max(0,(day-1)*34); // Day 1 expects 0, Day 2 expects 34, etc.
  if(day===1||b>=expectedB){
    status.textContent='ON TRACK';
    status.style.background='var(--green)';
  }else if(b>=expectedB*0.7){
    status.textContent='CATCHING UP';
    status.style.background='var(--orange)';
  }else{
    status.textContent='BEHIND';
    status.style.background='var(--red)';
  }
}

function updateChallengeDisplay(){
  let statEl=document.getElementById('challengeStat');
  let statTextEl=document.getElementById('statChallenge');
  // Elements may not exist in current UI version
  if(!statEl||!statTextEl)return;
  if(!data.challenge||!data.challenge.active){
    statTextEl.textContent='Start';
    statEl.classList.remove('challenge-active');
    return;
  }
  if(data.challenge.completed){
    statTextEl.textContent='🏆 Done!';
    statEl.classList.add('challenge-active');
    return;
  }
  statTextEl.textContent=data.challenge.breakthroughs+'/100';
  statEl.classList.add('challenge-active');
}

// Generate personalized Breakthrough Letter based on user's journey
function generateBreakthroughLetter(){
  let c=data.challenge||{};
  let days=getChallengeDay();
  let insights=data.insightsCollection||[];
  let arch=detectArchetype();
  let acceptRate=data.agreementTotal>0?Math.round((data.agreementAccepted/data.agreementTotal)*100):50;
  let recognitionRate=data.mirrorTotal>0?Math.round((data.mirrorRecognized/data.mirrorTotal)*100):50;
  
  // Determine dominant mode
  let dominantMode='balanced';
  if(c.mirror>c.agreement*1.5)dominantMode='reflection';
  else if(c.agreement>c.mirror*1.5)dominantMode='action';
  
  // Build the letter
  let letter='<p style="margin-bottom:16px;"><strong>Dear Traveler,</strong></p>';
  
  // Opening - acknowledge the journey
  letter+=`<p style="margin-bottom:16px;">You did it. <strong>${days} days</strong>. <strong>${c.breakthroughs||100} breakthroughs</strong>. This wasn't just a game. It was a mirror, and you had the courage to look.</p>`;
  
  // Archetype insight
  if(arch){
    letter+=`<p style="margin-bottom:16px;"><strong style="color:var(--pink);">${arch.icon} Your Pattern: ${arch.name}</strong><br>`;
    letter+=`${arch.edge}</p>`;
  }
  
  // Recognition/Acceptance balance insight
  if(dominantMode==='reflection'){
    letter+=`<p style="margin-bottom:16px;">Your journey was deeply <em>introspective</em>. You recognized patterns in yourself ${recognitionRate}% of the time. That takes radical honesty. The next edge? Taking what you see and translating it into action.</p>`;
  }else if(dominantMode==='action'){
    letter+=`<p style="margin-bottom:16px;">You showed up for the <em>practice</em>. ${acceptRate}% of the time, you chose acceptance over judgment. That's real change happening in real-time. The next edge? Sitting with what you notice without rushing to fix it.</p>`;
  }else{
    letter+=`<p style="margin-bottom:16px;">You walked both paths: seeing yourself clearly (${recognitionRate}% recognition) and practicing new responses (${acceptRate}% acceptance). That balance is rare. It's called integration.</p>`;
  }
  
  // The invitation
  letter+=`<p style="margin-bottom:16px;">Here's what I know after watching thousands of people play this game: <strong>The patterns you keep seeing are the ones you're ready to break.</strong></p>`;
  
  // Most frequent insights (if available)
  if(insights.length>=5){
    letter+=`<p style="margin-bottom:16px;">You've collected <strong>${insights.length} insights</strong>. Some of them probably hit different. The ones that made you pause? Those are the doors. The ones that made you defensive? Those are the keys.</p>`;
  }
  
  // The call to action - not salesy, genuinely helpful
  letter+=`<p style="margin-bottom:16px;">You've done the work of <em>seeing</em>. The next level is having someone see <em>you</em>. Someone who can reflect back what you might still be missing.</p>`;
  
  // Closing
  letter+=`<p style="margin-bottom:0;"><strong>This isn't the end of your journey. It's the beginning.</strong></p>`;
  letter+=`<p style="margin-top:16px;color:var(--muted);font-style:italic;">Arthur</p>`;
  
  return letter;
}

function detectArchetype(){
  // Simplified archetype detection based on play patterns
  let acceptRate=data.agreementTotal>0?(data.agreementAccepted/data.agreementTotal):0.5;
  let recogRate=data.mirrorTotal>0?(data.mirrorRecognized/data.mirrorTotal):0.5;
  
  const archetypes=[
    {id:'compassionate-boundary-breaker',name:'The Compassionate Boundary-Breaker',icon:'💔',
     edge:'Your empathy is a gift, but you give it away too freely. Learning to protect your energy isn\'t selfish, it\'s sustainable.',
     condition:()=>acceptRate>=0.75&&recogRate>=0.80},
    {id:'self-critical-achiever',name:'The Self-Critical Achiever',icon:'⚡',
     edge:'You\'ve accomplished more than most by being hard on yourself, but the cost is invisible. The next level of growth isn\'t more effort, it\'s more self-compassion.',
     condition:()=>acceptRate<0.55&&recogRate>=0.70},
    {id:'emotionally-armored-protector',name:'The Emotionally Armored Protector',icon:'🛡️',
     edge:'You\'ve survived by not needing anyone. But intimacy requires letting people in. The armor that protected you is now the wall that isolates you.',
     condition:()=>acceptRate<0.50&&recogRate<0.60},
    {id:'approval-seeking-chameleon',name:'The Approval-Seeking Chameleon',icon:'🦎',
     edge:'You\'ve learned to read every room perfectly. But who are you when no one is watching? That person deserves to exist too.',
     condition:()=>acceptRate>=0.70&&recogRate>=0.65},
    {id:'anxious-overthinker',name:'The Anxious Overthinker',icon:'🌀',
     edge:'Your mind sees every possibility, including the worst ones. The peace you seek isn\'t found in more thinking. It\'s found in trusting yourself to handle what comes.',
     condition:()=>recogRate>=0.85},
    {id:'conflict-avoidant-peacekeeper',name:'The Conflict-Avoidant Peacekeeper',icon:'🕊️',
     edge:'You keep the peace for everyone except yourself. Your needs matter too. Speaking them isn\'t conflict. It\'s truth.',
     condition:()=>acceptRate>=0.65&&data.games<20},
    {id:'perfectionist-controller',name:'The Perfectionist Controller',icon:'🎯',
     edge:'Perfection was how you stayed safe. But control is an illusion, and the anxiety of maintaining it is exhausting. What if good enough was actually enough?',
     condition:()=>true} // Default fallback
  ];
  
  for(let a of archetypes){
    if(a.condition())return a;
  }
  return archetypes[archetypes.length-1];
}

function updateBreakthroughLetter(){
  let letterEl=document.getElementById('breakthroughLetterContent');
  if(letterEl){
    letterEl.innerHTML=generateBreakthroughLetter();
  }
}

function printBreakthroughLetter(){
  let letter=generateBreakthroughLetter();
  let arch=detectArchetype();
  let days=getChallengeDay();
  let html=`<!DOCTYPE html><html><head><title>My Breakthrough Letter</title>
  <style>body{font-family:Georgia,serif;max-width:600px;margin:40px auto;padding:20px;line-height:1.8;color:#333;}
  h1{text-align:center;color:#FF3CAC;font-size:24px;margin-bottom:30px;}
  .meta{text-align:center;color:#888;font-size:14px;margin-bottom:30px;}
  strong{color:#000;}p{margin-bottom:20px;}
  .footer{margin-top:40px;padding-top:20px;border-top:1px solid #ddd;text-align:center;font-size:12px;color:#888;}</style></head>
  <body><h1>${arch?arch.icon:''} My Breakthrough Letter</h1>
  <div class="meta">30-Day Challenge Complete · ${days} Days · ${(data.challenge||{}).breakthroughs||100} Breakthroughs</div>
  ${letter}
  <div class="footer">Generated by Level Up · 100levelup.com · ${new Date().toLocaleDateString()}</div>
  </body></html>`;
  let w=window.open('','_blank');w.document.write(html);w.document.close();w.print();
}

function shareBreakthroughLetter(){
  let arch=detectArchetype();
  let days=getChallengeDay();
  let text=`${arch?arch.icon:''} I completed the 30-Day Challenge and discovered I'm "${arch?arch.name:'on a journey'}".\n\n${days} days. ${(data.challenge||{}).breakthroughs||100} breakthroughs. Patterns I never saw before.\n\nThe game that shows you yourself: 100levelup.com`;
  if(navigator.share){
    navigator.share({title:'My Breakthrough Letter',text:text,url:'https://100levelup.com'});
  }else{
    navigator.clipboard.writeText(text);
    showToast('📋 Copied to clipboard!');
  }
}

function shareChallenge(){
  let days=getChallengeDay();
  let text='🏆 I just completed the 30-Day Challenge!\n\n100 breakthroughs in '+days+' days.\n\nPattern recognition changes lives.\n\nTry it: 100levelup.com';
  if(navigator.share){
    navigator.share({title:'30-Day Challenge Complete!',text:text,url:'https://100levelup.com'});
  }else{
    navigator.clipboard.writeText(text);
    showToast('📋 Copied to clipboard!');
  }
}

function showCoinShop() {
  if(tourActive)return;
  document.getElementById('shopCoinCount').textContent = data.coins.toLocaleString();
  
  // Update reward affordability
  const rewards = [
    { id: 'rewardChallenge', cost: 0, key: 'challengeFree', requiresChallenge: true },
    { id: 'reward0', cost: 500, key: 'workshop20' },
    { id: 'reward1', cost: 1000, key: 'session20' },
    { id: 'reward2', cost: 5000, key: 'session50' },
    { id: 'reward3', cost: 7500, key: 'workshop50' },
    { id: 'reward4', cost: 10000, key: 'sessionFree' },
    { id: 'reward5', cost: 12500, key: 'workshopFree' }
  ];
  
  if (!data.redeemedRewards) data.redeemedRewards = [];
  let challengeCompleted = data.challenge && data.challenge.completed;
  
  rewards.forEach(r => {
    let el = document.getElementById(r.id);
    if(!el) return;
    el.classList.remove('affordable', 'redeemed', 'locked');
    if (data.redeemedRewards.includes(r.key)) {
      el.classList.add('redeemed');
    } else if (r.requiresChallenge && !challengeCompleted) {
      el.classList.add('locked');
    } else if (data.coins >= r.cost) {
      el.classList.add('affordable');
    }
  });
  
  // Show redeemed codes
  updateRedeemedList();
  
  // Update level pass status in shop
  updateLevelPassUI();
  
  document.getElementById('coinShopModal').classList.add('active');
}

function generateRewardCode(type) {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let code = 'LVL-';
  for (let i = 0; i < 8; i++) {
    code += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return code;
}

function redeemReward(key, cost, name) {
  if (!data.redeemedRewards) data.redeemedRewards = [];
  if (!data.rewardCodes) data.rewardCodes = {};
  
  // Check if already redeemed
  if (data.redeemedRewards.includes(key)) {
    showToast('Already redeemed!');
    return;
  }
  
  // Check foundation requirement for valuable rewards (FREE coaching and workshop)
  let needsFoundation = (key === 'sessionFree' || key === 'workshopFree');
  let hasFoundation = (data.foundationPlays || 0) >= FOUNDATION_REQUIRED;
  if (needsFoundation && !hasFoundation) {
    let remaining = FOUNDATION_REQUIRED - (data.foundationPlays || 0);
    showToast('Complete ' + remaining + ' more scenarios in Levels 1-3 first!', 3500);
    return;
  }
  
  // Check if can afford
  if (data.coins < cost) {
    let needed = cost - data.coins;
    showToast('Need ' + needed.toLocaleString() + ' more coins!', 2500);
    return;
  }
  
  // Confirm redemption
  if (!confirm('Redeem ' + name + ' for ' + cost.toLocaleString() + ' coins?')) return;
  
  // Deduct coins and save
  data.coins -= cost;
  let code = generateRewardCode(key);
  data.redeemedRewards.push(key);
  data.rewardCodes[key] = { code: code, name: name, date: new Date().toLocaleDateString() };
  save();
  
  // Update UI
  document.getElementById('shopCoinCount').textContent = data.coins.toLocaleString();
  document.getElementById('coinCount').textContent = data.coins;
  document.getElementById(getRewardId(key)).classList.add('redeemed');
  document.getElementById(getRewardId(key)).classList.remove('affordable');
  
  updateRedeemedList();
  
  // Show success and scroll to claim section
  showToast('🎉 ' + name + ' unlocked! Tap "Claim" below to redeem.', 4000);
  triggerConfetti();
  
  // Scroll to show the redeemed codes section
  setTimeout(() => {
    document.getElementById('redeemedCodes').scrollIntoView({ behavior: 'smooth', block: 'center' });
  }, 500);
}

// Level Preview - spend coins to unlock a level for 10 days
function redeemLevelPreview(level, cost) {
  const levelNames = {
    3: 'Family Self',
    4: 'Professional Self', 
    5: 'Societal Self',
    6: 'Existential Self',
    7: 'Transcendent Self'
  };
  
  // Initialize level passes if needed
  if (!data.levelPasses) data.levelPasses = {};
  
  // Check if already have an active pass
  if (data.levelPasses[level]) {
    let expiry = new Date(data.levelPasses[level]);
    if (expiry > new Date()) {
      let daysLeft = Math.ceil((expiry - new Date()) / (1000 * 60 * 60 * 24));
      showToast('You still have ' + daysLeft + ' days left on Level ' + level + '!', 3000);
      return;
    }
  }
  
  // Check if can afford
  if (data.coins < cost) {
    let needed = cost - data.coins;
    showToast('Need ' + needed.toLocaleString() + ' more coins!', 2500);
    return;
  }
  
  // Confirm
  if (!confirm('Spend ' + cost + ' coins to unlock Level ' + level + ': ' + levelNames[level] + ' for 10 days?')) return;
  
  // Deduct coins
  data.coins -= cost;
  
  // Set expiry 10 days from now
  let expiry = new Date();
  expiry.setDate(expiry.getDate() + 10);
  data.levelPasses[level] = expiry.toISOString();
  
  save();
  
  // Update UI
  document.getElementById('shopCoinCount').textContent = data.coins.toLocaleString();
  document.getElementById('coinCount').textContent = data.coins;
  
  // Update the button to show active
  let btn = document.getElementById('previewL' + level);
  if (btn) {
    btn.style.background = 'linear-gradient(135deg, rgba(0,200,83,0.2), rgba(0,200,83,0.1))';
    btn.style.borderColor = 'var(--green)';
    btn.querySelector('.coin-reward-desc').textContent = '✓ Active - 10 days left';
    btn.querySelector('.coin-reward-desc').style.color = 'var(--green)';
  }
  
  showToast('🔓 Level ' + level + ' unlocked for 10 days! Go explore!', 3500);
  triggerConfetti();
  
  // Refresh home screen to show unlocked level
  setTimeout(() => {
    document.getElementById('coinShopModal').classList.remove('active');
    updateLevelCards();
  }, 1500);
}

// Check if a level has an active pass
function hasLevelPass(level) {
  if (!data.levelPasses || !data.levelPasses[level]) return false;
  let expiry = new Date(data.levelPasses[level]);
  return expiry > new Date();
}

// Get days remaining on a level pass
function getLevelPassDays(level) {
  if (!hasLevelPass(level)) return 0;
  let expiry = new Date(data.levelPasses[level]);
  return Math.ceil((expiry - new Date()) / (1000 * 60 * 60 * 24));
}

// Update level cards to show pass status
function updateLevelPassUI() {
  for (let level = 3; level <= 7; level++) {
    let btn = document.getElementById('previewL' + level);
    if (btn && hasLevelPass(level)) {
      let days = getLevelPassDays(level);
      btn.style.background = 'linear-gradient(135deg, rgba(0,200,83,0.2), rgba(0,200,83,0.1))';
      btn.style.borderColor = 'var(--green)';
      btn.querySelector('.coin-reward-desc').textContent = '✓ Active - ' + days + ' day' + (days === 1 ? '' : 's') + ' left';
      btn.querySelector('.coin-reward-desc').style.color = 'var(--green)';
    }
  }
}

function startLevelPreview(level) {
  // Filter scenarios for this level
  let levelScenarios = mirrorScenarios.filter(s => {
    let cat = s.cat || '';
    if (level === 3 && cat.includes('Family')) return true;
    if (level === 4 && cat.includes('Professional')) return true;
    if (level === 5 && cat.includes('Societal')) return true;
    if (level === 6 && cat.includes('Existential')) return true;
    if (level === 7 && cat.includes('Transcendent')) return true;
    return false;
  });
  
  // If not enough scenarios, show message
  if (levelScenarios.length < 5) {
    showToast('Preview coming soon for this level!', 2500);
    // Refund coins
    data.coins += (level === 7 ? 750 : level === 6 ? 500 : level === 5 ? 400 : level === 4 ? 300 : 200);
    save();
    document.getElementById('coinCount').textContent = data.coins;
    return;
  }
  
  // Shuffle and take 5
  let previewScenarios = shuffle(levelScenarios).slice(0, 5);
  
  // Store preview state
  window.previewMode = {
    active: true,
    level: level,
    scenarios: previewScenarios,
    index: 0
  };
  
  // Start the game in preview mode
  currentMode = 'mirror';
  gameLen = 5;
  currentScenarios = previewScenarios;
  currentIndex = 0;
  sessionXP = 0;
  comboCount = 0;
  
  document.getElementById('home').style.display = 'none';
  document.getElementById('game').style.display = 'block';
  document.getElementById('gameMode').textContent = '🔮 Preview: Level ' + level;
  document.getElementById('gameMode').style.color = 'var(--purple)';
  
  showScenario();
}

function getRewardId(key) {
  const map = { 'challengeFree': 'rewardChallenge', 'workshop20': 'reward0', 'session20': 'reward1', 'session50': 'reward2', 'workshop50': 'reward3', 'sessionFree': 'reward4', 'workshopFree': 'reward5' };
  return map[key];
}

function updateRedeemedList() {
  if (!data.rewardCodes || Object.keys(data.rewardCodes).length === 0) {
    document.getElementById('redeemedCodes').style.display = 'none';
    return;
  }
  
  document.getElementById('redeemedCodes').style.display = 'block';
  let html = '';
  for (let key in data.rewardCodes) {
    let r = data.rewardCodes[key];
    let claimMsg = encodeURIComponent('Hi Arthur! I earned a reward in Level Up:\n\n🎁 ' + r.name + '\n📋 Code: ' + r.code + '\n\nHow do I claim this?');
    html += '<div style="background:var(--card);padding:12px;border-radius:8px;margin-bottom:8px;">';
    html += '<div style="display:flex;justify-content:space-between;align-items:start;gap:10px;">';
    html += '<div>';
    html += '<div style="font-weight:600;color:var(--text);">' + r.name + '</div>';
    html += '<div style="font-family:monospace;font-size:14px;color:var(--gold);margin:4px 0;">' + r.code + '</div>';
    html += '<div style="font-size:10px;color:var(--muted);">Redeemed ' + r.date + '</div>';
    html += '</div>';
    html += '<a href="https://wa.me/+18184399770?text=' + claimMsg + '" target="_blank" style="background:#25D366;color:#fff;padding:8px 12px;border-radius:8px;font-size:12px;font-weight:600;text-decoration:none;white-space:nowrap;display:flex;align-items:center;gap:4px;">💬 Claim</a>';
    html += '</div>';
    html += '</div>';
  }
  html += '<div style="font-size:10px;color:var(--muted);margin-top:8px;text-align:center;">Tap "Claim" to message Arthur on WhatsApp</div>';
  document.getElementById('redeemedList').innerHTML = html;
}

function showBonusPopup(text){document.getElementById('bonusText').textContent=text;document.getElementById('bonusPopup').classList.add('show');bonusSound();setTimeout(()=>document.getElementById('bonusPopup').classList.remove('show'),2500)}
function maybeBonus(){
  // Base chance 12%, but increases with combo and endless mode
  let chance=0.12;
  if(currentCombo>=3)chance+=0.05;
  if(currentCombo>=5)chance+=0.08;
  if(game.endlessMode)chance+=0.03;
  
  if(Math.random()<chance){
    let bonuses=[
      {text:'+25 XP Bonus!',xp:25,icon:'⚡'},
      {text:'+50 XP Jackpot!',xp:50,icon:'💎'},
      {text:'💎 Rare Insight!',xp:30,icon:'🔮'},
      {text:'+35 XP Streak Bonus!',xp:35,icon:'🔥'}
    ];
    // Add special endless mode bonus
    if(game.endlessMode&&Math.random()<0.2){
      bonuses.push({text:'+75 XP Endless Bonus!',xp:75,icon:'♾️'});
    }
    // Add combo bonus
    if(currentCombo>=5){
      bonuses.push({text:'+60 XP Combo Master!',xp:60,icon:'🎯'});
    }
    let bonus=bonuses[Math.floor(Math.random()*bonuses.length)];
    setTimeout(()=>{showBonusPopup(bonus.icon+' '+bonus.text);addXP(bonus.xp)},800);
    return true;
  }
  return false;
}

function triggerConfetti(){
  haptic('celebration');
  let canvas=document.getElementById('confetti'),ctx=canvas.getContext('2d');canvas.width=window.innerWidth;canvas.height=window.innerHeight;
  let particles=[],colors=['#FF3CAC','#FF6B35','#784BA0','#2F80ED','#00D26A','#F7C948','#FFD700'];
  for(let i=0;i<150;i++){particles.push({x:canvas.width/2,y:canvas.height/2,vx:(Math.random()-0.5)*15,vy:(Math.random()-0.5)*15-5,color:colors[Math.floor(Math.random()*colors.length)],size:Math.random()*8+4,life:1})}
  function animate(){ctx.clearRect(0,0,canvas.width,canvas.height);let alive=false;particles.forEach(p=>{if(p.life<=0)return;alive=true;p.x+=p.vx;p.y+=p.vy;p.vy+=0.3;p.life-=0.015;ctx.globalAlpha=p.life;ctx.fillStyle=p.color;ctx.fillRect(p.x,p.y,p.size,p.size)});if(alive)requestAnimationFrame(animate);else ctx.clearRect(0,0,canvas.width,canvas.height)}animate();
}

function checkDailyLogin(){
  let today=new Date().toDateString();
  if(data.lastLogin!==today){
    let yesterday=new Date(Date.now()-86400000).toDateString();
    data.loginDay=data.lastLogin===yesterday?Math.min(data.loginDay+1,7):1;
    data.lastLogin=today;save();
    let rewards=[10,15,20,25,30,40,50];
    document.getElementById('loginReward').textContent='+'+rewards[data.loginDay-1]+' XP (Day '+data.loginDay+')';
    document.getElementById('loginBonus').classList.add('show');
  }else{document.getElementById('loginBonus').classList.remove('show')}
}
(function(){
  var lb=document.getElementById('loginBonus'),claimed=false;
  function claimBonus(e){
    if(claimed)return;
    claimed=true;
    e.preventDefault();e.stopPropagation();
    let rewards=[10,15,20,25,30,40,50];multiCoinSound(data.loginDay);addXP(rewards[data.loginDay-1],'Daily Login');showToast('+'+rewards[data.loginDay-1]+' XP!');lb.classList.remove('show');triggerConfetti();
    setTimeout(function(){claimed=false},500);
  }
  lb.addEventListener('click',claimBonus,{passive:false});
  lb.addEventListener('touchend',claimBonus,{passive:false});
})();

function checkStreakWarning(){
  if(data.streak>0&&data.lastDaily!==new Date().toDateString()){
    document.getElementById('streakCount').textContent=data.streak;
    // Check if streak freeze is available
    const freezeAvailable = canUseStreakFreeze();
    const warningEl = document.getElementById('streakWarning');
    if(freezeAvailable && data.streak >= 3) {
      warningEl.innerHTML = '<div class="streak-warning-text">⚠️ Play today or lose your <span id="streakCount">'+data.streak+'</span>-day streak! <button onclick="useStreakFreeze()" style="background:var(--cyan);color:#000;border:none;padding:4px 12px;border-radius:6px;font-size:11px;font-weight:700;margin-left:8px;cursor:pointer;">❄️ Freeze</button></div>';
    }
    warningEl.classList.add('show');
  }
  else{document.getElementById('streakWarning').classList.remove('show')}
}

// ========== v11.3 STREAK FREEZE SYSTEM ==========
function canUseStreakFreeze(){
  if(!data.streakFreezeUsed) return true;
  const daysSince = Math.floor((Date.now() - new Date(data.streakFreezeUsed).getTime()) / 86400000);
  return daysSince >= 7;
}

function useStreakFreeze(){
  if(!canUseStreakFreeze()){
    const daysLeft = 7 - Math.floor((Date.now() - new Date(data.streakFreezeUsed).getTime()) / 86400000);
    showToast('❄️ Freeze recharges in ' + daysLeft + ' days');
    return;
  }
  data.streakFreezeUsed = new Date().toISOString();
  data.lastDaily = new Date().toDateString();
  save();
  haptic('success');
  triggerConfetti();
  showToast('❄️ Streak frozen! Your ' + data.streak + '-day streak is safe!', 3000);
  document.getElementById('streakWarning').classList.remove('show');
}

// ========== v11.3 DAILY WISDOM SYSTEM ==========
const WISDOM_LIBRARY = {
  boundaries: [
    "Every 'yes' to someone else can be a 'no' to yourself.",
    "Boundaries aren't walls. They're bridges to respect.",
    "You teach people how to treat you.",
    "No is a complete sentence."
  ],
  worth: [
    "Your worth isn't earned. It just is.",
    "Stop auditioning for people who already left.",
    "You are not too much. They were not enough.",
    "What you tolerate, you teach."
  ],
  control: [
    "The tighter you grip, the more slips away.",
    "Control is fear wearing a productivity costume.",
    "What would happen if you let go, just today?",
    "Surrender isn't giving up. It's giving over."
  ],
  abandonment: [
    "People leaving says nothing about your worth.",
    "You survived everyone who left. Remember that.",
    "Not everyone who leaves is abandoning you.",
    "The fear of being left often pushes people away."
  ],
  perfectionism: [
    "Done beats perfect. Every time.",
    "Your mistakes don't define you. Your response does.",
    "Progress, not perfection.",
    "The cracks are how the light gets in."
  ],
  general: [
    "The pattern you see is the pattern you can change.",
    "Awareness is the first step. You're already walking.",
    "What you resist persists. What you accept transforms.",
    "Small steps still move you forward.",
    "You can't heal what you won't feel.",
    "The obstacle is the way."
  ]
};

function getDailyWisdom(){
  // Use day of year for consistent daily wisdom
  const dayOfYear = Math.floor((Date.now() - new Date(new Date().getFullYear(),0,0)) / 86400000);
  
  // Try to match user's dominant theme if they have enough data
  let wisdomPool = WISDOM_LIBRARY.general;
  if(data.insightsCollection && data.insightsCollection.length >= 10) {
    const allText = data.insightsCollection.map(i => (i.text || '').toLowerCase()).join(' ');
    if(allText.includes('boundar') || allText.includes('say no')) wisdomPool = WISDOM_LIBRARY.boundaries;
    else if(allText.includes('worth') || allText.includes('enough')) wisdomPool = WISDOM_LIBRARY.worth;
    else if(allText.includes('control') || allText.includes('perfect')) wisdomPool = WISDOM_LIBRARY.perfectionism;
    else if(allText.includes('abandon') || allText.includes('leave') || allText.includes('left')) wisdomPool = WISDOM_LIBRARY.abandonment;
  }
  
  return wisdomPool[dayOfYear % wisdomPool.length];
}

function addInsight(text,level){if(text&&!data.insightsCollection.some(i=>i.text===text)){data.insightsCollection.push({text:text,level:level||1,date:new Date().toLocaleDateString()});game.sessionInsights++;if(data.insightsCollection.length>200)data.insightsCollection=data.insightsCollection.slice(-200);if(data.weeklyStats)data.weeklyStats.insightsGained++;save();
// 4. Pulse insights stat when new insight added
let insightsStat=document.getElementById('insightsStat');
insightsStat.classList.add('new-insight');
document.getElementById('statInsights').textContent=data.insightsCollection.length;
setTimeout(()=>insightsStat.classList.remove('new-insight'),600);
}}

function updateHome(){
  updateXPBar();checkDailyLogin();checkStreakWarning();checkCoachingBridge();checkMilestones();checkWeeklySummary();
  
  // 1. Welcome message based on streak/games
  let welcomeEl = document.getElementById('welcomeMessage');
  if(data.streak >= 2) {
    welcomeEl.textContent = 'Day ' + data.streak + ' 🔥 Keep it going!';
    welcomeEl.style.display = 'block';
  } else if(data.games >= 1 && data.games < 5) {
    welcomeEl.textContent = 'Welcome back! 👋';
    welcomeEl.style.display = 'block';
  } else if(data.games >= 5) {
    welcomeEl.textContent = 'Good to see you! ✨';
    welcomeEl.style.display = 'block';
  } else {
    welcomeEl.style.display = 'none';
  }
  
  // 1b. Daily wisdom (shows after 5 games)
  let wisdomEl = document.getElementById('dailyWisdom');
  if(data.games >= 5) {
    wisdomEl.textContent = '"' + getDailyWisdom() + '"';
    wisdomEl.style.display = 'block';
  } else {
    wisdomEl.style.display = 'none';
  }
  
  // 2. First-time pulse on Mirror Game - hide after they've started playing anything
  let mirrorEl = document.getElementById('mirrorMode');
  if(!data.hasStartedPlaying) {
    mirrorEl.classList.add('start-here');
  } else {
    mirrorEl.classList.remove('start-here');
  }
  
  // 3. Deep Insight ready badge
  let aiBtn = document.getElementById('aiBtn');
  if(data.games >= 10 && !data.seenDeepInsight) {
    aiBtn.classList.add('ai-ready');
  } else {
    aiBtn.classList.remove('ai-ready');
  }
  
  document.getElementById('statPlayed').textContent=data.games;
  document.getElementById('statInsights').textContent=data.insightsCollection?data.insightsCollection.length:0;
  document.getElementById('statStreak').textContent=data.streak||0;
  
  let acceptRate=data.agreementTotal>0?Math.round((data.agreementAccepted/data.agreementTotal)*100):0;
  document.getElementById('statAcceptRate').textContent=acceptRate+'%';
  let today=new Date().toDateString(),daily=document.getElementById('dailyCard');
  if(data.lastDaily===today){daily.classList.add('done');document.getElementById('dailyCta').textContent='✓ '+(typeof t==='function'?t('Completed Today'):'Completed today')}
  else{daily.classList.remove('done');document.getElementById('dailyCta').textContent=typeof t==='function'?t('Tap to join the global movement'):'Tap to join the global movement'}
  document.getElementById('mirrorMode').classList.remove('locked','newly-unlocked');document.getElementById('mirrorUnlock').textContent='';
  
  // Add NEW badge to Agreement mode if recently unlocked (within 3 days)
  let agreementEl=document.getElementById('agreementMode');
  let existingBadge=agreementEl.querySelector('.new-badge');
  if(existingBadge)existingBadge.remove();
  
  if(data.unlockedAgreement){
    agreementEl.classList.remove('locked');
    document.getElementById('agreementUnlock').textContent='';
    if(!data.seenAgreementUnlock){agreementEl.classList.add('newly-unlocked');}
    // Show NEW badge if unlocked within last 3 days
    if(data.unlockTimestamps&&data.unlockTimestamps.agreement){
      let daysSinceUnlock=(Date.now()-data.unlockTimestamps.agreement)/(1000*60*60*24);
      if(daysSinceUnlock<3&&!data.seenAgreementUnlock){
        let badge=document.createElement('span');badge.className='new-badge';badge.textContent='NEW';
        agreementEl.style.position='relative';
        agreementEl.appendChild(badge);
      }
    }
    // Update level select modal buttons to show unlocked
    let levelAgreementBtn=document.getElementById('levelAgreementBtn');
    let levelMixedBtn=document.getElementById('levelMixedBtn');
    if(levelAgreementBtn){levelAgreementBtn.style.opacity='1';levelAgreementBtn.style.border='2px solid var(--pink)';levelAgreementBtn.style.boxShadow='0 0 12px rgba(255,60,172,0.3)';}
    if(levelMixedBtn){levelMixedBtn.style.opacity='1';levelMixedBtn.style.border='2px solid var(--pink)';levelMixedBtn.style.boxShadow='0 0 12px rgba(255,60,172,0.3)';}
  }
  else{
    agreementEl.classList.add('locked');agreementEl.classList.remove('newly-unlocked');document.getElementById('agreementUnlock').textContent='Reach Level 2';
    // Keep level select buttons looking locked
    let levelAgreementBtn=document.getElementById('levelAgreementBtn');
    let levelMixedBtn=document.getElementById('levelMixedBtn');
    if(levelAgreementBtn){levelAgreementBtn.style.opacity='0.5';levelAgreementBtn.style.border='2px solid var(--border)';levelAgreementBtn.style.boxShadow='none';}
    if(levelMixedBtn){levelMixedBtn.style.opacity='0.5';levelMixedBtn.style.border='2px solid var(--border)';levelMixedBtn.style.boxShadow='none';}
  }
  let map=document.getElementById('levelMap');map.innerHTML='';
  const UNLOCK_LEVELS={1:1,2:2,3:3,4:5,5:7,6:10,7:15};
  
  // Calculate progress per level
  function getLevelProgress(levelId) {
    if (!data.seenScenarios) return { seen: 0, total: 0, pct: 0 };
    let seen = 0;
    let total = 0;
    // Count mirror scenarios for this level
    if (typeof MIRROR_SCENARIOS !== 'undefined') {
      let levelScenarios = MIRROR_SCENARIOS.filter(s => s.level === levelId);
      total += levelScenarios.length;
      levelScenarios.forEach(s => {
        if (data.seenScenarios.mirror && data.seenScenarios.mirror.includes(s.text)) seen++;
      });
    }
    // Count decision/agreement scenarios for this level
    if (typeof DECISION_SCENARIOS !== 'undefined') {
      let levelDecision = DECISION_SCENARIOS.filter(s => s.level === levelId);
      total += levelDecision.length;
      levelDecision.forEach(s => {
        if (data.seenScenarios.agreement && data.seenScenarios.agreement.includes(s.scenario)) seen++;
        if (data.seenScenarios.decision && data.seenScenarios.decision.includes(s.scenario)) seen++;
      });
    }
    let pct = total > 0 ? Math.round((seen / total) * 100) : 0;
    return { seen, total, pct };
  }
  
  LEVELS.forEach(lv=>{
    let permanentUnlock=data.unlockedLevels.includes(lv.id);
    let hasPass=hasLevelPass(lv.id);
    let unlocked=permanentUnlock||hasPass;
    let isNew=permanentUnlock&&data.newlyUnlockedLevels&&data.newlyUnlockedLevels.includes(lv.id);
    let progress = unlocked ? getLevelProgress(lv.id) : null;
    let showPlay = unlocked && data.hasStartedPlaying; // Show Play badge after they've started playing
    let passText = hasPass && !permanentUnlock ? ' ('+getLevelPassDays(lv.id)+'d pass)' : '';
    let div=document.createElement('div');div.className='level'+(unlocked?' unlocked':' locked')+(isNew?' newly-unlocked':'')+(showPlay?' has-play':'')+(hasPass&&!permanentUnlock?' has-pass':'');
    div.style.position='relative';
    let unlockText=(typeof t==='function'?t('Level'):'Level')+' '+UNLOCK_LEVELS[lv.id]+' '+(currentLang==='nl'?'vereist':'required');
    let tlv=typeof tLevel==='function'?tLevel(lv):lv;
    let progressHtml = unlocked && progress && progress.total > 0 ? '<div class="level-progress"><div class="level-progress-bar" style="width:'+progress.pct+'%"></div></div><div class="level-progress-text">'+progress.pct+'% '+(currentLang==='nl'?'verkend':'explored')+'</div>' : '';
    div.innerHTML='<div class="level-num" style="background:'+lv.color+'">'+lv.id+'</div><div class="level-info"><div class="level-name">'+tlv.name+(unlocked?passText:' 🔒')+'</div><div class="level-desc">'+(unlocked?tlv.desc:unlockText)+'</div>'+progressHtml+'</div>';
    // Add NEW badge for recently unlocked levels
    if(isNew&&data.unlockTimestamps&&data.unlockTimestamps['level'+lv.id]){
      let daysSince=(Date.now()-data.unlockTimestamps['level'+lv.id])/(1000*60*60*24);
      if(daysSince<3){
        let badge=document.createElement('span');badge.className='new-badge';badge.textContent='NEW';
        div.appendChild(badge);
      }
    }
    // Add PASS badge for temporary access
    if(hasPass&&!permanentUnlock){
      let badge=document.createElement('span');badge.className='pass-badge';badge.style.cssText='position:absolute;top:8px;right:8px;background:linear-gradient(135deg,var(--purple),var(--pink));color:#fff;font-size:9px;font-weight:700;padding:3px 6px;border-radius:4px;';badge.textContent='🔮 '+getLevelPassDays(lv.id)+'D';
      div.appendChild(badge);
    }
    if(unlocked){div.onclick=()=>{if(isNew){data.newlyUnlockedLevels=data.newlyUnlockedLevels.filter(x=>x!==lv.id);save();div.classList.remove('newly-unlocked');let b=div.querySelector('.new-badge');if(b)b.remove();}showLevelSelect(lv)};}
    else{div.onclick=()=>{showToast('🔒 Reach Player Level '+UNLOCK_LEVELS[lv.id]+' to unlock '+lv.name+' (or buy a 10-day pass in Reward Shop)');};}
    map.appendChild(div);
  });
  updateTimer();
  updatePatternCard();
  // Apply translations after dynamic content is built
  if (currentLang !== 'en') setTimeout(applyTranslations, 10);
}

// Milestone rewards system
let pendingMilestoneShare=null;
function checkMilestones(){
  if(!data.milestones)data.milestones={};
  let milestones=[
    // FRONT-LOADED: Get to Level 3 fast (first session)
    {id:'first_game',condition:data.games>=1,reward:200,msg:'🎉 Welcome! First game complete! +200 XP',icon:'🎉',share:false},
    {id:'2_games',condition:data.games>=2,reward:150,msg:'🔥 You\'re committed! +150 XP',icon:'🔥',share:false},
    {id:'3_games',condition:data.games>=3,reward:100,msg:'⭐ Explorer unlocked! +100 XP',icon:'⭐',share:true,shareMsg:'Level Up Explorer!'},
    {id:'5_games',condition:data.games>=5,reward:75,msg:'🎯 5 games strong! +75 XP',icon:'🎯',share:true,shareMsg:'5 Games Milestone!'},
    {id:'10_games',condition:data.games>=10,reward:100,msg:'🏆 10 games champion! +100 XP',icon:'🏆',share:true,shareMsg:'10 Games Champion!'},
    // SLOWER: Long-term engagement
    {id:'25_games',condition:data.games>=25,reward:75,msg:'💪 25 games dedication! +75 XP',icon:'💪',share:true,shareMsg:'25 Games Legend!'},
    {id:'50_games',condition:data.games>=50,reward:100,msg:'👑 50 games legend! +100 XP',icon:'👑',share:true,shareMsg:'50 Games Master!'},
    {id:'100_games',condition:data.games>=100,reward:150,msg:'🌟 100 GAMES MASTER! +150 XP',icon:'🌟',share:true,shareMsg:'100 GAMES MASTER!'},
    // INSIGHTS: Reward depth
    {id:'10_insights',condition:(data.insightsCollection||[]).length>=10,reward:50,msg:'💡 10 insights collected! +50 XP',icon:'💡',share:false},
    {id:'25_insights',condition:(data.insightsCollection||[]).length>=25,reward:50,msg:'🧠 25 insights! Growing awareness! +50 XP',icon:'🧠',share:true,shareMsg:'25 Insights Collected!'},
    {id:'50_insights',condition:(data.insightsCollection||[]).length>=50,reward:75,msg:'🔮 50 insights wisdom! +75 XP',icon:'🔮',share:true,shareMsg:'50 Insights Wisdom!'},
    {id:'100_insights',condition:(data.insightsCollection||[]).length>=100,reward:100,msg:'✨ 100 insights sage! +100 XP',icon:'✨',share:true,shareMsg:'100 Insights Sage!'},
    // STREAKS: Daily commitment + COIN BONUSES
    {id:'3_streak',condition:data.streak>=3,reward:25,msg:'🔥 3-day streak! +25 XP',icon:'🔥',share:false},
    {id:'7_streak',condition:data.streak>=7,reward:50,msg:'🔥🔥 7-day streak! +50 XP +250 coins!',icon:'🔥',share:true,shareMsg:'7-Day Streak!',coins:250},
    {id:'14_streak',condition:data.streak>=14,reward:75,msg:'🔥🔥🔥 14-day streak! +75 XP +500 coins!',icon:'🔥',share:true,shareMsg:'14-Day Streak!',coins:500},
    {id:'30_streak',condition:data.streak>=30,reward:100,msg:'⚡ 30-DAY STREAK! +100 XP +1000 coins!',icon:'⚡',share:true,shareMsg:'30-DAY STREAK!',coins:1000},
    // ACCEPTANCE: Skill mastery
    {id:'50_acceptance',condition:data.agreementTotal>=10&&(data.agreementAccepted/data.agreementTotal)>=0.5,reward:50,msg:'⚖️ 50%+ acceptance! +50 XP',icon:'⚖️',share:false},
    {id:'80_acceptance',condition:data.agreementTotal>=20&&(data.agreementAccepted/data.agreementTotal)>=0.8,reward:75,msg:'💫 80%+ acceptance master! +75 XP',icon:'💫',share:true,shareMsg:'80% Acceptance Master!'},
    // FOUNDATION COMPLETION BONUS (NEW)
    {id:'foundation_25',condition:(data.foundationPlays||0)>=37,reward:50,msg:'🧱 25% Foundation! +50 XP +100 coins!',icon:'🧱',share:false,coins:100},
    {id:'foundation_50',condition:(data.foundationPlays||0)>=75,reward:75,msg:'🧱 50% Foundation! +75 XP +250 coins!',icon:'🧱',share:false,coins:250},
    {id:'foundation_complete',condition:(data.foundationPlays||0)>=150,reward:150,msg:'🏛️ FOUNDATION COMPLETE! +150 XP +500 coins!',icon:'🏛️',share:true,shareMsg:'Foundation Complete!',coins:500},
    // CHALLENGE MILESTONES (NEW)
    {id:'challenge_start',condition:data.challenge&&data.challenge.active,reward:50,msg:'🎯 Challenge Started! +50 XP +100 coins!',icon:'🎯',share:false,coins:100},
    {id:'challenge_100',condition:data.challenge&&data.challenge.breakthroughs>=100,reward:50,msg:'💪 100 Breakthroughs! +50 XP +150 coins!',icon:'💪',share:false,coins:150},
    {id:'challenge_500',condition:data.challenge&&data.challenge.breakthroughs>=500,reward:75,msg:'🔥 500 Breakthroughs! +75 XP +300 coins!',icon:'🔥',share:true,shareMsg:'500 Breakthroughs!',coins:300},
  ];
  milestones.forEach(m=>{
    if(m.condition&&!data.milestones[m.id]){
      data.milestones[m.id]=true;
      setTimeout(()=>{
        showBonusPopup(m.msg);milestoneSound();addXP(m.reward, m.id.replace(/_/g,' ').replace(/\b\w/g,l=>l.toUpperCase())+' Milestone');triggerConfetti();
        // Award bonus coins if specified
        if(m.coins){
          data.coins=(data.coins||0)+m.coins;
          setTimeout(()=>showToast('💰 +'+m.coins+' bonus coins!',2000),1500);
        }
        // Show share prompt for significant milestones
        if(m.share){
          pendingMilestoneShare={icon:m.icon,msg:m.shareMsg,id:m.id};
          setTimeout(()=>showMilestoneSharePrompt(),2000);
        }
      },500);
      save();
    }
  });
}

function showMilestoneSharePrompt(){
  if(!pendingMilestoneShare)return;
  document.getElementById('milestoneShareIcon').textContent=pendingMilestoneShare.icon;
  document.getElementById('milestoneShareTitle').textContent='Achievement Unlocked!';
  document.getElementById('milestoneShareMsg').textContent=pendingMilestoneShare.msg;
  document.getElementById('milestoneShareModal').classList.add('active');
}

function shareMilestone(){
  if(!pendingMilestoneShare){
    showToast('Nothing to share yet');
    return;
  }
  let text=pendingMilestoneShare.icon+' '+pendingMilestoneShare.msg+'\n\n';
  text+='I just hit this milestone on Level Up!\n';
  text+='🎮 Level '+data.level+' • '+data.games+' games • '+(data.insightsCollection||[]).length+' insights\n';
  if(data.streak>0)text+='🔥 '+data.streak+'-day streak\n';
  text+='\nThis game reveals patterns you can\'t see yourself.\nWhat\'s YOUR pattern?\n';
  text+='100levelup.com';
  
  if(navigator.share){
    navigator.share({title:'Level Up Achievement: '+pendingMilestoneShare.msg,text:text,url:'https://100levelup.com'})
      .then(()=>showToast('📤 Shared!'))
      .catch((err)=>{
        if(err.name!=='AbortError'){
          copyToClipboard(text);
          showToast('📋 Copied! Paste to share manually.');
        }
      });
  }else{
    copyToClipboard(text);
    showToast('📋 Copied!');
  }
  pendingMilestoneShare=null;
}

// ============ WEEKLY SUMMARY SYSTEM ============
const GROWTH_THEMES=[
  {id:'boundaries',icon:'🛡️',name:'BOUNDARIES',desc:'Learning when to say no',keywords:['boundary','boundaries','no','yes','protect','energy','drain','limit']},
  {id:'worth',icon:'💎',name:'SELF-WORTH',desc:'Knowing you are enough',keywords:['worth','enough','deserve','value','matter','worthy']},
  {id:'honesty',icon:'🪞',name:'HONESTY',desc:'Seeing yourself clearly',keywords:['truth','honest','lie','pretend','real','fake','mask']},
  {id:'control',icon:'🎯',name:'CONTROL',desc:'Releasing what you can\'t hold',keywords:['control','perfect','fix','should','must','right','wrong']},
  {id:'connection',icon:'💞',name:'CONNECTION',desc:'Letting people in',keywords:['alone','lonely','connect','love','trust','vulnerable']},
  {id:'rest',icon:'🌿',name:'REST',desc:'Honoring your needs',keywords:['rest','tired','exhausted','sleep','care','heal']},
  {id:'acceptance',icon:'☯️',name:'ACCEPTANCE',desc:'Embracing what is',keywords:['accept','resist','fight','peace','let go']},
  {id:'withholding',icon:'🔒',name:'WITHHOLDING',desc:'What you hold back holds you back',keywords:['withhold','hold back','refuse','punish','silent','hide','suppress','keep','won\'t']},
  {id:'abandonment',icon:'🚪',name:'ABANDONMENT',desc:'The fear of being left',keywords:['abandon','leave','left','disappear','gone','stay','test']},
  {id:'betrayal',icon:'🗡️',name:'BETRAYAL',desc:'Trust broken and rebuilt',keywords:['betray','broke','promise','trust','secret','loyal']},
  {id:'resentment',icon:'🔥',name:'RESENTMENT',desc:'Releasing what you carry',keywords:['resent','grudge','score','bitter','angry','unfair']},
  {id:'perfectionism',icon:'✨',name:'PERFECTIONISM',desc:'Good enough is good enough',keywords:['perfect','flaw','mistake','fail','critic','never good']},
  {id:'peoplepleasing',icon:'🎭',name:'PEOPLE-PLEASING',desc:'Finding yourself again',keywords:['please','agree','yes','approve','everyone','exhaust']},
  {id:'avoidance',icon:'🙈',name:'AVOIDANCE',desc:'Facing what you flee',keywords:['avoid','run','escape','ignore','later','someday']},
  {id:'grief',icon:'🥀',name:'GRIEF',desc:'Honoring what was lost',keywords:['grief','mourn','loss','lost','miss','gone','death']},
  {id:'codependency',icon:'🔗',name:'CODEPENDENCY',desc:'Where you end and others begin',keywords:['codepend','fix','save','responsible','merge','identity','need']}
];

function checkWeeklySummary(){
  if(!data.weeklyStats)data.weeklyStats={startDate:Date.now(),gamesPlayed:0,insightsGained:0,acceptanceChoices:0,totalChoices:0};
  
  let daysSinceStart=(Date.now()-data.weeklyStats.startDate)/(1000*60*60*24);
  let lastSummaryShown=data.lastWeeklySummary||0;
  let daysSinceSummary=(Date.now()-lastSummaryShown)/(1000*60*60*24);
  
  // Show weekly summary if 7+ days since last shown AND played 5+ games that week
  if(daysSinceSummary>=7&&data.weeklyStats.gamesPlayed>=5){
    showWeeklySummary();
  }
}

function showWeeklySummary(){
  // Calculate date range
  let startDate=new Date(data.weeklyStats.startDate);
  let endDate=new Date();
  let dateRange=startDate.toLocaleDateString('en-US',{month:'short',day:'numeric'})+' - '+endDate.toLocaleDateString('en-US',{month:'short',day:'numeric'});
  document.getElementById('weeklyDateRange').textContent=dateRange;
  
  // Fill in stats
  document.getElementById('weeklyScenarios').textContent=data.weeklyStats.gamesPlayed*5||0;
  document.getElementById('weeklyInsights').textContent=data.weeklyStats.insightsGained||0;
  let accRate=data.weeklyStats.totalChoices>0?Math.round((data.weeklyStats.acceptanceChoices/data.weeklyStats.totalChoices)*100):0;
  document.getElementById('weeklyAcceptance').textContent=accRate+'%';
  
  // Determine growth theme from recent insights
  let recentInsights=(data.insightsCollection||[]).slice(-20);
  let themeScores={};
  GROWTH_THEMES.forEach(t=>{themeScores[t.id]=0;});
  
  recentInsights.forEach(insight=>{
    let text=(insight.text||'').toLowerCase();
    GROWTH_THEMES.forEach(theme=>{
      theme.keywords.forEach(kw=>{
        if(text.includes(kw))themeScores[theme.id]++;
      });
    });
  });
  
  // Find top theme
  let topTheme=GROWTH_THEMES[0];
  let topScore=0;
  GROWTH_THEMES.forEach(t=>{
    if(themeScores[t.id]>topScore){
      topScore=themeScores[t.id];
      topTheme=t;
    }
  });
  
  document.getElementById('weeklyThemeIcon').textContent=topTheme.icon;
  document.getElementById('weeklyThemeName').textContent=topTheme.name;
  document.getElementById('weeklyThemeDesc').textContent=topTheme.desc;
  
  document.getElementById('weeklySummaryModal').classList.add('active');
}

function dismissWeeklySummary(){
  document.getElementById('weeklySummaryModal').classList.remove('active');
  data.lastWeeklySummary=Date.now();
  // Reset weekly stats for next week
  data.weeklyStats={startDate:Date.now(),gamesPlayed:0,insightsGained:0,acceptanceChoices:0,totalChoices:0};
  save();
}

function shareWeeklySummary(){
  let theme=document.getElementById('weeklyThemeName').textContent;
  let scenarios=document.getElementById('weeklyScenarios').textContent;
  let insights=document.getElementById('weeklyInsights').textContent;
  
  let text='📊 My Week in Patterns\n\n';
  text+='✨ '+scenarios+' scenarios explored\n';
  text+='💡 '+insights+' insights collected\n';
  text+='🎯 Growth theme: '+theme+'\n\n';
  text+='What patterns are running YOUR life?\n';
  text+='100levelup.com';
  
  if(navigator.share){
    navigator.share({title:'My Week in Patterns',text:text,url:'https://100levelup.com'}).catch(()=>copyToClipboard(text));
  }else{
    copyToClipboard(text);
  }
  dismissWeeklySummary();
}

function updateTimer(){let now=new Date(),tom=new Date(now);tom.setDate(tom.getDate()+1);tom.setHours(0,0,0,0);let d=tom-now,h=String(Math.floor(d/3600000)).padStart(2,'0'),m=String(Math.floor((d%3600000)/60000)).padStart(2,'0'),s=String(Math.floor((d%60000)/1000)).padStart(2,'0');document.getElementById('dailyTimer').textContent=(typeof t==='function'?t('Resets in'):'Resets in')+' '+h+':'+m+':'+s}

// ============ PATTERN ANALYSIS SYSTEM ============
const ARCHETYPES = [
  // ===== NEW ARCHETYPES FOR 16 THEMES =====
  
  // 🔥 RESENTMENT + 🔒 WITHHOLDING
  {id:'silent-scorekeeper',name:'The Silent Scorekeeper',icon:'📒',condition:(p)=>p.resentmentTheme>=0.2&&p.withholdingTheme>=0.15,edge:'You remember every slight, every broken promise, every unfair moment. The ledger in your head is exhausting to carry. Forgiveness isn\'t about them. It\'s about putting down the weight.',challenges:['Write down three things you\'re still holding against someone. Ask: "What is holding this costing me?"','Notice when you replay an old hurt today. How much mental energy did it take?','Practice saying: "I release this, not because they deserve it, but because I do."','Ask yourself: "What would I have space for if I wasn\'t carrying this?"','Choose one grudge. Write a letter you\'ll never send. Then delete it.'],traits:['Long memory','Withheld resentment','Emotional scorekeeping'],coachingNotes:'Client stores pain rather than processing it. Resentment feels like protection but is actually poison. Help them see the cost of carrying the ledger.'},
  
  // 🥀 GRIEF + 🚪 ABANDONMENT  
  {id:'grief-holder',name:'The Grief Holder',icon:'🥀',condition:(p)=>p.griefTheme>=0.2||p.abandonmentTheme>=0.25,edge:'You\'ve experienced loss that changed you. The grief you carry is real, and holding onto it forever isn\'t honoring what you lost. Letting go isn\'t forgetting.',challenges:['Notice if you feel guilty when you have a good day. You\'re allowed to be happy.','Write down what you lost. Now write what you gained from having had it.','Ask: "Am I grieving, or am I punishing myself for moving forward?"','Give yourself permission to feel joy without betraying your grief.','What would the person/thing you lost want for you now?'],traits:['Deep feeling','Fear of moving on','Loyalty to loss'],coachingNotes:'Grief can become identity. Help client see that moving forward isn\'t betrayal. Watch for survivor\'s guilt and permission issues around joy.'},
  
  // 😔 LONELINESS + 💞 CONNECTION
  {id:'crowded-loner',name:'The Crowded Loner',icon:'🏝️',condition:(p)=>p.lonelinessTheme>=0.2&&p.connectionTheme>=0.15,edge:'You can be surrounded by people and still feel completely alone. The loneliness isn\'t about how many people are around. It\'s about how much of yourself you let them see.',challenges:['Notice one moment today when you felt alone in a crowd. What were you hiding?','Share one real thing with someone, not a highlight, but something true.','Ask: "Do I feel lonely because no one sees me, or because I won\'t let them?"','Reach out to one person today with no agenda except connection.','Write down: "To be truly seen, I would have to show them..."'],traits:['Surface connections','Hidden depths','Fear of being truly known'],coachingNotes:'Client confuses proximity with intimacy. Loneliness is often a withholding problem disguised as an external problem. Gently challenge the hiding.'},
  
  // 🔗 CODEPENDENCY + 🎭 PEOPLE-PLEASING
  {id:'identity-chameleon',name:'The Identity Chameleon',icon:'🦎',condition:(p)=>p.codependencyTheme>=0.15||p.peoplePleasingTheme>=0.25,edge:'You\'ve become so good at being what others need that you\'ve lost track of who you actually are. Your identity isn\'t supposed to be a group project.',challenges:['Before saying yes to anything today, pause and ask: "Do I actually want this?"','Notice when you change how you act based on who you\'re with. What\'s the delta?','Ask yourself: "Who am I when no one is watching?"','Practice having an opinion that might disappoint someone. Just once.','Write down 5 things you like that have nothing to do with anyone else.'],traits:['Shape-shifting','Lost sense of self','External validation addiction'],coachingNotes:'Client\'s self has been colonized by others\' needs. Core work is excavating authentic preferences. Start small. Even food preferences can be reclaimed.'},
  
  // 🌿 REST + ✨ PERFECTIONISM  
  {id:'burned-out-achiever',name:'The Burned Out Achiever',icon:'🔋',condition:(p)=>p.restTheme>=0.2&&p.perfectionismTheme>=0.15,edge:'You\'ve run yourself into the ground trying to be everything for everyone. Rest isn\'t a reward for finishing. It\'s fuel for continuing. You can\'t pour from an empty cup.',challenges:['Schedule one hour today where you do absolutely nothing productive. Protect it.','Notice when "tired" becomes "normal." That\'s a problem, not a personality.','Ask: "What am I afraid would happen if I stopped for a day?"','Practice saying: "Good enough is good enough" about one thing today.','What would you do if you had energy? That\'s what the rest is for.'],traits:['Driven to depletion','Rest as failure','Perfectionism fuel'],coachingNotes:'Client equates rest with laziness and worth with productivity. Burnout often feels like dedication. Help them see rest as strategic, not weak.'},
  
  // 🗡️ BETRAYAL + 🔐 (Trust issues)
  {id:'once-bitten',name:'The Once Bitten',icon:'🐺',condition:(p)=>p.betrayalTheme>=0.2&&p.trustTheme>=0.15,edge:'You learned the hard way that people can hurt you. Now you see threats everywhere, but hypervigilance is exhausting, and it keeps out the good along with the bad.',challenges:['Notice when you\'re testing someone who hasn\'t done anything wrong.','Ask: "Am I responding to this person or to the person who hurt me before?"','List one person who has been consistently trustworthy. Acknowledge it.','Practice assuming good intent once today, just as an experiment.','Ask yourself: "What would I lose if I trusted and was wrong? What if I\'m right?"'],traits:['Hypervigilance','Pre-emptive protection','Testing behaviors'],coachingNotes:'Client has generalized from specific betrayal to universal mistrust. Help differentiate between healthy caution and prison-building. Past perpetrator isn\'t present.'},
  
  // 🙈 AVOIDANCE + 🎯 CONTROL
  {id:'strategic-avoider',name:'The Strategic Avoider',icon:'🚧',condition:(p)=>p.avoidanceTheme>=0.25&&p.controlTheme>=0.15,edge:'You\'ve gotten very good at not dealing with things by staying very busy with other things. But what you avoid doesn\'t go away. It just grows in the dark.',challenges:['Name the one thing you\'ve been avoiding longest. What\'s it costing you?','Notice when you get busy right after an uncomfortable thought. What were you running from?','Ask: "What\'s the worst that would happen if I actually faced this?"','Spend 5 minutes today sitting with discomfort instead of distracting from it.','Pick one avoided conversation. Have it this week.'],traits:['Productive avoidance','Strategic distraction','Delayed reckoning'],coachingNotes:'Client uses busyness and control as avoidance tools. The avoided thing has likely grown. Help them see that avoidance is expensive and facing it is cheaper.'},
  
  // 🍷 ADDICTION (sensitive archetype)
  {id:'numbing-navigator',name:'The Numbing Navigator',icon:'🌫️',condition:(p)=>p.addictionTheme>=0.15,edge:'You\'ve found ways to take the edge off, but the edge is there for a reason. What you numb, you can\'t heal. The pain you\'re avoiding is the path forward.',challenges:['Notice what triggers reach for your numbing behavior. What feeling came right before?','Ask: "What am I trying not to feel right now?"','Practice sitting with discomfort for 5 minutes before reaching for the escape.','Write down: "If I couldn\'t numb, I would have to feel..."','What would you do with the energy you spend managing the numbing?'],traits:['Escape patterns','Pain avoidance','Temporary relief cycles'],coachingNotes:'Approach with zero judgment. Client knows the pattern. Shame makes it worse. Focus on what\'s underneath, not the behavior. Refer to professional support if needed.'},
  
  // ===== ORIGINAL ARCHETYPES (Updated conditions) =====
  
  // 🛡️ BOUNDARIES + 💎 WORTH
  {id:'compassionate-boundary-breaker',name:'The Compassionate Boundary-Breaker',icon:'💔',condition:(p)=>p.boundaryTheme>=0.25&&p.acceptanceRate>=0.55,edge:'Your empathy is a gift, but you give it away too freely. Learning to protect your energy isn\'t selfish, it\'s sustainable.',challenges:['Notice one moment today when you say yes but your body says no. What did you override?','Practice this exact phrase: "I care about you, and I need to take care of myself first."','Track every "yes" today. How many were genuine? How many were guilt?','When someone asks for your time today, wait 24 hours before responding.','Ask yourself: "Whose peace am I preserving at the cost of my own?"'],traits:['Deep empathy','Porous boundaries','Self-abandonment'],coachingNotes:'Client likely has childhood pattern of earning love through caretaking. Watch for burnout and resentment beneath the giving.'},
  
  {id:'self-critical-achiever',name:'The Self-Critical Achiever',icon:'⚡',condition:(p)=>p.worthTheme>=0.2&&p.acceptanceRate<0.55,edge:'You\'ve accomplished more than most by being hard on yourself, but the cost is invisible. The next level of growth isn\'t more effort, it\'s more self-compassion.',challenges:['When your inner critic speaks today, ask: "Would I say this to someone I love?"','Notice one thing you did well today. Let yourself feel proud for 30 full seconds. Time it.','Replace "I should have done better" with "I did what I could with what I had."','Track your self-critical thoughts today. Just count them. Awareness is the first step.','Ask yourself: "What would I attempt if I knew I couldn\'t fail?"'],traits:['High achievement','Harsh inner critic','Conditional self-worth'],coachingNotes:'Client uses achievement as armor against core unworthiness. Praise may trigger suspicion. Focus on unconditional presence.'},
  
  {id:'control-seeker',name:'The Control Seeker',icon:'🎛️',condition:(p)=>p.controlTheme>=0.25&&p.fearTheme>=0.15,edge:'Your need for control is a sophisticated protection against chaos, but the tighter you grip, the less you actually control. Real power comes from trusting yourself to handle uncertainty.',challenges:['Notice one thing today you\'re trying to control that isn\'t yours to control.','Practice saying: "I don\'t know what will happen, and I can handle it."','Let one small thing be imperfect today. Notice what happens.','Ask yourself: "What am I really afraid of beneath the need for control?"','When you feel the urge to fix something, pause and ask: "Is this mine to fix?"'],traits:['Preparation','Anticipation','Difficulty with uncertainty'],coachingNotes:'Anxiety likely drives the control. Don\'t challenge the control directly. Help client see what fear it\'s protecting against.'},
  
  {id:'shame-carrier',name:'The Shame Carrier',icon:'🫣',condition:(p)=>p.shameTheme>=0.2,edge:'You carry a weight that was never yours to hold. The shame you feel often belongs to someone else\'s actions or your younger self\'s circumstances. You can put it down.',challenges:['Notice when shame arises today. Ask: "Is this actually mine?"','Write down something you\'re ashamed of. Now write what you\'d say to a friend in the same situation.','Practice saying: "I did the best I could with what I knew then."','Notice if you hide parts of yourself. What would happen if they were seen?','Ask: "Whose voice is this shame really in?"'],traits:['Self-concealment','Perfectionism as protection','Fear of exposure'],coachingNotes:'Shame is pre-verbal and often doesn\'t respond to logic. Create safety first. Watch for deflection through humor or intellectualization.'},
  
  {id:'trust-rebuilder',name:'The Trust Rebuilder',icon:'🔐',condition:(p)=>p.trustTheme>=0.2&&p.attachmentTheme>=0.15,edge:'Past betrayals taught you that trust is dangerous. But the walls that protected you then now keep out what you need. Learning to trust is learning to risk. Selectively, wisely, but genuinely.',challenges:['Notice one person today who has been consistent with you. Acknowledge it.','Practice distinguishing between "this person hurt me" and "all people will hurt me."','Take one small trust risk today. Share something slightly vulnerable.','Ask yourself: "What would I need to see to trust this person more?"','Notice if you\'re waiting for betrayal. What would it mean if it didn\'t come?'],traits:['Vigilance','Self-protection','Difficulty with vulnerability'],coachingNotes:'Trust rebuilding is slow. Don\'t push vulnerability. Model consistent, boundaried reliability. Breaks in consistency will be magnified.'},
  
  // Recognition + Acceptance based archetypes
  {id:'honest-avoider',name:'The Honest Avoider',icon:'🪞',condition:(p)=>p.mirrorRecognition>=0.65&&p.acceptanceRate<0.45,edge:'You see yourself with unusual clarity, but seeing isn\'t doing. Your next step is bridging the gap between recognition and action.',challenges:['Notice one moment today when you see a pattern but choose not to act. What story do you tell yourself about why?','When you recognize something uncomfortable about yourself today, take one small action within 5 minutes.','Ask yourself: "What am I protecting by staying aware but inactive?"','Write down one pattern you\'ve known about for months but haven\'t changed. What would it cost you to change it?','Today, when you catch yourself analyzing instead of acting, say out loud: "I see this. Now I choose."'],traits:['High self-awareness','Analysis paralysis','Knowledge-action gap'],coachingNotes:'Client sees clearly but uses insight as substitute for action. Challenge the intellectualization gently. Ask: "What would you do if you already knew enough?"'},
  
  {id:'aware-procrastinator',name:'The Aware Procrastinator',icon:'⏳',condition:(p)=>p.mirrorRecognition>=0.55&&p.controlTheme>=0.2,edge:'You\'ve done the inner work to understand your patterns. Now it\'s time to stop preparing and start doing. Insight without action is just sophisticated avoidance.',challenges:['Pick your oldest recognized pattern. What\'s the 2-minute version of addressing it? Do that today.','Notice when "I need to think about it more" appears. That\'s fear dressed as wisdom.','Ask yourself: "What am I waiting for that will never come?"','Set a timer for 10 minutes. Work on that thing you\'ve been "about to start" for weeks.','Today, replace "I should" with "I will" or "I won\'t." No middle ground.'],traits:['Deep understanding','Endless preparation','Action resistance'],coachingNotes:'Knowledge has become a comfort zone. Push toward small, immediate actions. The insight muscle is strong; the action muscle needs building.'},
  
  {id:'peaceful-avoider',name:'The Peaceful Avoider',icon:'🕊️',condition:(p)=>p.mirrorRecognition<0.45&&p.acceptanceRate>=0.65,edge:'You\'ve mastered accepting others, but you might be using that acceptance to avoid looking in your own mirror. Peace that comes from avoidance isn\'t peace.',challenges:['Ask yourself honestly: "What truth about myself am I most afraid to face?"','Notice today if you redirect conversations away from yourself. What are you protecting?','When someone gives you feedback, resist explaining. Just say: "Tell me more."','Write down three things about yourself that you\'ve never told anyone. Why not?','Ask someone who loves you: "What do you see in me that I might not see in myself?"'],traits:['External acceptance','Self-avoidance','Surface peace'],coachingNotes:'Client may use acceptance as spiritual bypass. Gently redirect from accepting others to examining self. Watch for discomfort when mirror turns inward.'},
  
  {id:'growth-seeker',name:'The Growth Seeker',icon:'🌱',condition:(p)=>p.mirrorRecognition>=0.55&&p.acceptanceRate>=0.55,edge:'You\'re doing the rare work of seeing yourself clearly and accepting what you see. Your next edge isn\'t more insight. It\'s deeper integration of what you already know.',challenges:['Instead of seeking new insights today, spend 15 minutes with one you\'ve already had. What haven\'t you fully lived?','Ask yourself: "What would my life look like if I fully embodied what I already know?"','Pick your most repeated insight. What\'s underneath it? Go one layer deeper.','Today, teach someone else one thing you\'ve learned about yourself. Teaching deepens understanding.','Notice if you\'re collecting insights like trophies. Growth isn\'t accumulation. It\'s transformation.'],traits:['Self-awareness','Self-acceptance','Integration focus'],coachingNotes:'Client is doing the work. Help deepen rather than broaden. Watch for insight addiction. Growth for its own sake rather than transformation.'},
  
  // Newer players - only if no other patterns emerge
  {id:'emerging-observer',name:'The Emerging Observer',icon:'👁️',condition:(p)=>p.games>=10&&p.games<30&&p.boundaryTheme<0.15&&p.worthTheme<0.15&&p.controlTheme<0.15&&p.shameTheme<0.15&&p.trustTheme<0.15,edge:'You\'re building a powerful new habit: paying attention to yourself. Consistency now matters more than depth. Keep showing up.',challenges:['Play one game today. You\'re building the muscle of self-reflection.','Notice one pattern from this week showing up in real life. Connection is growth.','Ask yourself: "What surprised me most about myself this week?"','Share one insight with someone you trust. Vulnerability accelerates growth.','Before bed, name one thing you learned about yourself today. Make it a ritual.'],traits:['Building awareness','Consistency focus','Early insights'],coachingNotes:'Client is early in journey. Encourage consistency over depth. Celebrate showing up. Don\'t rush toward wounds they haven\'t discovered yet.'},
  
  // Default fallback
  {id:'default',name:'The Aware One',icon:'🔮',condition:()=>true,edge:'You\'ve started the journey of self-knowledge. Every question you ask yourself creates space for growth. Keep going.',challenges:['Notice one moment today when you react instead of respond. What triggered it?','Ask yourself: "What pattern am I in right now?" Do this three times today.','Practice pausing for 3 breaths before responding to anything that triggers you.','Write down one question about yourself that you don\'t know the answer to yet.','At the end of today, ask: "Who was I today? Who do I want to be tomorrow?"'],traits:['Beginning journey','Open curiosity','Growth potential'],coachingNotes:'Profile doesn\'t show clear patterns yet. Stay curious. Ask open questions. Let their dominant themes emerge organically.'}
];

function analyzePatterns(){
  if(data.games<10)return null;
  let insights=data.insightsCollection||[];
  let profile={
    games:data.games,
    mirrorRecognition:data.mirrorTotal>0?(data.mirrorRecognized||insights.length)/Math.max(data.mirrorTotal,1):0,
    acceptanceRate:data.agreementTotal>0?data.agreementAccepted/data.agreementTotal:0.5,
    // 16 THEMES - Full tracking
    boundaryTheme:0,        // 🛡️ Boundaries
    abandonmentTheme:0,     // 🚪 Abandonment
    worthTheme:0,           // 💎 Self-Worth
    betrayalTheme:0,        // 🗡️ Betrayal
    authenticityTheme:0,    // 🪞 Honesty
    resentmentTheme:0,      // 🔥 Resentment
    controlTheme:0,         // 🎯 Control
    perfectionismTheme:0,   // ✨ Perfectionism
    connectionTheme:0,      // 💞 Connection
    peoplePleasingTheme:0,  // 🎭 People-Pleasing
    restTheme:0,            // 🌿 Rest/Burnout
    avoidanceTheme:0,       // 🙈 Avoidance
    griefTheme:0,           // 🥀 Grief
    withholdingTheme:0,     // 🔒 Withholding
    codependencyTheme:0,    // 🔗 Codependency
    lonelinessTheme:0,      // 😔 Loneliness
    // Legacy themes (keep for backward compatibility)
    fearTheme:0,
    attachmentTheme:0,
    responsibilityTheme:0,
    angerTheme:0,
    shameTheme:0,
    trustTheme:0,
    // Core wounds
    addictionTheme:0,       // 🍷 Addiction
    topLevels:{}
  };
  
  // 🛡️ BOUNDARIES
  let boundaryWords=['boundary','boundaries','say no','can\'t say no','doormat','taken advantage','stand up','speak up','voice','silent','pushover','walked over','let them','too nice','assert','protect yourself','your needs'];
  
  // 🚪 ABANDONMENT  
  let abandonmentWords=['abandon','left behind','leave me','walked out','don\'t leave','fear of losing','they\'ll leave','everyone leaves','alone again','deserted','rejected','unwanted','discarded','thrown away','replaced'];
  
  // 💎 SELF-WORTH
  let worthWords=['worth','deserve','enough','value','matter','good enough','worthy','love yourself','self-esteem','confidence','imposter','fraud','measure up','compare','inferior','prove','validation','approval','not enough','undeserving'];
  
  // 🗡️ BETRAYAL
  let betrayalWords=['betray','backstab','two-faced','broke my trust','lied to me','cheated','deceived','played me','used me','fooled','manipulated','taken for a fool','stabbed in back','double-cross','unfaithful'];
  
  // 🪞 HONESTY/AUTHENTICITY
  let authenticityWords=['authentic','real','true self','mask','pretend','fake','hide who','show the real','reveal','honest','lie to yourself','truth','identity','who I am','perform','image','reputation','playing a role','not genuine'];
  
  // 🔥 RESENTMENT
  let resentmentWords=['resent','resentment','bitter','grudge','haven\'t forgiven','still angry','can\'t let go','holding onto','festering','simmering','unresolved anger','built up','score to settle','payback','get even'];
  
  // 🎯 CONTROL
  let controlWords=['control','in charge','handle it','manage','organized','plan everything','need to know','certainty','uncertain','chaos','unpredictable','grip','micromanage','can\'t let go','trust others to'];
  
  // ✨ PERFECTIONISM
  let perfectionismWords=['perfect','flawless','mistake','error','failure','not good enough','100%','all or nothing','high standards','critical of','never satisfied','obsess','redo','check again','can\'t be wrong'];
  
  // 💞 CONNECTION
  let connectionWords=['connect','connection','intimacy','close to','let them in','vulnerable with','open up','deep relationship','surface level','meaningful','bond','attached','distance','walls up','let people'];
  
  // 🎭 PEOPLE-PLEASING
  let peoplePleasingWords=['please everyone','make them happy','approval','disappoint','let them down','say yes when','can\'t refuse','need them to like','fear rejection','keep the peace','avoid conflict','their needs first','what they want'];
  
  // 🌿 REST/BURNOUT
  let restWords=['rest','exhausted','burned out','burnout','tired','no energy','running on empty','can\'t stop','always busy','no breaks','push through','keep going','collapse','depleted','worn out','need a break','slow down'];
  
  // 🙈 AVOIDANCE
  let avoidanceWords=['avoid','run away','escape','ignore','pretend it\'s fine','sweep under','put off','procrastinate','don\'t deal','head in sand','numb','distract','denial','face it','confront'];
  
  // 🥀 GRIEF
  let griefWords=['grief','loss','mourn','died','death','gone','miss them','let go','holding on','moved on','still hurts','never got over','goodbye','closure','funeral','passed away','losing them'];
  
  // 🔒 WITHHOLDING
  let withholdingWords=['withhold','hold back','don\'t share','keep to myself','walls up','guard','closed off','won\'t tell','secret','hide feelings','bottle up','suppress','stuff down','don\'t express','keep inside'];
  
  // 🔗 CODEPENDENCY
  let codependencyWords=['codependent','can\'t function without','need them','fix them','save them','their happiness','responsible for their','enable','enmeshed','lose myself','who am I without','orbiting','their moods','walk on eggshells'];
  
  // 😔 LONELINESS
  let lonelinessWords=['lonely','alone','isolated','no one understands','by myself','disconnected','outsider','don\'t belong','no friends','invisible','forgotten','left out','on the outside','no one there','empty'];
  
  // 🍷 ADDICTION (sensitive but important)
  let addictionWords=['addicted','can\'t stop','one more','numb the pain','escape reality','depends on','habit','compulsive','binge','withdrawal','craving','substance','drink away','smoke','gambling'];
  
  // Legacy word lists (for backward compatibility)
  let fearWords=['fear','afraid','scared','anxiety','panic','worry','dread','danger','threat','risk','unknown','what if','terrified'];
  let attachmentWords=['attach','cling','need','depend','connection','close','distant','push away','pull close','available'];
  let responsibilityWords=['responsible','blame','fault','guilty','my job','burden','carry','weight','shoulder','accountable'];
  let angerWords=['anger','angry','rage','fury','irritated','frustrated','bitter','grudge','revenge','unfair','injustice','wronged'];
  let shameWords=['shame','ashamed','embarrass','humiliate','guilt','bad person','broken','defective','flawed','damaged','unlovable','exposed'];
  let trustWords=['trust','faith','believe','doubt','suspicious','reliable','count on','let down','disappointed','guard','walls'];
  
  insights.forEach(i=>{
    let t=((i.text||'')+(i.insight||'')).toLowerCase();
    // 16 Primary Themes
    if(boundaryWords.some(w=>t.includes(w)))profile.boundaryTheme+=0.04;
    if(abandonmentWords.some(w=>t.includes(w)))profile.abandonmentTheme+=0.04;
    if(worthWords.some(w=>t.includes(w)))profile.worthTheme+=0.04;
    if(betrayalWords.some(w=>t.includes(w)))profile.betrayalTheme+=0.04;
    if(authenticityWords.some(w=>t.includes(w)))profile.authenticityTheme+=0.04;
    if(resentmentWords.some(w=>t.includes(w)))profile.resentmentTheme+=0.04;
    if(controlWords.some(w=>t.includes(w)))profile.controlTheme+=0.04;
    if(perfectionismWords.some(w=>t.includes(w)))profile.perfectionismTheme+=0.04;
    if(connectionWords.some(w=>t.includes(w)))profile.connectionTheme+=0.04;
    if(peoplePleasingWords.some(w=>t.includes(w)))profile.peoplePleasingTheme+=0.04;
    if(restWords.some(w=>t.includes(w)))profile.restTheme+=0.04;
    if(avoidanceWords.some(w=>t.includes(w)))profile.avoidanceTheme+=0.04;
    if(griefWords.some(w=>t.includes(w)))profile.griefTheme+=0.04;
    if(withholdingWords.some(w=>t.includes(w)))profile.withholdingTheme+=0.04;
    if(codependencyWords.some(w=>t.includes(w)))profile.codependencyTheme+=0.04;
    if(lonelinessWords.some(w=>t.includes(w)))profile.lonelinessTheme+=0.04;
    if(addictionWords.some(w=>t.includes(w)))profile.addictionTheme+=0.04;
    // Legacy themes
    if(fearWords.some(w=>t.includes(w)))profile.fearTheme+=0.04;
    if(attachmentWords.some(w=>t.includes(w)))profile.attachmentTheme+=0.04;
    if(responsibilityWords.some(w=>t.includes(w)))profile.responsibilityTheme+=0.04;
    if(angerWords.some(w=>t.includes(w)))profile.angerTheme+=0.04;
    if(shameWords.some(w=>t.includes(w)))profile.shameTheme+=0.04;
    if(trustWords.some(w=>t.includes(w)))profile.trustTheme+=0.04;
    profile.topLevels[i.level]=(profile.topLevels[i.level]||0)+1;
  });
  
  // Cap all themes at 1.0
  let themeKeys=['boundaryTheme','abandonmentTheme','worthTheme','betrayalTheme','authenticityTheme','resentmentTheme','controlTheme','perfectionismTheme','connectionTheme','peoplePleasingTheme','restTheme','avoidanceTheme','griefTheme','withholdingTheme','codependencyTheme','lonelinessTheme','addictionTheme','fearTheme','attachmentTheme','responsibilityTheme','angerTheme','shameTheme','trustTheme'];
  themeKeys.forEach(k=>profile[k]=Math.min(profile[k],1));
  
  for(let arch of ARCHETYPES){if(arch.condition(profile))return{archetype:arch,profile:profile}}
  return{archetype:ARCHETYPES[ARCHETYPES.length-1],profile:profile};
}

function getDailyChallenge(archetype){
  let dayOfYear=Math.floor((Date.now()-new Date(new Date().getFullYear(),0,0))/86400000);
  return archetype.challenges[dayOfYear%archetype.challenges.length];
}

function updatePatternCard(){
  let card=document.getElementById('patternCard');
  // Only show pattern card after 10 games
  if(data.games<10){
    card.style.display='none';
    return;
  }
  card.style.display='block';
  let analysis=analyzePatterns();
  if(!analysis){card.classList.remove('show');return}
  card.classList.add('show');
  
  // ARCHETYPE EVOLUTION TRACKING
  if(!data.archetypeHistory) data.archetypeHistory = [];
  let currentArchetype = analysis.archetype.id;
  let lastEntry = data.archetypeHistory[data.archetypeHistory.length - 1];
  
  // Record new snapshot every 10 games or if archetype changed
  if(!lastEntry || data.games - lastEntry.games >= 10 || lastEntry.archetype !== currentArchetype) {
    data.archetypeHistory.push({
      archetype: currentArchetype,
      name: analysis.archetype.name,
      icon: analysis.archetype.icon,
      games: data.games,
      date: new Date().toISOString().split('T')[0]
    });
    // Keep last 10 snapshots
    if(data.archetypeHistory.length > 10) data.archetypeHistory.shift();
    save();
    
    // Show evolution toast if archetype changed
    if(lastEntry && lastEntry.archetype !== currentArchetype) {
      showToast('🦋 Your pattern is evolving! You\'re now: ' + analysis.archetype.name, 4000);
    }
  }
  
  document.getElementById('patternIcon').textContent=analysis.archetype.icon;
  document.getElementById('patternArchetype').textContent=analysis.archetype.name;
  document.getElementById('patternEdge').textContent=analysis.archetype.edge;
  document.getElementById('patternChallenge').textContent=getDailyChallenge(analysis.archetype);
}

function showAIAnalysis(){
  let content='';
  
  // analyzePatterns requires 10 games, so check for that
  if(data.games<10){
    content='<p style="color:var(--muted);text-align:center;">Play at least 10 games to unlock your Deep Insight!</p>';
    content+='<p style="color:var(--muted);text-align:center;margin-top:12px;">Games played: <strong style="color:var(--pink);">'+data.games+'</strong> / 10</p>';
    
    // Show progress bar
    let pct=Math.min((data.games/10)*100,100);
    content+='<div style="margin-top:16px;background:var(--border);border-radius:5px;height:8px;overflow:hidden;"><div style="width:'+pct+'%;height:100%;background:linear-gradient(90deg,#FF4757,#FF6B81);border-radius:5px;"></div></div>';
    
    // Show what they'll get
    content+='<div style="margin-top:20px;padding:16px;background:rgba(0,0,0,0.3);border-radius:12px;text-align:left;">';
    content+='<p style="color:var(--text);font-size:13px;margin-bottom:12px;"><strong>Coming soon:</strong></p>';
    content+='<p style="color:var(--muted);font-size:12px;line-height:2;">• Personalized Growth Pattern Summary</p>';
    content+='<p style="color:var(--muted);font-size:12px;line-height:2;">• Core Wound Identification</p>';
    content+='<p style="color:var(--muted);font-size:12px;line-height:2;">• Pattern Contradiction Detection</p>';
    content+='<p style="color:var(--muted);font-size:12px;line-height:2;">• 16 Theme Analysis</p>';
    content+='<p style="color:var(--muted);font-size:12px;line-height:2;">• Level-Specific Insights</p>';
    content+='<p style="color:var(--muted);font-size:12px;line-height:2;">• Daily Growth Challenges</p>';
    content+='</div>';
  }else{
    let analysis=analyzePatterns();
    if(!analysis){
      content='<p style="color:var(--muted);text-align:center;">Unable to analyze patterns. Keep playing to build data!</p>';
    }else{
      let p=analysis.profile;
      let recPct=Math.round(p.mirrorRecognition*100);
      let accPct=Math.round(p.acceptanceRate*100);
      let insights=data.insightsCollection||[];
      
      // YOUR GROWTH PATTERN - Enhanced Summary
      content='<div style="background:linear-gradient(135deg,rgba(120,75,160,0.2),rgba(255,60,172,0.1));border:1px solid var(--purple);border-radius:12px;padding:16px;margin-bottom:16px;">';
      content+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--purple);font-weight:700;margin-bottom:8px;">Your Growth Pattern</div>';
      
      // Enhanced summary generation
      let summary='';
      // Get dominant theme for context
      let themes=[{k:'boundaries',v:p.boundaryTheme||0},{k:'control',v:p.controlTheme||0},{k:'worthiness',v:p.worthTheme||0},{k:'authenticity',v:p.authenticityTheme||0},{k:'fear',v:p.fearTheme||0},{k:'attachment',v:p.attachmentTheme||0},{k:'responsibility',v:p.responsibilityTheme||0},{k:'anger',v:p.angerTheme||0},{k:'shame',v:p.shameTheme||0},{k:'trust',v:p.trustTheme||0}];
      themes.sort((a,b)=>b.v-a.v);
      let domTheme=themes[0].v>0.1?themes[0].k:null;
      
      // Core pattern based on recognition + acceptance
      if(recPct>=75&&accPct>=75){
        summary='You see yourself clearly AND accept what you see. This combination is rare and powerful. ';
      }else if(recPct>=75&&accPct<45){
        summary='You see yourself with unusual clarity, but that sight comes with harsh judgment. Your awareness is a gift; your self-criticism is the shadow. ';
      }else if(recPct<45&&accPct>=75){
        summary='You\'re gentle with yourself and others. Perhaps too gentle to look closely. Your acceptance may be avoiding the mirror. ';
      }else if(recPct>=60&&accPct>=60){
        summary='You\'re building both awareness and acceptance. This balance is the foundation of lasting change. ';
      }else if(recPct<45&&accPct<45){
        summary='You\'re at the beginning of the journey. Most people never start. The fact that you\'re here matters. ';
      }else{
        summary='Your patterns are emerging. Every time you recognize something, you gain power over it. ';
      }
      
      // Add archetype context
      summary+='As '+analysis.archetype.name+', '+analysis.archetype.edge.split('.')[0].toLowerCase()+'. ';
      
      // Add theme context if dominant
      if(domTheme){
        let themeDescriptions={
          boundaries:'Your patterns cluster around boundaries. Fear of rejection if you set limits.',
          control:'Your patterns cluster around control. Deep fear that if you relax, everything falls apart.',
          worthiness:'Your patterns cluster around self-worth. Believing you must earn your right to exist.',
          authenticity:'Your patterns cluster around authenticity. Fear that the real you is unacceptable.',
          fear:'Your patterns cluster around fear. Belief that you cannot handle what life brings.',
          attachment:'Your patterns cluster around attachment. Early experiences taught connection is unsafe.',
          responsibility:'Your patterns cluster around responsibility. Confusion about what\'s yours to carry.',
          anger:'Your patterns cluster around anger. Not being seen, understood, or gotten.',
          shame:'Your patterns cluster around shame. Belief that something is fundamentally wrong with you.',
          trust:'Your patterns cluster around trust. Past betrayals made trust feel dangerous.'
        };
        if(themeDescriptions[domTheme])summary+=themeDescriptions[domTheme];
      }
      content+='<p style="color:var(--text);font-size:14px;line-height:1.6;">'+summary+'</p>';
      content+='</div>';
      
      // Stats row
      content+='<div style="display:flex;gap:12px;margin-bottom:16px;">';
      content+='<div style="flex:1;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center;">';
      content+='<div style="font-size:24px;font-weight:800;color:'+(recPct>=60?'var(--green)':recPct>=40?'var(--yellow)':'var(--orange)')+';">'+recPct+'%</div>';
      content+='<div style="font-size:10px;color:var(--muted);text-transform:uppercase;">Self-Aware</div>';
      content+='</div>';
      content+='<div style="flex:1;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center;">';
      content+='<div style="font-size:24px;font-weight:800;color:'+(accPct>=60?'var(--green)':accPct>=40?'var(--yellow)':'var(--orange)')+';">'+accPct+'%</div>';
      content+='<div style="font-size:10px;color:var(--muted);text-transform:uppercase;">Acceptance</div>';
      content+='</div>';
      content+='</div>';
      
      // ARCHETYPE EVOLUTION TRACKING
      if(data.archetypeHistory && data.archetypeHistory.length > 1) {
        content+='<div style="margin-bottom:16px;">';
        content+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--cyan);font-weight:700;margin-bottom:10px;">🦋 Your Evolution</div>';
        content+='<div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;">';
        let history = data.archetypeHistory;
        let first = history[0];
        let current = history[history.length - 1];
        if(first.archetype !== current.archetype) {
          content+='<div style="display:flex;align-items:center;gap:12px;margin-bottom:8px;">';
          content+='<div style="text-align:center;"><div style="font-size:24px;">'+first.icon+'</div><div style="font-size:10px;color:var(--muted);">Game '+first.games+'</div></div>';
          content+='<div style="flex:1;height:2px;background:linear-gradient(90deg,var(--orange),var(--pink),var(--purple),var(--cyan));border-radius:2px;"></div>';
          content+='<div style="text-align:center;"><div style="font-size:24px;">'+current.icon+'</div><div style="font-size:10px;color:var(--muted);">Now</div></div>';
          content+='</div>';
          content+='<p style="color:var(--text);font-size:12px;margin:0;text-align:center;">You started as <strong>'+first.name+'</strong> and evolved into <strong>'+current.name+'</strong></p>';
        } else {
          content+='<p style="color:var(--muted);font-size:12px;margin:0;text-align:center;">Your pattern has been consistent: <strong>'+current.name+'</strong> '+current.icon+'<br><span style="font-size:11px;">Keep playing to see how you evolve</span></p>';
        }
        content+='</div>';
        content+='</div>';
      }
      
      // CORE WOUNDS DETECTED (NEW)
      let wounds=[];
      if((p.boundaryTheme||0)>0.15)wounds.push({wound:'Fear of rejection if you set limits',theme:'Boundaries'});
      if((p.worthTheme||0)>0.15)wounds.push({wound:'Belief that you must earn your worth',theme:'Self-Worth'});
      if((p.shameTheme||0)>0.15)wounds.push({wound:'Belief that something is fundamentally wrong with you',theme:'Shame'});
      if((p.trustTheme||0)>0.15)wounds.push({wound:'Past betrayals made trust feel dangerous',theme:'Trust'});
      if((p.attachmentTheme||0)>0.15)wounds.push({wound:'Early experiences taught you connection is unsafe',theme:'Attachment'});
      if((p.angerTheme||0)>0.15)wounds.push({wound:'Not being seen, understood, or gotten',theme:'Anger'});
      if(accPct<40)wounds.push({wound:'Harsh inner critic that blocks self-acceptance',theme:'Judgment'});
      
      if(wounds.length>0){
        content+='<div style="margin-bottom:16px;">';
        content+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:#FF4757;font-weight:700;margin-bottom:10px;">Core Wounds Detected</div>';
        wounds.slice(0,3).forEach(w=>{
          content+='<div style="background:rgba(255,71,87,0.1);border-left:3px solid #FF4757;padding:10px 12px;margin-bottom:8px;border-radius:0 8px 8px 0;">';
          content+='<p style="color:var(--text);font-size:13px;margin:0;">'+w.wound+'</p>';
          content+='<p style="color:var(--muted);font-size:11px;margin-top:4px;">Theme: '+w.theme+'</p>';
          content+='</div>';
        });
        content+='</div>';
      }
      
      // CONTRADICTION DETECTION (NEW)
      if(insights.length>=10){
        let allText=insights.map(i=>((i.text||'')+(i.insight||'')).toLowerCase()).join(' ');
        let contradictions=[];
        // Check for contradiction patterns
        let contraPairs=[
          {p1:['avoid conflict','people please','say yes','keep peace'],p2:['anger','resentment','frustrated','bitter'],insight:'You avoid conflict on the surface while anger builds beneath. The peace you keep costs you.',theme:'Suppressed Anger'},
          {p1:['control','perfect','plan','organize','certain'],p2:['anxious','worry','fear','panic','overwhelm'],insight:'Your control is a response to anxiety, not a cure for it. The tighter you grip, the more anxious you become.',theme:'Control-Anxiety Loop'},
          {p1:['independent','don\'t need','alone','self-sufficient'],p2:['lonely','abandoned','disconnected','want connection'],insight:'Your independence protects you from rejection but creates the loneliness you fear.',theme:'False Independence'},
          {p1:['achieve','success','prove','accomplish'],p2:['not enough','imposter','fraud','worthless'],insight:'No achievement has ever silenced the voice that says you\'re not enough. Worth can\'t be earned.',theme:'Achievement Trap'},
          {p1:['help others','give','support','caretake'],p2:['neglect self','exhausted','burned out','empty'],insight:'You give to others what you won\'t give to yourself. Helping becomes hiding.',theme:'Caretaker Depletion'}
        ];
        contraPairs.forEach(cp=>{
          let has1=cp.p1.some(p=>allText.includes(p));
          let has2=cp.p2.some(p=>allText.includes(p));
          if(has1&&has2)contradictions.push(cp);
        });
        
        if(contradictions.length>0){
          let c=contradictions[0];
          content+='<div style="margin-bottom:16px;">';
          content+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--cyan);font-weight:700;margin-bottom:10px;">🔄 Pattern Contradiction</div>';
          content+='<div style="background:rgba(0,216,255,0.1);border:1px solid var(--cyan);border-radius:12px;padding:14px;">';
          content+='<p style="color:var(--text);font-size:13px;line-height:1.6;margin:0;">'+c.insight+'</p>';
          content+='<p style="color:var(--cyan);font-size:11px;margin-top:8px;font-weight:600;">'+c.theme+'</p>';
          content+='</div>';
          content+='</div>';
        }
      }
      
      // RECURRING THEMES - All 16 Primary Themes
      let hasThemes=p.boundaryTheme>0.08||p.abandonmentTheme>0.08||p.worthTheme>0.08||p.betrayalTheme>0.08||p.authenticityTheme>0.08||p.resentmentTheme>0.08||p.controlTheme>0.08||p.perfectionismTheme>0.08||p.connectionTheme>0.08||p.peoplePleasingTheme>0.08||p.restTheme>0.08||p.avoidanceTheme>0.08||p.griefTheme>0.08||p.withholdingTheme>0.08||p.codependencyTheme>0.08||p.lonelinessTheme>0.08;
      content+='<div style="margin-bottom:16px;">';
      content+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:#FF4757;font-weight:700;margin-bottom:10px;">Recurring Themes</div>';
      content+='<div style="display:flex;flex-wrap:wrap;gap:8px;">';
      if(hasThemes){
        if(p.boundaryTheme>0.08)content+='<span style="background:rgba(255,60,172,0.2);color:var(--pink);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">🛡️ Boundaries</span>';
        if(p.abandonmentTheme>0.08)content+='<span style="background:rgba(255,107,53,0.2);color:var(--orange);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">🚪 Abandonment</span>';
        if(p.worthTheme>0.08)content+='<span style="background:rgba(47,128,237,0.2);color:var(--blue);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">💎 Self-Worth</span>';
        if(p.betrayalTheme>0.08)content+='<span style="background:rgba(255,71,87,0.2);color:var(--red);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">🗡️ Betrayal</span>';
        if(p.authenticityTheme>0.08)content+='<span style="background:rgba(0,210,106,0.2);color:var(--green);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">🪞 Honesty</span>';
        if(p.resentmentTheme>0.08)content+='<span style="background:rgba(255,71,87,0.2);color:#FF4757;padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">🔥 Resentment</span>';
        if(p.controlTheme>0.08)content+='<span style="background:rgba(120,75,160,0.2);color:var(--purple);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">🎯 Control</span>';
        if(p.perfectionismTheme>0.08)content+='<span style="background:rgba(247,201,72,0.2);color:var(--yellow);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">✨ Perfectionism</span>';
        if(p.connectionTheme>0.08)content+='<span style="background:rgba(255,60,172,0.2);color:var(--pink);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">💞 Connection</span>';
        if(p.peoplePleasingTheme>0.08)content+='<span style="background:rgba(0,216,255,0.2);color:var(--cyan);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">🎭 People-Pleasing</span>';
        if(p.restTheme>0.08)content+='<span style="background:rgba(0,210,106,0.2);color:var(--green);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">🌿 Rest</span>';
        if(p.avoidanceTheme>0.08)content+='<span style="background:rgba(192,192,192,0.2);color:var(--silver);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">🙈 Avoidance</span>';
        if(p.griefTheme>0.08)content+='<span style="background:rgba(139,92,246,0.2);color:#8B5CF6;padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">🥀 Grief</span>';
        if(p.withholdingTheme>0.08)content+='<span style="background:rgba(120,75,160,0.2);color:var(--purple);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">🔒 Withholding</span>';
        if(p.codependencyTheme>0.08)content+='<span style="background:rgba(247,201,72,0.2);color:var(--yellow);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">🔗 Codependency</span>';
        if(p.lonelinessTheme>0.08)content+='<span style="background:rgba(47,128,237,0.2);color:var(--blue);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">😔 Loneliness</span>';
        if(p.addictionTheme>0.08)content+='<span style="background:rgba(192,192,192,0.2);color:var(--silver);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">🌫️ Numbing</span>';
      }else{
        content+='<span style="background:rgba(255,255,255,0.1);color:var(--muted);padding:6px 12px;border-radius:20px;font-size:12px;">Keep playing to reveal themes...</span>';
      }
      // Dynamic tags based on behavior
      if(accPct<40)content+='<span style="background:rgba(255,71,87,0.2);color:#FF4757;padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">⚖️ Judgment</span>';
      if(recPct>=70)content+='<span style="background:rgba(0,216,255,0.2);color:var(--cyan);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">👁️ High Awareness</span>';
      content+='</div>';
      content+='</div>';
      
      // AHA MOMENT TRACKING - Show scenario counts per dominant theme
      let themeCounts = [];
      if(p.boundaryTheme > 0.05) themeCounts.push({name: 'Boundaries', icon: '🛡️', count: Math.round(p.boundaryTheme * insights.length), pct: p.boundaryTheme});
      if(p.worthTheme > 0.05) themeCounts.push({name: 'Self-Worth', icon: '💎', count: Math.round(p.worthTheme * insights.length), pct: p.worthTheme});
      if(p.controlTheme > 0.05) themeCounts.push({name: 'Control', icon: '🎯', count: Math.round(p.controlTheme * insights.length), pct: p.controlTheme});
      if(p.abandonmentTheme > 0.05) themeCounts.push({name: 'Abandonment', icon: '🚪', count: Math.round(p.abandonmentTheme * insights.length), pct: p.abandonmentTheme});
      if(p.peoplePleasingTheme > 0.05) themeCounts.push({name: 'People-Pleasing', icon: '🎭', count: Math.round(p.peoplePleasingTheme * insights.length), pct: p.peoplePleasingTheme});
      if(p.perfectionismTheme > 0.05) themeCounts.push({name: 'Perfectionism', icon: '✨', count: Math.round(p.perfectionismTheme * insights.length), pct: p.perfectionismTheme});
      if(p.avoidanceTheme > 0.05) themeCounts.push({name: 'Avoidance', icon: '🙈', count: Math.round(p.avoidanceTheme * insights.length), pct: p.avoidanceTheme});
      if(p.resentmentTheme > 0.05) themeCounts.push({name: 'Resentment', icon: '🔥', count: Math.round(p.resentmentTheme * insights.length), pct: p.resentmentTheme});
      if(p.griefTheme > 0.05) themeCounts.push({name: 'Grief', icon: '🥀', count: Math.round(p.griefTheme * insights.length), pct: p.griefTheme});
      if(p.lonelinessTheme > 0.05) themeCounts.push({name: 'Loneliness', icon: '😔', count: Math.round(p.lonelinessTheme * insights.length), pct: p.lonelinessTheme});
      themeCounts.sort((a,b) => b.pct - a.pct);
      
      if(themeCounts.length >= 2 && themeCounts[0].count >= 3) {
        content+='<div style="margin-bottom:16px;">';
        content+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--gold);font-weight:700;margin-bottom:10px;">💡 Pattern Recognition</div>';
        content+='<div style="background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(255,107,53,0.1));border:1px solid var(--gold);border-radius:12px;padding:14px;">';
        let top = themeCounts[0];
        content+='<p style="color:var(--text);font-size:14px;line-height:1.6;margin:0 0 10px 0;">';
        content+='You have recognized <strong style="color:var(--gold);">'+top.count+' scenarios</strong> about '+top.icon+' <strong>'+top.name+'</strong>. ';
        if(themeCounts.length >= 2) {
          content+='Your second strongest pattern is '+themeCounts[1].icon+' '+themeCounts[1].name+' ('+themeCounts[1].count+' scenarios).';
        }
        content+='</p>';
        content+='<p style="color:var(--muted);font-size:12px;margin:0;font-style:italic;">This is not random. Your attention keeps landing here because something wants to be seen.</p>';
        content+='</div>';
        content+='</div>';
      }
      
      // LEVEL BREAKDOWN (NEW)
      let levelCounts=Object.entries(p.topLevels||{}).sort((a,b)=>b[1]-a[1]);
      if(levelCounts.length>0){
        content+='<div style="margin-bottom:16px;">';
        content+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--purple);font-weight:700;margin-bottom:10px;">Your Level Focus</div>';
        let levelNames={1:'Individual',2:'Family',3:'Groups',4:'Community',5:'Society',6:'World',7:'Generations'};
        let levelInsights={
          1:{high:'Self for self is your strongest foundation.',low:'Your patterns keep circling back to Level 1, your feelings, beliefs, needs. This is where your real work is.'},
          2:{high:'You have done significant work on your created or immediate family.',low:'Your family patterns are asking for attention. What you learned about love came from here.'},
          3:{high:'You navigate extended family, friends, and group dynamics with awareness.',low:'Group situations reveal your patterns. Do you hide, perform, dominate, or disappear?'},
          4:{high:'You understand your role in your community and identity groups.',low:'Where do you belong beyond personal relationships? Your community role is speaking to you.'},
          5:{high:'You see your nation and its systems clearly. Not as you wish, but as they are.',low:'Your relationship with society creates friction. What reality are you fighting instead of seeing?'},
          6:{high:'You feel connected to the global stage and humanity beyond your borders.',low:'The world beyond your immediate life is calling for your attention.'},
          7:{high:'You are thinking about those who came before and what you will leave behind.',low:'Questions about legacy are emerging. What cycles will you break? What will you build that outlasts you?'}
        };
        levelCounts.slice(0,2).forEach(([lvlId,count])=>{
          let id=parseInt(lvlId);
          let lname=levelNames[id]||'Unknown';
          let linsight=levelInsights[id]?(count>=5?levelInsights[id].high:levelInsights[id].low):'';
          content+='<div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;margin-bottom:8px;">';
          content+='<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">';
          content+='<span style="font-weight:700;color:var(--text);">Level '+id+': '+lname+'</span>';
          content+='<span style="background:var(--purple);color:#fff;padding:2px 8px;border-radius:10px;font-size:11px;">'+count+' patterns</span>';
          content+='</div>';
          content+='<p style="color:var(--muted);font-size:12px;line-height:1.5;margin:0;">'+linsight+'</p>';
          content+='</div>';
        });
        content+='</div>';
      }
      
      // ARCHETYPE
      content+='<div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:16px;text-align:center;">';
      content+='<div style="font-size:36px;margin-bottom:8px;">'+analysis.archetype.icon+'</div>';
      content+='<div style="font-size:18px;font-weight:800;color:var(--pink);margin-bottom:6px;">'+analysis.archetype.name+'</div>';
      content+='<div style="font-size:13px;color:var(--muted);line-height:1.5;">'+analysis.archetype.edge+'</div>';
      content+='</div>';
      
      // ARCHETYPE EVOLUTION DISPLAY
      let history = data.archetypeHistory || [];
      if(history.length > 1) {
        let first = history[0];
        let current = history[history.length - 1];
        content+='<div style="background:linear-gradient(135deg,rgba(139,92,246,0.1),rgba(255,60,172,0.1));border:1px solid var(--purple);border-radius:12px;padding:14px;margin-bottom:16px;text-align:center;">';
        content+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--purple);font-weight:700;margin-bottom:10px;">🦋 Your Evolution</div>';
        content+='<div style="display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:8px;">';
        content+='<span style="font-size:24px;">'+first.icon+'</span>';
        content+='<div style="flex:1;max-width:80px;height:4px;background:linear-gradient(90deg,var(--purple),var(--pink));border-radius:2px;"></div>';
        content+='<span style="font-size:24px;">'+current.icon+'</span>';
        content+='</div>';
        if(first.archetype !== current.archetype) {
          content+='<p style="color:var(--text);font-size:13px;margin:0;">You started as <strong>'+first.name+'</strong> and evolved into <strong>'+current.name+'</strong></p>';
        } else {
          content+='<p style="color:var(--muted);font-size:13px;margin:0;">Your pattern has been consistent: <strong>'+current.name+'</strong></p>';
        }
        content+='</div>';
      }
      
      // RECOMMENDED PRACTICE - Level-specific with enhanced theme detection
      let topLevel=Object.entries(p.topLevels).sort((x,y)=>y[1]-x[1])[0];
      let recommendedLevel=2;
      let levelName='Family';
      let levelReason='boundary-setting patterns that may be influencing your self-relationship';
      
      if(topLevel){
        let lvlId=parseInt(topLevel[0]);
        let lvl=LEVELS.find(l=>l.id===lvlId);
        if(lvl){
          if(lvlId<7&&data.unlockedLevels.includes(lvlId+1)){
            recommendedLevel=lvlId+1;
            let nextLvl=LEVELS.find(l=>l.id===recommendedLevel);
            levelName=nextLvl?nextLvl.name:'Family';
          }else{
            recommendedLevel=lvlId;
            levelName=lvl.name;
          }
        }
      }
      
      // Dynamic reason based on ALL themes
      if(p.boundaryTheme>0.15)levelReason='boundary-setting patterns that show up in your relationships';
      else if(p.controlTheme>0.15)levelReason='control patterns and where they originate';
      else if(p.worthTheme>0.15)levelReason='self-worth patterns and how they affect your connections';
      else if(p.shameTheme>0.15)levelReason='shame patterns and where they were learned';
      else if(p.trustTheme>0.15)levelReason='trust patterns and how to rebuild safety';
      else if(p.angerTheme>0.15)levelReason='anger patterns and what needs aren\'t being met';
      else if(p.responsibilityTheme>0.15)levelReason='responsibility patterns, what\'s yours to carry and what isn\'t';
      else levelReason='deeper patterns that are ready to emerge';
      
      content+='<div style="background:linear-gradient(135deg,rgba(0,210,106,0.1),rgba(47,128,237,0.1));border:1px solid var(--green);border-radius:12px;padding:16px;">';
      content+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--green);font-weight:700;margin-bottom:8px;">Recommended Practice</div>';
      content+='<p style="color:var(--text);font-size:14px;line-height:1.6;">Focus on <strong>Level '+recommendedLevel+' ('+levelName+')</strong> scenarios to explore '+levelReason+'.</p>';
      content+='</div>';
      
      // TODAY'S CHALLENGE
      content+='<div style="margin-top:16px;padding:16px;background:rgba(0,0,0,0.3);border-radius:12px;border-left:3px solid var(--gold);">';
      content+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--gold);font-weight:700;margin-bottom:8px;">Today\'s Challenge</div>';
      content+='<p style="color:var(--text);font-size:14px;line-height:1.6;">'+getDailyChallenge(analysis.archetype)+'</p>';
      content+='</div>';
    }
  }
  
  document.getElementById('aiAnalysisContent').innerHTML=content;
  document.getElementById('aiModal').classList.add('active');
  // Mark deep insight as seen and add breakthrough for first view
  if(data.games >= 10) {
    if(!data.seenDeepInsight){
      addBreakthrough('deep',5); // 5 breakthroughs for first deep insight unlock
    }
    data.seenDeepInsight = true;
    save();
    document.getElementById('aiBtn').classList.remove('ai-ready');
  }
}

function showPatternModal(){
  if(tourActive)return;
  let analysis=analyzePatterns();
  if(!analysis)return;
  let p=analysis.profile,a=analysis.archetype;
  let topLevel=Object.entries(p.topLevels).sort((x,y)=>y[1]-x[1])[0];
  let topLevelName='Individual';
  if(topLevel){let lvl=LEVELS.find(l=>l.id===parseInt(topLevel[0]));if(lvl)topLevelName=lvl.name;}
  let html='<div style="text-align:center;margin-bottom:20px;">';
  html+='<div style="font-size:60px;margin-bottom:10px;">'+a.icon+'</div>';
  html+='<div style="font-size:24px;font-weight:800;background:linear-gradient(135deg,var(--purple),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">'+a.name+'</div>';
  html+='</div>';
  html+='<div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:16px;margin-bottom:16px;">';
  html+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--purple);font-weight:700;margin-bottom:8px;">Your Growth Edge</div>';
  html+='<div style="font-size:15px;color:var(--text);line-height:1.6;">'+a.edge+'</div>';
  html+='</div>';
  html+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);font-weight:700;margin-bottom:12px;">Your Numbers</div>';
  html+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px;">';
  html+='<div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center;"><div style="font-size:24px;font-weight:800;color:var(--pink);">'+Math.round(p.mirrorRecognition*100)+'%</div><div style="font-size:10px;color:var(--muted);margin-top:4px;">Self-Recognition</div></div>';
  html+='<div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center;"><div style="font-size:24px;font-weight:800;color:var(--green);">'+Math.round(p.acceptanceRate*100)+'%</div><div style="font-size:10px;color:var(--muted);margin-top:4px;">Acceptance Rate</div></div>';
  html+='</div>';
  html+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);font-weight:700;margin-bottom:12px;">Themes In Your Patterns</div>';
  html+='<div style="display:flex;flex-direction:column;gap:8px;margin-bottom:16px;">';
  if(p.boundaryTheme>0.1)html+='<div style="display:flex;justify-content:space-between;align-items:center;"><span style="font-size:13px;">Boundaries</span><div style="width:100px;height:6px;background:var(--border);border-radius:3px;overflow:hidden;"><div style="width:'+Math.round(p.boundaryTheme*100)+'%;height:100%;background:var(--orange);"></div></div></div>';
  if(p.controlTheme>0.1)html+='<div style="display:flex;justify-content:space-between;align-items:center;"><span style="font-size:13px;">Control</span><div style="width:100px;height:6px;background:var(--border);border-radius:3px;overflow:hidden;"><div style="width:'+Math.round(p.controlTheme*100)+'%;height:100%;background:var(--purple);"></div></div></div>';
  if(p.worthTheme>0.1)html+='<div style="display:flex;justify-content:space-between;align-items:center;"><span style="font-size:13px;">Self-Worth</span><div style="width:100px;height:6px;background:var(--border);border-radius:3px;overflow:hidden;"><div style="width:'+Math.round(p.worthTheme*100)+'%;height:100%;background:var(--pink);"></div></div></div>';
  if(p.boundaryTheme<=0.1&&p.controlTheme<=0.1&&p.worthTheme<=0.1)html+='<div style="font-size:13px;color:var(--muted);font-style:italic;">Keep playing to reveal your themes.</div>';
  html+='</div>';
  html+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);font-weight:700;margin-bottom:12px;">Most Active Level</div>';
  html+='<div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;margin-bottom:16px;text-align:center;">';
  html+='<div style="font-size:16px;font-weight:700;">'+topLevelName+'</div>';
  html+='<div style="font-size:12px;color:var(--muted);">'+((data.insightsCollection||[]).filter(i=>topLevel&&i.level===parseInt(topLevel[0])).length)+' insights collected</div>';
  html+='</div>';
  html+='<div style="background:linear-gradient(135deg,rgba(255,215,0,0.15),rgba(255,107,53,0.1));border:1px solid var(--gold);border-radius:12px;padding:14px;">';
  html+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--gold);font-weight:700;margin-bottom:8px;">Today\'s Practice</div>';
  html+='<div style="font-size:14px;color:var(--text);line-height:1.6;">'+getDailyChallenge(a)+'</div>';
  html+='</div>';
  html+='<div style="text-align:center;margin-top:16px;padding-top:16px;border-top:1px solid var(--border);">';
  html+='<div style="font-size:11px;color:var(--muted);">Based on '+data.games+' games played</div>';
  html+='<div style="font-size:11px;color:var(--muted);margin-top:4px;">Your archetype updates as you grow</div>';
  html+='</div>';
  document.getElementById('patternProfile').innerHTML=html;
  document.getElementById('patternModal').classList.add('active');
}

document.getElementById('patternCard').onclick=showPatternModal;

// ============ END PATTERN ANALYSIS SYSTEM ============

let selectedLevel=null;
function showLevelSelect(lv){
  if(tourActive)return;
  selectedLevel=lv;
  document.getElementById('levelSelectTitle').textContent='Level '+lv.id+': '+lv.name;
  document.getElementById('levelSelectDesc').textContent=lv.desc;
  let levelInsightCount=data.insightsCollection?data.insightsCollection.filter(i=>i.level===lv.id).length:0;
  
  // Calculate level mastery progress
  let mirrorSeen=(data.seenScenarios&&data.seenScenarios.mirror)?data.seenScenarios.mirror.filter(s=>{
    let scenario=MIRROR_SCENARIOS&&MIRROR_SCENARIOS.find(m=>m.text===s&&m.level===lv.id);
    return scenario;
  }).length:0;
  let totalMirror=MIRROR_SCENARIOS?MIRROR_SCENARIOS.filter(s=>s.level===lv.id).length:300;
  let progressPct=totalMirror>0?Math.round((mirrorSeen/totalMirror)*100):0;
  
  document.getElementById('levelInsightsCount').innerHTML=levelInsightCount+' insights collected';
  document.getElementById('levelProgress').innerHTML='📊 '+mirrorSeen+'/'+totalMirror+' scenarios explored ('+progressPct+'%)';
  
  // Update 30-day challenge status
  let challengeStatus=document.getElementById('level30DayStatus');
  if(data.challenge&&data.challenge.active){
    if(data.challenge.completed){
      challengeStatus.textContent='🏆 Completed!';
    }else{
      challengeStatus.textContent=data.challenge.breakthroughs+'/1,000 breakthroughs';
    }
  }else{
    challengeStatus.textContent='Start your journey';
  }
  
  let agrBtn=document.getElementById('levelAgreementBtn');
  let mixBtn=document.getElementById('levelMixedBtn');
  if(data.unlockedAgreement){
    agrBtn.style.opacity='1';agrBtn.style.pointerEvents='auto';
    agrBtn.style.border='2px solid var(--pink)';agrBtn.style.boxShadow='0 0 12px rgba(255,60,172,0.3)';
    mixBtn.style.opacity='1';mixBtn.style.pointerEvents='auto';
    mixBtn.style.border='2px solid var(--pink)';mixBtn.style.boxShadow='0 0 12px rgba(255,60,172,0.3)';
  }else{
    agrBtn.style.opacity='0.5';agrBtn.style.pointerEvents='none';
    agrBtn.style.border='2px solid var(--border)';agrBtn.style.boxShadow='none';
    mixBtn.style.opacity='0.5';mixBtn.style.pointerEvents='none';
    mixBtn.style.border='2px solid var(--border)';mixBtn.style.boxShadow='none';
  }
  document.getElementById('levelSelectModal').classList.add('active');
}

function shareGame(){
  // If user has enough data, show the shareable pattern card
  if(data.games >= 10 && analyzePatterns()) {
    showShareCard();
    return;
  }
  
  // Build enhanced share text with recent insight
  let text="🎮 Just finished a game on Level Up!\n\n";
  text+="I'm Level "+data.level+" with "+data.games+" games played";
  if(data.streak>0)text+=" and a 🔥"+data.streak+"-day streak";
  text+=".\n";
  
  // Add a recent insight if available
  if(data.insightsCollection&&data.insightsCollection.length>0){
    let recent=data.insightsCollection[data.insightsCollection.length-1];
    text+='\n💡 Insight I just got:\n"'+recent.text.substring(0,80)+(recent.text.length>80?'...':'')+'"\n';
  }
  
  text+="\nThis game sees patterns you can't. What's yours?\n";
  let url='https://100levelup.com';
  let fullText=text+url;
  if(navigator.share){
    navigator.share({title:'Level Up - 7 Levels of Self',text:text,url:url}).then(()=>showToast('Shared!')).catch(()=>{copyToClipboard(fullText)});
  }else{
    copyToClipboard(fullText);
  }
}
function copyToClipboard(text){
  if(navigator.clipboard&&navigator.clipboard.writeText){
    navigator.clipboard.writeText(text).then(()=>showToast('📋 Copied to clipboard!')).catch(()=>fallbackCopy(text));
  }else{
    fallbackCopy(text);
  }
}
function fallbackCopy(text){
  let ta=document.createElement('textarea');ta.value=text;ta.style.position='fixed';ta.style.left='-9999px';document.body.appendChild(ta);ta.select();
  try{document.execCommand('copy');showToast('📋 Copied to clipboard!')}catch(e){showToast('Copy: '+text.substring(0,50)+'...')}
  document.body.removeChild(ta);
}
// v9.4 multi-platform sharing
function getShareText(){
  let analysis = data.games >= 10 ? analyzePatterns() : null;
  let text = "";
  
  // Different messages based on archetype
  if(analysis && analysis.archetype) {
    let arch = analysis.archetype;
    text = arch.icon + " I discovered I'm \"" + arch.name + "\"\n\n";
    text += "Level " + data.level + " • " + data.games + " games";
    if(data.streak > 0) text += " • 🔥" + data.streak + " day streak";
    text += "\n\n";
    // Add compelling insight from their edge
    let edgeFirst = arch.edge.split('.')[0];
    text += "\"" + edgeFirst + ".\"\n\n";
    text += "What pattern is quietly running YOUR life? 👇";
  } else {
    // Early player - simpler message
    text = "🎮 Just started Level Up!\n\n";
    text += data.games + " games played";
    if(data.streak > 0) text += " • 🔥" + data.streak + " day streak";
    if(data.insightsCollection && data.insightsCollection.length > 0){
      text += '\n\n💡 "' + data.insightsCollection[data.insightsCollection.length-1].text.substring(0,60) + '..."';
    }
    text += "\n\nSee the patterns that quietly run YOUR life 👇";
  }
  return text;
}
function shareWhatsApp(){selectSound();window.open('https://wa.me/?text='+encodeURIComponent(getShareText()+"\n\nhttps://100levelup.com"),'_blank');showToast('💬 Opening WhatsApp...')}
function shareTwitter(){selectSound();window.open('https://twitter.com/intent/tweet?text='+encodeURIComponent(getShareText())+'&url='+encodeURIComponent('https://100levelup.com'),'_blank');showToast('𝕏 Opening Twitter...')}
function copyShareLink(){selectSound();copyToClipboard(getShareText()+"\n\nhttps://100levelup.com")}
function shareNative(){selectSound();if(navigator.share){navigator.share({title:'Level Up',text:getShareText(),url:'https://100levelup.com'}).then(()=>showToast('📤 Shared!')).catch(()=>copyShareLink())}else{copyShareLink()}}

// Share with Lily - sends gameplay summary to Telegram Lily
function shareWithLily(){
  if(typeof trackEvent==='function')trackEvent('share_with_lily');
  selectSound();
  
  // Get analysis data
  let analysis = data.games >= 10 ? analyzePatterns() : null;
  let archetype = analysis ? analysis.archetype.name : 'Still discovering...';
  let recPct = data.mirrorTotal > 0 ? Math.round((data.mirrorRecognized/data.mirrorTotal)*100) : 0;
  let accPct = data.agreementTotal > 0 ? Math.round((data.agreementAccepted/data.agreementTotal)*100) : 0;
  
  // Get top themes
  let themes = [];
  if(analysis && analysis.profile) {
    let p = analysis.profile;
    let themeScores = [
      {name:'Boundaries',v:p.boundaryTheme||0},
      {name:'Abandonment',v:p.abandonmentTheme||0},
      {name:'Self-Worth',v:p.worthTheme||0},
      {name:'Control',v:p.controlTheme||0},
      {name:'People-Pleasing',v:p.peoplePleasingTheme||0},
      {name:'Perfectionism',v:p.perfectionismTheme||0},
      {name:'Connection',v:p.connectionTheme||0},
      {name:'Codependency',v:p.codependencyTheme||0}
    ];
    themeScores.sort((a,b)=>b.v-a.v);
    themes = themeScores.filter(t=>t.v>0.1).slice(0,3).map(t=>t.name);
  }
  
  // Get recent insight
  let recentInsight = '';
  if(data.insightsCollection && data.insightsCollection.length > 0) {
    recentInsight = data.insightsCollection[data.insightsCollection.length-1].text;
    if(recentInsight.length > 80) recentInsight = recentInsight.substring(0,77) + '...';
  }
  
  // Build message
  let msg = 'Hi Lily, I just played Level Up and here\'s what came up:\n\n';
  msg += '🎭 Archetype: ' + archetype + '\n';
  msg += '📊 Recognition: ' + recPct + '% | Acceptance: ' + accPct + '%\n';
  msg += '🎮 Games played: ' + (data.games||0) + '\n';
  if(themes.length > 0) {
    msg += '🎯 Top themes: ' + themes.join(', ') + '\n';
  }
  if(recentInsight) {
    msg += '\n💡 Recent insight: "' + recentInsight + '"\n';
  }
  msg += '\nWhat patterns do you see in this?';
  
  // Open Telegram Lily with pre-filled message
  let url = 'https://t.me/LevelsOfSelfBot?text=' + encodeURIComponent(msg);
  window.open(url, '_blank');
  showToast('💜 Opening Lily...');
}

function showHook(){
  document.body.classList.add('hook-active');
  let logo=document.getElementById('hookLogo');
  let logoImg=logo.querySelector('img');
  
  // Wait for logo image to be loaded before showing
  function showLogoSequence(){
    // Fade in logo
    setTimeout(()=>{logo.style.opacity='1'},100);
    // Fade out logo
    setTimeout(()=>{logo.style.opacity='0'},1500);
    // Show text after logo fades
    setTimeout(()=>document.getElementById('line1').classList.add('show'),2000);
    setTimeout(()=>document.getElementById('line2').classList.add('show'),2700);
    setTimeout(()=>{let sub=document.getElementById('hookSub');sub.classList.add('show');sub.style.opacity='1'},3600);
    setTimeout(()=>{let btn=document.getElementById('hookBtn');btn.classList.add('show');btn.style.opacity='1';btn.style.transform='translateY(0)'},4300);
    setTimeout(()=>{let lang=document.getElementById('langToggle');if(lang)lang.style.opacity='1'},5000);
    setTimeout(()=>{let t=document.querySelector('.hook-time');if(t){t.classList.add('show');t.style.opacity='1'}},4900);
  }
  
  // If image already loaded (cached), show immediately
  if(logoImg.complete){
    showLogoSequence();
  }else{
    // Wait for image to load
    logoImg.onload=showLogoSequence;
    // Fallback in case onload doesn't fire
    setTimeout(showLogoSequence,500);
  }
}

// Entry Flow State
let entryAnswers = { recognition: [], voice: null, voices: [] };

// Entry Flow Pattern Mapping
const ENTRY_PATTERNS = {
  'honest-avoider': { icon: '🪞', name: 'The Honest Avoider', tagline: 'You see yourself with unusual clarity, but seeing isn\'t doing.', match: 87, others: 23 },
  'boundary-breaker': { icon: '💔', name: 'The Compassionate Boundary-Breaker', tagline: 'Your empathy is a gift you give away too freely.', match: 82, others: 31 },
  'self-critical-achiever': { icon: '⚡', name: 'The Self-Critical Achiever', tagline: 'You\'ve achieved so much by being hard on yourself, but at what cost?', match: 91, others: 28 },
  'peaceful-avoider': { icon: '🕊️', name: 'The Peaceful Avoider', tagline: 'You\'ve mastered accepting others, but what about yourself?', match: 78, others: 19 },
  'aware-procrastinator': { icon: '⏳', name: 'The Aware Procrastinator', tagline: 'You understand your patterns deeply, and delay changing them.', match: 85, others: 34 },
  'silent-scorekeeper': { icon: '📒', name: 'The Silent Scorekeeper', tagline: 'You remember every slight. The ledger is exhausting to carry.', match: 79, others: 26 },
  'crowded-loner': { icon: '🏝️', name: 'The Crowded Loner', tagline: 'Surrounded by people, still completely alone.', match: 83, others: 22 },
  'burned-out-achiever': { icon: '🔋', name: 'The Burned Out Achiever', tagline: 'You\'ve run yourself into the ground trying to be everything.', match: 88, others: 29 },
  'identity-chameleon': { icon: '🦎', name: 'The Identity Chameleon', tagline: 'You\'ve become what others need, but who are you?', match: 81, others: 25 }
};

function showHookScreen(num) {
  // Smooth transition between screens
  let current = document.querySelector('.hook-screen.active');
  if(current) {
    current.style.opacity = '0';
    current.style.transform = 'translateY(-10px)';
    setTimeout(() => {
      current.classList.remove('active');
      current.style.opacity = '';
      current.style.transform = '';
      activateScreen(num);
    }, 200);
  } else {
    activateScreen(num);
  }
}

function activateScreen(num) {
  let screen = document.getElementById('hookScreen' + num);
  let container = document.querySelector('.hook-container');
  let hook = document.getElementById('hook');
  
  // Scroll to top (now scrolling the hook element itself)
  if(hook) hook.scrollTop = 0;
  
  // For scrollable screens, align to top and enable scrolling; otherwise center
  if(container) {
    if(screen.classList.contains('hook-screen-scrollable')) {
      container.style.justifyContent = 'flex-start';
      container.style.paddingTop = '40px';
      if(hook) hook.classList.add('scrollable');
    } else {
      container.style.justifyContent = 'center';
      container.style.paddingTop = '0';
      if(hook) hook.classList.remove('scrollable');
    }
  }
  
  // Force re-trigger screen entrance animation
  screen.style.animation = 'none';
  screen.offsetHeight; // Force reflow
  screen.classList.add('active');
  screen.style.animation = 'screenFadeIn 0.4s cubic-bezier(0.16,1,0.3,1)';
  
  // Re-trigger button entrance animation when navigating between screens
  screen.querySelectorAll('.hook-btn').forEach(btn => {
    if(btn.classList.contains('show')) {
      btn.style.animation = 'none';
      btn.offsetHeight; // Force reflow
      btn.style.animation = 'btnFadeUp 0.5s cubic-bezier(0.16,1,0.3,1) forwards';
    }
  });
}

function toggleRecognition(el) {
  el.classList.toggle('selected');
  const pattern = el.dataset.pattern;
  if (el.classList.contains('selected')) {
    entryAnswers.recognition.push(pattern);
    // Subtle selection sound
    if(soundOn) playSound(660, 0.08);
    // Hide validation hint when something is selected
    document.getElementById('recognitionHint').classList.remove('show');
  } else {
    entryAnswers.recognition = entryAnswers.recognition.filter(p => p !== pattern);
    if(soundOn) playSound(440, 0.06);
  }
}

function continueFromRecognition() {
  const selected = document.querySelectorAll('.recognition-item.selected');
  if (selected.length === 0) {
    document.getElementById('recognitionHint').classList.add('show');
    return;
  }
  document.getElementById('recognitionHint').classList.remove('show');
  showHookScreen(3);
}

function toggleLevelInfo(el, levelNum) {
  const wasSelected = el.classList.contains('selected');
  
  // Remove selected from all levels and hide all details
  document.querySelectorAll('.level-compact').forEach(l => l.classList.remove('selected'));
  document.querySelectorAll('.level-detail').forEach(d => d.classList.remove('show'));
  
  // If it wasn't selected, select it and show detail
  if (!wasSelected) {
    el.classList.add('selected');
    const detail = document.getElementById('levelDetail' + levelNum);
    if (detail) {
      detail.classList.add('show');
    }
    if(soundOn) playSound(523, 0.08);
  } else {
    if(soundOn) playSound(440, 0.06);
  }
}

function toggleVoice(el) {
  el.classList.toggle('selected');
  const voice = el.dataset.voice;
  if (el.classList.contains('selected')) {
    if (!entryAnswers.voices) entryAnswers.voices = [];
    entryAnswers.voices.push(voice);
    entryAnswers.voice = voice; // Keep primary for pattern matching
    if(soundOn) playSound(523, 0.1);
    // Hide validation hint when something is selected
    document.getElementById('voiceHint').classList.remove('show');
  } else {
    entryAnswers.voices = (entryAnswers.voices || []).filter(v => v !== voice);
    // Update primary voice to another selected one, or null
    if (entryAnswers.voice === voice) {
      entryAnswers.voice = entryAnswers.voices.length > 0 ? entryAnswers.voices[0] : null;
    }
    if(soundOn) playSound(440, 0.06);
  }
}

function continueFromVoice() {
  // Require at least one selection
  const selectedCount = document.querySelectorAll('.voice-option.selected').length;
  if (selectedCount === 0) {
    document.getElementById('voiceHint').classList.add('show');
    return;
  }
  document.getElementById('voiceHint').classList.remove('show');
  
  // Use first selected voice for pattern matching
  if (!entryAnswers.voice && entryAnswers.voices && entryAnswers.voices.length > 0) {
    entryAnswers.voice = entryAnswers.voices[0];
  }
  
  // Store the pattern now
  const patternKey = determineEntryPattern();
  const pattern = ENTRY_PATTERNS[patternKey];
  data.entryPattern = patternKey;
  save();
  
  // Pre-populate Screen 5 with pattern data
  document.getElementById('revealIcon').textContent = pattern.icon;
  document.getElementById('revealPattern').textContent = pattern.name;
  document.getElementById('revealInsight').textContent = '"' + pattern.tagline + '"';
  
  // Play confirmation sound
  if(soundOn) {
    playSound(523, 0.1);
    setTimeout(() => playSound(659, 0.1), 80);
  }
  
  // Go to explanation screen (Screen 4)
  showHookScreen(4);
}

function selectVoice(el) {
  document.querySelectorAll('.voice-option').forEach(o => o.classList.remove('selected'));
  el.classList.add('selected');
  entryAnswers.voice = el.dataset.voice;
  // Selection sound
  if(soundOn) {
    playSound(523, 0.1);
    setTimeout(() => playSound(659, 0.1), 80);
  }
  // Store the pattern now
  const patternKey = determineEntryPattern();
  const pattern = ENTRY_PATTERNS[patternKey];
  data.entryPattern = patternKey;
  save();
  
  // Pre-populate Screen 5 with pattern data
  document.getElementById('revealIcon').textContent = pattern.icon;
  document.getElementById('revealPattern').textContent = pattern.name;
  document.getElementById('revealInsight').textContent = '"' + pattern.tagline + '"';
  
  // Go to explanation screen (Screen 4)
  setTimeout(() => showHookScreen(4), 600);
}

// Share entry pattern (for Screen 5, before any games played)
async function shareEntryPattern() {
  const patternKey = data.entryPattern || 'honest-avoider';
  const pattern = ENTRY_PATTERNS[patternKey];
  
  if (!pattern) {
    showToast('Unable to share - pattern not found');
    return;
  }
  
  const shareText = `I'm "${pattern.name}: ${pattern.tagline.toLowerCase().replace(/"/g, '')} What's your pattern?`;
  const shareData = {
    title: 'My Pattern | Level Up',
    text: shareText,
    url: 'https://100levelup.com?ref=share'
  };
  
  if (navigator.share) {
    try {
      await navigator.share(shareData);
      showToast('📤 Shared!');
    } catch (err) {
      if (err.name === 'AbortError') {
        // User cancelled - no action needed
      } else {
        // Share failed - copy to clipboard as fallback
        copyEntryLink();
        showToast('📋 Link copied! Paste to share manually.');
      }
    }
  } else {
    copyEntryLink();
  }
}

// Copy entry pattern link (for Screen 5)
function copyEntryLink() {
  const patternKey = data.entryPattern || 'honest-avoider';
  const url = 'https://100levelup.com?pattern=' + patternKey;
  navigator.clipboard.writeText(url);
  showToast('Link copied!');
}

function determineEntryPattern() {
  const { recognition, voices } = entryAnswers;
  
  // Score each pattern based on ALL selections
  const scores = {
    'self-critical-achiever': 0,
    'boundary-breaker': 0,
    'peaceful-avoider': 0,
    'aware-procrastinator': 0,
    'honest-avoider': 0,
    'silent-scorekeeper': 0,
    'crowded-loner': 0,
    'burned-out-achiever': 0,
    'identity-chameleon': 0
  };
  
  // Screen 2 Recognition scoring (what they've felt)
  if (recognition.includes('success-empty')) {
    scores['self-critical-achiever'] += 3;
    scores['burned-out-achiever'] += 2;
    scores['honest-avoider'] += 1;
  }
  if (recognition.includes('repeat')) {
    scores['aware-procrastinator'] += 3;
    scores['honest-avoider'] += 2;
    scores['silent-scorekeeper'] += 1;
  }
  if (recognition.includes('help-others')) {
    scores['boundary-breaker'] += 3;
    scores['identity-chameleon'] += 2;
    scores['burned-out-achiever'] += 1;
  }
  if (recognition.includes('more')) {
    scores['peaceful-avoider'] += 2;
    scores['honest-avoider'] += 2;
    scores['crowded-loner'] += 1;
  }
  if (recognition.includes('dying-inside')) {
    scores['boundary-breaker'] += 2;
    scores['crowded-loner'] += 3;
    scores['burned-out-achiever'] += 2;
    scores['self-critical-achiever'] += 1;
  }
  
  // Screen 3 Voice scoring (what haunts them) - stronger weight
  const voiceList = voices || [];
  voiceList.forEach(voice => {
    switch(voice) {
      case 'not-enough':
        scores['self-critical-achiever'] += 4;
        scores['identity-chameleon'] += 2;
        break;
      case 'alone':
        scores['crowded-loner'] += 4;
        scores['peaceful-avoider'] += 3;
        scores['boundary-breaker'] += 1;
        break;
      case 'success-unhappy':
        scores['burned-out-achiever'] += 3;
        scores['self-critical-achiever'] += 2;
        scores['honest-avoider'] += 2;
        break;
      case 'made-it':
        scores['self-critical-achiever'] += 3;
        scores['aware-procrastinator'] += 2;
        scores['burned-out-achiever'] += 1;
        break;
      case 'all-there-is':
        scores['peaceful-avoider'] += 2;
        scores['honest-avoider'] += 3;
        scores['aware-procrastinator'] += 1;
        scores['silent-scorekeeper'] += 1;
        break;
    }
  });
  
  // Combination bonuses - when patterns reinforce each other
  if (recognition.includes('success-empty') && voiceList.includes('not-enough')) {
    scores['self-critical-achiever'] += 2;
  }
  if (recognition.includes('help-others') && recognition.includes('dying-inside')) {
    scores['boundary-breaker'] += 2;
    scores['burned-out-achiever'] += 2;
  }
  if (recognition.includes('repeat') && voiceList.includes('all-there-is')) {
    scores['aware-procrastinator'] += 2;
    scores['silent-scorekeeper'] += 1;
  }
  if (voiceList.includes('alone') && recognition.includes('more')) {
    scores['crowded-loner'] += 3;
    scores['peaceful-avoider'] += 1;
  }
  if (voiceList.includes('alone') && recognition.includes('dying-inside')) {
    scores['crowded-loner'] += 2;
  }
  if (recognition.includes('help-others') && voiceList.includes('not-enough')) {
    scores['identity-chameleon'] += 3;
  }
  if (recognition.includes('success-empty') && voiceList.includes('success-unhappy')) {
    scores['burned-out-achiever'] += 3;
  }
  
  // Find highest scoring pattern
  let maxScore = 0;
  let result = 'honest-avoider';
  
  for (const [pattern, score] of Object.entries(scores)) {
    if (score > maxScore) {
      maxScore = score;
      result = pattern;
    }
  }
  
  // If scores are very close (within 1), and honest-avoider is close, prefer it
  // because it means they have broad self-awareness without one dominant wound
  if (scores['honest-avoider'] >= maxScore - 1 && result !== 'honest-avoider') {
    // Check if honest-avoider is actually close
    const sortedScores = Object.entries(scores).sort((a, b) => b[1] - a[1]);
    if (sortedScores[0][1] - sortedScores[1][1] <= 1) {
      // Close race - they see themselves broadly
      result = 'honest-avoider';
    }
  }
  
  return result;
}

// Hook button starts entry flow and intro music
document.getElementById('hookBtn').onclick = function() {
  if(typeof trackEvent==='function')trackEvent('hook_start');
  // Start intro music on user interaction
  if(!musicOn) {
    document.getElementById('introMusic').play().then(() => {
      musicOn = true;
      document.getElementById('musicBtn').classList.add('on');
    }).catch(() => {});
  }
  showHookScreen(2);
};

// Start game button after reveal
// Start game button goes directly to home - respect user's music choice
document.getElementById('startGameBtn').onclick = function() {
  if(typeof trackEvent==='function')trackEvent('hook_complete');
  data.seenIntro = true;
  save();
  // Stop intro music
  document.getElementById('introMusic').pause();
  document.getElementById('introMusic').currentTime = 0;
  // Only play game music if user had intro music on (didn't turn it off or switch to Spotify/Apple Music)
  if(musicOn && hookMusicPlaying) {
    music.play().catch(() => {});
  } else if (!hookMusicPlaying) {
    // User turned off music or switched to external app - keep music off
    musicOn = false;
    document.getElementById('musicBtn').classList.remove('on');
  }
  document.body.classList.remove('hook-active');
  document.getElementById('hook').classList.add('hidden');
  updateHome();
  // Start onboarding tour for new users
  if(!data.seenOnboarding) setTimeout(startOnboardingTour, 600);
};

// Shareable Pattern Card Functions
function showShareCard() {
  let analysis = analyzePatterns();
  if (!analysis) {
    showToast('Play more games to unlock your shareable card!');
    return;
  }
  
  const a = analysis.archetype;
  const p = analysis.profile;
  
  document.getElementById('shareCardIcon').textContent = a.icon;
  document.getElementById('shareCardName').textContent = a.name;
  document.getElementById('shareCardTagline').textContent = '"' + a.edge.split('.')[0] + '."';
  document.getElementById('shareCardRecognition').textContent = Math.round(p.mirrorRecognition * 100) + '%';
  document.getElementById('shareCardAcceptance').textContent = Math.round(p.acceptanceRate * 100) + '%';
  
  document.getElementById('shareCardModal').classList.add('active');
}

async function sharePatternCard() {
  let analysis = analyzePatterns();
  if (!analysis) {
    showToast('Play more games to share your pattern');
    return;
  }
  
  const shareText = `I'm "${analysis.archetype.name}: ${analysis.archetype.edge.split('.')[0].toLowerCase()}. What's your pattern?`;
  const shareData = {
    title: 'My Pattern | Level Up',
    text: shareText,
    url: 'https://100levelup.com?ref=share'
  };
  
  if (navigator.share) {
    try {
      await navigator.share(shareData);
      document.getElementById('shareCardModal').classList.remove('active');
      showToast('📤 Shared!');
    } catch (err) {
      if (err.name === 'AbortError') {
        // User cancelled - no action needed
      } else {
        // Share failed - copy to clipboard as fallback
        copyPatternLink();
        document.getElementById('shareCardModal').classList.remove('active');
        showToast('📋 Link copied! Paste to share manually.');
      }
    }
  } else {
    copyPatternLink();
  }
}

function copyPatternLink() {
  let analysis = analyzePatterns();
  let url = 'https://100levelup.com';
  if (analysis) {
    url += '?pattern=' + analysis.archetype.id;
  }
  navigator.clipboard.writeText(url);
  showToast('Link copied!');
}

// Coaching Bridge Logic
function checkCoachingBridge() {
  if (data.games < 10) return;
  if (data.bridgeDismissed && new Date().getTime() - data.bridgeDismissed < 86400000 * 3) return; // 3 day cooldown
  
  // Check for repeating patterns
  let insights = data.insightsCollection || [];
  let recentInsights = insights.slice(-20);
  
  let themes = { boundary: 0, control: 0, worth: 0 };
  recentInsights.forEach(i => {
    let text = (i.text || '').toLowerCase();
    if (text.includes('boundary') || text.includes('no ') || text.includes('yes ')) themes.boundary++;
    if (text.includes('control') || text.includes('perfect') || text.includes('fix')) themes.control++;
    if (text.includes('worth') || text.includes('enough') || text.includes('deserve')) themes.worth++;
  });
  
  let topTheme = Object.entries(themes).sort((a,b) => b[1] - a[1])[0];
  if (topTheme && topTheme[1] >= 3) {
    let themeNames = { boundary: 'Boundary', control: 'Control', worth: 'Self-worth' };
    document.getElementById('bridgePatternText').textContent = themeNames[topTheme[0]] + ' pattern appeared ' + topTheme[1] + ' times recently';
    document.getElementById('coachingBridge').classList.add('show');
  }
}

function dismissCoachingBridge() {
  document.getElementById('coachingBridge').classList.remove('show');
  data.bridgeDismissed = new Date().getTime();
  save();
}
// Entry flow hookBtn handler is defined above - this line removed to prevent override

function startMirrorGame(lf){
  if(typeof trackEvent==='function')trackEvent('game_start',{mode:'mirror',level:lf||'all'});
  // Clean up any lingering onboarding elements
  if(currentTooltip){currentTooltip.remove();currentTooltip=null;}
  document.querySelectorAll('.onboard-tooltip').forEach(el=>el.remove());
  document.querySelectorAll('.onboard-highlight').forEach(el=>el.classList.remove('onboard-highlight'));
  document.getElementById('onboardOverlay').classList.remove('show');
  tourActive=false;
  
  game.mode='mirror';game.idx=0;game.answers=[];game.useTimer=hardMode;game.levelFilter=lf||null;currentCombo=0;
  if(!game.endlessMode){game.sessionXP=0;game.sessionInsights=0;game.sessionGames=0;}
  game.sessionGames++;
  // Mark that they've started playing (hides Start Here, shows Play badges)
  if(!data.hasStartedPlaying){data.hasStartedPlaying=true;save();}
  // First-time instruction
  if(!data.seenMirrorIntro){data.seenMirrorIntro=true;save();showToast('Tap the answer that feels most true for you',3000);}
  // Check if scenarios are loaded
  if(typeof MIRROR_SCENARIOS==='undefined'||MIRROR_SCENARIOS.length===0){
    showToast('⚠️ Loading scenarios...');
    setTimeout(()=>startMirrorGame(lf),1000);
    return;
  }
  let pool=MIRROR_SCENARIOS.filter(s=>lf?s.level===lf:(data.unlockedLevels.includes(s.level)||hasLevelPass(s.level)));
  if(pool.length===0){showToast('No scenarios for this level');return}
  let questionCount=game.endlessMode?Math.min(pool.length,25):15;
  // Use smartShuffle to prioritize unseen scenarios
  game.scenarios=smartShuffle(pool,'mirror').slice(0,questionCount);
  
  // PEEK SYSTEM: Inject occasional L4+ scenario if foundation not complete
  if(!lf && (data.foundationPlays||0) < 150 && data.games >= 5 && data.games % 3 === 0) {
    let peekLevels = [4,5,6,7].filter(l => !data.unlockedLevels.includes(l));
    if(peekLevels.length > 0) {
      let peekLevel = peekLevels[Math.floor(Math.random() * peekLevels.length)];
      let peekPool = MIRROR_SCENARIOS.filter(s => s.level === peekLevel);
      if(peekPool.length > 0) {
        let peekScenario = {...peekPool[Math.floor(Math.random() * peekPool.length)], isPeek: true};
        // Insert at position 3 (4th scenario)
        game.scenarios.splice(3, 0, peekScenario);
        game.scenarios = game.scenarios.slice(0, questionCount);
      }
    }
  }
  
  document.getElementById('home').classList.add('hidden');document.getElementById('results').classList.remove('active');document.getElementById('game').classList.add('active');
  document.getElementById('gameMode').textContent=game.endlessMode?'♾️ '+(typeof t==='function'?t('Mirror'):' Mirror')+' (Endless)':(hardMode?'💀 '+(typeof t==='function'?t('Mirror'):' Mirror')+' (Hard)':(typeof t==='function'?t('Mirror Game'):'Mirror Game'));document.getElementById('gameCombo').textContent='';if(hardMode){document.getElementById('timerBar').classList.remove('hidden')}else{document.getElementById('timerBar').classList.add('hidden')};
  showMirrorScenario();
}

// Agreement Game Onboarding Functions
function showAgreementOnboard(screen) {
  document.getElementById('agreementOnboardScreen1').style.display = screen === 1 ? 'block' : 'none';
  document.getElementById('agreementOnboardScreen2').style.display = screen === 2 ? 'block' : 'none';
  document.getElementById('agreementOnboardScreen3').style.display = screen === 3 ? 'block' : 'none';
}

function finishAgreementOnboard() {
  document.getElementById('agreementOnboardModal').classList.remove('active');
  data.seenAgreementOnboard = true;
  save();
  // Now actually start the game
  startAgreementGameReal(window._pendingAgreementLevel);
}

function startAgreementGame(lf){
  if(!data.unlockedAgreement){showToast('🔒 Reach Level 2!');return}
  
  // Show onboarding first time
  if(!data.seenAgreementOnboard) {
    window._pendingAgreementLevel = lf;
    showAgreementOnboard(1);
    document.getElementById('agreementOnboardModal').classList.add('active');
    return;
  }
  
  startAgreementGameReal(lf);
}

function startAgreementGameReal(lf){
  // Clean up any lingering onboarding elements
  if(currentTooltip){currentTooltip.remove();currentTooltip=null;}
  document.querySelectorAll('.onboard-tooltip').forEach(el=>el.remove());
  document.querySelectorAll('.onboard-highlight').forEach(el=>el.classList.remove('onboard-highlight'));
  document.getElementById('onboardOverlay').classList.remove('show');
  tourActive=false;
  
  game.mode='agreement';game.idx=0;game.answers=[];game.useTimer=true;game.levelFilter=lf||null;currentCombo=0;
  if(!game.endlessMode){game.sessionXP=0;game.sessionInsights=0;game.sessionGames=0;}
  game.sessionGames++;
  // Mark that they've started playing (hides Start Here, shows Play badges)
  if(!data.hasStartedPlaying){data.hasStartedPlaying=true;save();}
  // First-time instruction
  if(!data.seenAgreementIntro){data.seenAgreementIntro=true;save();showToast('Choose acceptance over judgment - accept reality as it is',3500);}
  // Check if scenarios are loaded
  if(typeof DECISION_SCENARIOS==='undefined'||DECISION_SCENARIOS.length===0){
    showToast('⚠️ Loading scenarios...');
    setTimeout(()=>startAgreementGame(lf),1000);
    return;
  }
  let pool=DECISION_SCENARIOS_EXPANDED.filter(s=>lf?s.level===lf:(data.unlockedLevels.includes(s.level)||hasLevelPass(s.level)));
  if(pool.length===0){showToast('No scenarios for this level');return}
  let questionCount=game.endlessMode?Math.min(pool.length,25):15;
  // Use smartShuffle to prioritize unseen scenarios
  game.scenarios=smartShuffle(pool,'agreement').slice(0,questionCount);
  document.getElementById('home').classList.add('hidden');document.getElementById('results').classList.remove('active');document.getElementById('game').classList.add('active');
  document.getElementById('gameMode').textContent=game.endlessMode?'♾️ '+(typeof t==='function'?t('Agreement'):' Agreement')+' (Endless)':(typeof t==='function'?t('Agreement Game'):'Agreement Game');document.getElementById('gameCombo').textContent='';document.getElementById('timerBar').classList.remove('hidden');
  showAgreementScenario();
}
function startDecisionGame(){
  let today=new Date().toDateString();if(data.lastDaily===today){showToast('Already completed!');return}
  // Clean up any lingering onboarding elements
  if(currentTooltip){currentTooltip.remove();currentTooltip=null;}
  document.querySelectorAll('.onboard-tooltip').forEach(el=>el.remove());
  document.querySelectorAll('.onboard-highlight').forEach(el=>el.classList.remove('onboard-highlight'));
  document.getElementById('onboardOverlay').classList.remove('show');
  tourActive=false;
  
  game.mode='decision';game.idx=0;game.answers=[];game.useTimer=true;game.scenarios=[];currentCombo=0;
  // Mark that they've started playing (hides Start Here, shows Play badges)
  if(!data.hasStartedPlaying){data.hasStartedPlaying=true;save();}
  if(typeof window.SCENARIOS==='undefined'){showToast('Loading...');return}
  let seed=hashDate(today),all=[];
  for(let l=1;l<=7;l++){if(window.SCENARIOS[l])all=all.concat(window.SCENARIOS[l].map(s=>({...s,level:l})))}
  // Filter out recently seen decision scenarios to prevent repeats
  let seen=data.seenScenarios&&data.seenScenarios.decision?data.seenScenarios.decision:[];
  let unseen=all.filter(s=>!seen.includes(s.id&&s.id.toString?s.id.toString():s.text));
  let pool=unseen.length>=3?unseen:all;
  for(let i=0;i<3&&i<pool.length;i++){let idx=(seed+i*31337)%pool.length;game.scenarios.push(pool[idx]);seed=(seed*31337)&0xFFFFFF}
  if(game.scenarios.length===0){showToast('No scenarios');return}
  document.getElementById('home').classList.add('hidden');document.getElementById('results').classList.remove('active');document.getElementById('game').classList.add('active');
  document.getElementById('gameMode').textContent=typeof t==='function'?t('Worldwide Challenge'):'Worldwide Challenge';document.getElementById('gameCombo').textContent='';document.getElementById('timerBar').classList.remove('hidden');
  showDecisionScenario();
}

function showMirrorScenario(){
  let s=game.scenarios[game.idx];if(!s){endGame();return}
  document.getElementById('gameProgress').textContent=(game.idx+1)+'/'+game.scenarios.length;
  let lv=LEVELS.find(l=>l.id===s.level);
  
  // PEEK INDICATOR: Show special label for preview scenarios
  let levelLabel = 'Level '+s.level+': '+(lv?lv.name:'');
  if(s.isPeek) {
    levelLabel = '👀 Preview: Level '+s.level+' '+(lv?lv.name:'');
    if(!data.shownPeekToast) {
      showToast('👀 Sneak peek at what\'s ahead!', 2500);
      data.shownPeekToast = true;
    }
  }
  document.getElementById('scenarioCat').textContent=levelLabel;
  
  let scenarioEl=document.getElementById('scenarioText');scenarioEl.textContent=truncateText(s.text);scenarioEl.classList.remove('loading');
  let c=document.getElementById('choices');c.innerHTML='';
  [{text:"That's Me",value:true},{text:"That's Not Me",value:false}].forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=typeof t==='function'?(ch.value?t("That's Me"):t('Not Me')):ch.text;b.onclick=()=>selectMirrorChoice(ch,b,s);c.appendChild(b)});
}
function selectMirrorChoice(ch,btn,sc){
  document.querySelectorAll('.choice').forEach(b=>{b.disabled=true;if(b!==btn)b.classList.add('dim-neutral')});
  btn.classList.add('selected-mirror');
  game.answers.push({recognized:ch.value,insight:sc.insight,text:sc.text,level:sc.level});
  addInsight(sc.insight,sc.level);
  // Mirror mode: no combos (no right/wrong answer), reduced XP for reflection
  data.mirrorTotal++;if(ch.value){data.mirrorRecognized++;addBreakthrough('mirror',1);}
  // Track foundation plays (levels 1-3)
  if(sc.level<=3)data.foundationPlays=(data.foundationPlays||0)+1;
  positiveSound();coinSound();addXP(15, 'Mirror Game');maybeBonus();
  // Track seen scenario
  markScenarioSeen('mirror',sc.text);
  save();
  setTimeout(()=>showMirrorFeedback(sc.text,sc.insight,ch.value),400);
}
function showMirrorFeedback(txt,ins,rec){document.getElementById('fbIcon').textContent='💡';document.getElementById('fbIcon').style.color='var(--pink)';document.getElementById('fbTitle').textContent='Reflection';document.getElementById('fbLabel').textContent=rec?'🪞 That\'s Me':'🪞 Not Me';document.getElementById('fbText').innerHTML='<div style="font-size:14px;margin-bottom:10px;color:var(--text);">"'+txt+'"</div><div style="font-size:13px;color:var(--muted);font-style:italic;">'+ins+'</div>';document.getElementById('feedbackModal').classList.add('active')}

function showAgreementScenario(){
  let s=game.scenarios[game.idx];if(!s){endGame();return}
  document.getElementById('gameProgress').textContent=(game.idx+1)+'/'+game.scenarios.length;
  let lv=LEVELS.find(l=>l.id===s.level);document.getElementById('scenarioCat').textContent='Level '+s.level+': '+(lv?lv.name:'');
  let scenarioEl=document.getElementById('scenarioText');scenarioEl.textContent=truncateText(s.scenario);scenarioEl.classList.remove('loading');
  let c=document.getElementById('choices');c.innerHTML='';
  shuffle(s.choices).forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=ch.text;b.onclick=()=>selectAgreementChoice(ch,b,s);c.appendChild(b)});
  if(game.useTimer)startTimer();
}
function selectAgreementChoice(ch,btn,sc){
  if(game.timer)clearInterval(game.timer);document.querySelectorAll('.choice').forEach(b=>b.disabled=true);
  let isAcc=ch.type==='acceptance';game.answers.push({type:ch.type,isAcceptance:isAcc,insight:ch.insight,level:sc.level});
  // Track weekly acceptance stats
  if(data.weeklyStats){data.weeklyStats.totalChoices++;if(isAcc)data.weeklyStats.acceptanceChoices++;}
  // Track foundation plays (levels 1-3)
  if(sc.level<=3)data.foundationPlays=(data.foundationPlays||0)+1;
  if(isAcc){btn.classList.add('correct');data.agreementAccepted++;positiveSound();multiCoinSound(2);addXP(10, 'Agreement Game');addInsight(ch.insight,sc.level);addCombo();addBreakthrough('agreement',1);}
  else{btn.classList.add('wrong');let acc=sc.choices.find(c=>c.type==='acceptance');document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===acc.text)b.classList.add('correct');else if(b!==btn)b.classList.add('dim')});neutralSound();addXP(2, 'Partial Credit');resetCombo()}
  // Track seen scenario
  markScenarioSeen('agreement',sc.scenario);
  data.agreementTotal++;maybeBonus();setTimeout(()=>showAgreementFeedback(ch,isAcc),500);
}
function showAgreementFeedback(ch,isAcc){document.getElementById('fbIcon').textContent=isAcc?'✓':'⚖️';document.getElementById('fbIcon').style.color=isAcc?'var(--green)':'var(--yellow)';document.getElementById('fbTitle').textContent=isAcc?'Acceptance':'Judgment';document.getElementById('fbLabel').textContent=isAcc?'Why this works':'Learning opportunity';document.getElementById('fbText').textContent=ch.insight;document.getElementById('feedbackModal').classList.add('active')}

function showDecisionScenario(){
  let s=game.scenarios[game.idx];if(!s){endGame();return}
  document.getElementById('gameProgress').textContent=(game.idx+1)+'/'+game.scenarios.length;
  let lv=LEVELS.find(l=>l.id===s.level);document.getElementById('scenarioCat').textContent='Level '+s.level+': '+(lv?lv.name:'');
  let scenarioEl=document.getElementById('scenarioText');scenarioEl.textContent=truncateText(s.text);scenarioEl.classList.remove('loading');
  let c=document.getElementById('choices');c.innerHTML='';
  shuffle(s.choices).forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=ch.text;b.onclick=()=>selectDecisionChoice(ch,b,s);c.appendChild(b)});
  if(game.useTimer)startTimer();
}
function selectDecisionChoice(ch,btn,sc){
  if(game.timer)clearInterval(game.timer);document.querySelectorAll('.choice').forEach(b=>b.disabled=true);
  let isCorr=ch.correct===true;game.answers.push({correct:isCorr,feedback:ch.fb,level:sc.level});
  // Track foundation plays (levels 1-3)
  if(sc.level<=3)data.foundationPlays=(data.foundationPlays||0)+1;
  if(isCorr){btn.classList.add('correct');positiveSound();multiCoinSound(3);addXP(12, 'Mixed Mode');addInsight(ch.fb,sc.level);addCombo();addBreakthrough('daily',1);}
  else{btn.classList.add('wrong');let corr=sc.choices.find(c=>c.correct===true);document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===corr.text)b.classList.add('correct');else if(b!==btn)b.classList.add('dim')});neutralSound();addXP(2, 'Partial Credit');resetCombo()}
  maybeBonus();setTimeout(()=>showDecisionFeedback(ch,isCorr),500);
}
function showDecisionFeedback(ch,isCorr){document.getElementById('fbIcon').textContent=isCorr?'✓':'💡';document.getElementById('fbIcon').style.color=isCorr?'var(--green)':'var(--yellow)';document.getElementById('fbTitle').textContent=isCorr?'Correct!':'Not Quite';document.getElementById('fbLabel').textContent='Insight';document.getElementById('fbText').textContent=ch.fb;document.getElementById('feedbackModal').classList.add('active')}

function startTimer(){let duration=hardMode?5:(game.timerDuration||15);game.timeLeft=duration;if(game.timer)clearInterval(game.timer);game.timer=setInterval(()=>{game.timeLeft-=0.1;let pct=(game.timeLeft/duration)*100,fill=document.getElementById('timerFill');fill.style.width=pct+'%';fill.classList.remove('warn','danger');if(game.timeLeft<=5)fill.classList.add('danger');else if(game.timeLeft<=duration*0.66)fill.classList.add('warn');if(game.timeLeft<=0){clearInterval(game.timer);timeUp()}},100)}
function timeUp(){
  let s=game.scenarios[game.idx];document.querySelectorAll('.choice').forEach(b=>b.disabled=true);resetCombo();
  if(game.mode==='agreement'||(game.mode==='mixed'&&s.gameType==='agreement')){let acc=s.choices.find(c=>c.type==='acceptance');game.answers.push({type:'timeout',isAcceptance:false,level:s.level});data.agreementTotal++;document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===acc.text)b.classList.add('correct');else b.classList.add('dim')});neutralSound();setTimeout(()=>{document.getElementById('fbIcon').textContent='⏰';document.getElementById('fbTitle').textContent="Time's Up";document.getElementById('fbLabel').textContent='The accepting response';document.getElementById('fbText').textContent=acc.insight;document.getElementById('feedbackModal').classList.add('active')},500)}
  else if(game.mode==='decision'||(game.mode==='mixed'&&s.gameType==='decision')){let corr=s.choices.find(c=>c.correct===true);game.answers.push({correct:false,feedback:corr.fb,level:s.level,gameType:'decision'});document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===corr.text)b.classList.add('correct');else b.classList.add('dim')});neutralSound();setTimeout(()=>{document.getElementById('fbIcon').textContent='⏰';document.getElementById('fbTitle').textContent="Time's Up";document.getElementById('fbLabel').textContent='The right response';document.getElementById('fbText').textContent=corr.fb;document.getElementById('feedbackModal').classList.add('active')},500)}
}

document.getElementById('nextBtn').onclick=function(){document.getElementById('feedbackModal').classList.remove('active');game.idx++;if(game.idx>=game.scenarios.length)endGame();else{if(game.mode==='mirror')showMirrorScenario();else if(game.mode==='agreement')showAgreementScenario();else if(game.mode==='decision')showDecisionScenario();else if(game.mode==='mixed')showMixedScenario();}};

function endGame(){
  if(typeof trackEvent==='function')trackEvent('game_complete',{mode:game.mode,score:game.answers.filter(a=>a.recognized||a.isAcceptance||a.correct).length,total:game.answers.length,games:data.games+1});
  // End game processing
  if(game.timer)clearInterval(game.timer);data.games++;
  
  // Track weekly stats
  if(!data.weeklyStats)data.weeklyStats={startDate:Date.now(),gamesPlayed:0,insightsGained:0,acceptanceChoices:0,totalChoices:0};
  data.weeklyStats.gamesPlayed++;
  
  let score=0,total=game.answers.length;
  
  // Reset results screen state
  document.getElementById('insightsList').innerHTML='';
  document.getElementById('resultMsg').textContent='';
  
  if(game.mode==='mirror'){score=game.answers.filter(a=>a.recognized).length}
  else if(game.mode==='agreement'){score=game.answers.filter(a=>a.isAcceptance).length}
  else if(game.mode==='mixed'){score=game.answers.filter(a=>a.recognized||a.isAcceptance).length}
  else if(game.mode==='decision'){
    score=game.answers.filter(a=>a.correct).length;
    let today=new Date().toDateString(),yesterday=new Date(Date.now()-86400000).toDateString();
    if(data.lastDaily===yesterday)data.streak++;else if(data.lastDaily!==today)data.streak=1;
    if(!data.bestStreak || data.streak > data.bestStreak) data.bestStreak = data.streak;
    data.lastDaily=today;
  }
  save();document.getElementById('game').classList.remove('active');document.getElementById('results').classList.add('active');
  
  // Show session XP earned
  if(game.sessionXP>0){
    document.getElementById('resultsXP').style.display='block';
    // Add session stats
    let sessionStats='';
    if(game.sessionGames>1)sessionStats+='<div style="font-size:11px;color:var(--muted);margin-top:4px;">'+game.sessionGames+' games • '+game.sessionInsights+' new insights</div>';
    document.getElementById('resultsXP').innerHTML='<div style="font-size:24px;font-weight:800;color:var(--gold);">+'+game.sessionXP+' XP</div><div style="font-size:12px;color:var(--muted);margin-top:4px;">This session</div>'+sessionStats;
  }else{
    document.getElementById('resultsXP').style.display='none';
  }
  
  // Show/hide Keep Playing and Endless Mode buttons (not for Daily Challenge)
  let keepPlayingBtn=document.getElementById('keepPlayingBtn');
  let endlessModeBtn=document.getElementById('endlessModeBtn');
  if(game.mode!=='decision'){
    keepPlayingBtn.style.display='block';
    endlessModeBtn.style.display=game.endlessMode?'none':'block';
    if(game.endlessMode){
      keepPlayingBtn.textContent='♾️ '+(typeof t==='function'?t('Continue Endless'):'Continue Endless')+' (+25 more)';
    }else{
      keepPlayingBtn.textContent='🔄 '+(typeof t==='function'?t('Keep Playing'):'Keep Playing')+' (+10 more)';
    }
  }else{
    keepPlayingBtn.style.display='none';
    endlessModeBtn.style.display='none';
  }
  
  let insights=document.getElementById('insightsList');
  if(game.mode==='mirror'){
    document.getElementById('resultsTitle').textContent=game.endlessMode?'♾️ '+(typeof t==='function'?t('Mirror Complete'):'Mirror Complete'):(typeof t==='function'?t('Mirror Complete'):'Mirror Complete');document.getElementById('finalScore').textContent=total+' '+(typeof t==='function'?t('Reflections'):'Reflections');
    let recognized=game.answers.filter(a=>a.recognized).length;
    let recPct=Math.round((recognized/total)*100);
    let resultMsg=recPct>=80?(typeof t==='function'?t('High self-recognition. You see yourself clearly. That\'s rare and powerful.'):'High self-recognition. You see yourself clearly. That\'s rare and powerful.'):recPct>=60?(typeof t==='function'?t('Strong awareness. You\'re willing to look at what others avoid.'):'Strong awareness. You\'re willing to look at what others avoid.'):recPct>=40?(typeof t==='function'?t('Selective recognition. Some patterns are easier to see than others.'):'Selective recognition. Some patterns are easier to see than others.'):(typeof t==='function'?t('Low recognition. Either you\'re different, or there\'s a blind spot worth exploring.'):'Low recognition. Either you\'re different, or there\'s a blind spot worth exploring.');
    document.getElementById('resultMsg').textContent=resultMsg;
    insights.innerHTML='';game.answers.slice(0,10).forEach(a=>{let div=document.createElement('div');div.className='insight-item';div.innerHTML='<span style="color:'+(a.recognized?'var(--cyan)':'var(--muted)')+';">'+(a.recognized?'🪞 That\'s Me':'🪞 Not Me')+'</span><div style="margin-top:4px;">"'+a.text+'"</div>';insights.appendChild(div)});
  }else if(game.mode==='agreement'){
    document.getElementById('resultsTitle').textContent=game.endlessMode?'♾️ '+(typeof t==='function'?t('Agreement Complete'):'Agreement Complete'):(typeof t==='function'?t('Agreement Complete'):'Agreement Complete');document.getElementById('finalScore').textContent=score+'/'+total;
    let accPct=Math.round((score/total)*100);
    let resultMsg=accPct>=90?(typeof t==='function'?t('Exceptional. You chose acceptance almost every time.'):'Exceptional. You chose acceptance almost every time.'):accPct>=70?(typeof t==='function'?t('Strong acceptance. You\'re rewiring your default response.'):'Strong acceptance. You\'re rewiring your default response.'):accPct>=50?(typeof t==='function'?t('Growing awareness. Notice when judgment feels safer.'):'Growing awareness. Notice when judgment feels safer.'):(typeof t==='function'?t('Judgment is your current default. That\'s not wrong. It\'s information.'):'Judgment is your current default. That\'s not wrong. It\'s information.');
    document.getElementById('resultMsg').textContent=resultMsg;
    insights.innerHTML='';game.answers.slice(0,5).forEach(a=>{let div=document.createElement('div');div.className='insight-item';div.textContent=(a.isAcceptance?'✓ ':'⚖️ ')+a.insight;insights.appendChild(div)});
    if(score===total&&total>=10){triggerConfetti();showToast('🎉 Perfect! +25 XP');addXP(25, 'Perfect Game')}
  }else if(game.mode==='mixed'){
    let mirrorAnswers=game.answers.filter(a=>a.recognized!==undefined);
    let agreementAnswers=game.answers.filter(a=>a.isAcceptance!==undefined);
    let decisionAnswers=game.answers.filter(a=>a.gameType==='decision');
    let recognized=mirrorAnswers.filter(a=>a.recognized);
    let notMe=mirrorAnswers.filter(a=>!a.recognized);
    let acceptCount=agreementAnswers.filter(a=>a.isAcceptance).length;
    let judgmentCount=agreementAnswers.length-acceptCount;
    let correctCount=decisionAnswers.filter(a=>a.correct).length;
    
    document.getElementById('resultsTitle').textContent=game.endlessMode?'♾️ Mixed Endless':'Mixed Complete';
    let scoreText='🪞 '+mirrorAnswers.length+' Reflections';
    if(agreementAnswers.length>0)scoreText+=' • ⚖️ '+acceptCount+'/'+agreementAnswers.length+' Accepted';
    if(decisionAnswers.length>0)scoreText+=' • 🎯 '+correctCount+'/'+decisionAnswers.length+' Correct';
    document.getElementById('finalScore').innerHTML=scoreText;
    
    // Build DEEP personalized reflection
    let reflection='<div style="background:linear-gradient(135deg,rgba(120,75,160,0.15),rgba(255,60,172,0.1));border:1px solid var(--purple);border-radius:12px;padding:16px;margin-bottom:16px;text-align:left;">';
    reflection+='<div style="font-weight:700;color:var(--pink);margin-bottom:12px;">💭 What This Session Revealed</div>';
    
    // Show specific recognized patterns with actual quotes
    if(recognized.length>0){
      reflection+='<p style="font-size:13px;color:var(--text);margin-bottom:8px;">You recognized:</p>';
      recognized.slice(0,2).forEach(a=>{
        reflection+='<div style="font-size:13px;color:var(--muted);font-style:italic;margin:4px 0 4px 12px;">"'+(a.text||a.insight)+'"</div>';
      });
    }
    
    // Show what they rejected - potential blind spots
    if(notMe.length>0&&recognized.length>0){
      reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0 8px;">But you rejected:</p>';
      reflection+='<div style="font-size:13px;color:var(--muted);font-style:italic;margin:4px 0 4px 12px;">"'+(notMe[0].text||notMe[0].insight)+'"</div>';
      
      // Look for contradiction patterns
      let boundaryWords=['boundary','boundaries','no','yes','peace','please','avoid','conflict'];
      let controlWords=['control','perfect','right','wrong','should','must','fix'];
      let worthWords=['worth','deserve','enough','value','matter'];
      
      let recognizedText=recognized.map(a=>(a.insight||'').toLowerCase()).join(' ');
      let rejectedText=notMe.map(a=>(a.insight||'').toLowerCase()).join(' ');
      
      let hasBoundaryRecognized=boundaryWords.some(w=>recognizedText.includes(w));
      let hasBoundaryRejected=boundaryWords.some(w=>rejectedText.includes(w));
      let hasControlRecognized=controlWords.some(w=>recognizedText.includes(w));
      let hasWorthRejected=worthWords.some(w=>rejectedText.includes(w));
      
      // Generate insight based on contradiction
      if(hasBoundaryRecognized&&hasBoundaryRejected){
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">These might be connected. You see some boundary patterns but not others. The ones you don\'t see often protect you from seeing something deeper.</p>';
      }else if(hasControlRecognized&&hasWorthRejected){
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">Interesting pattern: you recognize control tendencies but may not see how they connect to self-worth. Control is often protection.</p>';
      }else if(recognized.length>=2){
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">These patterns are often connected. The ones you see and the ones you rejected may share a root. That\'s not a flaw. It\'s how awareness unfolds.</p>';
      }
    }
    
    // Agreement analysis with specific insight
    if(agreementAnswers.length>0){
      if(judgmentCount>acceptCount){
        let judgmentExample=agreementAnswers.find(a=>!a.isAcceptance);
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">In acceptance scenarios, <strong>judgment came up more than acceptance</strong>.';
        if(judgmentExample&&judgmentExample.insight){
          reflection+=' One insight: "'+judgmentExample.insight+'" The trigger is the teacher.</p>';
        }else{
          reflection+='</p>';
        }
      }else if(acceptCount>judgmentCount){
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">You chose acceptance <strong>'+acceptCount+' time'+(acceptCount>1?'s':'')+'</strong>. You\'re building the muscle that creates space for change.</p>';
      }else if(acceptCount===judgmentCount&&acceptCount>0){
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">Equal acceptance and judgment. You\'re in transition. The old patterns and new awareness are both present. That\'s exactly where growth happens.</p>';
      }
    }
    
    // Decision analysis
    if(decisionAnswers.length>0){
      if(correctCount===decisionAnswers.length){
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;"><strong>Perfect on decision scenarios.</strong> Your instincts are aligned with wisdom.</p>';
      }else if(correctCount===0){
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">The decision scenarios challenged you. Each "wrong" answer revealed a growth edge.</p>';
      }else{
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">'+correctCount+' of '+decisionAnswers.length+' decisions aligned with the framework. The misses are where learning lives.</p>';
      }
    }
    
    // Pattern summary based on overall session
    if(recognized.length>=3&&acceptCount>=2){
      reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;"><strong>Strong self-awareness and acceptance.</strong> You\'re ready to go deeper into this level.</p>';
    }else if(recognized.length<=1&&judgmentCount>acceptCount){
      reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">This level is challenging you. You may be avoiding looking at yourself, or genuinely don\'t relate. Either is information.</p>';
    }else if(recognized.length>=2&&judgmentCount>acceptCount){
      reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">You see yourself clearly but struggle to accept what you see. <strong>Self-compassion is your next edge.</strong></p>';
    }else if(recognized.length<=1&&acceptCount>=2){
      reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">You accept others easily but may be avoiding the mirror. The reflection is waiting when you\'re ready.</p>';
    }
    
    reflection+='<p style="font-size:11px;color:var(--muted);margin-top:14px;font-style:italic;">This reflection is based on your specific answers, not a template.</p>';
    reflection+='</div>';
    
    document.getElementById('resultMsg').innerHTML=reflection;
    
    // Show all responses
    insights.innerHTML='<div style="font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Your Responses</div>';
    game.answers.forEach(a=>{
      let div=document.createElement('div');div.className='insight-item';
      if(a.recognized!==undefined){
        div.innerHTML='<span style="color:'+(a.recognized?'var(--cyan)':'var(--muted)')+';">🪞 '+(a.recognized?'That\'s Me':'Not Me')+'</span><div style="margin-top:4px;">"'+(a.text||a.insight)+'"</div>';
      }else if(a.isAcceptance!==undefined){
        div.innerHTML='<span style="color:'+(a.isAcceptance?'var(--green)':'var(--yellow)')+';">⚖️ '+(a.isAcceptance?'Accepted':'Judgment')+'</span> '+a.insight;
      }else if(a.gameType==='decision'){
        div.innerHTML='<span style="color:'+(a.correct?'var(--green)':'var(--yellow)')+';">🎯 '+(a.correct?'Correct':'Missed')+'</span><div style="margin-top:4px;">"'+(a.text||'')+'"</div><div style="font-size:12px;color:var(--muted);margin-top:4px;">'+a.feedback+'</div>';
      }
      insights.appendChild(div);
    });
  }else if(game.mode==='decision'){
    document.getElementById('resultsTitle').textContent=typeof t==='function'?t('Challenge Complete'):'Challenge Complete';document.getElementById('finalScore').textContent='🔥 '+data.streak;
    document.getElementById('resultMsg').textContent=score+'/'+total+' '+(typeof t==='function'?t('correct!'):'correct!');
    insights.innerHTML='';game.answers.forEach(a=>{let div=document.createElement('div');div.className='insight-item';div.textContent=(a.correct?'✓ ':'💡 ')+a.feedback;insights.appendChild(div)});
    if(score===3){triggerConfetti();showToast('🎉 Perfect! +30 XP');addXP(30, 'Perfect Daily')}
  }else{
    // Fallback for unknown mode - show generic results
    console.warn('Unknown game mode:',game.mode);
    document.getElementById('resultsTitle').textContent=typeof t==='function'?t('Game Complete'):'Game Complete';
    document.getElementById('finalScore').textContent=total+' '+(typeof t==='function'?t('Questions'):'Questions');
    document.getElementById('resultMsg').textContent=typeof t==='function'?t('Great job!'):'Great job!';
  }
  
  // Show coaching CTA on results (after Mirror/Mixed games OR after 5+ games played)
  let coachingCta=document.getElementById('resultsCoachingCta');
  if(coachingCta){
    if((game.mode==='mirror'||game.mode==='mixed')&&data.games>=3){
      coachingCta.style.display='block';
    }else if(data.games>=5){
      coachingCta.style.display='block';
    }else{
      coachingCta.style.display='none';
    }
  }
  
  // Find deepest insight from this session (only for mirror/mixed)
  let deepestInsightEl=document.getElementById('deepestInsight');
  if((game.mode==='mirror'||game.mode==='mixed')&&game.answers.length>0){
    // Find a recognized insight with good text
    let recognizedInsights=game.answers.filter(a=>a.recognized&&a.insight&&a.insight.length>20);
    if(recognizedInsights.length>0){
      // Pick the one with most impactful keywords
      let impactWords=['never','always','afraid','hurt','love','pain','worth','enough','alone','hide','truth','lie','pretend'];
      let scored=recognizedInsights.map(a=>{
        let score=impactWords.filter(w=>a.insight.toLowerCase().includes(w)).length;
        return {insight:a.insight,score:score};
      }).sort((a,b)=>b.score-a.score);
      currentDeepestInsight=scored[0].insight;
      document.getElementById('deepestInsightText').textContent='"'+currentDeepestInsight+'"';
      document.getElementById('deepestInsightMessage').textContent=generateDeepInsightMessage(currentDeepestInsight);
      deepestInsightEl.style.display='block';
    }else{
      deepestInsightEl.style.display='none';
    }
  }else{
    deepestInsightEl.style.display='none';
  }
  
  // ========== EXERCISE SURFACING & COACHING BRIDGE ==========
  let exerciseHtml=surfaceExercise(game.answers);
  let coachingHtml=coachingBridge(game.answers);
  if(exerciseHtml||coachingHtml){
    let extraDiv=document.getElementById('resultsSuggestions');
    if(!extraDiv){
      extraDiv=document.createElement('div');
      extraDiv.id='resultsSuggestions';
      let insightsEl=document.getElementById('insightsList');
      if(insightsEl)insightsEl.parentNode.insertBefore(extraDiv,insightsEl.nextSibling);
    }
    extraDiv.innerHTML=(exerciseHtml||'')+(coachingHtml||'');
  }else{
    let extraDiv=document.getElementById('resultsSuggestions');
    if(extraDiv)extraDiv.innerHTML='';
  }
  
  // Check if user should take a break (20+ min OR 5+ games this session)
  let sessionMinutes=(Date.now()-sessionStartTime)/(1000*60);
  if(!sessionBreakShown&&(sessionMinutes>=20||game.sessionGames>=5)&&game.mode!=='decision'){
    setTimeout(()=>{
      document.getElementById('takeBreakModal').classList.add('active');
    },1500);
  }
  
  // Check for pattern links (breakthrough connections)
  if(data.games>=10 && data.games%5===0){
    setTimeout(()=>showPatternLink(),2000);
  }
}

// Deepest insight functions
function generateDeepInsightMessage(insight){
  let lower=insight.toLowerCase();
  
  // Pattern-based personalized messages
  if(lower.includes('never')&&lower.includes('enough')){
    return "This one hits deep. The 'never enough' wound often starts young, and it's exhausting to carry. What if you already are?";
  }
  if(lower.includes('alone')||lower.includes('lonely')){
    return "Feeling alone even in a crowd? That's not about other people. It's about the walls you've built. They kept you safe once. Maybe not anymore.";
  }
  if(lower.includes('afraid')||lower.includes('fear')){
    return "Fear is just excitement without breath. What you're afraid of often points to what you most need to do.";
  }
  if(lower.includes('love')&&(lower.includes('hurt')||lower.includes('pain'))){
    return "Love and pain got tangled up somewhere. They don't have to be the same thing. That's unlearnable.";
  }
  if(lower.includes('hide')||lower.includes('mask')||lower.includes('pretend')){
    return "The mask worked for a while. But the person underneath is tired of not being seen. They deserve to exist.";
  }
  if(lower.includes('control')){
    return "Control is a trauma response. What felt like safety became a cage. Letting go isn't giving up. It's growing up.";
  }
  if(lower.includes('perfect')){
    return "Perfectionism isn't high standards. It's fear wearing a suit. You're allowed to be human.";
  }
  if(lower.includes('worth')||lower.includes('deserve')){
    return "Your worth isn't earned. It was never conditional. Somewhere you learned otherwise. That was a lie.";
  }
  if(lower.includes('trust')){
    return "Trust was broken, so you stopped giving it. But walls that keep pain out also keep connection out.";
  }
  if(lower.includes('anger')||lower.includes('rage')){
    return "Anger is grief's bodyguard. What's underneath the fire? That's where the healing is.";
  }
  if(lower.includes('guilt')||lower.includes('shame')){
    return "Guilt says 'I did something bad.' Shame says 'I am bad.' Only one of those is ever true.";
  }
  if(lower.includes('boundary')||lower.includes('boundaries')){
    return "Boundaries aren't walls. They're doors. You get to choose who has a key.";
  }
  if(lower.includes('abandon')){
    return "The fear of being left often makes us leave first. But you can't abandon yourself anymore.";
  }
  if(lower.includes('please')||lower.includes('pleasing')){
    return "You learned that being liked meant being safe. But the cost was losing yourself. Time to come home.";
  }
  if(lower.includes('numb')||lower.includes('feel')||lower.includes('feeling')){
    return "Numbing the pain also numbs the joy. You can't selectively shut down. Feeling is the price of being alive.";
  }
  
  // Generic but meaningful fallbacks
  let fallbacks=[
    "This pattern keeps showing up for a reason. It's asking to be seen.",
    "The things we recognize fastest are often the things we've lived longest.",
    "Awareness is the first step. You just took it.",
    "What you notice in others often lives in you too. That's not judgment. That's recognition.",
    "This insight found you. Now what will you do with it?"
  ];
  return fallbacks[Math.floor(Math.random()*fallbacks.length)];
}

function saveDeepestInsight(){
  if(currentDeepestInsight){
    if(!data.favoriteInsights)data.favoriteInsights=[];
    if(!data.favoriteInsights.includes(currentDeepestInsight)){
      data.favoriteInsights.push(currentDeepestInsight);
      save();
      showToast('❤️ Saved to favorites!');
    }else{
      showToast('Already saved!');
    }
  }
}

function shareDeepestInsight(){
  if(currentDeepestInsight){
    let shareText='"'+currentDeepestInsight+'"\n\nWhat pattern is running YOUR life?\n100levelup.com';
    if(navigator.share){
      navigator.share({title:'My Pattern',text:shareText,url:'https://100levelup.com'});
    }else{
      navigator.clipboard.writeText(shareText);
      showToast('📋 Copied to clipboard!');
    }
  }
}

document.getElementById('homeBtn').onclick=function(){game.mode=null;game.scenarios=[];game.answers=[];game.idx=0;game.endlessMode=false;game.sessionXP=0;game.sessionInsights=0;game.sessionGames=0;document.getElementById('results').classList.remove('active');document.getElementById('home').classList.remove('hidden');updateHome()};

// Keep Playing button - continue same mode with 10 more questions
document.getElementById('keepPlayingBtn').onclick=function(){
  document.getElementById('results').classList.remove('active');
  let lf=game.levelFilter;
  let currentMode=game.mode;
  // Keep session stats running
  if(currentMode==='mirror'){
    startMirrorGame(lf);
  }else if(currentMode==='agreement'){
    startAgreementGame(lf);
  }else if(currentMode==='mixed'){
    startMixedGame(lf);
  }
};

// Endless Mode button - sets endless mode and restarts
document.getElementById('endlessModeBtn').onclick=function(){
  game.endlessMode=true;
  document.getElementById('results').classList.remove('active');
  let lf=game.levelFilter;
  let currentMode=game.mode;
  showToast('♾️ Endless Mode activated!');
  if(currentMode==='mirror'){
    startMirrorGame(lf);
  }else if(currentMode==='agreement'){
    startAgreementGame(lf);
  }else if(currentMode==='mixed'){
    startMixedGame(lf);
  }
};
document.getElementById('quitBtn').onclick=function(){if(game.timer)clearInterval(game.timer);game.mode=null;game.scenarios=[];game.answers=[];game.idx=0;game.endlessMode=false;game.sessionXP=0;game.sessionInsights=0;game.sessionGames=0;document.getElementById('game').classList.remove('active');document.getElementById('feedbackModal').classList.remove('active');document.getElementById('home').classList.remove('hidden');updateHome()};
document.getElementById('musicBtn').onclick=toggleMusic;
document.getElementById('gameMusicToggle').onclick=toggleMusic;
function toggleMusic(){
  let musicBtn=document.getElementById('musicBtn');
  let gameMusicBtn=document.getElementById('gameMusicToggle');
  let introMusic=document.getElementById('introMusic');
  let isInHook=!document.getElementById('hook').classList.contains('hidden');
  if(musicOn){
    music.pause();
    introMusic.pause();
    musicOn=false;
    if(musicBtn)musicBtn.classList.remove('on');
    if(gameMusicBtn)gameMusicBtn.classList.remove('on');
  }else{
    // Play appropriate track based on where user is
    let trackToPlay=isInHook?introMusic:music;
    trackToPlay.play().then(()=>{
      musicOn=true;
      if(musicBtn)musicBtn.classList.add('on');
      if(gameMusicBtn)gameMusicBtn.classList.add('on');
    }).catch(()=>{});
  }
}
// Quick Mode toggle moved to FAQ section
document.getElementById('qaBtn').onclick=function(){if(tourActive)return;document.getElementById('qaModal').classList.add('active')};

document.getElementById('aiBtn').onclick=function(){if(tourActive)return;showAIAnalysis()};

document.getElementById('founderBtn').onclick=function(){if(tourActive)return;document.getElementById('founderModal').classList.add('active')};


// Logo click - Rate the app in App Store / Play Store
document.getElementById('logoRateBtn').onclick=function(){
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  const isAndroid = /Android/.test(navigator.userAgent);
  if(isIOS) {
    window.open('https://apps.apple.com/app/id6757724858?action=write-review', '_blank');
  } else if(isAndroid) {
    // Google Play not live yet - show message
    showToast('Google Play coming soon! 🚀');
  } else {
    // Default to iOS App Store for desktop users
    window.open('https://apps.apple.com/app/id6757724858?action=write-review', '_blank');
  }
  haptic('light');
};

document.getElementById('archetypeClose').onclick=function(){document.getElementById('archetypeModal').classList.remove('active')};

// Backdrop click to close modals
document.querySelectorAll('.modal').forEach(function(m){m.addEventListener('click',function(e){if(e.target===m)m.classList.remove('active')})});

// Scroll-to-top buttons for long modals
document.querySelectorAll('.modal-content').forEach(function(mc){
  var btn=document.createElement('button');
  btn.className='modal-scroll-top';
  btn.innerHTML='⬆';
  btn.title='Back to top';
  btn.onclick=function(e){e.stopPropagation();mc.scrollTo({top:0,behavior:'smooth'})};
  mc.appendChild(btn);
  mc.addEventListener('scroll',function(){
    if(mc.scrollTop>300)btn.classList.add('show');
    else btn.classList.remove('show');
  });
});
document.getElementById('resetBtn').onclick=function(){document.getElementById('qaModal').classList.remove('active');document.getElementById('resetModal').classList.add('active')};
document.getElementById('resetCancel').onclick=function(){document.getElementById('resetModal').classList.remove('active')};
document.getElementById('resetConfirm').onclick=async function(){
  // Clear localStorage
  localStorage.removeItem('levelup_v7');
  localStorage.removeItem('installDismissed');
  sessionStorage.clear();
  
  // Clear service worker cache for fresh start
  if ('caches' in window) {
    const cacheNames = await caches.keys();
    await Promise.all(cacheNames.map(name => caches.delete(name)));
  }
  
  // Unregister service worker
  if ('serviceWorker' in navigator) {
    const registrations = await navigator.serviceWorker.getRegistrations();
    await Promise.all(registrations.map(reg => reg.unregister()));
  }
  
  // Reset data
  data={xp:0,level:1,coins:0,games:0,mirrorRecognized:0,mirrorTotal:0,agreementAccepted:0,agreementTotal:0,streak:0,lastDaily:null,lastLogin:null,loginDay:0,unlockedLevels:[1],unlockedAgreement:false,seenIntro:false,insightsCollection:[],newlyUnlockedLevels:[],seenAgreementUnlock:false};
  save();
  document.getElementById('resetModal').classList.remove('active');
  showToast('✨ Fresh start! Reloading...');
  
  // Hard reload to get fresh files
  setTimeout(() => location.reload(true), 1000);
};
document.querySelectorAll('.qa-question').forEach(q=>{q.onclick=function(){this.parentElement.classList.toggle('open')}});
document.getElementById('dailyCard').onclick=function(){if(tourActive)return;if(!this.classList.contains('done'))startDecisionGame()};
document.getElementById('mirrorMode').onclick=()=>{if(tourActive)return;startMirrorGame()};
document.getElementById('agreementMode').onclick=function(){if(tourActive)return;if(data.unlockedAgreement){data.seenAgreementUnlock=true;save();document.getElementById('agreementMode').classList.remove('newly-unlocked');startAgreementGame();}};
// shareBtn removed - replaced with Join Our Team button
// document.getElementById('resultsShare').onclick=shareGame; // Removed - using new share grid
document.getElementById('insightsStat').onclick=function(){if(tourActive)return;showInsightsModal(null)};


document.getElementById('levelMirrorBtn').onclick=function(){document.getElementById('levelSelectModal').classList.remove('active');startMirrorGame(selectedLevel.id)};
document.getElementById('levelAgreementBtn').onclick=function(){if(data.unlockedAgreement){document.getElementById('levelSelectModal').classList.remove('active');startAgreementGame(selectedLevel.id)}};
document.getElementById('levelMixedBtn').onclick=function(){if(data.unlockedAgreement){document.getElementById('levelSelectModal').classList.remove('active');startMixedGame(selectedLevel.id)}};
document.getElementById('levelInsightsBtn').onclick=function(){document.getElementById('levelSelectModal').classList.remove('active');showInsightsModal(selectedLevel.id)};

function startMixedGame(levelFilter){
  game.mode='mixed';game.idx=0;game.answers=[];game.useTimer=true;game.timerDuration=18;game.levelFilter=levelFilter||null;currentCombo=0;
  if(!game.endlessMode){game.sessionXP=0;game.sessionInsights=0;game.sessionGames=0;}
  game.sessionGames++;
  let mirrorPool=levelFilter?MIRROR_SCENARIOS.filter(s=>s.level===levelFilter):MIRROR_SCENARIOS.filter(s=>data.unlockedLevels.includes(s.level)||hasLevelPass(s.level));
  let agreePool=levelFilter&&typeof DECISION_SCENARIOS!=='undefined'?DECISION_SCENARIOS.filter(s=>s.level===levelFilter):typeof DECISION_SCENARIOS!=='undefined'?DECISION_SCENARIOS.filter(s=>data.unlockedLevels.includes(s.level)):[];
  let decisionPool=[];
  if(typeof window.SCENARIOS!=='undefined'){
    if(levelFilter&&window.SCENARIOS[levelFilter]){decisionPool=window.SCENARIOS[levelFilter]}
    else{data.unlockedLevels.forEach(lvl=>{if(window.SCENARIOS[lvl])decisionPool=decisionPool.concat(window.SCENARIOS[lvl].map(s=>({...s,level:lvl})))})}
  }
  let combined=[];
  let mirrorCount=game.endlessMode?12:7;
  let agreeCount=game.endlessMode?8:5;
  let decisionCount=game.endlessMode?5:3;
  shuffle(mirrorPool).slice(0,mirrorCount).forEach(s=>combined.push({...s,gameType:'mirror'}));
  shuffle(agreePool).slice(0,agreeCount).forEach(s=>combined.push({...s,gameType:'agreement'}));
  shuffle(decisionPool).slice(0,decisionCount).forEach(s=>combined.push({...s,gameType:'decision',level:s.level||levelFilter||1}));
  let totalCount=game.endlessMode?25:15;
  game.scenarios=shuffle(combined).slice(0,totalCount);
  if(game.scenarios.length===0){showToast('No scenarios available!');return}
  document.getElementById('home').classList.add('hidden');document.getElementById('game').classList.add('active');
  document.getElementById('gameMode').textContent=game.endlessMode?'♾️ Mixed (Endless)':'Mixed';document.getElementById('timerBar').classList.remove('hidden');
  showMixedScenario();
}

function showMixedScenario(){
  let s=game.scenarios[game.idx];if(!s){endGame();return}
  document.getElementById('gameProgress').textContent=(game.idx+1)+'/'+game.scenarios.length;
  let lv=LEVELS.find(l=>l.id===s.level);
  let scenarioEl=document.getElementById('scenarioText');
  if(s.gameType==='mirror'){
    document.getElementById('scenarioCat').textContent='🪞 Level '+s.level+': '+(lv?lv.name:'');
    scenarioEl.textContent=truncateText(s.text);scenarioEl.classList.remove('loading');
    let c=document.getElementById('choices');c.innerHTML='';
    [{text:"That's Me",value:true},{text:"That's Not Me",value:false}].forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=typeof t==='function'?(ch.value?t("That's Me"):t('Not Me')):ch.text;b.onclick=()=>selectMixedMirror(ch,b,s);c.appendChild(b)});
  }else if(s.gameType==='agreement'){
    document.getElementById('scenarioCat').textContent='⚖️ Level '+s.level+': '+(lv?lv.name:'');
    scenarioEl.textContent=truncateText(s.scenario);scenarioEl.classList.remove('loading');
    let c=document.getElementById('choices');c.innerHTML='';
    shuffle(s.choices).forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=ch.text;b.onclick=()=>selectMixedAgreement(ch,b,s);c.appendChild(b)});
    if(game.useTimer)startTimer();
  }else if(s.gameType==='decision'){
    document.getElementById('scenarioCat').textContent='🎯 Level '+s.level+': '+(lv?lv.name:'');
    scenarioEl.textContent=truncateText(s.text);scenarioEl.classList.remove('loading');
    let c=document.getElementById('choices');c.innerHTML='';
    shuffle(s.choices).forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=ch.text;b.onclick=()=>selectMixedDecision(ch,b,s);c.appendChild(b)});
    if(game.useTimer)startTimer();
  }
}

function selectMixedMirror(ch,btn,sc){
  document.querySelectorAll('.choice').forEach(b=>{b.disabled=true;if(b!==btn)b.classList.add('dim-neutral')});
  btn.classList.add('selected-mirror');
  game.answers.push({recognized:ch.value,insight:sc.insight,text:sc.text,level:sc.level});
  addInsight(sc.insight,sc.level);
  // Mirror mode: no combos (no right/wrong answer), reduced XP
  data.mirrorTotal++;if(ch.value)data.mirrorRecognized++;positiveSound();coinSound();addXP(15, 'Mirror Game');maybeBonus();save();
  setTimeout(()=>{document.getElementById('fbIcon').textContent='💡';document.getElementById('fbIcon').style.color='var(--pink)';document.getElementById('fbTitle').textContent='Reflection';document.getElementById('fbLabel').textContent=ch.value?'🪞 That\'s Me':'🪞 Not Me';document.getElementById('fbText').innerHTML='<div style="font-size:14px;margin-bottom:10px;color:var(--text);">"'+sc.text+'"</div><div style="font-size:13px;color:var(--muted);font-style:italic;">'+sc.insight+'</div>';document.getElementById('feedbackModal').classList.add('active')},400);
}

function selectMixedAgreement(ch,btn,sc){
  if(game.timer)clearInterval(game.timer);document.querySelectorAll('.choice').forEach(b=>b.disabled=true);
  let isAcc=ch.type==='acceptance';game.answers.push({type:ch.type,isAcceptance:isAcc,insight:ch.insight,level:sc.level,gameType:'agreement'});
  if(isAcc){btn.classList.add('correct');data.agreementAccepted++;positiveSound();multiCoinSound(2);addXP(10, 'Agreement Game');addInsight(ch.insight,sc.level);addCombo()}
  else{btn.classList.add('wrong');let acc=sc.choices.find(c=>c.type==='acceptance');document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===acc.text)b.classList.add('correct');else if(b!==btn)b.classList.add('dim')});neutralSound();addXP(2, 'Partial Credit');resetCombo()}
  data.agreementTotal++;maybeBonus();
  setTimeout(()=>{document.getElementById('fbIcon').textContent=isAcc?'✓':'⚖️';document.getElementById('fbIcon').style.color=isAcc?'var(--green)':'var(--yellow)';document.getElementById('fbTitle').textContent=isAcc?'Acceptance':'Judgment';document.getElementById('fbLabel').textContent=isAcc?'Why this works':'Learning opportunity';document.getElementById('fbText').textContent=ch.insight;document.getElementById('feedbackModal').classList.add('active')},500);
}

function selectMixedDecision(ch,btn,sc){
  if(game.timer)clearInterval(game.timer);document.querySelectorAll('.choice').forEach(b=>b.disabled=true);
  let isCorr=ch.correct===true;game.answers.push({correct:isCorr,feedback:ch.fb,text:sc.text,level:sc.level,gameType:'decision'});
  if(isCorr){btn.classList.add('correct');positiveSound();multiCoinSound(3);addXP(12, 'Mixed Mode');addInsight(ch.fb,sc.level);addCombo()}
  else{btn.classList.add('wrong');let corr=sc.choices.find(c=>c.correct===true);document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===corr.text)b.classList.add('correct');else if(b!==btn)b.classList.add('dim')});neutralSound();addXP(2, 'Partial Credit');resetCombo()}
  maybeBonus();
  setTimeout(()=>{document.getElementById('fbIcon').textContent=isCorr?'✓':'💡';document.getElementById('fbIcon').style.color=isCorr?'var(--green)':'var(--yellow)';document.getElementById('fbTitle').textContent=isCorr?'Correct!':'Not Quite';document.getElementById('fbLabel').textContent='Insight';document.getElementById('fbText').textContent=ch.fb;document.getElementById('feedbackModal').classList.add('active')},500);
}

function showInsightsModal(filterLevel){
  let filter=document.getElementById('insightsFilter');
  // Add favorites filter
  let hasFavorites=data.favoriteInsights&&data.favoriteInsights.length>0;
  filter.innerHTML='<button style="padding:6px 12px;border-radius:20px;border:none;font-size:12px;font-weight:600;cursor:pointer;background:'+(filterLevel===null?'var(--pink)':'var(--card)')+';color:'+(filterLevel===null?'#fff':'var(--muted)')+';" onclick="showInsightsModal(null)">All</button>';
  if(hasFavorites){
    filter.innerHTML+='<button style="padding:6px 12px;border-radius:20px;border:none;font-size:12px;font-weight:600;cursor:pointer;background:'+(filterLevel==='favorites'?'var(--gold)':'var(--card)')+';color:'+(filterLevel==='favorites'?'#000':'var(--muted)')+';" onclick="showInsightsModal(\'favorites\')">⭐ Favorites</button>';
  }
  LEVELS.forEach(lv=>{
    let hasInsights=data.insightsCollection&&data.insightsCollection.some(i=>i.level===lv.id);
    if(hasInsights){
      filter.innerHTML+='<button style="padding:6px 12px;border-radius:20px;border:none;font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:6px;background:'+(filterLevel===lv.id?'var(--pink)':'var(--card)')+';color:'+(filterLevel===lv.id?'#fff':'var(--muted)')+';" onclick="showInsightsModal('+lv.id+')"><span style="width:10px;height:10px;border-radius:50%;background:'+lv.color+';"></span>'+lv.name+'</button>';
    }
  });
  let list=document.getElementById('insightsListModal');
  list.innerHTML='';
  if(!data.insightsCollection||data.insightsCollection.length===0){
    list.innerHTML='<p style="color:var(--muted);text-align:center;padding:20px;">No insights yet. Play Mirror Game or Worldwide Challenge to start collecting insights!</p>';
  }else{
    let filtered;
    if(filterLevel==='favorites'){
      filtered=data.insightsCollection.filter(i=>data.favoriteInsights.includes(i.text));
    }else{
      filtered=filterLevel===null?data.insightsCollection:data.insightsCollection.filter(i=>i.level===filterLevel);
    }
    filtered.slice().reverse().forEach((insight,idx)=>{
      let lv=LEVELS.find(l=>l.id===insight.level)||{color:'#888',name:'Unknown'};
      let isFav=data.favoriteInsights&&data.favoriteInsights.includes(insight.text);
      let div=document.createElement('div');
      div.style.cssText='background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;margin-bottom:10px;position:relative;';
      div.innerHTML='<button onclick="toggleFavoriteInsight(\''+btoa(encodeURIComponent(insight.text))+'\')" style="position:absolute;top:10px;right:10px;background:none;border:none;font-size:18px;cursor:pointer;opacity:'+(isFav?'1':'0.4')+';transition:all 0.2s;">'+(isFav?'⭐':'☆')+'</button><div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;padding-right:30px;"><span style="width:10px;height:10px;border-radius:50%;background:'+lv.color+';"></span><span style="font-size:12px;color:var(--muted);">Level '+insight.level+': '+lv.name+(insight.date?' • '+insight.date:'')+'</span></div><div style="font-size:14px;color:var(--text);padding-right:30px;">'+insight.text+'</div>';
      list.appendChild(div);
    });
  }
  document.getElementById('insightsModal').classList.add('active');
}

function toggleFavoriteInsight(encodedText){
  let text=decodeURIComponent(atob(encodedText));
  if(!data.favoriteInsights)data.favoriteInsights=[];
  let idx=data.favoriteInsights.indexOf(text);
  if(idx>-1){
    data.favoriteInsights.splice(idx,1);
    haptic('light');
  }else{
    data.favoriteInsights.push(text);
    haptic('medium');
    showToast('⭐ Added to favorites!');
  }
  save();
  // Refresh the modal
  let currentFilter=document.querySelector('#insightsFilter button[style*="var(--pink)"]')||document.querySelector('#insightsFilter button[style*="var(--gold)"]');
  let filterVal=null;
  if(currentFilter){
    if(currentFilter.textContent.includes('Favorites'))filterVal='favorites';
    else if(currentFilter.textContent!=='All'){
      let lvName=currentFilter.textContent.trim();
      let lv=LEVELS.find(l=>l.name===lvName);
      if(lv)filterVal=lv.id;
    }
  }
  showInsightsModal(filterVal);
}

// PWA Install Logic
let deferredPrompt=null;
let installDismissed=localStorage.getItem('installDismissed');
let isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent);
let isInStandaloneMode=window.matchMedia('(display-mode: standalone)').matches||window.navigator.standalone||document.referrer.includes('android-app://')||window.matchMedia('(display-mode: fullscreen)').matches;

function showInstallBanner(){
  if(isInStandaloneMode||installDismissed)return;
  setTimeout(()=>{document.getElementById('installBanner').classList.add('show')},3000);
}

window.addEventListener('beforeinstallprompt',(e)=>{
  e.preventDefault();
  deferredPrompt=e;
  showInstallBanner();
});

document.getElementById('installBtn').onclick=function(){
  if(isIOS){
    document.getElementById('installBanner').classList.remove('show');
    document.getElementById('iosModal').classList.add('active');
  }else if(deferredPrompt){
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then((result)=>{
      if(result.outcome==='accepted'){showToast('🎉 Added to Home Screen!')}
      deferredPrompt=null;
      document.getElementById('installBanner').classList.remove('show');
    });
  }
};

document.getElementById('installClose').onclick=function(){
  document.getElementById('installBanner').classList.remove('show');
  localStorage.setItem('installDismissed','true');
};

document.getElementById('iosClose').onclick=function(){
  document.getElementById('iosModal').classList.remove('active');
  localStorage.setItem('installDismissed','true');
};

// Show install banner for iOS after a delay
if(isIOS&&!isInStandaloneMode&&!installDismissed){
  showInstallBanner();
}

// Scroll to top button logic
window.addEventListener('scroll',function(){
  let btn=document.getElementById('scrollTopBtn');
  if(window.scrollY>400){btn.classList.add('show')}
  else{btn.classList.remove('show')}
});

// Offline detection
function updateOnlineStatus() {
  const badge = document.getElementById('offlineBadge');
  if (!navigator.onLine) {
    badge.classList.add('show');
  } else {
    badge.classList.remove('show');
  }
}
window.addEventListener('online', updateOnlineStatus);
window.addEventListener('offline', updateOnlineStatus);
updateOnlineStatus();

// Service Worker Registration
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then(reg => {})
      .catch(err => {});
  });
}

// Fresh UI reset on app load - closes modals, resets temporary states, keeps game data
function freshUIReset() {
  // Close all modals and remove body scroll lock
  document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
  // removed
  
  // Reset game session state
  if (typeof game !== 'undefined') {
    game.mode = null;
    game.scenarios = [];
    game.answers = [];
    game.idx = 0;
    game.endlessMode = false;
    game.sessionXP = 0;
    game.sessionInsights = 0;
    game.sessionGames = 0;
  }
  
  // Hide game/results screens, show home
  document.getElementById('game').classList.remove('active');
  document.getElementById('results').classList.remove('active');
  
  // Reset any expanded FAQ items
  document.querySelectorAll('.qa-item.open').forEach(item => item.classList.remove('open'));
  
  // Reset any selected onboarding items (but keep data)
  document.querySelectorAll('.recognition-item.selected').forEach(el => el.classList.remove('selected'));
  document.querySelectorAll('.voice-option.selected').forEach(el => el.classList.remove('selected'));
  
  // Clear any validation hints
  const recHint = document.getElementById('recognitionHint');
  const voiceHint = document.getElementById('voiceHint');
  if (recHint) recHint.classList.remove('show');
  if (voiceHint) voiceHint.classList.remove('show');
  
  // Reset combo display
  const comboDisplay = document.getElementById('comboDisplay');
  if (comboDisplay) comboDisplay.classList.remove('show');
  
  // Reset any popups
  const bonusPopup = document.getElementById('bonusPopup');
  const levelupPopup = document.getElementById('levelupPopup');
  if (bonusPopup) bonusPopup.classList.remove('show');
  if (levelupPopup) levelupPopup.classList.remove('show');
  
  // Fresh UI reset complete
}

// Run fresh reset on load
freshUIReset();

// Initialize app with error handling
try {
  if(data.seenIntro){document.getElementById('hook').classList.add('hidden');updateHome();showWelcomeBack();}else{showHook()}
  setInterval(updateTimer,1000);
  initBreakthroughExercises();
} catch(e) {
  console.error('Initialization error:', e);
}

// ========== WELCOME BACK - Session Progress Visibility ==========
function showWelcomeBack(){
  if(!data.seenIntro||data.games<3)return;
  let lastLogin=data.lastLogin;
  let today=new Date().toDateString();
  if(lastLogin===today)return; // Already seen today
  data.lastLogin=today;save();
  
  // Build welcome message
  let seen=data.seenScenarios;
  let totalSeen=(seen.mirror?seen.mirror.length:0)+(seen.agreement?seen.agreement.length:0)+(seen.decision?seen.decision.length:0);
  let topPatterns=[];
  if(data.insightsCollection&&data.insightsCollection.length>0){
    // Find most common level in recent insights
    let levelCounts={};
    data.insightsCollection.slice(-20).forEach(ins=>{
      let lv=ins.level||1;
      levelCounts[lv]=(levelCounts[lv]||0)+1;
    });
    let topLevel=Object.entries(levelCounts).sort((a,b)=>b[1]-a[1])[0];
    if(topLevel){
      let levelNames={1:'Self',2:'Family',3:'Groups',4:'Community',5:'Society',6:'World',7:'Generations'};
      topPatterns.push(levelNames[topLevel[0]]||'Level '+topLevel[0]);
    }
  }
  
  let msg='<div style="text-align:center;padding:4px 0;">';
  msg+='<div style="font-size:14px;color:var(--gold);font-weight:700;margin-bottom:6px;">Welcome Back</div>';
  msg+='<div style="font-size:12px;color:var(--text-secondary);line-height:1.5;">';
  msg+=data.games+' games played · '+totalSeen+' scenarios explored';
  if(data.streak>1)msg+=' · '+data.streak+' day streak 🔥';
  if(topPatterns.length>0)msg+='<br>Your patterns are clustering around <span style="color:var(--cyan);font-weight:600;">'+topPatterns[0]+'</span>';
  msg+='</div></div>';
  
  showToast(msg,4500);
}

// ========== EXERCISE SURFACING - Show relevant exercise after pattern detection ==========
function surfaceExercise(answers){
  if(!answers||answers.length<3)return'';
  
  // Detect patterns in this game session
  let boundaryCount=0,selfCriticCount=0,relationshipCount=0,forgiveCount=0;
  answers.forEach(a=>{
    let txt=(a.text||a.insight||'').toLowerCase();
    if(txt.includes('boundar')||txt.includes('say no')||txt.includes('people-pleas')||txt.includes('yes when'))boundaryCount++;
    if(txt.includes('not enough')||txt.includes('failure')||txt.includes('broken')||txt.includes('wrong with me')||txt.includes('self-worth'))selfCriticCount++;
    if(txt.includes('relationship')||txt.includes('partner')||txt.includes('family')||txt.includes('parent'))relationshipCount++;
    if(txt.includes('resent')||txt.includes('forgiv')||txt.includes('grudge')||txt.includes('let go'))forgiveCount++;
  });
  
  let exercise=null;
  if(selfCriticCount>=2)exercise={name:'Daily Check-In',icon:'📝',tip:'You recognized self-critical patterns. The Daily Check-In exercise helps rewrite that inner voice.'};
  else if(boundaryCount>=2)exercise={name:'Have To → Get To → Blessed To',icon:'🔄',tip:'Boundary patterns showed up. This reframe exercise shifts obligation into choice.'};
  else if(forgiveCount>=2)exercise={name:'Forgiveness Letter',icon:'💌',tip:'Resentment patterns are active. The Forgiveness Letter isn\'t for them. It\'s for you.'};
  else if(relationshipCount>=3)exercise={name:'Blessings Letter',icon:'🙏',tip:'Relationship patterns emerged. The Blessings Letter helps you see what\'s working, not just what\'s broken.'};
  
  if(!exercise)return'';
  
  return '<div style="background:linear-gradient(135deg,rgba(255,87,34,0.12),rgba(255,87,34,0.04));border:1px solid rgba(255,87,34,0.3);border-radius:12px;padding:14px;margin-top:12px;text-align:left;cursor:pointer;" onclick="document.getElementById(\'results\').classList.remove(\'active\');document.getElementById(\'home\').classList.remove(\'hidden\');updateHome();document.getElementById(\'breakthroughModal\').classList.add(\'active\');">'
    +'<div style="font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--orange);font-weight:700;margin-bottom:6px;">'+exercise.icon+' Suggested Exercise</div>'
    +'<div style="font-size:14px;font-weight:700;color:var(--text);margin-bottom:4px;">'+exercise.name+'</div>'
    +'<div style="font-size:12px;color:var(--text-secondary);line-height:1.5;">'+exercise.tip+'</div>'
    +'</div>';
}

// ========== COACHING BRIDGE - Suggest coach when deep patterns emerge ==========
function coachingBridge(answers){
  if(!answers||answers.length<4||data.games<5)return'';
  
  // Only show coaching bridge occasionally (not every game)
  if(data.games%3!==0)return'';
  
  let patternCount=0;
  answers.forEach(a=>{
    let txt=(a.text||a.insight||'').toLowerCase();
    if(txt.includes('pattern')||txt.includes('always')||txt.includes('never')||txt.includes('cycle')||txt.includes('keep doing'))patternCount++;
  });
  
  if(patternCount<2)return'';
  
  return '<div style="background:linear-gradient(135deg,rgba(120,75,160,0.12),rgba(255,60,172,0.08));border:1px solid rgba(120,75,160,0.3);border-radius:12px;padding:14px;margin-top:12px;text-align:left;cursor:pointer;" onclick="document.getElementById(\'results\').classList.remove(\'active\');document.getElementById(\'home\').classList.remove(\'hidden\');updateHome();document.getElementById(\'coachingModal\').classList.add(\'active\');">'
    +'<div style="font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--purple);font-weight:700;margin-bottom:6px;">💬 Patterns Detected</div>'
    +'<div style="font-size:13px;color:var(--text-secondary);line-height:1.5;">You\'re recognizing cycles. A coach can help you break them. Sessions start at $100.</div>'
    +'</div>';
}

// ========== LANGUAGE SYSTEM ==========
var currentLang = localStorage.getItem('levelup_lang') || 'en';

// ── Dutch (Nederlands) UI Translation Dictionary ──
var TRANSLATIONS = {
  nl: {
    // ─── Hook / Intro Screens ───
    'See the patterns': 'Zie de patronen',
    'that quietly run<br>your life.': 'die stilletjes je<br>leven bepalen.',
    'Discover why you keep repeating<br>the same mistakes.': 'Ontdek waarom je steeds dezelfde<br>fouten blijft maken.',
    'Prove it': 'Bewijs het',
    'As Seen On': 'o.a. gezien op',
    'Have you ever<br>felt like...': 'Heb je ooit<br>het gevoel gehad dat\u2026',
    'Select all that feel true': 'Selecteer alles wat voor jou als waarheid aanvoelt',
    "You're successful on paper, but something essential is missing?": 'Op papier ben je succesvol, maar er ontbreekt iets essentieels?',
    "You've tried everything, but the same patterns keep repeating?": 'Je hebt alles geprobeerd, maar dezelfde patronen herhalen zich steeds?',
    "You're great at helping others, but can't seem to help yourself?": 'Je bent geweldig in het helpen van anderen, maar kunt jezelf maar niet helpen?',
    'There has to be more to life than this?': 'Er moet toch meer in het leven zijn dan dit?',
    "Everyone thinks you're doing great... but you're dying inside?": 'Iedereen denkt dat het geweldig met je gaat\u2026 maar vanbinnen ga je kapot?',
    'Continue': 'Doorgaan',
    'Please select at least one': 'Selecteer er minstens een',
    'Do you ever<br>ask yourself...': 'Vraag je jezelf<br>wel eens af\u2026',
    'Select all that resonate with you': 'Selecteer alles wat jou aanspreekt',
    '"Why am I not enough, no matter how much I achieve?"': '"Waarom ben ik niet goed genoeg, hoeveel ik ook bereik?"',
    '"Why do I feel so alone, even when surrounded by people?"': '"Waarom voel ik me zo alleen, zelfs als ik omringd ben door mensen?"',
    '"What\'s the point of all this success if I\'m still unhappy?"': '"Wat heeft al dit succes voor zin als ik nog steeds ongelukkig ben?"',
    '"When will I finally feel like I\'ve made it?"': '"Wanneer zal ik eindelijk het gevoel hebben dat ik het gemaakt heb?"',
    '"Is this really all there is?"': '"Is dit werkelijk alles wat er is?"',
    'Back': 'Terug',
    "This isn't a flaw.": 'Dit is geen tekortkoming.',
    "It's a signal you're solving the problem at the wrong level.": 'Het is een teken dat je het probleem op het verkeerde niveau aanpakt.',
    'Tap each level to learn more:': 'Tik op elk niveau om meer te weten te komen:',
    'The game shows you which level your pattern lives on, so you can finally change it.': 'Het spel laat je zien op welk niveau je patroon zich bevindt, zodat je het eindelijk kunt veranderen.',
    'See My Pattern': 'Zie mijn patroon',

    // ─── 7 Level Names & Descriptions ───
    'Individual': 'Individueel',
    'Self for yourself': 'Zelf tot jezelf',
    'Family': 'Familie',
    'Your created or immediate family': 'Je zelfgekozen of directe familie',
    'Groups': 'Groepen',
    'Extended family, friends, coworkers': 'Uitgebreide familie, vrienden, collega\'s',
    'Community': 'Gemeenschap',
    'Activities and events': 'Activiteiten en evenementen',
    'Society': 'Samenleving',
    'Nation & systems': 'Land & systemen',
    'World': 'Wereld',
    'Global stage': 'Wereldpodium',
    'Global stage, politics, humanity': 'Wereldpodium, politiek, mensheid',
    'Generations': 'Generaties',
    'Those before you and after': 'Degenen die voor je kwamen en na je komen',

    // ─── Level Detail Descriptions ───
    'Self for yourself: your feelings, your life, your beliefs, your needs, your wants. Before you can show up for anyone else, you have to show up for yourself. This means having non-negotiables, things you do for yourself every day, no matter what. It\'s not selfish. It\'s required. If this level isn\'t solid, everything above it is unstable.': 'Zelf tot jezelf \u2013 je gevoelens, je leven, je overtuigingen, je behoeften, je verlangens. Voordat je er voor iemand anders kunt zijn, moet je er voor jezelf zijn. Dit betekent dat je niet-onderhandelbare dingen hebt \u2014 dingen die je elke dag voor jezelf doet, wat er ook gebeurt. Het is niet ego\u00efstisch. Het is noodzakelijk. Als dit niveau niet stabiel is, is alles daarboven instabiel.',
    'Self for family: either the family you were born into OR the family you have created (spouse, kids). If you\'ve created your own family, they become Level 2, and your family of origin moves to Level 3. These are the people who see you at your best and worst. You can\'t skip to community impact if things are incomplete here.': 'Zelf tot familie \u2013 ofwel het gezin waarin je geboren bent, OF het gezin dat je zelf hebt gecre\u00eberd (partner, kinderen). Als je je eigen gezin hebt gecre\u00eberd, zijn zij Niveau 2 en wordt je oorspronkelijke gezin Niveau 3. Dit zijn de mensen die je op je best en op je slechtst zien. Je kunt niet doorgaan naar impact in de gemeenschap als dit niveau incompleet voelt.',
    'Self for group: extended family members, friends, relatives, coworkers, and groups you belong to. If you\'ve created your own family, your parents and siblings now live here. The question: Are you being yourself, or performing a version of yourself to fit in, or hiding entirely? The first 3 levels represent 90% of everyday life.': 'Zelf tot groepen \u2013 uitgebreide familieleden, vrienden, kennissen, collega\u2019s en groepen waar je bij hoort. Als je je eigen familie hebt gecre\u00eberd, is dit het niveau waar je ouders en broers en zussen zijn. De vraag is: ben je jezelf, of speel je een versie van jezelf om erbij te horen \u2014 of verberg je jezelf volledig? De eerste drie niveaus vertegenwoordigen 90% van het dagelijkse leven.',
    'Self for community: mostly seen as activities, events, and classes of people you identify with: musicians, business people, athletes, artists, your industry. Where you belong beyond personal relationships. Do you have a role, and do you respect the roles of others?': 'Zelf tot de gemeenschap \u2013 meestal zichtbaar in de vorm van activiteiten, evenementen en groepen mensen waarmee je je identificeert: muzikanten, zakenmensen, sporters, kunstenaars, jouw branche. Waar hoor je thuis, los van je persoonlijke relaties? Heb je een rol, en respecteer je de rollen van anderen?',
    'Self for society: the people of your nation and its systems: government, economy, culture, laws. This level is about seeing reality clearly. Not what you wish was true. Not what you\'re fighting against. What actually is. You can\'t change what you won\'t first accept.': 'Zelf tot de samenleving \u2013 de mensen van je land en hun systemen: overheid, economie, cultuur, wetten. Op dit niveau gaat het om de realiteit helder zien. Niet wat je zou willen dat waar was. Niet waar je tegen vecht. Maar wat werkelijk is. Je kunt niet veranderen wat je niet eerst accepteert.',
    'Self for world: the global stage: international politics, global events, other nations, other cultures, humanity as a whole. How connected do you feel to what happens outside your borders? This isn\'t about being an activist. It\'s about recognizing you\'re part of something larger than your own life.': 'Zelf tot de wereld \u2013 het wereldpodium: internationale politiek, wereldwijde gebeurtenissen, andere landen, andere culturen, de mensheid als geheel. Hoe verbonden voel je je met wat er buiten je eigen landgrenzen gebeurt? Dit gaat niet over activisme. Het gaat erom te erkennen dat je deel uitmaakt van iets dat groter is dan je eigen leven.',
    'Self for generations: the people who came before you (ancestors) and those who will come after. This is legacy. What cycles did you inherit? What cycles will you break? What will you build that outlasts you? Legacy isn\'t always a building. Sometimes it\'s a pattern you refused to repeat.': 'Zelf tot generaties \u2013 de mensen die v\u00f3\u00f3r jou kwamen (voorouders) en degenen die na jou komen. Dit is je nalatenschap. Welke patronen heb je ge\u00ebrfd? Welke patronen zul je doorbreken? Wat zul je bouwen dat jou overleeft? Een nalatenschap is niet altijd iets bouwen. Soms is het een patroon dat je weigerde te herhalen.',

    // ─── Home Screen ───
    'See Your Patterns': 'Zie Je Patronen',
    'The game that reveals<br>what\'s really running your life.': 'Het spel dat onthult<br>wat je leven werkelijk bepaalt.',
    'TRENDING GLOBALLY': 'Wereldwijd Trending',
    'Worldwide Challenge': 'Wereldwijde Uitdaging',
    'Same 3 scenarios for everyone on Earth. One chance daily.': 'Dezelfde 3 scenario\'s voor iedereen op aarde. Een kans per dag.',
    'playing now': 'spelen nu',
    'Tap to join the global movement': 'Tik om mee te doen aan de wereldwijde beweging',
    'Resets in': 'Reset over',
    'Mirror Game': 'Spiegel Spel',
    'See yourself honestly': 'Zie jezelf eerlijk',
    'Agreement Game': 'Akkoord Spel',
    'Acceptance vs Judgment': 'Acceptatie vs Oordeel',
    'Level': 'Niveau',
    'coins': 'munten',
    'Played': 'Gespeeld',
    'Streak': 'Reeks',
    'Acceptance': 'Acceptatie',
    'Insights': 'Inzichten',
    'Your Pattern': 'Jouw Patroon',
    "Today's Practice": 'Oefening van Vandaag',
    'Tap for full profile': 'Tik voor volledig profiel',
    'Your Journey': 'Jouw Reis',
    'Breakthrough Work': 'Doorbraakwerk',
    'Join Our Team': 'Word Lid van Ons Team',
    'Learn the Full Framework': 'Leer het Volledige Raamwerk',
    'Get Coaching': 'Krijg Coaching',
    '1-on-1 Integration': '1-op-1 Integratie',
    'Built by': 'Gemaakt door',
    'on the framework he uses with founders, leaders, and clients worldwide.': 'op het raamwerk dat hij gebruikt met oprichters, leiders en clienten wereldwijd.',

    // ─── Game Screen ───
    'Mirror': 'Spiegel',
    'Agreement': 'Akkoord',
    'Loading...': 'Laden...',
    "That's Me": 'Dat Ben Ik',
    'Not Me': 'Niet Ik',

    // ─── Results Screen ───
    'Game Complete': 'Spel Voltooid',
    'Mirror Complete': 'Spiegel Voltooid',
    'Agreement Complete': 'Akkoord Voltooid',
    'Mixed Complete': 'Gemengd Voltooid',
    'Challenge Complete': 'Uitdaging Voltooid',
    'This session': 'Deze sessie',
    'Keep going!': 'Ga zo door!',
    'Reflections': 'Reflecties',
    'correct!': 'juist!',
    'Great job!': 'Goed gedaan!',
    'Questions': 'Vragen',
    'Back to Home': 'Terug naar Start',
    'Keep Playing': 'Blijf Spelen',
    'Endless Mode': 'Eindeloze Modus',
    'Continue Endless': 'Ga Door Eindeloos',
    'WhatsApp': 'WhatsApp',
    'Twitter': 'Twitter',
    'Copy': 'Kopieren',
    'More': 'Meer',
    'Ready to break these patterns for good?': 'Klaar om deze patronen voorgoed te doorbreken?',

    // ─── Result Messages ───
    'High self-recognition. You see yourself clearly. That\'s rare and powerful.': 'Hoge zelfherkenning. Je ziet jezelf helder. Dat is zeldzaam en krachtig.',
    'Strong awareness. You\'re willing to look at what others avoid.': 'Sterk bewustzijn. Je bent bereid te kijken naar wat anderen vermijden.',
    'Selective recognition. Some patterns are easier to see than others.': 'Selectieve herkenning. Sommige patronen zijn makkelijker te zien dan andere.',
    'Low recognition. Either you\'re different, or there\'s a blind spot worth exploring.': 'Lage herkenning. Of je bent anders, of er is een blinde vlek die het verkennen waard is.',
    'Exceptional. You chose acceptance almost every time.': 'Uitzonderlijk. Je koos bijna elke keer voor acceptatie.',
    'Strong acceptance. You\'re rewiring your default response.': 'Sterke acceptatie. Je herprogrammeert je standaardreactie.',
    'Growing awareness. Notice when judgment feels safer.': 'Groeiend bewustzijn. Merk op wanneer oordelen veiliger voelt.',
    'Judgment is your current default. That\'s not wrong. It\'s information.': 'Oordelen is je huidige standaard. Dat is niet fout. Het is informatie.',

    // ─── Modals & Popups ───
    'Help & FAQ': 'Hulp & FAQ',
    'Achievement Unlocked!': 'Prestatie Ontgrendeld!',
    'Pattern Detected': 'Patroon Gedetecteerd',
    'This keeps showing up.': 'Dit blijft terugkomen.',
    'pattern appeared': 'patroon verscheen',
    'times recently': 'keer recentelijk',
    "You're seeing it clearly now.": 'Je ziet het nu duidelijk.',
    "That's the first step. But seeing a pattern and breaking it are two different things.": 'Dat is de eerste stap. Maar een patroon zien en het doorbreken zijn twee verschillende dingen.',
    "Most people can't break lifelong patterns alone. That's not weakness. It's how patterns work.": 'De meeste mensen kunnen levenslange patronen niet alleen doorbreken. Dat is geen zwakte. Zo werken patronen.',
    'Talk to Arthur': 'Praat met Arthur',
    'Keep Playing': 'Blijf Spelen',
    'Remind me later': 'Herinner me later',

    // ─── Stats & XP ───
    'Games Played': 'Gespeelde Spellen',
    'Daily Streak': 'Dagelijkse Reeks',
    'Acceptance Rate': 'Acceptatiegraad',
    'insights collected': 'inzichten verzameld',
    'scenarios explored': 'scenario\'s verkend',
    'Start your journey': 'Begin je reis',
    'Completed!': 'Voltooid!',
    'breakthroughs': 'doorbraken',
    'ON TRACK': 'OP SCHEMA',
    'CATCHING UP': 'INHALEN',
    'BEHIND': 'ACHTER',
    'Start': 'Beginnen',
    'Done!': 'Klaar!',

    // ─── Archetype Names ───
    'The Honest Avoider': 'De eerlijke Vermijder',
    'The Aware Procrastinator': 'De Bewuste Uitsteller',
    'The Peaceful Avoider': 'De Vredelievende Vermijder',
    'The Growth Seeker': 'De Groeizoeker',
    'The Aware One': 'De Bewuste',

    // ─── Pattern Card Reveal ───
    'Your Pattern': 'Jouw Patroon',
    '"You see yourself with unusual clarity — but seeing isn\'t doing."': '"Je ziet jezelf met een ongewone helderheid, maar zien is niet hetzelfde als doen."',
    "What's yours?": 'Wat is die van jou?',
    'Play the full game to go deeper.': 'Speel het volledige spel om dieper te gaan.',
    'Play the Game': 'Speel het Spel',
    'Share My Pattern': 'Deel mijn patroon',
    'Share Your Pattern': 'Deel je patroon',
    'Copy Link': 'Link kopi\u00ebren',
    'Start Playing': 'Begin met spelen',

    // ─── Welcome Messages ───
    'Keep it going!': 'Ga zo door!',
    'Welcome back!': 'Welkom terug!',
    'Good to see you!': 'Leuk je te zien!',

    // ─── Game Mode Labels (in-game) ───
    'Level 1: Individual': 'Niveau 1: Individueel',
    'Level 2: Family': 'Niveau 2: Familie',
    'Level 3: Groups': 'Niveau 3: Groepen',
    'Level 4: Community': 'Niveau 4: Gemeenschap',
    'Level 5: Society': 'Niveau 5: Samenleving',
    'Level 6: World': 'Niveau 6: Wereld',
    'Level 7: Generations': 'Niveau 7: Generaties',

    // ─── Misc UI ───
    'NEW': 'NIEUW',
    'Start Here': 'Begin Hier',
    'Play': 'Spelen',
    'Save': 'Opslaan',
    'Share': 'Delen',
    'Close': 'Sluiten',
    'Day': 'Dag',
    'XP': 'XP',
    'games': 'spellen',
    'new insights': 'nieuwe inzichten',
    'correct': 'juist',
    'Accepted': 'Geaccepteerd',
    'Judgment': 'Oordeel',
    'Correct': 'Juist',
    'Missed': 'Gemist',
    'Your Responses': 'Jouw Antwoorden',
    'Perfect!': 'Perfect!',
    'Loading scenarios... Please wait': 'Scenario\'s laden... Even geduld',
    "You're now Level": 'Je bent nu Niveau',
    'Completed Today': 'Vandaag Voltooid'
  },

  // ═══════════════════════════════════════════════
  // SPANISH (Español) — Translated by Roger Walter
  // ═══════════════════════════════════════════════
  es: {
    // ─── Hook / Intro Screens ───
    'See the patterns': 'Descubre los patrones',
    'that quietly run<br>your life.': 'que silenciosamente<br>dirigen tu vida.',
    'Discover why you keep repeating<br>the same mistakes.': 'Descubre por qu\u00e9 sigues repitiendo<br>los mismos errores.',
    'Prove it': 'Demuéstralo',
    'As Seen On': 'Visto en',
    'Have you ever<br>felt like...': '\u00bfAlguna vez has<br>sentido que\u2026',
    'Select all that feel true': 'Selecciona todo lo que sientas verdadero',
    "You're successful on paper, but something essential is missing?": '\u00bfEres exitoso/a en el papel, pero algo esencial falta?',
    "You've tried everything, but the same patterns keep repeating?": '\u00bfHas intentado todo, pero los mismos patrones se siguen repitiendo?',
    "You're great at helping others, but can't seem to help yourself?": '\u00bfEres genial ayudando a otros, pero no puedes ayudarte a ti mismo/a?',
    'There has to be more to life than this?': '\u00bfTiene que haber algo m\u00e1s en la vida que esto?',
    "Everyone thinks you're doing great... but you're dying inside?": '\u00bfTodos piensan que te va genial\u2026 pero por dentro te est\u00e1s muriendo?',
    'Continue': 'Continuar',
    'Please select at least one': 'Selecciona al menos una opci\u00f3n',
    'Do you ever<br>ask yourself...': '\u00bfAlguna vez te<br>preguntas\u2026',
    'Select all that resonate with you': 'Selecciona todo lo que resuene contigo',
    '"Why am I not enough, no matter how much I achieve?"': '"\u00bfPor qu\u00e9 no soy suficiente, sin importar cu\u00e1nto logre?"',
    '"Why do I feel so alone, even when surrounded by people?"': '"\u00bfPor qu\u00e9 me siento tan solo/a, incluso rodeado/a de gente?"',
    '"What\'s the point of all this success if I\'m still unhappy?"': '"\u00bfDe qu\u00e9 sirve todo este \u00e9xito si sigo siendo infeliz?"',
    '"When will I finally feel like I\'ve made it?"': '"\u00bfCu\u00e1ndo sentir\u00e9 por fin que lo logr\u00e9?"',
    '"Is this really all there is?"': '"\u00bfEsto es realmente todo lo que hay?"',
    'Back': 'Atr\u00e1s',
    "This isn't a flaw.": 'Esto no es un defecto.',
    "It's a signal you're solving the problem at the wrong level.": 'Es una se\u00f1al de que est\u00e1s resolviendo el problema en el nivel equivocado.',
    'Tap each level to learn more:': 'Toca cada nivel para saber m\u00e1s:',
    'The game shows you which level your pattern lives on, so you can finally change it.': 'El juego te muestra en qu\u00e9 nivel vive tu patr\u00f3n, para que finalmente puedas cambiarlo.',
    'See My Pattern': 'Ver mi patr\u00f3n',

    // ─── 7 Level Names & Descriptions (from Roger) ───
    'Individual': 'Individuo',
    'Self for yourself': 'El yo para ti mismo',
    'Family': 'Familia',
    'Your created or immediate family': 'Creada o de origen',
    'Groups': 'Grupos',
    'Extended family, friends, coworkers': 'Familiares, amigos, compa\u00f1eros de trabajo',
    'Community': 'Comunidad',
    'Activities and events': 'Actividades y eventos',
    'Society': 'Sociedad',
    'Nation & systems': 'Naci\u00f3n y sistemas',
    'World': 'Mundo',
    'Global stage': 'Escenario global',
    'Global stage, politics, humanity': 'Escenario global, pol\u00edtica, humanidad',
    'Generations': 'Generaciones',
    'Those before you and after': 'Antes y despu\u00e9s de ti',

    // ─── Level Detail Descriptions (from Roger FAQ) ───
    'Self for yourself: your feelings, your life, your beliefs, your needs, your wants. Before you can show up for anyone else, you have to show up for yourself. This means having non-negotiables, things you do for yourself every day, no matter what. It\'s not selfish. It\'s required. If this level isn\'t solid, everything above it is unstable.': 'El yo para uno mismo: tus sentimientos, tu vida, tus creencias, tus necesidades, tus deseos. Antes de poder estar presente para los dem\u00e1s, tienes que estar presente para ti mismo. Cosas innegociables: cosas que haces por ti mismo todos los d\u00edas. No es ego\u00edsmo. Es necesario. Si este nivel no es s\u00f3lido, todo lo que est\u00e1 por encima es inestable.',
    'Self for family: either the family you were born into OR the family you have created (spouse, kids). If you\'ve created your own family, they become Level 2, and your family of origin moves to Level 3. These are the people who see you at your best and worst. You can\'t skip to community impact if things are incomplete here.': 'La familia en la que naciste O la familia que has creado (c\u00f3nyuge, hijos). Si has creado tu propia familia, ellos se convierten en el Nivel 2, y tu familia de origen pasa al Nivel 3. Estas son las personas que te ven en tus mejores y peores momentos.',
    'Self for group: extended family members, friends, relatives, coworkers, and groups you belong to. If you\'ve created your own family, your parents and siblings now live here. The question: Are you being yourself, or performing a version of yourself to fit in, or hiding entirely? The first 3 levels represent 90% of everyday life.': 'Familiares, amigos, parientes, compa\u00f1eros de trabajo y grupos a los que perteneces. Si has creado tu propia familia, tus padres y hermanos ahora se encuentran en este nivel. \u00bfEst\u00e1s siendo t\u00fa mismo o interpretando una versi\u00f3n de ti mismo para encajar? Los primeros 3 niveles representan el 90% de la vida cotidiana.',
    'Self for community: mostly seen as activities, events, and classes of people you identify with: musicians, business people, athletes, artists, your industry. Where you belong beyond personal relationships. Do you have a role, and do you respect the roles of others?': 'Actividades, eventos y grupos de personas con los que te identificas: m\u00fasicos, empresarios, deportistas, artistas, tu sector. Tu lugar de pertenencia m\u00e1s all\u00e1 de las relaciones personales. \u00bfTienes un rol y respetas los roles de los dem\u00e1s?',
    'Self for society: the people of your nation and its systems: government, economy, culture, laws. This level is about seeing reality clearly. Not what you wish was true. Not what you\'re fighting against. What actually is. You can\'t change what you won\'t first accept.': 'La gente de tu naci\u00f3n y sus sistemas: gobierno, econom\u00eda, cultura, leyes. Este nivel trata de ver la realidad con claridad. No lo que deseas que fuera verdad. No contra lo que luchas. Lo que realmente es. No puedes cambiar lo que primero no aceptas.',
    'Self for world: the global stage: international politics, global events, other nations, other cultures, humanity as a whole. How connected do you feel to what happens outside your borders? This isn\'t about being an activist. It\'s about recognizing you\'re part of something larger than your own life.': 'El escenario global: pol\u00edtica internacional, eventos globales, otras naciones, otras culturas, la humanidad en su conjunto. \u00bfQu\u00e9 tan conectado te sientes con lo que sucede fuera de tus fronteras? Se trata de reconocer que eres parte de algo m\u00e1s grande que tu propia vida.',
    'Self for generations: the people who came before you (ancestors) and those who will come after. This is legacy. What cycles did you inherit? What cycles will you break? What will you build that outlasts you? Legacy isn\'t always a building. Sometimes it\'s a pattern you refused to repeat.': 'Las personas que vinieron antes que t\u00fa (antepasados) y las que vendr\u00e1n despu\u00e9s. Este es el legado. \u00bfQu\u00e9 ciclos heredaste? \u00bfQu\u00e9 ciclos romper\u00e1s? \u00bfQu\u00e9 construir\u00e1s que perdure m\u00e1s all\u00e1 de ti? El legado no siempre es un edificio. A veces es un patr\u00f3n que te negaste a repetir.',

    // ─── Home Screen (from Roger) ───
    'See Your Patterns': 'Descubre tus patrones',
    'The game that reveals<br>what\'s really running your life.': 'El juego que revela<br>lo que realmente dirige tu vida.',
    'TRENDING GLOBALLY': 'Tendencia Global',
    'Worldwide Challenge': 'Desaf\u00edo mundial',
    'Same 3 scenarios for everyone on Earth. One chance daily.': 'Los mismos 3 escenarios para todos en la Tierra. Una oportunidad diaria.',
    'playing now': 'jugando ahora',
    'Tap to join the global movement': 'Haz clic para unirte al movimiento global',
    'Resets in': 'Se reinicia en',
    'Mirror Game': 'Juego del espejo',
    'See yourself honestly': 'M\u00edrate con honestidad',
    'Agreement Game': 'Juego del acuerdo',
    'Acceptance vs Judgment': 'Aceptaci\u00f3n vs. Juicio',
    'Level': 'Nivel',
    'coins': 'monedas',
    'Played': 'Jugado',
    'Streak': 'Racha',
    'Acceptance': 'Aceptaci\u00f3n',
    'Insights': 'Perspectivas',
    'Your Pattern': 'Tu patr\u00f3n',
    "Today's Practice": 'Pr\u00e1ctica de hoy',
    'Tap for full profile': 'Toca para ver perfil completo',
    'Your Journey': 'Tu viaje',
    'Breakthrough Work': 'Trabajo innovador',
    'Join Our Team': '\u00danete a nuestro equipo',
    'Learn the Full Framework': 'Aprende el marco completo',
    'Get Coaching': 'Obt\u00e9n asesoramiento',
    '1-on-1 Integration': 'Integraci\u00f3n individual',
    'Built by': 'Creado por',
    'on the framework he uses with founders, leaders, and clients worldwide.': 'bas\u00e1ndose en el marco que utiliza con fundadores, l\u00edderes y clientes en todo el mundo.',

    // ─── Game Screen ───
    'Mirror': 'Espejo',
    'Agreement': 'Acuerdo',
    'Loading...': 'Cargando...',
    "That's Me": 'Ese soy yo',
    'Not Me': 'Ese no soy yo',

    // ─── Results Screen ───
    'Game Complete': 'Juego completado',
    'Mirror Complete': 'Espejo completado',
    'Agreement Complete': 'Acuerdo completado',
    'Mixed Complete': 'Mixto completado',
    'Challenge Complete': 'Desaf\u00edo completado',
    'This session': 'Esta sesi\u00f3n',
    'Keep going!': '\u00a1Sigue adelante!',
    'Reflections': 'Reflexiones',
    'correct!': '\u00a1correcto!',
    'Great job!': '\u00a1Buen trabajo!',
    'Questions': 'Preguntas',
    'Back to Home': 'Volver al inicio',
    'Keep Playing': 'Seguir jugando',
    'Endless Mode': 'Modo infinito',
    'Continue Endless': 'Continuar infinito',
    'WhatsApp': 'WhatsApp',
    'Twitter': 'Twitter',
    'Copy': 'Copiar',
    'More': 'M\u00e1s',
    'Ready to break these patterns for good?': '\u00bfListo/a para romper estos patrones de una vez?',

    // ─── Result Messages ───
    'High self-recognition. You see yourself clearly. That\'s rare and powerful.': 'Alto autorreconocimiento. Te ves con claridad. Eso es raro y poderoso.',
    'Strong awareness. You\'re willing to look at what others avoid.': 'Gran conciencia. Est\u00e1s dispuesto/a a mirar lo que otros evitan.',
    'Selective recognition. Some patterns are easier to see than others.': 'Reconocimiento selectivo. Algunos patrones son m\u00e1s f\u00e1ciles de ver que otros.',
    'Low recognition. Either you\'re different, or there\'s a blind spot worth exploring.': 'Bajo reconocimiento. O eres diferente, o hay un punto ciego que vale la pena explorar.',
    'Exceptional. You chose acceptance almost every time.': 'Excepcional. Elegiste la aceptaci\u00f3n casi siempre.',
    'Strong acceptance. You\'re rewiring your default response.': 'Fuerte aceptaci\u00f3n. Est\u00e1s reprogramando tu respuesta predeterminada.',
    'Growing awareness. Notice when judgment feels safer.': 'Conciencia en crecimiento. Observa cu\u00e1ndo juzgar se siente m\u00e1s seguro.',
    'Judgment is your current default. That\'s not wrong. It\'s information.': 'Juzgar es tu modo predeterminado. No est\u00e1 mal. Es informaci\u00f3n.',

    // ─── Modals & Popups ───
    'Help & FAQ': 'Ayuda y preguntas frecuentes',
    'Achievement Unlocked!': '\u00a1Logro desbloqueado!',
    'Pattern Detected': 'Patr\u00f3n detectado',
    'This keeps showing up.': 'Esto sigue apareciendo.',
    'pattern appeared': 'el patr\u00f3n apareci\u00f3',
    'times recently': 'veces recientemente',
    "You're seeing it clearly now.": 'Ahora lo ves con claridad.',
    "That's the first step. But seeing a pattern and breaking it are two different things.": 'Ese es el primer paso. Pero ver un patr\u00f3n y romperlo son dos cosas diferentes.',
    "Most people can't break lifelong patterns alone. That's not weakness. It's how patterns work.": 'La mayor\u00eda de las personas no pueden romper patrones de toda la vida solas. Eso no es debilidad. As\u00ed funcionan los patrones.',
    'Talk to Arthur': 'Habla con Arthur',
    'Remind me later': 'Recu\u00e9rdame despu\u00e9s',

    // ─── Stats & XP ───
    'Games Played': 'Partidas jugadas',
    'Daily Streak': 'Racha diaria',
    'Acceptance Rate': 'Tasa de aceptaci\u00f3n',
    'insights collected': 'perspectivas recopiladas',
    'scenarios explored': 'escenarios explorados',
    'Start your journey': 'Comienza tu viaje',
    'Completed!': '\u00a1Completado!',
    'breakthroughs': 'avances',
    'ON TRACK': 'EN CAMINO',
    'CATCHING UP': 'RECUPERANDO',
    'BEHIND': 'REZAGADO',
    'Start': 'Comenzar',
    'Done!': '\u00a1Hecho!',

    // ─── Archetype Names (from Roger FAQ) ───
    'The Honest Avoider': 'Evitador de la honestidad',
    'The Aware Procrastinator': 'Procrastinador Consciente',
    'The Peaceful Avoider': 'Evasor Pac\u00edfico',
    'The Growth Seeker': 'Buscador de Crecimiento',
    'The Aware One': 'El Consciente',
    'The Silent Scorekeeper': 'Guardi\u00e1n Silencioso de las Cuentas',
    'The Grief Holder': 'Portador del Duelo',
    'The Crowded Loner': 'Solitario Rodeado de Gente',
    'The Identity Chameleon': 'Camale\u00f3n de la Identidad',
    'The Burned Out Achiever': 'Triunfador Agotado',
    'The Once Bitten': 'Una Vez Mordido',
    'The Strategic Avoider': 'Evitador Estrat\u00e9gico',
    'The Numbing Navigator': 'Navegante Insensible',
    'The Compassionate Boundary-Breaker': 'Rompedor de L\u00edmites',
    'The Self-Critical Achiever': 'Triunfador Autocr\u00edtico',
    'The Control Seeker': 'Buscador de Control',
    'The Shame Carrier': 'Portador de la verg\u00fcenza',
    'The Trust Rebuilder': 'Reconstructor de la confianza',
    'The Emerging Observer': 'Observador Emergente',

    // ─── Pattern Card Reveal ───
    "What's yours?": '\u00bfCu\u00e1l es el tuyo?',
    'Play the full game to go deeper.': 'Juega el juego completo para profundizar.',
    'Play the Game': 'Juega el juego',
    'Share My Pattern': 'Compartir mi patr\u00f3n',
    'Share Your Pattern': 'Comparte tu patr\u00f3n',
    'Copy Link': 'Copiar enlace',
    'Start Playing': 'Empieza a jugar',

    // ─── Welcome Messages ───
    'Keep it going!': '\u00a1Sigue as\u00ed!',
    'Welcome back!': '\u00a1Bienvenido de nuevo!',
    'Good to see you!': '\u00a1Qu\u00e9 bueno verte!',

    // ─── Game Mode Labels (in-game) ───
    'Level 1: Individual': 'Nivel 1: Individuo',
    'Level 2: Family': 'Nivel 2: Familia',
    'Level 3: Groups': 'Nivel 3: Grupos',
    'Level 4: Community': 'Nivel 4: Comunidad',
    'Level 5: Society': 'Nivel 5: Sociedad',
    'Level 6: World': 'Nivel 6: Mundo',
    'Level 7: Generations': 'Nivel 7: Generaciones',

    // ─── Misc UI ───
    'NEW': 'NUEVO',
    'Start Here': 'Empieza aqu\u00ed',
    'Play': 'Jugar',
    'Save': 'Guardar',
    'Share': 'Compartir',
    'Close': 'Cerrar',
    'Day': 'D\u00eda',
    'XP': 'XP',
    'games': 'partidas',
    'new insights': 'nuevas perspectivas',
    'correct': 'correcto',
    'Accepted': 'Aceptado',
    'Judgment': 'Juicio',
    'Correct': 'Correcto',
    'Missed': 'Fallado',
    'Your Responses': 'Tus respuestas',
    'Perfect!': '\u00a1Perfecto!',
    'Loading scenarios... Please wait': 'Cargando escenarios... Por favor espera',
    "You're now Level": 'Ahora eres Nivel',
    'Completed Today': 'Completado hoy',

    // ─── Deep Insight / AI Analysis ───
    'Deep Insight': 'An\u00e1lisis profundo',
    'Print / Save': 'Imprimir / Guardar',
    'Scroll': 'Desplazarse',

    // ─── Reach Level Unlocks (from Roger) ───
    'Reach Player Level': 'Alcanza el nivel',
    'explored': 'explorado'
  }
};

// Translate a string - returns translation if available, otherwise original English
function t(str) {
  if (!TRANSLATIONS || currentLang === 'en' || !TRANSLATIONS[currentLang]) return str;
  return TRANSLATIONS[currentLang][str] || str;
}

// Apply translations to all static HTML elements with data-i18n attribute
function applyStaticTranslations() {
  document.querySelectorAll('[data-i18n]').forEach(el => {
    let key = el.getAttribute('data-i18n');
    if (TRANSLATIONS[currentLang] && TRANSLATIONS[currentLang][key]) {
      if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
        el.placeholder = TRANSLATIONS[currentLang][key];
      } else {
        el.innerHTML = TRANSLATIONS[currentLang][key];
      }
    }
  });
}

// Apply translations to all known text elements by ID or selector
function applyTranslations() {
  if (currentLang === 'en') return; // English is the hardcoded default, no changes needed
  let tr = TRANSLATIONS[currentLang];
  if (!tr) return;

  // ─── Hook Screen 1 ───
  let line1 = document.getElementById('line1');
  if (line1) line1.innerHTML = tr['See the patterns'] || line1.innerHTML;
  let line2 = document.getElementById('line2');
  if (line2) line2.innerHTML = tr['that quietly run<br>your life.'] || line2.innerHTML;
  let hookSub = document.getElementById('hookSub');
  if (hookSub) hookSub.innerHTML = tr['Discover why you keep repeating<br>the same mistakes.'] || hookSub.innerHTML;
  let hookBtn = document.getElementById('hookBtn');
  if (hookBtn) hookBtn.textContent = tr['Prove it'] || hookBtn.textContent;

  // ─── Hook Screen 2: Recognition ───
  let recGrid = document.getElementById('recognitionGrid');
  if (recGrid) {
    recGrid.querySelectorAll('.recognition-item').forEach(item => {
      let orig = item.textContent.trim();
      if (tr[orig]) item.textContent = tr[orig];
    });
  }
  let recHint = document.getElementById('recognitionHint');
  if (recHint) recHint.textContent = tr['Please select at least one'] || recHint.textContent;

  // ─── Hook Screen 3: Inner Voice ───
  let voiceOpts = document.getElementById('voiceOptions');
  if (voiceOpts) {
    voiceOpts.querySelectorAll('.voice-option').forEach(item => {
      let orig = item.textContent.trim();
      if (tr[orig]) item.textContent = tr[orig];
    });
  }
  let voiceHint = document.getElementById('voiceHint');
  if (voiceHint) voiceHint.textContent = tr['Please select at least one'] || voiceHint.textContent;

  // ─── Hook Screen 4: Levels Explanation ───
  document.querySelectorAll('.level-compact-name').forEach(el => {
    let orig = el.textContent.trim();
    if (tr[orig]) el.textContent = tr[orig];
  });
  document.querySelectorAll('.level-compact-desc').forEach(el => {
    let orig = el.textContent.trim();
    if (tr[orig]) el.textContent = tr[orig];
  });
  // Level detail paragraphs
  for (let i = 1; i <= 7; i++) {
    let detail = document.getElementById('levelDetail' + i);
    if (detail) {
      let orig = detail.textContent.trim();
      if (tr[orig]) detail.textContent = tr[orig];
    }
  }

  // ─── Home Screen ───
  // Worldwide Challenge
  let dailyCard = document.getElementById('dailyCard');
  if (dailyCard) {
    let badge = dailyCard.querySelector('.player-count');
    if (badge) { let dot = badge.querySelector('.player-dot'); badge.textContent = ''; if(dot) badge.appendChild(dot); badge.appendChild(document.createTextNode(tr['TRENDING GLOBALLY'] || 'Trending Globally')); }
    let h2 = dailyCard.querySelector('h2');
    if (h2) h2.textContent = tr['Worldwide Challenge'] || h2.textContent;
    let p = dailyCard.querySelector('p');
    if (p) p.textContent = tr['Same 3 scenarios for everyone on Earth. One chance daily.'] || p.textContent;
    let cta = document.getElementById('dailyCta');
    if (cta) cta.textContent = tr['Tap to join the global movement'] || cta.textContent;
  }

  // Game modes
  document.querySelectorAll('.mode-name').forEach(el => {
    let orig = el.textContent.trim();
    if (tr[orig]) el.textContent = tr[orig];
  });
  document.querySelectorAll('.mode-desc').forEach(el => {
    let orig = el.textContent.trim();
    if (tr[orig]) el.textContent = tr[orig];
  });

  // Stats labels
  document.querySelectorAll('.stat-label').forEach(el => {
    let orig = el.textContent.replace(/[^\w\s]/g, '').trim();
    if (tr[orig]) el.innerHTML = tr[orig] + (el.innerHTML.includes('🔥') ? ' 🔥' : '');
  });

  // Pattern card
  let patternLabel = document.querySelector('.pattern-label');
  if (patternLabel) patternLabel.textContent = tr['Your Pattern'] || patternLabel.textContent;
  let patternChallengeLabel = document.querySelector('.pattern-challenge-label');
  if (patternChallengeLabel) patternChallengeLabel.textContent = tr["Today's Practice"] || patternChallengeLabel.textContent;
  let patternTap = document.querySelector('.pattern-tap');
  if (patternTap) patternTap.textContent = (tr['Tap for full profile'] || 'Tap for full profile') + ' \u2192';

  // Section title
  document.querySelectorAll('.section-title').forEach(el => {
    let orig = el.textContent.trim();
    if (tr[orig]) el.textContent = tr[orig];
  });

  // Action buttons
  document.querySelectorAll('.action-btn-text').forEach(el => {
    let orig = el.textContent.trim();
    if (tr[orig]) el.textContent = tr[orig];
  });

  // Footer
  let transformText = document.querySelector('.transform-btn-text');
  if (transformText) transformText.textContent = tr['Get Coaching'] || transformText.textContent;
  let transformSub = document.querySelector('.transform-btn-sub');
  if (transformSub) transformSub.textContent = tr['1-on-1 Integration'] || transformSub.textContent;

  // Language dropdown button
  let langBtn = document.getElementById('langDropBtn');
  if (langBtn) {
    if (currentLang === 'nl') langBtn.innerHTML = '\u{1F1F3}\u{1F1F1} Nederlands <span style="font-size:10px;opacity:0.8;">\u25BC</span>';
    else if (currentLang === 'es') langBtn.innerHTML = '\u{1F1EA}\u{1F1F8} Espa\u00f1ol <span style="font-size:10px;opacity:0.8;">\u25BC</span>';
  }

  // Hook screen question titles & subs
  document.querySelectorAll('.hook-question-title').forEach(el => {
    let orig = el.innerHTML.trim();
    if (tr[orig]) el.innerHTML = tr[orig];
  });
  document.querySelectorAll('.hook-question-sub').forEach(el => {
    let orig = el.textContent.trim();
    if (tr[orig]) el.textContent = tr[orig];
  });

  // Continue / Back buttons in hooks
  document.querySelectorAll('.hook-btn').forEach(el => {
    let orig = el.textContent.trim();
    if (tr[orig]) el.textContent = tr[orig];
  });

  // Results buttons
  let homeBtn = document.getElementById('homeBtn');
  if (homeBtn) homeBtn.innerHTML = '\u{1F3E0} ' + (tr['Back to Home'] || 'Back to Home');

  // Share platform labels
  document.querySelectorAll('.share-platform-btn .label').forEach(el => {
    let orig = el.textContent.trim();
    if (tr[orig]) el.textContent = tr[orig];
  });

  // Coaching bridge
  let bridgeTitle = document.querySelector('.bridge-title');
  if (bridgeTitle) bridgeTitle.textContent = tr['This keeps showing up.'] || bridgeTitle.textContent;
  let bridgeInsight = document.querySelector('.bridge-insight');
  if (bridgeInsight) {
    let strong = bridgeInsight.querySelector('strong');
    if (strong) strong.textContent = tr["You're seeing it clearly now."] || strong.textContent;
  }
  let bridgeCta = document.querySelector('.bridge-cta');
  if (bridgeCta) bridgeCta.textContent = tr["Most people can't break lifelong patterns alone. That's not weakness. It's how patterns work."] || bridgeCta.textContent;

  // Hero section
  let heroH1 = document.querySelector('.hero h1');
  if (heroH1) heroH1.textContent = tr['See Your Patterns'] || heroH1.textContent;
  let heroP = document.querySelector('.hero p');
  if (heroP) heroP.innerHTML = tr['The game that reveals<br>what\'s really running your life.'] || heroP.innerHTML;

  // Footer learn link
  let learnLink = document.querySelector('.footer-btn.primary');
  if (learnLink) learnLink.textContent = tr['Learn the Full Framework'] || learnLink.textContent;

  // Reveal label top
  let revealLabel = document.querySelector('.reveal-label-top');
  if (revealLabel) revealLabel.textContent = tr['Your Pattern'] || revealLabel.textContent;

  // Reveal CTA
  let revealCta = document.querySelector('.reveal-cta');
  if (revealCta) revealCta.textContent = tr['The game shows you which level your pattern lives on, so you can finally change it.'] || revealCta.textContent;

  // Levels intro
  let levelsIntro = document.querySelector('.levels-intro');
  if (levelsIntro) levelsIntro.textContent = tr['Tap each level to learn more:'] || levelsIntro.textContent;

  // Hook screen 5: pattern card elements
  let footerQ = document.querySelector('.footer-question');
  if (footerQ) footerQ.textContent = tr["What's yours?"] || footerQ.textContent;
  let startBtn = document.getElementById('startGameBtn');
  if (startBtn) startBtn.textContent = (tr['Start Playing'] || 'Start Playing') + ' \u2192';
  let shareMyBtn = document.querySelector('.share-btn');
  if (shareMyBtn && shareMyBtn.querySelector('.share-btn-icon')) {
    shareMyBtn.innerHTML = '<span class="share-btn-icon">\ud83d\udce4</span> ' + (tr['Share My Pattern'] || 'Share My Pattern');
  }
}

function setLanguage(lang) {
  if (lang !== 'en' && lang !== 'nl' && lang !== 'es') {
    showToast('\u{1F30D} ' + {hy:'\u0540\u0561\u0575\u0565\u0580\u0565\u0576',ru:'\u0420\u0443\u0441\u0441\u043a\u0438\u0439',ko:'\ud55c\uad6d\uc5b4'}[lang] + ' coming soon! Stay tuned.', 3000);
    return;
  }
  currentLang = lang;
  localStorage.setItem('levelup_lang', lang);

  // Update the dropdown button label
  let langBtn = document.getElementById('langDropBtn');
  if (langBtn) {
    if (lang === 'nl') langBtn.innerHTML = '\u{1F1F3}\u{1F1F1} Nederlands <span style="font-size:10px;opacity:0.8;">\u25BC</span>';
    else if (lang === 'es') langBtn.innerHTML = '\u{1F1EA}\u{1F1F8} Espa\u00f1ol <span style="font-size:10px;opacity:0.8;">\u25BC</span>';
    else langBtn.innerHTML = '\u{1F1FA}\u{1F1F8} English <span style="font-size:10px;opacity:0.8;">\u25BC</span>';
  }

  // Apply or revert translations
  if (lang === 'nl' || lang === 'es') {
    applyTranslations();
    if (lang === 'nl') showToast('\u{1F1F3}\u{1F1F1} Nederlands geactiveerd!', 2000);
    else showToast('\u{1F1EA}\u{1F1F8} \u00a1Espa\u00f1ol activado!', 2000);
  } else {
    // Reload to revert to English defaults
    location.reload();
  }
}

// Auto-apply translations on page load if a non-English language was previously selected
if (currentLang === 'nl' || currentLang === 'es') {
  document.addEventListener('DOMContentLoaded', function() {
    // Small delay to let other init code run first
    setTimeout(applyTranslations, 100);
  });
  // Also apply after updateHome which rebuilds some elements
  let _origUpdateHome = typeof updateHome === 'function' ? updateHome : null;
  if (_origUpdateHome) {
    let _wrappedUpdateHome = function() {
      _origUpdateHome.apply(this, arguments);
      if (currentLang === 'nl' || currentLang === 'es') setTimeout(applyTranslations, 50);
    };
    // Will be patched after updateHome is defined
  }
}

// Close language dropdown when clicking outside
document.addEventListener('click', function(e) {
  let dd = document.getElementById('langDropdown');
  let btn = document.getElementById('langDropBtn');
  if (dd && btn && !dd.contains(e.target) && !btn.contains(e.target)) {
    dd.classList.remove('open');
  }
});

// ========== PATTERN LINKING ENGINE ==========
// Detects connections between scenarios the player has recognized
// Creates "breakthrough moments" when linked patterns reveal deeper truth

function analyzePatternLinks() {
  if (!data.insightsCollection || data.insightsCollection.length < 10) return null;
  
  // Build frequency map of themes from recent answers
  let recent = data.insightsCollection.slice(-50);
  let themeHits = {};
  let themeScenarios = {};
  
  const LINK_THEMES = {
    'people-pleasing': ['please','approval','say yes','say no','boundaries','conflict','peace','agree','accommodate','doormat','walked over'],
    'self-worth': ['enough','worthy','deserve','value','matter','prove','earn','inadequate','unworthy','broken','defective'],
    'control': ['control','perfect','fix','plan','organize','predict','certain','let go','surrender','grip','micromanage'],
    'abandonment': ['leave','alone','abandon','reject','replace','forgotten','invisible','chosen','picked','left behind'],
    'authenticity': ['mask','pretend','real','fake','hide','true self','perform','show','honest','role','act','character'],
    'grief': ['loss','grieve','gone','miss','mourn','passed','death','ended','over','letting go','holding on'],
    'trust': ['trust','betray','safe','vulnerable','guard','wall','open','protect','hurt','burned','let in'],
    'anger': ['anger','rage','furious','resentment','bitter','frustrated','explode','suppress','swallow','hold in']
  };
  
  recent.forEach(ins => {
    let txt = (ins.text || ins.insight || '').toLowerCase();
    Object.entries(LINK_THEMES).forEach(([theme, keywords]) => {
      if (keywords.some(kw => txt.includes(kw))) {
        themeHits[theme] = (themeHits[theme] || 0) + 1;
        if (!themeScenarios[theme]) themeScenarios[theme] = [];
        themeScenarios[theme].push(ins);
      }
    });
  });
  
  // Find themes with 3+ hits (a real pattern)
  let activePatterns = Object.entries(themeHits)
    .filter(([,count]) => count >= 3)
    .sort((a, b) => b[1] - a[1]);
  
  if (activePatterns.length < 2) return null;
  
  // PATTERN LINKING: Find connections between top patterns
  let links = [];
  const LINK_MAP = {
    'people-pleasing+self-worth': {
      insight: 'You say yes to everyone because deep down you believe your value depends on being useful. The people-pleasing isn\'t kindness. It\'s a worth strategy.',
      question: 'What if you were valuable even when you said no?',
      exercise: 'Daily Check-In'
    },
    'people-pleasing+anger': {
      insight: 'You swallow your needs to keep the peace, then wonder why resentment builds. The anger isn\'t the problem. The silence before it is.',
      question: 'What would happen if you spoke up before the anger arrived?',
      exercise: 'Have To → Get To → Blessed To'
    },
    'control+abandonment': {
      insight: 'You try to control everything because you\'ve been left before. If you can predict it, it can\'t surprise-hurt you. But control pushes people away, creating the abandonment you fear.',
      question: 'What if letting go didn\'t mean losing?',
      exercise: 'Forgiveness Letter'
    },
    'self-worth+authenticity': {
      insight: 'You wear masks because you believe the real you isn\'t enough. Every performance gets applause but none of it reaches you. Because they\'re clapping for the character, not you.',
      question: 'Who are you when no one is watching?',
      exercise: 'Most Painful Memory'
    },
    'control+authenticity': {
      insight: 'You curate every detail of how people see you because the real version feels unsafe. Perfectionism is just control wearing a nicer outfit.',
      question: 'What would imperfect-but-real look like?',
      exercise: 'Daily Check-In'
    },
    'grief+anger': {
      insight: 'Under your anger is grief you haven\'t let yourself feel. It\'s easier to be furious than to be heartbroken.',
      question: 'What are you actually sad about?',
      exercise: 'Forgiveness Letter'
    },
    'trust+abandonment': {
      insight: 'You build walls because you\'ve been left. But the walls keep out the very thing you need, connection. The fortress works. That\'s the tragedy.',
      question: 'Who have you kept at arm\'s length that you actually want closer?',
      exercise: 'Blessings Letter'
    },
    'self-worth+grief': {
      insight: 'You grieve something you never had. The version of yourself that felt whole. That\'s not weakness. That\'s the beginning of finding it.',
      question: 'What would it feel like to stop mourning who you should have been and start meeting who you are?',
      exercise: 'Ultimate Acknowledgment'
    },
    'people-pleasing+authenticity': {
      insight: 'You\'re so good at being what others need that you\'ve lost track of what you need. The mask fit so well you forgot you were wearing one.',
      question: 'If everyone in your life disappeared tomorrow, who would you be?',
      exercise: 'Most Painful Memory'
    },
    'anger+self-worth': {
      insight: 'Your anger flares when you feel dismissed. Because being overlooked confirms the fear that you don\'t matter. The anger is your worth fighting to be seen.',
      question: 'What if your value didn\'t depend on recognition?',
      exercise: 'Daily Check-In'
    }
  };
  
  // Check top patterns for known links
  for (let i = 0; i < activePatterns.length; i++) {
    for (let j = i + 1; j < activePatterns.length; j++) {
      let key1 = activePatterns[i][0] + '+' + activePatterns[j][0];
      let key2 = activePatterns[j][0] + '+' + activePatterns[i][0];
      let link = LINK_MAP[key1] || LINK_MAP[key2];
      if (link) {
        links.push({
          patterns: [activePatterns[i][0], activePatterns[j][0]],
          counts: [activePatterns[i][1], activePatterns[j][1]],
          ...link
        });
      }
    }
  }
  
  return links.length > 0 ? links[0] : null; // Return strongest link
}

function showPatternLink() {
  let link = analyzePatternLinks();
  if (!link) return;
  
  // Don't show if shown recently
  let lastShown = parseInt(localStorage.getItem('levelup_lastPatternLink') || '0');
  if (Date.now() - lastShown < 86400000) return; // Once per day max
  localStorage.setItem('levelup_lastPatternLink', Date.now().toString());
  
  let patternNames = {
    'people-pleasing': '🛡️ People-Pleasing',
    'self-worth': '💎 Self-Worth',
    'control': '🎯 Control',
    'abandonment': '💔 Abandonment',
    'authenticity': '🪞 Authenticity',
    'grief': '🕊️ Grief',
    'trust': '🔒 Trust',
    'anger': '🔥 Anger'
  };
  
  let modal = document.createElement('div');
  modal.id = 'patternLinkModal';
  modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:10001;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn 0.5s ease;';
  
  modal.innerHTML = `
    <div style="background:var(--card);border:1px solid var(--border);border-radius:20px;max-width:380px;width:100%;padding:28px;text-align:center;position:relative;animation:slideUp 0.5s ease;">
      <div style="font-size:10px;text-transform:uppercase;letter-spacing:2px;color:var(--gold);font-weight:700;margin-bottom:12px;">⚡ Breakthrough Detected</div>
      <div style="display:flex;justify-content:center;align-items:center;gap:12px;margin-bottom:16px;">
        <div style="padding:8px 14px;background:rgba(255,107,53,0.15);border:1px solid rgba(255,107,53,0.3);border-radius:10px;font-size:13px;font-weight:600;color:var(--text);">
          ${patternNames[link.patterns[0]]} <span style="color:var(--muted);font-size:11px;">×${link.counts[0]}</span>
        </div>
        <div style="color:var(--gold);font-size:18px;">⟷</div>
        <div style="padding:8px 14px;background:rgba(120,75,160,0.15);border:1px solid rgba(120,75,160,0.3);border-radius:10px;font-size:13px;font-weight:600;color:var(--text);">
          ${patternNames[link.patterns[1]]} <span style="color:var(--muted);font-size:11px;">×${link.counts[1]}</span>
        </div>
      </div>
      <div style="font-size:14px;color:var(--text);line-height:1.6;margin-bottom:16px;text-align:left;">
        ${link.insight}
      </div>
      <div style="background:rgba(255,199,72,0.1);border:1px solid rgba(255,199,72,0.2);border-radius:10px;padding:12px;margin-bottom:16px;text-align:left;">
        <div style="font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--gold);font-weight:700;margin-bottom:4px;">The Question</div>
        <div style="font-size:14px;color:var(--text);font-style:italic;">${link.question}</div>
      </div>
      <div style="font-size:12px;color:var(--muted);margin-bottom:16px;">
        Try the <strong style="color:var(--cyan);">${link.exercise}</strong> exercise in Breakthrough Work
      </div>
      <div style="display:flex;gap:8px;">
        <button onclick="document.getElementById('patternLinkModal').remove();document.getElementById('breakthroughModal').classList.add('active');" style="flex:1;padding:12px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:10px;color:#fff;font-size:13px;font-weight:700;cursor:pointer;">Do Exercise Now</button>
        <button onclick="document.getElementById('patternLinkModal').remove();" style="padding:12px 16px;background:var(--card);border:1px solid var(--border);border-radius:10px;color:var(--muted);font-size:13px;cursor:pointer;">Later</button>
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
}

// ========== LILY SELF-AWARENESS COACH ==========
// In-game self-awareness coaching powered by Anthropic API
// Lily can analyze patterns and provide warm, insightful responses

function openLily() {
  if(typeof trackEvent==='function')trackEvent('lily_open');
  let lilyModal = document.getElementById('lilyModal');
  if (!lilyModal) {
    lilyModal = document.createElement('div');
    lilyModal.id = 'lilyModal';
    lilyModal.className = 'modal';
    lilyModal.innerHTML = `
      <div class="modal-content" style="max-width:420px;max-height:85vh;display:flex;flex-direction:column;">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
          <div style="width:48px;height:48px;border-radius:50%;overflow:hidden;flex-shrink:0;border:2px solid #a855f7;"><img src="Lily_Bot.jpg" alt="Lily" style="width:100%;height:100%;object-fit:cover;"></div>
          <div>
            <div style="font-size:16px;font-weight:800;color:var(--text);">Lily</div>
            <div style="font-size:11px;color:var(--muted);">Self-Awareness Coach</div>
          </div>
          <button onclick="document.getElementById('lilyModal').classList.remove('active')" style="margin-left:auto;background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer;">✕</button>
        </div>
        <div style="text-align:right;margin-bottom:4px;"><button onclick="lilyConversation=[];saveLilyConversation();document.getElementById('lilyChat').innerHTML='';openLily();" style="background:none;border:none;color:var(--muted);font-size:11px;cursor:pointer;text-decoration:underline;">New Chat</button></div>
        <div id="lilyChat" style="flex:1;overflow-y:auto;margin-bottom:12px;min-height:200px;max-height:50vh;padding:8px;"></div>
        <div style="display:flex;gap:8px;">
          <input type="text" id="lilyInput" placeholder="What's on your mind?" style="flex:1;padding:12px;border-radius:10px;border:1px solid var(--border);background:var(--bg);color:var(--text);font-size:14px;" onkeydown="if(event.key==='Enter')sendToLily()">
          <button onclick="sendToLily()" style="padding:12px 16px;background:linear-gradient(135deg,#a855f7,#ec4899);border:none;border-radius:10px;color:#fff;font-size:14px;cursor:pointer;">→</button>
        </div>
        <div style="font-size:10px;color:var(--muted);text-align:center;margin-top:8px;">Lily analyzes your game patterns to give personalized guidance</div>
      </div>
    `;
    document.body.appendChild(lilyModal);
  }
  
  lilyModal.classList.add('active');
  
  // Clear any leftover typing indicator
  let oldTyping = document.getElementById('lilyTyping');
  if (oldTyping) oldTyping.remove();
  
  // Show initial message if empty
  let chat = document.getElementById('lilyChat');
  if (!chat.hasChildNodes()) {
    if (lilyConversation.length > 0) {
      // Restore previous conversation
      lilyConversation.forEach(msg => {
        addLilyMessage(msg.role === 'user' ? 'user' : 'lily', msg.content);
      });
      addLilyMessage('lily', "Welcome back. Where were we? 🌸");
      setTimeout(() => { chat.scrollTop = chat.scrollHeight; }, 50);
    } else {
      let hasGameData = data && data.games && data.games >= 5;
      if (hasGameData) {
        let patternSummary = buildPatternSummary();
        addLilyMessage('lily', "Hi, I'm Lily 🌸 I've been watching your patterns in the game." + 
          (patternSummary ? " " + patternSummary : "") +
          "\n\nWhat's on your mind? You can ask me about your patterns, what they mean, or what to do next.");
      } else {
        addLilyMessage('lily', "Hi, I'm Lily 🌸 I'm the self-awareness coach here at Levels of Self.\n\nYou don't need to have played the game for us to work together. Tell me what's going on in your life and I'll help you see the patterns underneath. Or if you want, I can walk you through one of Arthur's breakthrough exercises right now.\n\nWhat's on your mind?");
      }
    }
  }
}

function buildPatternSummary() {
  if (!data.insightsCollection || data.insightsCollection.length < 5) return '';
  
  let recognized = data.insightsCollection.filter(i => i.recognized !== false).length;
  let total = data.insightsCollection.length;
  let recPct = Math.round((recognized / total) * 100);
  
  let themes = {};
  data.insightsCollection.slice(-30).forEach(ins => {
    let txt = (ins.text || '').toLowerCase();
    if (txt.includes('boundar') || txt.includes('say no') || txt.includes('limit')) themes['boundaries'] = (themes['boundaries'] || 0) + 1;
    if (txt.includes('enough') || txt.includes('worth') || txt.includes('deserve') || txt.includes('value')) themes['self-worth'] = (themes['self-worth'] || 0) + 1;
    if (txt.includes('honest') || txt.includes('lie') || txt.includes('truth') || txt.includes('pretend')) themes['honesty'] = (themes['honesty'] || 0) + 1;
    if (txt.includes('control') || txt.includes('perfect') || txt.includes('micromanag')) themes['control'] = (themes['control'] || 0) + 1;
    if (txt.includes('connect') || txt.includes('intimat') || txt.includes('close') || txt.includes('vulnerab')) themes['connection'] = (themes['connection'] || 0) + 1;
    if (txt.includes('rest') || txt.includes('exhaust') || txt.includes('burnout') || txt.includes('tired')) themes['rest'] = (themes['rest'] || 0) + 1;
    if (txt.includes('accept') || txt.includes('resist') || txt.includes('deny') || txt.includes('fight reality')) themes['acceptance'] = (themes['acceptance'] || 0) + 1;
    if (txt.includes('withhold') || txt.includes('hold back') || txt.includes('suppress') || txt.includes('bottle')) themes['withholding'] = (themes['withholding'] || 0) + 1;
    if (txt.includes('abandon') || txt.includes('leave') || txt.includes('alone') || txt.includes('left behind')) themes['abandonment'] = (themes['abandonment'] || 0) + 1;
    if (txt.includes('betray') || txt.includes('trust') || txt.includes('cheat') || txt.includes('stab')) themes['betrayal'] = (themes['betrayal'] || 0) + 1;
    if (txt.includes('resent') || txt.includes('anger') || txt.includes('grudge') || txt.includes('bitter')) themes['resentment'] = (themes['resentment'] || 0) + 1;
    if (txt.includes('perfect') || txt.includes('mistake') || txt.includes('fail') || txt.includes('flawless')) themes['perfectionism'] = (themes['perfectionism'] || 0) + 1;
    if (txt.includes('people-pleas') || txt.includes('approval') || txt.includes('validate') || txt.includes('please everyone')) themes['people-pleasing'] = (themes['people-pleasing'] || 0) + 1;
    if (txt.includes('avoid') || txt.includes('numb') || txt.includes('distract') || txt.includes('escape')) themes['avoidance'] = (themes['avoidance'] || 0) + 1;
    if (txt.includes('grief') || txt.includes('loss') || txt.includes('miss') || txt.includes('mourn')) themes['grief'] = (themes['grief'] || 0) + 1;
    if (txt.includes('codepend') || txt.includes('need') || txt.includes('cling') || txt.includes('can\'t function without')) themes['codependency'] = (themes['codependency'] || 0) + 1;
  });
  
  let topThemes = Object.entries(themes).sort((a,b) => b[1] - a[1]).slice(0, 3);
  if (topThemes.length === 0) return '';
  
  let summary = 'You\'ve played ' + data.games + ' games and recognized patterns ' + recPct + '% of the time.';
  summary += ' Your strongest patterns are around ' + topThemes.map(t => t[0]).join(', ') + '.';
  return summary;
}

function addLilyMessage(role, text) {
  let chat = document.getElementById('lilyChat');
  let msg = document.createElement('div');
  msg.style.cssText = 'margin-bottom:12px;display:flex;gap:8px;' + (role === 'user' ? 'flex-direction:row-reverse;' : '');
  
  let bubble = document.createElement('div');
  bubble.style.cssText = 'max-width:85%;padding:10px 14px;border-radius:14px;font-size:13px;line-height:1.5;white-space:pre-wrap;' +
    (role === 'user' 
      ? 'background:linear-gradient(135deg,var(--orange),var(--pink));color:#fff;border-bottom-right-radius:4px;'
      : 'background:var(--bg);border:1px solid var(--border);color:var(--text);border-bottom-left-radius:4px;');
  bubble.textContent = text;
  
  if (role === 'lily') {
    let avatar = document.createElement('div');
    avatar.style.cssText = 'width:28px;height:28px;border-radius:50%;overflow:hidden;flex-shrink:0;border:1px solid #a855f7;';
    avatar.innerHTML = '<img src="Lily_Bot.jpg" alt="Lily" style="width:100%;height:100%;object-fit:cover;">';
    msg.appendChild(avatar);
  }
  
  msg.appendChild(bubble);
  chat.appendChild(msg);
  chat.scrollTop = chat.scrollHeight;
}

// Load saved Lily conversation from localStorage
let lilyConversation = [];
try {
  let saved = localStorage.getItem('lilyConversation');
  if (saved) lilyConversation = JSON.parse(saved);
} catch(e) { lilyConversation = []; }

function saveLilyConversation() {
  try {
    // Keep last 50 messages max to avoid localStorage bloat
    let toSave = lilyConversation.slice(-50);
    localStorage.setItem('lilyConversation', JSON.stringify(toSave));
  } catch(e) {}
}

async function sendToLily() {
  let input = document.getElementById('lilyInput');
  let text = input.value.trim();
  if (!text) return;
  input.value = '';
  
  addLilyMessage('user', text);
  lilyConversation.push({ role: 'user', content: text });
  saveLilyConversation();
  
  // Show typing indicator
  let typing = document.createElement('div');
  typing.id = 'lilyTyping';
  typing.style.cssText = 'margin-bottom:12px;display:flex;gap:8px;align-items:center;';
  typing.innerHTML = '<div style="width:28px;height:28px;border-radius:50%;overflow:hidden;flex-shrink:0;border:1px solid #a855f7;"><img src="Lily_Bot.jpg" alt="Lily" style="width:100%;height:100%;object-fit:cover;"></div><div style="padding:10px 14px;background:var(--bg);border:1px solid var(--border);border-radius:14px;font-size:13px;color:var(--muted);">Lily is thinking...</div>';
  document.getElementById('lilyChat').appendChild(typing);
  
  try {
    let patternContext = buildPatternSummary();

    const response = await fetch("https://api.100levelup.com/api/lily", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        messages: lilyConversation.slice(-30),
        playerData: patternContext ? patternContext + '\nGames played: ' + (data.games || 0) + '\nCurrent level: ' + (data.level || 1) : ''
      })
    });
    
    const responseData = await response.json();
    let reply = responseData.reply || "Something went wrong on my end. Try again in a sec.";
    lilyConversation.push({ role: 'assistant', content: reply });
    saveLilyConversation();
    
    let typingEl = document.getElementById('lilyTyping');
    if (typingEl) typingEl.remove();
    addLilyMessage('lily', reply);
    
  } catch (err) {
    let typingEl = document.getElementById('lilyTyping');
    if (typingEl) typingEl.remove();
    addLilyMessage('lily', "I'm having trouble connecting right now. In the meantime, try the Breakthrough Work exercises. They're powerful even without me. 🌸");
  }
}

// ========== ANDROID BACK BUTTON HANDLER ==========
// Prevents app from exiting when back button is pressed
// Instead navigates back to home screen or closes modals
(function() {
  // Push initial state on load
  history.pushState({page: 'home'}, '', window.location.href);
  
  window.addEventListener('popstate', function(event) {
    // Check if any modal is open
    let activeModal = document.querySelector('.modal.active');
    if (activeModal) {
      event.preventDefault();
      activeModal.classList.remove('active');
      history.pushState({page: 'home'}, '', window.location.href);
      return;
    }
    
    // Check if in game
    let gameEl = document.getElementById('game');
    if (gameEl && gameEl.classList.contains('active')) {
      event.preventDefault();
      let quitBtn = document.getElementById('quitBtn');
      if (quitBtn) quitBtn.click();
      history.pushState({page: 'home'}, '', window.location.href);
      return;
    }
    
    // Check if results screen is showing
    let resultsEl = document.getElementById('results');
    if (resultsEl && resultsEl.classList.contains('active')) {
      event.preventDefault();
      let homeBtn = document.getElementById('homeBtn');
      if (homeBtn) homeBtn.click();
      history.pushState({page: 'home'}, '', window.location.href);
      return;
    }
    
    // If on home screen with nothing open, show exit warning
    let homeEl = document.getElementById('home');
    if (homeEl && homeEl.style.display !== 'none') {
      if (!window.backPressedOnce) {
        event.preventDefault();
        window.backPressedOnce = true;
        showToast('Press back again to exit');
        history.pushState({page: 'home'}, '', window.location.href);
        setTimeout(function() {
          window.backPressedOnce = false;
        }, 2000);
        return;
      }
    }
  });
  
  // Push state when navigating within the app
  document.addEventListener('click', function(e) {
    let target = e.target.closest('button, .game-card, .stat');
    if (target) {
      setTimeout(function() {
        let activeModal = document.querySelector('.modal.active');
        let gameActive = document.getElementById('game')?.classList.contains('active');
        let resultsActive = document.getElementById('results')?.classList.contains('active');
        if (activeModal || gameActive || resultsActive) {
          history.pushState({page: 'inner'}, '', window.location.href);
        }
      }, 100);
    }
  });
})();

// ========== KEYBOARD NAVIGATION ==========
document.addEventListener('keydown', function(e) {
  // Don't interfere with typing in inputs
  if(e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
  
  // Game screen controls
  let gameActive = document.getElementById('game').classList.contains('active');
  if(gameActive) {
    let choices = document.querySelectorAll('.choice:not(:disabled)');
    // 1-4 keys select choices
    if(e.key >= '1' && e.key <= '4') {
      let idx = parseInt(e.key) - 1;
      if(choices[idx]) choices[idx].click();
    }
    // Escape quits game
    if(e.key === 'Escape') {
      document.getElementById('quitBtn').click();
    }
    return;
  }
  
  // Modal controls
  let activeModal = document.querySelector('.modal.active');
  if(activeModal) {
    // Escape closes modal
    if(e.key === 'Escape') {
      activeModal.classList.remove('active');
    }
    // Enter clicks primary button
    if(e.key === 'Enter') {
      let btn = activeModal.querySelector('.modal-btn, button[style*="gradient"]');
      if(btn) btn.click();
    }
    return;
  }
  
  // Results screen
  let resultsActive = document.getElementById('results').classList.contains('active');
  if(resultsActive) {
    if(e.key === 'Enter' || e.key === ' ') {
      let keepPlaying = document.getElementById('keepPlayingBtn');
      if(keepPlaying.style.display !== 'none') keepPlaying.click();
      else document.getElementById('homeBtn').click();
    }
    if(e.key === 'Escape') {
      document.getElementById('homeBtn').click();
    }
    return;
  }
  
  // Hook screen
  let hookActive = document.body.classList.contains('hook-active');
  if(hookActive) {
    if(e.key === 'Enter' || e.key === ' ') {
      let hookBtn = document.getElementById('hookBtn');
      if(hookBtn.classList.contains('show')) hookBtn.click();
    }
    return;
  }
  
  // Home screen shortcuts
  if(e.key === 'm' || e.key === 'M') {
    // Start Mirror game
    document.getElementById('mirrorMode')?.click();
  }
  if(e.key === 'a' || e.key === 'A') {
    // Start Agreement game
    let agreementBtn = document.getElementById('agreementMode');
    if(agreementBtn && !agreementBtn.classList.contains('locked')) agreementBtn.click();
  }
  if(e.key === 'd' || e.key === 'D') {
    // Daily challenge
    document.getElementById('dailyCard')?.click();
  }
  if(e.key === '?') {
    // Help
    document.getElementById('qaBtn')?.click();
  }
});

// ========== ONBOARDING TOOLTIP SYSTEM ==========
const ONBOARD_STEPS = [
  { target: 'musicBtn', text: '🎵 Toggle Music. Set the mood', position: 'bottom' },
  { target: 'aiBtn', text: '❤️ Deep Insights. See your patterns analyzed after 10 games', position: 'bottom' },
  { target: 'qaBtn', text: '❓ Questions. Get help & learn more', position: 'bottom' },
  { target: 'lilyBtn', text: 'Lily is your self-awareness coach. She reads your patterns and guides you.', position: 'bottom' },
  { target: 'founderBtn', text: '👤 Meet the Founder. Learn about Arthur', position: 'bottom' },
  { target: 'dailyCard', text: '🌍 Worldwide Challenge. Same 3 scenarios for everyone on Earth. Resets daily!', position: 'top' },
  { target: 'coinCount', text: '💰 Coins. Tap to open the Reward Shop. Earn discounts on workshops & sessions!', position: 'bottom', parentTarget: true },
  { target: 'insightsStat', text: '💡 Your Insights. Every pattern you recognize gets saved here', position: 'top' },
  { target: 'mirrorMode', text: 'Mirror Game. See yourself honestly. No right or wrong answers.', position: 'top' },
  { target: 'levelMap', text: '🎯 Level 1: Individual. Start here! Your relationship with yourself.', position: 'top', selector: '.level' }
];
let onboardStep = 0;
let currentTooltip = null;
let tourActive = false;

function isTourActive() {
  return tourActive;
}

function startOnboardingTour() {
  if (data.seenOnboarding || data.games > 0) return;
  onboardStep = 0;
  tourActive = true;
  showOnboardStep();
}

function showOnboardStep() {
  // Clean up previous
  if (currentTooltip) currentTooltip.remove();
  document.querySelectorAll('.onboard-highlight').forEach(el => el.classList.remove('onboard-highlight'));
  
  if (onboardStep >= ONBOARD_STEPS.length) {
    // Tour complete
    tourActive = false;
    document.getElementById('onboardOverlay').classList.remove('show');
    data.seenOnboarding = true;
    save();
    return;
  }
  
  const step = ONBOARD_STEPS[onboardStep];
  // Support selector option for targeting child elements (like first .level in levelMap)
  let target;
  if (step.selector) {
    const parent = document.getElementById(step.target);
    target = parent ? parent.querySelector(step.selector) : null;
  } else if (step.parentTarget) {
    // For coins, highlight the parent xp-coins div
    const el = document.getElementById(step.target);
    target = el ? el.parentElement : null;
  } else {
    target = document.getElementById(step.target);
  }
  if (!target) {
    onboardStep++;
    showOnboardStep();
    return;
  }
  
  // Show overlay
  document.getElementById('onboardOverlay').classList.add('show');
  
  // Highlight target
  target.classList.add('onboard-highlight');
  
  // Scroll target into view (instant to guarantee position)
  target.scrollIntoView({ behavior: 'instant', block: 'center' });
  
  // Create tooltip immediately after instant scroll
  var rect = target.getBoundingClientRect();
  
  currentTooltip = document.createElement('div');
  currentTooltip.className = 'onboard-tooltip arrow-' + (step.position === 'bottom' ? 'up' : 'down');
  currentTooltip.innerHTML = step.text + '<br><button class="onboard-tooltip-btn" onclick="nextOnboardStep()">' + 
    (onboardStep === ONBOARD_STEPS.length - 1 ? 'Got it!' : 'Next') + '</button>';
  document.body.appendChild(currentTooltip);
  
  // Measure tooltip after adding to DOM
  var tooltipRect = currentTooltip.getBoundingClientRect();
  
  // Position using viewport coords (fixed positioning)
  if (step.position === 'bottom') {
    currentTooltip.style.top = (rect.bottom + 12) + 'px';
  } else {
    currentTooltip.style.top = (rect.top - tooltipRect.height - 12) + 'px';
  }
  currentTooltip.style.left = Math.max(16, Math.min(window.innerWidth - 216, rect.left + rect.width/2 - 100)) + 'px';
  
  // Show with animation
  setTimeout(function() { currentTooltip.classList.add('show'); }, 50);
}

function nextOnboardStep() {
  onboardStep++;
  showOnboardStep();
}

function skipOnboarding() {
  tourActive = false;
  if (currentTooltip) currentTooltip.remove();
  document.querySelectorAll('.onboard-highlight').forEach(el => el.classList.remove('onboard-highlight'));
  document.getElementById('onboardOverlay').classList.remove('show');
  data.seenOnboarding = true;
  save();
}

// Tour can only be advanced with the Next button - no click-away
// document.getElementById('onboardOverlay').addEventListener('click', skipOnboarding);

// ========== iOS PWA FRESH START & RESUME REFRESH ==========
// Ensures clean state on app open and refreshes when resuming from background
(function() {
  const SESSION_KEY = 'levelup_session_active';
  const REFRESH_THRESHOLD = 30000; // 30 seconds
  let lastHidden = 0;
  
  // Check if this is a fresh app open (not a page refresh within active session)
  const isActiveSession = sessionStorage.getItem(SESSION_KEY);
  
  if (!isActiveSession) {
    // First open of the app - mark session as active
    sessionStorage.setItem(SESSION_KEY, Date.now().toString());
    
    // Check if we need to force refresh to clear stale cache
    const lastRefresh = localStorage.getItem('levelup_last_refresh');
    const now = Date.now();
    
    // If app was last refreshed more than 1 hour ago, force a clean reload
    if (lastRefresh && (now - parseInt(lastRefresh)) > 3600000) {
      localStorage.setItem('levelup_last_refresh', now.toString());
      // Use cache-busting reload
      location.reload(true);
    } else if (!lastRefresh) {
      // First time ever - just set the timestamp
      localStorage.setItem('levelup_last_refresh', now.toString());
    }
  }
  
  // Handle visibility changes (app going to/from background)
  document.addEventListener('visibilitychange', function() {
    if (document.hidden) {
      lastHidden = Date.now();
    } else {
      const hiddenDuration = Date.now() - lastHidden;
      
      if (lastHidden > 0 && hiddenDuration > REFRESH_THRESHOLD) {
        const gameEl = document.getElementById('game');
        const resultsEl = document.getElementById('results');
        const isInGame = gameEl && gameEl.classList.contains('active');
        const isInResults = resultsEl && resultsEl.classList.contains('active');
        
        if (!isInGame && !isInResults) {
          localStorage.setItem('levelup_last_refresh', Date.now().toString());
          location.reload(true);
        }
      }
    }
  });
  
  // Handle iOS bfcache
  window.addEventListener('pageshow', function(event) {
    if (event.persisted) {
      location.reload(true);
    }
  });
})();

// ========== PWA/GOOGLE PLAY ENGAGEMENT TRACKING ==========
// Tracks sessions and time spent for installed app users
(function() {
  // Check if running as installed PWA (standalone or fullscreen mode)
  const isPWA = window.matchMedia('(display-mode: standalone)').matches || 
                window.matchMedia('(display-mode: fullscreen)').matches ||
                window.navigator.standalone === true;
  
  if (!isPWA) return; // Only track for installed app users
  
  const STORAGE_KEY = 'levelup_pwa_engagement';
  const sessionStart = Date.now();
  
  // Get existing engagement data or initialize
  let engagement = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
  if (!engagement.firstOpen) engagement.firstOpen = sessionStart;
  if (!engagement.sessions) engagement.sessions = [];
  if (!engagement.totalSessions) engagement.totalSessions = 0;
  if (!engagement.totalTimeMs) engagement.totalTimeMs = 0;
  
  // Start new session
  engagement.totalSessions++;
  engagement.lastOpen = sessionStart;
  
  // Save on page unload/hide
  function saveEngagement() {
    const timeSpent = Date.now() - sessionStart;
    engagement.totalTimeMs += timeSpent;
    engagement.sessions.push({
      date: new Date(sessionStart).toISOString(),
      durationMs: timeSpent
    });
    // Keep only last 50 sessions to avoid storage bloat
    if (engagement.sessions.length > 50) {
      engagement.sessions = engagement.sessions.slice(-50);
    }
    localStorage.setItem(STORAGE_KEY, JSON.stringify(engagement));
  }
  
  // Track when user leaves
  document.addEventListener('visibilitychange', function() {
    if (document.hidden) saveEngagement();
  });
  window.addEventListener('pagehide', saveEngagement);
  window.addEventListener('beforeunload', saveEngagement);
  
  // Log for debugging (can be viewed in browser console)
  console.log('📱 PWA Mode Detected - Tracking engagement');
  console.log('Total sessions:', engagement.totalSessions);
  console.log('Total time:', Math.round(engagement.totalTimeMs / 60000) + ' minutes');
})();

// ========== LIGHTWEIGHT ANALYTICS ==========
// Sends anonymous events to VPS for funnel visibility
(function(){
  const ANALYTICS_URL='https://api.100levelup.com/api/analytics';
  const SESSION_ID=Math.random().toString(36).slice(2)+Date.now().toString(36);
  let eventQueue=[];
  let flushTimer=null;

  window.trackEvent=function(event,props){
    eventQueue.push({
      e:event,
      p:props||{},
      t:Date.now(),
      s:SESSION_ID,
      l:data?data.level:0,
      g:data?data.games:0
    });
    // Batch send every 5 seconds or when queue hits 10
    if(eventQueue.length>=10){flushEvents();}
    else if(!flushTimer){flushTimer=setTimeout(flushEvents,5000);}
  };

  function flushEvents(){
    if(flushTimer){clearTimeout(flushTimer);flushTimer=null;}
    if(eventQueue.length===0)return;
    let batch=eventQueue.splice(0);
    try{
      if(navigator.sendBeacon){
        navigator.sendBeacon(ANALYTICS_URL,JSON.stringify({events:batch}));
      }else{
        fetch(ANALYTICS_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({events:batch}),keepalive:true}).catch(()=>{});
      }
    }catch(e){}
  }

  // Flush on page exit
  document.addEventListener('visibilitychange',function(){if(document.hidden)flushEvents();});
  window.addEventListener('pagehide',flushEvents);

  // Auto-track page load
  window.trackEvent('page_load',{ref:document.referrer||'direct',url:location.href});

  // Track outbound link clicks (WhatsApp, Calendly, paylinks)
  document.addEventListener('click',function(e){
    let link=e.target.closest('a[href]');
    if(link&&link.href){
      let href=link.href;
      if(href.includes('wa.me'))window.trackEvent('click_whatsapp',{coach:href.includes('18184399770')?'arthur':href.includes('34613734121')?'laurie':href.includes('19105261160')?'aurora':href.includes('37477449962')?'heghine':href.includes('19738730425')?'roger':'unknown'});
      else if(href.includes('calendly'))window.trackEvent('click_calendly');
      else if(href.includes('_paylink'))window.trackEvent('click_paylink',{url:href});
      else if(href.includes('apps.apple.com'))window.trackEvent('click_appstore');
    }
  });
})();
</script>

<!-- Coach Profile Overlays -->
<div class="coach-profile-overlay" id="coachProfileLaurie" onclick="if(event.target===this)this.classList.remove('active')">
<div class="coach-profile-card">
<button class="cp-close" onclick="document.getElementById('coachProfileLaurie').classList.remove('active')">✕</button>
<img src="laurie.jpg" alt="Laurie Van Werde" class="cp-photo">
<div class="cp-name">Laurie Van Werde</div>
<div class="cp-location">📍 Catalonia, Spain</div>
<div class="cp-langs">
<span class="cp-lang">🇺🇸 English</span>
<span class="cp-lang">🇳🇱 Dutch</span>
</div>
<div class="cp-price">$250 <span>/session</span></div>
<div class="cp-divider"></div>
<div class="cp-section-title">Specialties</div>
<div class="cp-specialties">
<span class="cp-specialty">Pattern Recognition</span>
<span class="cp-specialty">Hypnosis</span>
<span class="cp-specialty">EFT Tapping</span>
<span class="cp-specialty">NLP</span>
</div>
<div class="cp-divider"></div>
<div class="cp-section-title">About Laurie</div>
<div class="cp-bio">Laurie serves as the platform's first Dutch-speaking coach, bringing the 7 Levels of Self framework to over 30 million Dutch speakers across the Netherlands, Belgium, Suriname, and South Africa. Based in Catalonia, Spain, she also leads translation efforts to make the game's 6,854 scenarios accessible in Dutch. In addition to coaching, she is completing certifications in hypnosis, EFT tapping, and NLP, which she integrates with the 7 Levels of Self framework. Certified by founder Arthur Palyan.</div>
<div class="cp-actions">
<a href="https://wa.me/+34613734121?text=Hi%20Laurie,%20I've%20been%20playing%20Level%20Up%20and%20have%20some%20questions%20about%20coaching." target="_blank" style="background:#25D366;" onclick="event.stopPropagation()">💬 WhatsApp</a>
<a href="https://www.levelsofself.com/_paylink/AZusz5dC" target="_blank" style="background:linear-gradient(135deg,var(--pink),var(--purple));" onclick="event.stopPropagation()">Book Session</a>
</div>
</div>
</div>

<div class="coach-profile-overlay" id="coachProfileAurora" onclick="if(event.target===this)this.classList.remove('active')">
<div class="coach-profile-card">
<button class="cp-close" onclick="document.getElementById('coachProfileAurora').classList.remove('active')">✕</button>
<img src="aurora.jpg" alt="Aurora Maier" class="cp-photo">
<div class="cp-name">Aurora Maier</div>
<div class="cp-location">📍 Shelter Cove, California</div>
<div class="cp-langs">
<span class="cp-lang">🇺🇸 English</span>
<span class="cp-lang">🇰🇷 Korean</span>
</div>
<div class="cp-price">$100 <span>/session</span></div>
<div class="cp-divider"></div>
<div class="cp-section-title">Specialties</div>
<div class="cp-specialties">
<span class="cp-specialty">Pattern Recognition</span>
<span class="cp-specialty">Generational Patterns</span>
<span class="cp-specialty">Cultural Identity</span>
<span class="cp-specialty">Family Dynamics</span>
</div>
<div class="cp-divider"></div>
<div class="cp-section-title">About Aurora</div>
<div class="cp-bio">Aurora is the first bilingual coach certified in the 7 Levels of Self, bringing the framework to Korean speakers across the United States and South Korea. She addresses generational patterns and cultural expectations unique to the Korean community: unspoken expectations around success, sacrifice, and family duty that get passed down without question. She also assists with translating the game's 6,854 scenarios for Korean-speaking users worldwide. Certified by founder Arthur Palyan.</div>
<div class="cp-actions">
<a href="https://wa.me/+19105261160?text=Hi%20Aurora,%20I've%20been%20playing%20Level%20Up%20and%20have%20some%20questions%20about%20coaching." target="_blank" style="background:#25D366;" onclick="event.stopPropagation()">💬 WhatsApp</a>
<a href="https://www.levelsofself.com/_paylink/AZwqmg6N" target="_blank" style="background:linear-gradient(135deg,var(--pink),var(--purple));" onclick="event.stopPropagation()">Book Session</a>
</div>
</div>
</div>

<div class="coach-profile-overlay" id="coachProfileHeghine" onclick="if(event.target===this)this.classList.remove('active')">
<div class="coach-profile-card">
<button class="cp-close" onclick="document.getElementById('coachProfileHeghine').classList.remove('active')">✕</button>
<img src="heghine.jpg" alt="Heghine Manukyan" class="cp-photo">
<div class="cp-name">Heghine Manukyan</div>
<div class="cp-location">📍 Yerevan, Armenia</div>
<div class="cp-langs">
<span class="cp-lang">🇦🇲 Armenian</span>
<span class="cp-lang">🇷🇺 Russian</span>
</div>
<div class="cp-price">$100 <span>/session</span></div>
<div class="cp-divider"></div>
<div class="cp-section-title">Specialties</div>
<div class="cp-specialties">
<span class="cp-specialty">Pattern Recognition</span>
<span class="cp-specialty">Generational Patterns</span>
<span class="cp-specialty">Cross-Cultural Communication</span>
<span class="cp-specialty">Entrepreneurship</span>
</div>
<div class="cp-divider"></div>
<div class="cp-section-title">About Heghine</div>
<div class="cp-bio">Heghine brings 15 years of entrepreneurial experience as founder of Yeraz Travel Agency in Yerevan, Armenia. Her expertise in client relationships, cross-cultural communication, and navigating complex life situations makes her uniquely qualified to serve Armenian and Russian-speaking clients seeking personal transformation. She brings the 7 Levels of Self framework to an estimated 10 million Armenian speakers and 250 million Russian speakers across more than 20 countries. Certified by founder Arthur Palyan.</div>
<div class="cp-actions">
<a href="https://wa.me/+37477449962?text=Hi%20Heghine,%20I've%20been%20playing%20Level%20Up%20and%20have%20some%20questions%20about%20coaching." target="_blank" style="background:#25D366;" onclick="event.stopPropagation()">💬 WhatsApp</a>
<a href="https://www.levelsofself.com/_paylink/AZwqmRJr" target="_blank" style="background:linear-gradient(135deg,var(--pink),var(--purple));" onclick="event.stopPropagation()">Book Session</a>
</div>
</div>
</div>

<div class="coach-profile-overlay" id="coachProfileRoger" onclick="if(event.target===this)this.classList.remove('active')">
<div class="coach-profile-card">
<button class="cp-close" onclick="document.getElementById('coachProfileRoger').classList.remove('active')">✕</button>
<img src="roger.jpg" alt="Roger Walter" class="cp-photo">
<div class="cp-name">Roger Walter</div>
<div class="cp-location">📍 United States</div>
<div class="cp-langs">
<span class="cp-lang">🇺🇸 English</span>
<span class="cp-lang">🇪🇸 Spanish</span>
<span class="cp-lang">🇧🇷 Portuguese</span>
</div>
<div class="cp-price">$100 <span>/session</span></div>
<div class="cp-divider"></div>
<div class="cp-section-title">Specialties</div>
<div class="cp-specialties">
<span class="cp-specialty">Communication & Connection</span>
<span class="cp-specialty">Cultural Bridging</span>
<span class="cp-specialty">Family & Relationships</span>
<span class="cp-specialty">Personal Growth</span>
</div>
<div class="cp-divider"></div>
<div class="cp-section-title">About Roger</div>
<div class="cp-bio">Roger is a trilingual communicator with a BA in International Relations from George Washington University and an MA in Education with cognition emphasis from Universidad del Norte in Barranquilla, Colombia. After 15 years as a high school Spanish teacher and trilingual wedding officiant, Roger brings deep expertise in human connection, cross-cultural understanding, and the psychology of learning. A dedicated father and husband of 16 years, he understands the real challenges of balancing personal growth with family life. Roger brings the 7 Levels of Self framework to over 500 million Spanish speakers and 250 million Portuguese speakers worldwide. Certified by founder Arthur Palyan.</div>
<div class="cp-actions">
<a href="https://wa.me/+19738730425?text=Hi%20Roger,%20I've%20been%20playing%20Level%20Up%20and%20have%20some%20questions%20about%20coaching." target="_blank" style="background:#25D366;" onclick="event.stopPropagation()">💬 WhatsApp</a>
<a href="https://www.levelsofself.com/_paylink/AZwqnSCH" target="_blank" style="background:linear-gradient(135deg,var(--pink),var(--purple));" onclick="event.stopPropagation()">Book Session</a>
</div>
</div>
</div>

</body>
</html>