<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Level Up">
<meta name="theme-color" content="#0d0a1a">
<meta name="description" content="See the patterns that quietly run your life. A game that reveals why you keep repeating the same mistakes.">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://100levelup.com/">
<meta property="og:title" content="Level Up - See Your Patterns">
<meta property="og:description" content="See the patterns that quietly run your life. The game that reveals why you keep repeating the same mistakes.">
<meta property="og:image" content="https://100levelup.com/og-game.png">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="https://100levelup.com/">
<meta name="twitter:title" content="Level Up - See Your Patterns">
<meta name="twitter:description" content="See the patterns that quietly run your life. The game that reveals why you keep repeating the same mistakes.">
<meta name="twitter:image" content="https://100levelup.com/og-game.png">

<link rel="icon" type="image/png" sizes="32x32" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="16x16" href="apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="manifest" href="manifest.json">
<title>Level Up - See Your Patterns | 7 Levels of Self</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0d0a1a;--card:rgba(30,26,46,0.95);--border:#3d3655;--text:#f5f0ff;--muted:#b8b0cc;
  --pink:#FF3CAC;--orange:#FF6B35;--purple:#784BA0;--blue:#2F80ED;--green:#00D26A;--yellow:#F7C948;--silver:#C0C0C0;--red:#FF4757;--gold:#FFD700;--cyan:#00D8FF;
  --grad-primary:linear-gradient(135deg,var(--orange),var(--pink));
  --grad-secondary:linear-gradient(135deg,var(--purple),var(--blue));
  --grad-success:linear-gradient(135deg,var(--green),#00B85D);
  --grad-warning:linear-gradient(135deg,var(--yellow),var(--orange));
  --shadow-sm:0 2px 8px rgba(0,0,0,0.15);
  --shadow-md:0 4px 20px rgba(0,0,0,0.25);
  --shadow-glow:0 0 30px rgba(255,60,172,0.4);
  --transition-fast:all 0.2s ease;
  --transition-normal:all 0.3s ease
}
body{font-family:'Inter',system-ui,-apple-system,sans-serif;background:linear-gradient(180deg,#1a1035 0%,#0d0a1a 100%);min-height:100vh;color:var(--text);overflow-x:hidden}
body::-webkit-scrollbar{display:none}
*{scrollbar-width:none}
.app{max-width:500px;margin:0 auto;padding:16px;padding-top:20px;padding-bottom:40px}
.hook{position:fixed;inset:0;background:linear-gradient(180deg,#1a1035 0%,#0d0a1a 100%);display:flex;align-items:center;justify-content:center;z-index:300;text-align:center;padding:24px}
.hook.hidden{display:none}
.hook-line{font-size:36px;font-weight:800;margin-bottom:16px;opacity:0;transform:translateY(20px);background:linear-gradient(135deg,var(--orange),var(--pink),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hook-line.show{animation:fadeUp 0.8s forwards}
.hook-sub{font-size:17px;color:var(--muted);line-height:1.6;margin:24px 0;opacity:0}
.hook-sub.show{animation:fadeUp 0.8s forwards}
.hook-btn{padding:18px 48px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:16px;color:#fff;font-size:18px;font-weight:700;cursor:pointer;opacity:0;transform:translateY(20px)}
.hook-btn.show{animation:fadeUp 0.6s forwards}
@keyframes fadeUp{to{opacity:1;transform:translateY(0)}}
.onboard{position:fixed;inset:0;background:linear-gradient(180deg,#1a1035 0%,#0d0a1a 100%);display:none;flex-direction:column;align-items:center;justify-content:center;z-index:200;overflow-y:auto}
.onboard.active{display:flex}
.onboard-screen{display:none;flex-direction:column;align-items:center;justify-content:center;min-height:auto;width:100%;max-width:700px;padding:40px 30px;text-align:center}
.onboard-screen.active{display:flex}
.onboard-title{font-size:32px;font-weight:800;text-align:center;margin:20px 0 16px;background:linear-gradient(135deg,var(--orange),var(--pink),var(--purple),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.onboard-sub{text-align:center;color:var(--muted);font-size:17px;margin-bottom:20px}
.onboard-text{text-align:center;color:var(--muted);font-size:17px;line-height:1.6;margin-bottom:6px}
.onboard-text2{text-align:center;color:var(--text);font-size:16px;margin-bottom:6px}
.onboard-highlight{text-align:center;color:var(--text);font-size:17px;font-weight:600}
.onboard-highlight strong{color:var(--pink)}
.onboard-spacer{height:16px}
.onboard-levels{display:flex;flex-direction:column;gap:8px;margin-bottom:20px;width:100%}
.onboard-level{display:flex;align-items:center;gap:14px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px 16px}
.onboard-num{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700;color:#000;flex-shrink:0}
.onboard-info{flex:1}
.onboard-name{font-size:16px;font-weight:600}
.onboard-desc{font-size:14px;color:var(--muted)}
.onboard-dots{display:flex;justify-content:center;gap:8px;margin:20px 0}
.dot{width:8px;height:8px;border-radius:50%;background:var(--border)}
.dot.active{background:var(--pink)}
.onboard-btns{display:flex;gap:12px;width:100%;max-width:700px;padding:20px 30px;margin-top:24px}
.onboard-skip{padding:18px 28px;background:transparent;border:none;color:var(--muted);font-size:16px;cursor:pointer}
.onboard-next,.onboard-start{flex:1;padding:18px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:12px;color:#fff;font-size:17px;font-weight:700;cursor:pointer}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.logo{font-size:22px;font-weight:800;background:linear-gradient(135deg,var(--orange),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.controls{display:flex;gap:8px}
.ctrl-btn{width:40px;height:40px;border-radius:50%;background:var(--card);border:1px solid var(--border);color:var(--muted);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--transition-fast)}
.ctrl-btn:hover{transform:translateY(-2px);box-shadow:var(--shadow-sm)}
.ctrl-btn:active{transform:scale(0.95)}
.ctrl-btn.on{background:linear-gradient(135deg,var(--orange),var(--pink));color:#fff;border:none}
.ctrl-btn.qa-btn{background:linear-gradient(135deg,var(--purple),var(--blue));color:#fff;border:none;box-shadow:0 2px 8px rgba(120,75,160,0.4)}
.ctrl-btn.heart-btn{background:linear-gradient(135deg,#FF4757,#FF6B81);color:#fff;border:none;box-shadow:0 2px 8px rgba(255,71,87,0.4)}
.ctrl-btn.founder-btn{background:linear-gradient(135deg,var(--gold),var(--orange));color:#fff;border:none;box-shadow:0 2px 8px rgba(255,215,0,0.4)}
.login-bonus{background:linear-gradient(135deg,rgba(255,215,0,0.15),rgba(255,107,53,0.15));border:2px solid var(--gold);border-radius:12px;padding:14px;margin-bottom:16px;text-align:center;cursor:pointer;display:none}
.login-bonus.show{display:block;animation:glow 2s ease-in-out infinite}
@keyframes glow{0%,100%{box-shadow:0 0 5px var(--gold)}50%{box-shadow:0 0 20px var(--gold)}}
.login-title{font-size:14px;font-weight:700;color:var(--gold);margin-bottom:4px}
.login-sub{font-size:12px;color:var(--muted)}
.streak-warning{background:linear-gradient(135deg,rgba(255,71,87,0.2),rgba(255,107,53,0.2));border:2px solid var(--red);border-radius:12px;padding:12px;margin-bottom:16px;text-align:center;display:none;animation:shake 0.5s ease}
.streak-warning.show{display:block}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
.streak-warning-text{font-size:13px;color:var(--red);font-weight:600}
.hero{text-align:center;margin-bottom:20px}
.hero h1{font-size:26px;font-weight:800;margin-bottom:8px;background:linear-gradient(135deg,var(--orange),var(--pink),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero p{color:var(--muted);font-size:14px}
.challenge{background:var(--card);border:2px solid var(--pink);border-radius:16px;padding:18px;margin-bottom:16px;cursor:pointer;transition:var(--transition-fast);box-shadow:var(--shadow-glow);position:relative;overflow:hidden}
.challenge::after{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--grad-primary)}
.challenge:hover{box-shadow:0 8px 30px rgba(255,60,172,0.3);transform:translateY(-4px)}
.challenge:active{transform:scale(0.98)}
.badge{display:inline-flex;align-items:center;gap:6px;background:var(--grad-primary);color:#fff;font-size:10px;font-weight:700;padding:5px 10px;border-radius:20px;margin-bottom:10px}
.badge-dot{width:6px;height:6px;background:#fff;border-radius:50%;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.5;transform:scale(0.8)}}
.challenge h2{font-size:20px;font-weight:700;margin-bottom:6px}
.challenge p{color:var(--muted);font-size:13px;margin-bottom:12px;line-height:1.5}
.challenge-footer{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);align-items:center}
.challenge.done{opacity:0.6;border-color:var(--green);box-shadow:0 4px 20px rgba(0,210,106,0.3)}
.challenge.done .badge{background:var(--green)}
.xp-container{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:16px;box-shadow:var(--shadow-md);position:relative}
.xp-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.xp-level{font-size:15px;font-weight:700;color:var(--gold);text-shadow:0 0 10px rgba(255,215,0,0.3);display:flex;align-items:center;gap:8px}
.xp-text{font-size:12px;color:var(--muted);margin-top:8px;display:flex;justify-content:space-between}
.xp-bar{height:10px;background:var(--border);border-radius:5px;overflow:hidden;box-shadow:inset 0 2px 4px rgba(0,0,0,0.3);position:relative}
.xp-fill{height:100%;background:var(--grad-warning);border-radius:5px;transition:width 0.5s cubic-bezier(0.2,0.8,0.2,1);box-shadow:0 0 10px rgba(255,215,0,0.5);position:relative;overflow:hidden}
.xp-fill::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);animation:shimmer 2s infinite}
@keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
.xp-coins{display:flex;align-items:center;gap:4px;font-size:14px;color:var(--gold);font-weight:600}
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:16px}
.stat{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px 6px;text-align:center;transition:var(--transition-fast);box-shadow:var(--shadow-sm);cursor:pointer}
.stat:hover{transform:translateY(-4px);box-shadow:var(--shadow-md)}
.stat-val{font-size:24px;font-weight:800;background:var(--grad-primary);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.stat-label{font-size:9px;font-weight:700;color:var(--muted);text-transform:uppercase;margin-top:4px;letter-spacing:0.5px}
.insights-stat{cursor:pointer;border:2px solid var(--pink);box-shadow:0 0 12px rgba(255,60,172,0.3)}
.insights-stat:hover{box-shadow:0 0 20px rgba(255,60,172,0.5)}
.pattern-card{display:none;background:linear-gradient(135deg,rgba(120,75,160,0.2),rgba(255,60,172,0.1));border:2px solid var(--purple);border-radius:16px;padding:18px;margin-bottom:16px;cursor:pointer;transition:var(--transition-normal);position:relative;overflow:hidden}
.pattern-card.show{display:block}
.pattern-card::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg,transparent,rgba(255,255,255,0.03),transparent);transform:rotate(45deg);animation:patternShimmer 3s infinite}
@keyframes patternShimmer{0%{transform:translateX(-100%) rotate(45deg)}100%{transform:translateX(100%) rotate(45deg)}}
.pattern-card:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(120,75,160,0.3)}
.pattern-header{display:flex;align-items:center;gap:10px;margin-bottom:12px}
.pattern-icon{font-size:28px}
.pattern-label{font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--purple);font-weight:700}
.pattern-archetype{font-size:20px;font-weight:800;background:linear-gradient(135deg,var(--purple),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:8px}
.pattern-edge{font-size:14px;color:var(--text);line-height:1.5;margin-bottom:12px}
.pattern-challenge{background:rgba(0,0,0,0.3);border-radius:10px;padding:12px;border-left:3px solid var(--gold)}
.pattern-challenge-label{font-size:9px;text-transform:uppercase;letter-spacing:1px;color:var(--gold);font-weight:700;margin-bottom:6px}
.pattern-challenge-text{font-size:13px;color:var(--text);line-height:1.5}
.pattern-tap{font-size:11px;color:var(--muted);text-align:center;margin-top:12px}
.modes{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px}
.mode{background:var(--card);border:2px solid var(--pink);border-radius:16px;padding:20px 14px;text-align:center;cursor:pointer;position:relative;transition:var(--transition-fast);box-shadow:0 4px 20px rgba(255,60,172,0.15)}
.mode:hover{box-shadow:0 8px 30px rgba(255,60,172,0.25);transform:translateY(-4px)}
.mode:active{transform:scale(0.97)}
.mode.locked{opacity:0.5;border-color:var(--border);box-shadow:0 2px 10px rgba(0,0,0,0.15);cursor:not-allowed}
.mode.locked:hover{box-shadow:0 2px 10px rgba(0,0,0,0.15);transform:none}
.mode.locked::after{content:'üîí';position:absolute;top:10px;right:10px;font-size:16px}
.mode.locked:hover{box-shadow:0 2px 10px rgba(0,0,0,0.15);transform:none}
.mode.locked::after{content:'üîí';position:absolute;top:10px;right:10px;font-size:16px}
.mode.newly-unlocked{border-color:var(--pink);box-shadow:0 0 20px rgba(255,60,172,0.5);animation:unlockPulse 2s ease-in-out infinite}
.level.newly-unlocked{border:2px solid var(--pink);box-shadow:0 0 15px rgba(255,60,172,0.4);animation:unlockPulse 2s ease-in-out infinite}
@keyframes unlockPulse{0%,100%{box-shadow:0 0 15px rgba(255,60,172,0.4)}50%{box-shadow:0 0 25px rgba(255,60,172,0.7)}}
.mode-icon{font-size:40px;margin-bottom:12px;line-height:1}
.mode-name{font-size:16px;font-weight:700;margin-bottom:6px}
.mode-desc{font-size:12px;color:var(--muted);line-height:1.4}
.mode-unlock{font-size:10px;color:var(--gold);margin-top:8px;font-weight:600}
.section-title{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:2px;margin-bottom:14px}
.levels{display:flex;flex-direction:column;gap:8px;margin-bottom:20px}
.level{display:flex;align-items:center;gap:14px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;cursor:pointer;transition:all 0.2s;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.level.unlocked{border:2px solid var(--pink);box-shadow:0 2px 12px rgba(255,60,172,0.25)}
.level:hover{border-color:var(--pink);transform:translateX(4px);box-shadow:0 4px 12px rgba(0,0,0,0.15)}
.level:active{transform:scale(0.98)}
.level.locked{opacity:0.4;cursor:not-allowed}
.level.locked:hover{transform:none;border-color:var(--border)}
.level-num{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:15px;font-weight:800;color:#000;flex-shrink:0;box-shadow:0 2px 8px rgba(0,0,0,0.2)}
.level-info{flex:1}
.level-name{font-size:15px;font-weight:600}
.level-desc{font-size:12px;color:var(--muted);margin-top:2px}
.action-btns{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px}
.action-btn{display:flex;align-items:center;justify-content:center;gap:8px;background:var(--card);border:2px solid var(--border);border-radius:12px;padding:14px;cursor:pointer;text-decoration:none;color:var(--text);transition:all 0.2s;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.action-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.2)}
.action-btn:active{transform:scale(0.97)}
.action-btn-icon{font-size:20px}
.action-btn-text{font-size:14px;font-weight:600}
.action-btn.assess{border-color:var(--blue);background:linear-gradient(135deg,rgba(47,128,237,0.1),rgba(47,128,237,0.05))}
.action-btn.assess:hover{border-color:var(--blue);box-shadow:0 4px 15px rgba(47,128,237,0.3)}
.action-btn.share{border-color:var(--green);background:linear-gradient(135deg,rgba(0,210,106,0.1),rgba(0,210,106,0.05))}
.action-btn.share:hover{border-color:var(--green);box-shadow:0 4px 15px rgba(0,210,106,0.3)}
.footer{text-align:center;padding:16px 0}
.footer-btns{display:flex;flex-direction:column;gap:12px;margin-bottom:12px}
.footer-btn{display:block;padding:14px 24px;background:var(--card);border:2px solid var(--pink);border-radius:12px;color:var(--text);text-decoration:none;font-size:14px;font-weight:600;transition:var(--transition-fast)}
.footer-btn:hover{background:rgba(255,60,172,0.15);transform:translateY(-2px);box-shadow:0 4px 15px rgba(255,60,172,0.2)}
.footer-btn.primary{background:var(--grad-primary);border:none;color:#fff}
.footer-btn.primary:hover{box-shadow:0 4px 20px rgba(255,60,172,0.4)}
.game{display:none}
.game.active{display:block}
.home.hidden{display:none}
.game-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
.game-info{font-size:14px}
.game-mode{color:var(--muted);font-size:11px;text-transform:uppercase;letter-spacing:1px}
.game-combo{font-size:12px;color:var(--gold);font-weight:700;display:flex;align-items:center;gap:4px}
.quit{width:40px;height:40px;border-radius:50%;background:rgba(255,71,87,0.15);border:2px solid var(--red);color:var(--red);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--transition-fast)}
.quit:hover{transform:rotate(90deg);background:rgba(255,71,87,0.25)}
.timer{height:6px;background:var(--border);border-radius:3px;margin-bottom:16px;overflow:hidden;position:relative}
.timer.hidden{display:none}
.timer-fill{height:100%;width:100%;background:var(--green);transition:width 0.1s linear;position:relative}
.timer-fill::after{content:'';position:absolute;top:0;right:0;bottom:0;width:4px;background:rgba(255,255,255,0.5);animation:pulse 1s infinite}
.timer-fill.warn{background:var(--yellow)}
.timer-fill.danger{background:var(--red)}
.scenario{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px;margin-bottom:14px;position:relative}
.scenario-cat{display:inline-block;background:var(--border);padding:5px 10px;border-radius:16px;font-size:10px;text-transform:uppercase;margin-bottom:12px;font-weight:600;letter-spacing:0.5px}
.scenario-text{font-size:16px;line-height:1.6}
.choices{display:flex;flex-direction:column;gap:10px}
.choice{width:100%;padding:16px;background:var(--card);border:2px solid var(--border);border-radius:12px;color:var(--text);font-size:15px;text-align:left;cursor:pointer;line-height:1.5;transition:var(--transition-fast);box-shadow:var(--shadow-sm)}
.choice:hover{border-color:var(--pink);transform:translateX(4px);box-shadow:0 4px 12px rgba(255,60,172,0.15)}
.choice:active{transform:scale(0.98);border-color:var(--pink)}
.choice:disabled{cursor:default;transform:none}
.choice.selected{border-color:var(--pink);background:rgba(255,60,172,0.15);box-shadow:0 0 15px rgba(255,60,172,0.2)}
.choice.correct{border-color:var(--green);background:rgba(0,210,106,0.15);box-shadow:0 0 15px rgba(0,210,106,0.2)}
.choice.wrong{border-color:var(--red);background:rgba(255,71,87,0.15);box-shadow:0 0 15px rgba(255,71,87,0.2)}
.choice.dim{opacity:0.25}
.results{display:none;text-align:center;padding-top:40px;padding-bottom:100px}
.results.active{display:block}
.results h2{font-size:26px;margin-bottom:16px;font-weight:800;background:var(--grad-primary);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.score{font-size:72px;font-weight:900;background:linear-gradient(135deg,var(--orange),var(--pink),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin:20px 0;text-shadow:0 0 40px rgba(255,60,172,0.3);animation:scoreBounce 1s ease}
@keyframes scoreBounce{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
.result-msg{font-size:17px;color:var(--muted);margin-bottom:24px;line-height:1.6;padding:0 20px}
.results-btn{width:100%;padding:18px;background:var(--grad-primary);border:none;border-radius:14px;color:#fff;font-size:16px;font-weight:700;cursor:pointer;margin-bottom:12px;box-shadow:0 4px 15px rgba(255,60,172,0.3);transition:var(--transition-fast)}
.results-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(255,60,172,0.4)}
.results-share{width:100%;padding:16px;background:var(--card);border:2px solid var(--green);border-radius:14px;color:var(--green);font-size:15px;font-weight:700;cursor:pointer;transition:var(--transition-fast)}
.results-share:hover{background:rgba(0,210,106,0.1);box-shadow:0 4px 15px rgba(0,210,106,0.2)}
.insights-list{text-align:left;margin:20px 0;max-height:200px;overflow-y:auto}
.insight-item{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px 14px;margin-bottom:8px;font-size:14px;line-height:1.5;transition:var(--transition-fast)}
.insight-item:hover{border-color:var(--pink);transform:translateX(4px)}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.92);display:none;align-items:center;justify-content:center;padding:20px;z-index:100;backdrop-filter:blur(4px);animation:modalFadeIn 0.3s ease}
@keyframes modalFadeIn{from{opacity:0}to{opacity:1}}
.modal.active{display:flex}
.modal-content{background:linear-gradient(180deg,rgba(40,35,60,0.98),rgba(25,20,40,0.98));border:1px solid var(--border);border-radius:20px;padding:28px;max-width:360px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,0.5);animation:modalSlide 0.3s ease}
@keyframes modalSlide{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
.modal-icon{font-size:48px;text-align:center;margin-bottom:12px;animation:iconBounce 2s infinite}
@keyframes iconBounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
.modal-title{font-size:24px;font-weight:800;text-align:center;margin-bottom:18px;background:var(--grad-primary);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.feedback-box{background:rgba(0,0,0,0.4);border-radius:12px;padding:16px;margin-bottom:18px;border:1px solid var(--border)}
.feedback-label{font-size:10px;color:var(--purple);text-transform:uppercase;margin-bottom:10px;font-weight:700;letter-spacing:1px}
.feedback-text{font-size:15px;line-height:1.6}
.modal-btn{width:100%;padding:16px;background:var(--grad-primary);border:none;border-radius:12px;color:#fff;font-size:16px;font-weight:700;cursor:pointer;transition:var(--transition-fast);box-shadow:0 4px 15px rgba(255,60,172,0.3)}
.modal-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(255,60,172,0.4)}
.modal-btn:active{transform:scale(0.98)}
.bonus-popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);background:var(--grad-warning);border-radius:20px;padding:30px;text-align:center;z-index:400;box-shadow:0 0 40px rgba(255,215,0,0.5)}
.bonus-popup.show{transform:translate(-50%,-50%) scale(1);animation:bonusPop 0.5s ease}
@keyframes bonusPop{0%{transform:translate(-50%,-50%) scale(0)}50%{transform:translate(-50%,-50%) scale(1.1)}100%{transform:translate(-50%,-50%) scale(1)}}
.bonus-icon{font-size:60px;margin-bottom:10px;animation:spinOnce 1s ease}
@keyframes spinOnce{from{transform:rotate(0)}to{transform:rotate(360deg)}}
.bonus-title{font-size:24px;font-weight:800;color:#000;margin-bottom:8px}
.bonus-sub{font-size:16px;color:rgba(0,0,0,0.7)}
.levelup-popup{position:fixed;inset:0;background:rgba(0,0,0,0.95);display:none;align-items:center;justify-content:center;z-index:500;backdrop-filter:blur(10px)}
.levelup-popup.show{display:flex}
.levelup-content{text-align:center;animation:levelUpAnim 1s ease}
@keyframes levelUpAnim{0%{transform:scale(0) rotate(-10deg);opacity:0}50%{transform:scale(1.2) rotate(5deg)}100%{transform:scale(1) rotate(0);opacity:1}}
.levelup-icon{font-size:80px;margin-bottom:20px;animation:iconBounce 2s infinite}
.levelup-title{font-size:36px;font-weight:900;background:linear-gradient(135deg,var(--gold),var(--orange));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:10px}
.levelup-sub{font-size:18px;color:var(--muted);margin-bottom:20px}
.levelup-unlock{font-size:14px;color:var(--green);margin-bottom:20px}
.levelup-btn{padding:16px 40px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:12px;color:#fff;font-size:16px;font-weight:700;cursor:pointer}
.combo-display{position:fixed;top:100px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,var(--orange),var(--pink));padding:10px 20px;border-radius:20px;font-size:16px;font-weight:800;color:#fff;opacity:0;z-index:50}
.combo-display.show{opacity:1;animation:comboPop 0.5s ease}
@keyframes comboPop{0%{transform:translateX(-50%) scale(0.5)}50%{transform:translateX(-50%) scale(1.2)}100%{transform:translateX(-50%) scale(1)}}
.toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%);background:var(--grad-success);color:#fff;padding:14px 28px;border-radius:14px;font-size:14px;font-weight:600;opacity:0;transition:var(--transition-normal);z-index:500;pointer-events:none;box-shadow:0 4px 20px rgba(0,210,106,0.4)}
.toast.show{opacity:1;transform:translateX(-50%) translateY(-10px)}
.qa-item{border-bottom:1px solid var(--border);padding:14px 0}
.qa-item:last-of-type{border:none}
.qa-question{font-size:14px;font-weight:600;cursor:pointer;padding:10px 0;display:flex;justify-content:space-between;align-items:center;color:var(--text);gap:12px;transition:var(--transition-fast)}
.qa-question:hover{color:var(--pink)}
.qa-question::after{content:'+';color:var(--pink);font-size:20px;font-weight:700;width:28px;height:28px;background:rgba(255,60,172,0.15);border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:var(--transition-normal)}
.qa-item.open .qa-question::after{content:'‚àí';background:rgba(255,60,172,0.3)}
.qa-answer{font-size:13px;color:var(--muted);line-height:1.7;max-height:0;overflow:hidden;transition:max-height 0.3s ease,padding 0.3s ease}
.qa-item.open .qa-answer{max-height:500px;padding-top:12px}
#confetti{position:fixed;inset:0;pointer-events:none;z-index:1000}
.install-banner{position:fixed;bottom:0;left:0;right:0;background:var(--grad-secondary);padding:16px 20px;display:none;align-items:center;justify-content:space-between;gap:12px;z-index:600;box-shadow:0 -4px 20px rgba(0,0,0,0.4);animation:slideUp 0.3s ease}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.install-banner.show{display:flex}
.install-banner-text{flex:1}
.install-banner-title{font-size:14px;font-weight:700;margin-bottom:2px}
.install-banner-sub{font-size:12px;color:rgba(255,255,255,0.8)}
.install-banner-btn{padding:10px 20px;background:#fff;color:var(--purple);border:none;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;white-space:nowrap}
.install-banner-close{background:none;border:none;color:rgba(255,255,255,0.6);font-size:20px;cursor:pointer;padding:4px}
.ios-modal{position:fixed;inset:0;background:rgba(0,0,0,0.92);display:none;align-items:flex-end;justify-content:center;padding:20px;z-index:700}
.ios-modal.active{display:flex}
.ios-modal-content{background:var(--card);border:1px solid var(--border);border-radius:20px 20px 0 0;padding:24px;width:100%;max-width:400px;text-align:center;animation:slideUp 0.3s ease}
.ios-modal-title{font-size:18px;font-weight:700;margin-bottom:16px}
.ios-modal-steps{text-align:left;margin:16px 0}
.ios-modal-step{display:flex;align-items:center;gap:12px;margin-bottom:12px;font-size:14px}
.ios-modal-icon{font-size:24px}
.ios-modal-btn{width:100%;padding:14px;background:var(--grad-primary);border:none;border-radius:12px;color:#fff;font-size:15px;font-weight:700;cursor:pointer;margin-top:8px;transition:var(--transition-fast)}
.ios-modal-btn:hover{transform:translateY(-2px);box-shadow:0 4px 20px rgba(255,60,172,0.3)}

/* Media Queries */
@media(max-width:480px){
  .hook-line{font-size:28px}
  .onboard-title{font-size:24px}
  .hero h1{font-size:22px}
  .score{font-size:56px}
  .stats{grid-template-columns:repeat(2,1fr)}
  .action-btns{grid-template-columns:1fr}
}
@media(min-width:768px){
  .app{max-width:600px;padding:24px}
}

/* Utility Classes */
.hidden{display:none!important}
.fade-in{animation:fadeIn 0.5s ease}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
</style>
</head>
<body>
<canvas id="confetti"></canvas>
<div class="install-banner" id="installBanner">
<button class="install-banner-close" id="installClose">√ó</button>
<div class="install-banner-text">
<div class="install-banner-title">üì≤ Add to Home Screen</div>
<div class="install-banner-sub">Play daily without opening browser</div>
</div>
<button class="install-banner-btn" id="installBtn">Install</button>
</div>
<div class="ios-modal" id="iosModal">
<div class="ios-modal-content">
<div class="ios-modal-title">Add Level Up to Home Screen</div>
<div class="ios-modal-steps">
<div class="ios-modal-step"><span class="ios-modal-icon">üì§</span><span>Tap the <strong>Share</strong> button below</span></div>
<div class="ios-modal-step"><span class="ios-modal-icon">‚ûï</span><span>Scroll and tap <strong>"Add to Home Screen"</strong></span></div>
<div class="ios-modal-step"><span class="ios-modal-icon">‚úì</span><span>Tap <strong>Add</strong> in the top right</span></div>
</div>
<button class="ios-modal-btn" id="iosClose">Got it!</button>
</div>
</div>
<audio id="music" loop><source src="level-up.mp3" type="audio/mpeg"></audio>
<div class="toast" id="toast">+10 XP!</div>
<div class="combo-display" id="comboDisplay">üî• 3x COMBO!</div>
<div class="bonus-popup" id="bonusPopup"><div class="bonus-icon">üéÅ</div><div class="bonus-title">BONUS!</div><div class="bonus-sub" id="bonusText">+25 XP</div></div>
<div class="levelup-popup" id="levelupPopup"><div class="levelup-content"><div class="levelup-icon" id="levelupIcon">‚≠ê</div><div class="levelup-title">LEVEL UP!</div><div class="levelup-sub" id="levelupText">You're now Level 2</div><div class="levelup-unlock" id="levelupUnlock"></div><button class="levelup-btn" id="levelupBtn">Amazing!</button></div></div>

<div class="hook" id="hook"><div><div class="hook-line" id="line1">See the patterns</div><div class="hook-line" id="line2">that quietly run your life.</div><div class="hook-sub" id="hookSub">Discover why you keep repeating the same mistakes.</div><button class="hook-btn" id="hookBtn">Show Me</button></div></div>

<div class="onboard" id="onboard">
<div class="onboard-screen active" id="onboard1"><div class="onboard-title">There Are Levels To This</div><div class="onboard-text">Most people are stuck ‚Äî not because they lack knowledge, but because they're working on the wrong level.</div><div class="onboard-spacer"></div><div class="onboard-text2">Rewire your brain through play.</div><div class="onboard-text2">Mirror reveals. Agreement trains. Decision challenges.</div><div class="onboard-spacer"></div><div class="onboard-highlight">The goal isn't the "highest" level.<br>It's the <strong>right</strong> level.</div><div class="onboard-dots"><span class="dot active"></span><span class="dot"></span></div><div class="onboard-btns"><button class="onboard-skip" id="skipBtn">Skip</button><button class="onboard-next" id="nextBtn1">Next</button></div></div>
<div class="onboard-screen" id="onboard2"><div class="onboard-title">The 7 Levels of Self</div><div class="onboard-sub">Master each level to unlock the next.</div><div class="onboard-levels"><div class="onboard-level"><div class="onboard-num" style="background:#FF6B35">1</div><div class="onboard-info"><div class="onboard-name">Individual</div><div class="onboard-desc">Your relationship with yourself</div></div></div><div class="onboard-level"><div class="onboard-num" style="background:#FF3CAC">2</div><div class="onboard-info"><div class="onboard-name">Family</div><div class="onboard-desc">Your closest relationships</div></div></div><div class="onboard-level"><div class="onboard-num" style="background:#784BA0">3</div><div class="onboard-info"><div class="onboard-name">Groups</div><div class="onboard-desc">Teams, friends, communities</div></div></div><div class="onboard-level"><div class="onboard-num" style="background:#2F80ED">4</div><div class="onboard-info"><div class="onboard-name">Community</div><div class="onboard-desc">Your role in the larger whole</div></div></div><div class="onboard-level"><div class="onboard-num" style="background:#00D26A">5</div><div class="onboard-info"><div class="onboard-name">Society</div><div class="onboard-desc">Systems, culture, nation</div></div></div><div class="onboard-level"><div class="onboard-num" style="background:#F7C948">6</div><div class="onboard-info"><div class="onboard-name">World</div><div class="onboard-desc">Global connection</div></div></div><div class="onboard-level"><div class="onboard-num" style="background:#C0C0C0">7</div><div class="onboard-info"><div class="onboard-name">Generations</div><div class="onboard-desc">Legacy that outlasts you</div></div></div></div><div class="onboard-dots"><span class="dot"></span><span class="dot active"></span></div><div class="onboard-btns"><button class="onboard-skip" id="skipBtn2">Skip</button><button class="onboard-start" id="goBtn">Let's Go</button></div></div>
</div>

<div class="app">
<div class="home" id="home">
<div class="header"><div class="logo">LEVEL UP</div><div class="controls"><button class="ctrl-btn" id="musicBtn">üéµ</button><button class="ctrl-btn on" id="soundBtn">üîä</button><button class="ctrl-btn heart-btn" id="aiBtn">‚ù§Ô∏è</button><button class="ctrl-btn qa-btn" id="qaBtn">‚ùì</button><button class="ctrl-btn founder-btn" id="founderBtn">üë§</button></div></div>

<div class="login-bonus" id="loginBonus"><div class="login-title">üéÅ Daily Login Bonus!</div><div class="login-sub">Tap to claim <span id="loginReward">+20 XP</span></div></div>
<div class="streak-warning" id="streakWarning"><div class="streak-warning-text">‚ö†Ô∏è Play today or lose your <span id="streakCount">0</span>-day streak!</div></div>

<div class="hero"><h1>See Your Patterns</h1><p>The game that reveals what's really running your life.</p></div>

<div class="challenge" id="dailyCard"><div class="badge"><span class="badge-dot"></span>TRENDING GLOBALLY</div><h2>Worldwide Challenge</h2><p>Same 3 scenarios for everyone on Earth. One chance daily.</p><div class="challenge-footer"><span id="dailyCta">Tap to join the global movement</span><span id="dailyTimer">Resets in --:--:--</span></div></div>

<div class="xp-container"><div class="xp-header"><div class="xp-level" id="playerLevel">Level 1</div><div class="xp-coins">ü™ô <span id="coinCount">0</span></div></div><div class="xp-bar"><div class="xp-fill" id="xpFill" style="width:0%"></div></div><div class="xp-text"><span id="xpCurrent">0</span> / <span id="xpNeeded">100</span> XP</div></div>

<div class="stats"><div class="stat"><div class="stat-val" id="statPlayed">0</div><div class="stat-label">Played</div></div><div class="stat"><div class="stat-val" id="statStreak">0</div><div class="stat-label">Streak</div></div><div class="stat"><div class="stat-val" id="statAcceptRate">0%</div><div class="stat-label">Acceptance</div></div><div class="stat insights-stat" id="insightsStat"><div class="stat-val" id="statInsights">0</div><div class="stat-label">Insights</div></div></div>

<div class="pattern-card" id="patternCard">
<div class="pattern-header"><span class="pattern-icon" id="patternIcon">üîÆ</span><span class="pattern-label">Your Pattern</span></div>
<div class="pattern-archetype" id="patternArchetype">The Aware One</div>
<div class="pattern-edge" id="patternEdge">You see yourself clearly. Now the question is: what will you do with what you see?</div>
<div class="pattern-challenge">
<div class="pattern-challenge-label">Today's Practice</div>
<div class="pattern-challenge-text" id="patternChallenge">Notice one moment today when a pattern you recognized shows up. You don't have to change it‚Äîjust notice.</div>
</div>
<div class="pattern-tap">Tap for full profile ‚Üí</div>
</div>

<div class="modes"><div class="mode" id="mirrorMode"><div class="mode-icon" style="font-family:'Apple Color Emoji','Segoe UI Emoji','Noto Color Emoji',sans-serif;">ü™û</div><div class="mode-name">Mirror Game</div><div class="mode-desc">See yourself honestly</div><div class="mode-unlock" id="mirrorUnlock"></div></div><div class="mode" id="agreementMode"><div class="mode-icon" style="font-family:'Apple Color Emoji','Segoe UI Emoji','Noto Color Emoji',sans-serif;">‚öñÔ∏è</div><div class="mode-name">Agreement Game</div><div class="mode-desc">Acceptance vs Judgment</div><div class="mode-unlock" id="agreementUnlock"></div></div></div>

<div class="section-title">Your Journey</div>
<div class="levels" id="levelMap"></div>

<div class="action-btns"><a class="action-btn assess" href="https://selfcheck.100levelup.com/assessment.html" target="_blank" rel="noopener"><span class="action-btn-icon">üìã</span><span class="action-btn-text">Full Assessment</span></a><button class="action-btn share" id="shareBtn"><span class="action-btn-icon">üîó</span><span class="action-btn-text">Share</span></button></div>

<div class="footer">
<div class="footer-btns">
<a class="footer-btn primary" href="https://www.levelsofself.com/post/the-7-levels-of-self-explained" target="_blank" rel="noopener">Learn the Full Framework</a>
<a class="footer-btn" href="https://www.levelsofself.com" target="_blank" rel="noopener">LevelsOfSelf.com</a>
</div>
<div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border);text-align:center;">
<p style="font-size:12px;color:var(--muted);line-height:1.6;">Built by <span style="color:var(--gold);font-weight:600;cursor:pointer;" onclick="document.getElementById('founderModal').classList.add('active')">Arthur Palyan</span> on the framework he uses with founders, leaders, and clients worldwide.</p>
</div>
</div>
</div>

<div class="game" id="game"><div class="game-header"><div class="game-info"><div class="game-mode" id="gameMode">Mirror</div><div id="gameProgress">1/5</div><div class="game-combo" id="gameCombo"></div></div><button class="quit" id="quitBtn">‚úï</button></div><div class="timer" id="timerBar"><div class="timer-fill" id="timerFill"></div></div><div class="scenario"><div class="scenario-cat" id="scenarioCat">Level 1: Individual</div><div class="scenario-text" id="scenarioText">Loading...</div></div><div class="choices" id="choices"></div></div>

<div class="results" id="results"><h2 id="resultsTitle">Game Complete</h2><div class="score" id="finalScore">0</div><p class="result-msg" id="resultMsg">Keep going!</p><div class="insights-list" id="insightsList"></div><button class="results-btn" id="homeBtn">Continue</button><button class="results-share" id="resultsShare">üì§ Share Results</button></div>
</div>

<div class="modal" id="qaModal"><div class="modal-content" id="qaContent" style="max-height:80vh;overflow-y:auto;position:relative;scroll-behavior:smooth;">
<button onclick="document.getElementById('qaModal').classList.remove('active')" style="position:absolute;top:12px;right:12px;width:32px;height:32px;border-radius:50%;background:var(--card);border:1px solid var(--border);color:var(--muted);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:10;">‚úï</button>
<div class="modal-title" style="margin-top:8px;">Questions & Answers</div>
<div style="display:flex;justify-content:center;margin-bottom:16px;">
<button onclick="document.getElementById('qaBottom').scrollIntoView({behavior:'smooth'})" style="padding:10px 20px;background:var(--card);border:1px solid var(--border);border-radius:20px;color:var(--muted);font-size:13px;cursor:pointer;display:flex;align-items:center;gap:6px;"><span style="font-size:18px;">‚¨á</span> Jump to Bottom</button>
</div>
<div class="qa-item"><div class="qa-question">What is the 7 Levels framework?</div><div class="qa-answer">The 7 Levels of Self maps human growth across 7 dimensions: Individual (self), Family (close relationships), Groups (teams/friends), Community (local impact), Society (systems/culture), World (global connection), and Generations (legacy). You can't skip levels - each must be mastered before climbing higher.</div></div>
<div class="qa-item"><div class="qa-question">What's the difference between the 3 games?</div><div class="qa-answer"><strong style="color:var(--pink);">ü™û Mirror Game:</strong> Self-reflection. See patterns honestly. No right/wrong - just recognition.<br><br><strong style="color:var(--purple);">‚öñÔ∏è Agreement Game:</strong> Train yourself to choose acceptance over judgment. Timed to build instinct.<br><br><strong style="color:var(--orange);">üåç Worldwide Challenge:</strong> Same 3 scenarios for everyone globally. One chance daily. Builds streak.</div></div>
<div class="qa-item"><div class="qa-question">How does scoring and leveling work?</div><div class="qa-answer"><strong>XP System:</strong> Every answer earns XP. Correct/accepting answers earn more. Combos multiply rewards!<br><br><strong>Level Up:</strong> Every 100 XP = 1 level. Levels unlock new game modes and framework levels.<br><br><strong>Unlocks:</strong><br>‚Ä¢ Level 2: Agreement Game + Family<br>‚Ä¢ Level 3: Groups<br>‚Ä¢ Level 5: Community<br>‚Ä¢ Level 7: Society<br>‚Ä¢ Level 10: World<br>‚Ä¢ Level 15: Generations</div></div>
<div class="qa-item"><div class="qa-question">What does "Acceptance ‚â† Agreement" mean?</div><div class="qa-answer">This is the core philosophy. <strong>Acceptance</strong> means acknowledging reality as it is. <strong>Agreement</strong> means endorsing it.<br><br>You can accept that something IS without agreeing it SHOULD BE. Acceptance is the first step to change - you can't transform what you won't acknowledge.</div></div>
<div class="qa-item"><div class="qa-question">What is the ‚ù§Ô∏è Deep Insight button?</div><div class="qa-answer">Deep Insight examines your gameplay patterns and generates personalized insights about your growth journey:<br><br>‚Ä¢ <strong>Your Growth Pattern:</strong> A personalized summary of where you are<br>‚Ä¢ <strong>Self-Awareness & Acceptance Scores:</strong> How you see and accept yourself<br>‚Ä¢ <strong>Recurring Themes:</strong> Patterns like boundaries, control, self-worth<br>‚Ä¢ <strong>Your Archetype:</strong> A growth personality based on your patterns<br>‚Ä¢ <strong>Recommended Practice:</strong> Which level to focus on next<br><br>Play at least 10 games to unlock this feature.</div></div>
<div class="qa-item"><div class="qa-question">What are Archetypes?</div><div class="qa-answer">Based on your gameplay patterns, you're matched with one of these growth archetypes:<br><br><strong style="color:#FF6B35;">üî• The Boundary Builder:</strong> Learning to protect your energy<br><strong style="color:#784BA0;">üîÆ The Pattern Seeker:</strong> Seeing connections others miss<br><strong style="color:#2F80ED;">üåä The Flow Finder:</strong> Releasing control for peace<br><strong style="color:#00D26A;">üå± The Growth Gardener:</strong> Nurturing steady progress<br><strong style="color:#F7C948;">‚ö° The Truth Teller:</strong> Embracing radical honesty<br><strong style="color:#FF3CAC;">üí´ The Integration Master:</strong> Balancing all dimensions</div></div>
<div class="qa-item"><div class="qa-question">What are Insights and how do I use them?</div><div class="qa-answer">Every pattern you recognize in Mirror Game gets saved to your Insights collection. Tap the <strong>Insights stat</strong> on the home screen to review them.<br><br>They're organized by level and date so you can:<br>‚Ä¢ Track your growth over time<br>‚Ä¢ Share with therapists or coaches<br>‚Ä¢ Notice recurring patterns<br>‚Ä¢ Celebrate your self-awareness journey</div></div>
<div class="qa-item"><div class="qa-question">What is Mixed Mode?</div><div class="qa-answer">When you tap a level on the Journey map, you can choose <strong>Mixed Mode</strong> which combines Mirror Game and Agreement Game questions in a shuffled order.<br><br>This is great for:<br>‚Ä¢ Variety in gameplay<br>‚Ä¢ Testing both recognition AND acceptance skills<br>‚Ä¢ Focused practice on a specific level</div></div>
<div class="qa-item"><div class="qa-question">How do streaks and bonuses work?</div><div class="qa-answer"><strong>Daily Login Bonus:</strong> Log in each day to claim increasing XP rewards (up to 100 XP on day 7).<br><br><strong>Streak:</strong> Complete the Worldwide Challenge daily to build your streak. Miss a day and it resets!<br><br><strong>Combos:</strong> Get multiple correct answers in a row for bonus XP (5x combo = +15 XP, 10x = +40 XP).</div></div>
<div class="qa-item"><div class="qa-question">Can I use this with my therapist or coach?</div><div class="qa-answer">Absolutely! Your insights reveal growth patterns that can deepen therapeutic or coaching work.<br><br>Ways to use it:<br>‚Ä¢ Share your Insights collection<br>‚Ä¢ Discuss your archetype and growth edge<br>‚Ä¢ Track progress between sessions<br>‚Ä¢ Use scenarios as conversation starters</div></div>
<div class="qa-item"><div class="qa-question">Is this a substitute for therapy?</div><div class="qa-answer"><strong style="color:var(--yellow);">No.</strong> This game is for self-reflection and personal growth‚Äîit is not therapy, diagnosis, or treatment.<br><br>If you're experiencing a mental health crisis, please reach out for professional support:<br><br><strong style="color:var(--green);">üÜò Crisis Resources:</strong><br>‚Ä¢ <strong>988 Suicide & Crisis Lifeline:</strong> Call or text 988 (US)<br>‚Ä¢ <strong>Crisis Text Line:</strong> Text HOME to 741741<br>‚Ä¢ <strong>International:</strong> <a href="https://findahelpline.com" target="_blank" style="color:var(--blue);">findahelpline.com</a><br><br><em style="color:var(--muted);">You are not alone. Help is available.</em></div></div>
<div id="qaActions" style="display:flex;flex-direction:column;gap:12px;margin-top:12px;padding-top:12px;">
<div style="font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px;text-align:center;">Quick Actions</div>
<a href="https://selfcheck.100levelup.com/assessment.html" target="_blank" style="display:block;padding:14px;background:linear-gradient(135deg,var(--orange),var(--pink));border-radius:12px;color:#fff;font-size:15px;font-weight:700;text-decoration:none;text-align:center;">üìã Take Full Assessment</a>
<button onclick="if(navigator.share){navigator.share({title:'Level Up - 7 Levels of Self',text:'See the patterns that quietly run your life.',url:'https://100levelup.com'})}else{navigator.clipboard.writeText('https://100levelup.com');showToast('üìã Link copied!')}" style="padding:14px;background:linear-gradient(135deg,var(--pink),var(--purple));border:none;border-radius:12px;color:#fff;font-size:15px;font-weight:600;cursor:pointer;">üì§ Share This Game</button>
<button onclick="document.getElementById('qaModal').classList.remove('active');document.getElementById('founderModal').classList.add('active');" style="padding:14px;background:linear-gradient(135deg,var(--gold),var(--orange));border:none;border-radius:12px;color:#fff;font-size:15px;font-weight:600;cursor:pointer;">üë§ Meet the Founder</button>
<button id="resetBtn" style="padding:14px;background:transparent;border:2px solid var(--red);border-radius:12px;color:var(--red);font-size:14px;font-weight:600;cursor:pointer;margin-top:8px;">üîÑ Reset All Progress</button>
</div>
<div id="qaBottom"></div>
<button class="modal-btn" id="qaClose" style="margin-top:16px;background:var(--card);border:1px solid var(--border);color:var(--muted);">Close</button></div></div>

<div class="modal" id="feedbackModal"><div class="modal-content"><div class="modal-icon" id="fbIcon">üí°</div><div class="modal-title" id="fbTitle">Insight</div><div class="feedback-box"><div class="feedback-label" id="fbLabel">Reflection</div><div class="feedback-text" id="fbText">...</div></div><button class="modal-btn" id="nextBtn">Next</button></div></div>

<div class="modal" id="insightsModal"><div class="modal-content" style="max-height:80vh;overflow-y:auto"><div class="modal-title">Your Insights</div>
<div id="insightsFilter" style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px;justify-content:center;"></div>
<div id="insightsListModal" style="text-align:left;"></div><div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border);"><button class="modal-btn" id="insightsClose">Close</button></div></div></div>

<div class="modal" id="levelSelectModal"><div class="modal-content">
<div class="modal-title" id="levelSelectTitle">Level 1: Individual</div>
<div style="color:var(--muted);text-align:center;margin-bottom:20px;" id="levelSelectDesc">Your relationship with yourself</div>
<div style="display:flex;flex-direction:column;gap:12px;">
<button class="modal-btn" id="levelMirrorBtn" style="background:linear-gradient(135deg,var(--pink),var(--purple));">ü™û Mirror Game<br><span style="font-size:12px;font-weight:400;opacity:0.8;">See yourself honestly</span></button>
<button class="modal-btn" id="levelAgreementBtn" style="background:linear-gradient(135deg,var(--purple),var(--blue));">‚öñÔ∏è Agreement Game<br><span style="font-size:12px;font-weight:400;opacity:0.8;">Practice acceptance</span></button>
<button class="modal-btn" id="levelMixedBtn" style="background:linear-gradient(135deg,var(--orange),var(--pink));">üé≤ Mixed Mode<br><span style="font-size:12px;font-weight:400;opacity:0.8;">Both games shuffled</span></button>
<button class="modal-btn" id="levelInsightsBtn" style="background:linear-gradient(135deg,var(--gold),var(--orange));">üí° Your Insights<br><span style="font-size:12px;font-weight:400;opacity:0.8;" id="levelInsightsCount">0 collected</span></button>
</div>
<button id="levelSelectClose" style="margin-top:16px;padding:12px;background:transparent;border:1px solid var(--border);border-radius:10px;color:var(--muted);font-size:14px;cursor:pointer;width:100%;">Cancel</button>
</div></div>

<div class="modal" id="patternModal"><div class="modal-content" style="max-height:85vh;overflow-y:auto">
<div class="modal-title">Your Growth Profile</div>
<div id="patternProfile"></div>
<button class="modal-btn" id="patternClose" style="margin-top:16px;">Close</button>
</div></div>

<div class="modal" id="aiModal"><div class="modal-content" style="max-height:85vh;overflow-y:auto">
<div class="modal-icon">‚ù§Ô∏è</div>
<div class="modal-title" style="background:linear-gradient(135deg,#FF4757,#FF6B81);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">Deep Insight</div>
<div id="aiAnalysisContent" style="background:linear-gradient(135deg,rgba(255,71,87,0.1),rgba(255,107,129,0.1));border:2px solid #FF4757;border-radius:12px;padding:16px;margin-bottom:16px;text-align:left;">
<p style="color:var(--muted);text-align:center;">Play more games to generate personalized analysis!</p>
</div>
<button class="modal-btn" id="aiClose" style="background:linear-gradient(135deg,#FF4757,#FF6B81);">Close</button>
</div></div>

<div class="modal" id="founderModal"><div class="modal-content" style="max-height:85vh;overflow-y:auto">
<div style="text-align:center;margin-bottom:20px;">
<img src="arthur.jpg" alt="Arthur Palyan" style="width:100px;height:100px;border-radius:50%;object-fit:cover;border:3px solid var(--gold);box-shadow:0 4px 20px rgba(255,215,0,0.4);margin-bottom:16px;">
<div style="font-size:22px;font-weight:800;background:linear-gradient(135deg,var(--gold),var(--orange));-webkit-background-clip:text;-webkit-text-fill-color:transparent;">Meet Arthur Palyan</div>
<div style="font-size:13px;color:var(--muted);margin-top:4px;">Creator of the 7 Levels of Self</div>
</div>

<div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:16px;margin-bottom:16px;border-left:3px solid var(--gold);">
<div style="font-size:14px;color:var(--text);line-height:1.7;font-style:italic;">"For 20 years, I helped people transform their financial lives while I was dying inside. No matter how much I achieved, I was never enough. The problem wasn't my circumstances‚Äîit was my foundation: me."</div>
</div>

<div style="font-size:13px;color:var(--muted);line-height:1.7;margin-bottom:16px;">
After 10 years of deep transformational work‚ÄîLandmark, MITT, Insight Seminars, Ancestral Medicine‚ÄîArthur discovered the 7 Levels of Self framework that finally made sense of the journey from broken to whole.
</div>

<div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:16px;">
<div style="font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--gold);font-weight:700;margin-bottom:10px;">Training & Experience</div>
<div style="font-size:12px;color:var(--muted);line-height:1.8;">
‚Ä¢ 20+ years transforming relationships with money<br>
‚Ä¢ Landmark Worldwide<br>
‚Ä¢ MITT (Mastery in Transformational Training)<br>
‚Ä¢ Insight Seminars<br>
‚Ä¢ Ancestral Medicine<br>
‚Ä¢ Creator of 20+ subconscious exercises
</div>
</div>

<div style="background:linear-gradient(135deg,rgba(0,210,106,0.1),rgba(47,128,237,0.1));border:1px solid var(--green);border-radius:12px;padding:16px;margin-bottom:16px;">
<div style="font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--green);font-weight:700;margin-bottom:8px;">Work With Arthur</div>
<div style="font-size:13px;color:var(--text);line-height:1.6;margin-bottom:12px;">Ready to stop performing and start living? Book a coaching session.</div>
<a href="https://wa.me/qr/OFPFUYXQFBMIF1" target="_blank" style="display:block;padding:12px;background:linear-gradient(135deg,var(--green),#00B85D);border-radius:10px;color:#fff;font-size:14px;font-weight:700;text-decoration:none;text-align:center;">üí¨ Book a Session on WhatsApp</a>
</div>

<button class="modal-btn" id="founderClose" style="background:linear-gradient(135deg,var(--gold),var(--orange));">Close</button>
</div></div>

<div class="modal" id="archetypeModal"><div class="modal-content" style="text-align:center;">
<div class="modal-icon" id="archetypeModalIcon">üé≠</div>
<div class="modal-title">Your Archetype</div>
<div style="background:var(--card);border:2px solid var(--pink);border-radius:16px;padding:20px;margin-bottom:16px;">
<div style="font-size:48px;margin-bottom:12px;" id="archetypeIcon">üîÆ</div>
<div style="font-size:24px;font-weight:800;color:var(--pink);margin-bottom:8px;" id="archetypeName">The Wise Observer</div>
<div style="color:var(--muted);font-size:14px;line-height:1.6;margin-bottom:16px;" id="archetypeDesc">You see patterns others miss and understand that true strength comes from understanding rather than control.</div>
<div id="archetypeTraits" style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center;"></div>
</div>
<button class="modal-btn" id="archetypeClose">Amazing!</button>
</div></div>

<div class="modal" id="resetModal"><div class="modal-content" style="text-align:center;">
<div style="font-size:48px;margin-bottom:12px;">‚ö†Ô∏è</div>
<div class="modal-title" style="color:var(--red);">Reset All Progress?</div>
<div style="color:var(--muted);font-size:14px;line-height:1.6;margin-bottom:20px;">This will permanently delete:<br>‚Ä¢ All XP and levels<br>‚Ä¢ Your streak<br>‚Ä¢ All collected insights<br>‚Ä¢ Your pattern profile<br><br><strong style="color:var(--text);">This cannot be undone.</strong></div>
<div style="display:flex;gap:12px;">
<button id="resetCancel" style="flex:1;padding:14px;background:var(--card);border:1px solid var(--border);border-radius:12px;color:var(--muted);font-size:15px;font-weight:600;cursor:pointer;">Cancel</button>
<button id="resetConfirm" style="flex:1;padding:14px;background:var(--red);border:none;border-radius:12px;color:#fff;font-size:15px;font-weight:700;cursor:pointer;">Reset</button>
</div>
</div></div>

<script src="mirror-level1-individual.js"></script>
<script src="mirror-level2-family.js"></script>
<script src="mirror-level3-groups.js"></script>
<script src="mirror-level4-community.js"></script>
<script src="mirror-level5-society.js"></script>
<script src="mirror-level6-world.js"></script>
<script src="mirror-level7-generations.js"></script>
<script src="agreement_game.js"></script>
<script src="worldwide_challenge.js"></script>
<script>
const MIRROR_SCENARIOS=[...(typeof LEVEL_1_INDIVIDUAL!=='undefined'?LEVEL_1_INDIVIDUAL:[]),...(typeof LEVEL_2_FAMILY!=='undefined'?LEVEL_2_FAMILY:[]),...(typeof LEVEL_3_GROUPS!=='undefined'?LEVEL_3_GROUPS:[]),...(typeof LEVEL_4_COMMUNITY!=='undefined'?LEVEL_4_COMMUNITY:[]),...(typeof LEVEL_5_SOCIETY!=='undefined'?LEVEL_5_SOCIETY:[]),...(typeof LEVEL_6_WORLD!=='undefined'?LEVEL_6_WORLD:[]),...(typeof LEVEL_7_GENERATIONS!=='undefined'?LEVEL_7_GENERATIONS:[])];
const LEVELS=[{id:1,name:'Individual',color:'#FF6B35',desc:'Your relationship with yourself'},{id:2,name:'Family',color:'#FF3CAC',desc:'Your closest relationships'},{id:3,name:'Groups',color:'#784BA0',desc:'Teams, friends, communities'},{id:4,name:'Community',color:'#2F80ED',desc:'Your role in the larger whole'},{id:5,name:'Society',color:'#00D26A',desc:'Systems, culture, nation'},{id:6,name:'World',color:'#F7C948',desc:'Global connection'},{id:7,name:'Generations',color:'#C0C0C0',desc:'Legacy that outlasts you'}];
const XP_PER_LEVEL=100;
let music=document.getElementById('music');music.volume=0.4;
let musicOn=false,soundOn=true,currentCombo=0;
let data=JSON.parse(localStorage.getItem('levelup_v7'))||{xp:0,level:1,coins:0,games:0,mirrorRecognized:0,mirrorTotal:0,agreementAccepted:0,agreementTotal:0,streak:0,lastDaily:null,lastLogin:null,loginDay:0,unlockedLevels:[1],unlockedAgreement:false,seenIntro:false,insightsCollection:[],newlyUnlockedLevels:[],seenAgreementUnlock:false};
let game={mode:null,scenarios:[],idx:0,answers:[],timer:null,timeLeft:15,useTimer:true};

function save(){localStorage.setItem('levelup_v7',JSON.stringify(data))}
function shuffle(a){let arr=[...a];for(let i=arr.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]}return arr}
function hashDate(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h=h&h}return Math.abs(h)}

function playSound(f,d){if(!soundOn)return;try{let c=new(window.AudioContext||window.webkitAudioContext)(),o=c.createOscillator(),g=c.createGain();o.frequency.value=f;o.connect(g);g.connect(c.destination);g.gain.setValueAtTime(0.15,c.currentTime);g.gain.exponentialRampToValueAtTime(0.001,c.currentTime+d);o.start();o.stop(c.currentTime+d)}catch(e){}}
function positiveSound(){[523,659,784].forEach((f,i)=>setTimeout(()=>playSound(f,0.15),i*80))}
function neutralSound(){playSound(330,0.2)}
function coinSound(){playSound(988,0.05);setTimeout(()=>playSound(1319,0.3),60)}
function multiCoinSound(n){for(let i=0;i<Math.min(n,5);i++){setTimeout(()=>{playSound(988+i*100,0.05);setTimeout(()=>playSound(1319+i*100,0.2),40)},i*80)}}
function levelUpSound(){[523,659,784,1047].forEach((f,i)=>setTimeout(()=>playSound(f,0.2),i*100))}
function bonusSound(){[784,988,1175,1568].forEach((f,i)=>setTimeout(()=>playSound(f,0.15),i*60))}
function comboSound(n){let base=523;for(let i=0;i<Math.min(n,5);i++){setTimeout(()=>playSound(base+i*50,0.1),i*50)}}

function addXP(amount){
  data.xp+=amount;data.coins+=Math.floor(amount/2);
  let newLevel=Math.floor(data.xp/XP_PER_LEVEL)+1;
  if(newLevel>data.level){
    data.level=newLevel;levelUpSound();triggerConfetti();
    let unlockMsg='';
    if(newLevel===2){data.unlockedAgreement=true;data.seenAgreementUnlock=false;if(!data.unlockedLevels.includes(2)){data.unlockedLevels.push(2);if(!data.newlyUnlockedLevels)data.newlyUnlockedLevels=[];data.newlyUnlockedLevels.push(2);}unlockMsg='üîì Agreement Game unlocked!';}
    if(newLevel===3&&!data.unlockedLevels.includes(3)){data.unlockedLevels.push(3);if(!data.newlyUnlockedLevels)data.newlyUnlockedLevels=[];data.newlyUnlockedLevels.push(3);unlockMsg='üîì Level 3 unlocked!';}
    if(newLevel>=5&&!data.unlockedLevels.includes(4)){data.unlockedLevels.push(4);if(!data.newlyUnlockedLevels)data.newlyUnlockedLevels=[];data.newlyUnlockedLevels.push(4);}
    if(newLevel>=7&&!data.unlockedLevels.includes(5)){data.unlockedLevels.push(5);if(!data.newlyUnlockedLevels)data.newlyUnlockedLevels=[];data.newlyUnlockedLevels.push(5);}
    if(newLevel>=10&&!data.unlockedLevels.includes(6)){data.unlockedLevels.push(6);if(!data.newlyUnlockedLevels)data.newlyUnlockedLevels=[];data.newlyUnlockedLevels.push(6);}
    if(newLevel>=15&&!data.unlockedLevels.includes(7)){data.unlockedLevels.push(7);if(!data.newlyUnlockedLevels)data.newlyUnlockedLevels=[];data.newlyUnlockedLevels.push(7);}
    showLevelUp(newLevel,unlockMsg);
  }
  save();updateXPBar();
}
const GROWTH_ICONS=['üå±','üåø','ü™ª','üå≥','üå≤','üåç','‚≠ê'];
function updateXPBar(){
  let levelXP=(data.level-1)*XP_PER_LEVEL;let currentLevelXP=data.xp-levelXP;let pct=(currentLevelXP/XP_PER_LEVEL)*100;
  let icon=GROWTH_ICONS[Math.min(data.level-1,6)];
  document.getElementById('playerLevel').innerHTML=icon+' Level '+data.level;
  document.getElementById('xpFill').style.width=pct+'%';
  document.getElementById('xpCurrent').textContent=currentLevelXP;
  document.getElementById('xpNeeded').textContent=XP_PER_LEVEL;
  document.getElementById('coinCount').textContent=data.coins;
}
function showLevelUp(level,unlockMsg){
  let icon=GROWTH_ICONS[Math.min(level-1,6)];
  document.getElementById('levelupIcon').textContent=icon;
  document.getElementById('levelupText').textContent="You're now Level "+level+"!";
  document.getElementById('levelupUnlock').textContent=unlockMsg||'';
  document.getElementById('levelupPopup').classList.add('show');
}
document.getElementById('levelupBtn').onclick=function(){document.getElementById('levelupPopup').classList.remove('show')};

function addCombo(){
  currentCombo++;
  if(currentCombo>=3){
    let el=document.getElementById('comboDisplay');el.textContent='üî• '+currentCombo+'x COMBO!';el.classList.add('show');comboSound(currentCombo);
    setTimeout(()=>el.classList.remove('show'),1500);
    if(currentCombo===5){showBonusPopup('+30 XP Combo!');addXP(30);}
    else if(currentCombo===10){showBonusPopup('+50 XP Mega Combo!');addXP(50);}
  }
  document.getElementById('gameCombo').textContent=currentCombo>1?'üî•'+currentCombo+'x':'';
}
function resetCombo(){currentCombo=0;document.getElementById('gameCombo').textContent='';}

function showToast(msg){let t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2000)}
function showBonusPopup(text){document.getElementById('bonusText').textContent=text;document.getElementById('bonusPopup').classList.add('show');bonusSound();setTimeout(()=>document.getElementById('bonusPopup').classList.remove('show'),2500)}
function maybeBonus(){if(Math.random()<0.12){let bonuses=[{text:'+25 XP Bonus!',xp:25},{text:'+50 XP Jackpot!',xp:50},{text:'üíé Rare Insight!',xp:30}];let bonus=bonuses[Math.floor(Math.random()*bonuses.length)];setTimeout(()=>{showBonusPopup(bonus.text);addXP(bonus.xp)},800);return true}return false}

function triggerConfetti(){
  let canvas=document.getElementById('confetti'),ctx=canvas.getContext('2d');canvas.width=window.innerWidth;canvas.height=window.innerHeight;
  let particles=[],colors=['#FF3CAC','#FF6B35','#784BA0','#2F80ED','#00D26A','#F7C948','#FFD700'];
  for(let i=0;i<150;i++){particles.push({x:canvas.width/2,y:canvas.height/2,vx:(Math.random()-0.5)*15,vy:(Math.random()-0.5)*15-5,color:colors[Math.floor(Math.random()*colors.length)],size:Math.random()*8+4,life:1})}
  function animate(){ctx.clearRect(0,0,canvas.width,canvas.height);let alive=false;particles.forEach(p=>{if(p.life<=0)return;alive=true;p.x+=p.vx;p.y+=p.vy;p.vy+=0.3;p.life-=0.015;ctx.globalAlpha=p.life;ctx.fillStyle=p.color;ctx.fillRect(p.x,p.y,p.size,p.size)});if(alive)requestAnimationFrame(animate);else ctx.clearRect(0,0,canvas.width,canvas.height)}animate();
}

function checkDailyLogin(){
  let today=new Date().toDateString();
  if(data.lastLogin!==today){
    let yesterday=new Date(Date.now()-86400000).toDateString();
    data.loginDay=data.lastLogin===yesterday?Math.min(data.loginDay+1,7):1;
    data.lastLogin=today;save();
    let rewards=[20,25,30,40,50,75,100];
    document.getElementById('loginReward').textContent='+'+rewards[data.loginDay-1]+' XP (Day '+data.loginDay+')';
    document.getElementById('loginBonus').classList.add('show');
  }else{document.getElementById('loginBonus').classList.remove('show')}
}
document.getElementById('loginBonus').onclick=function(){
  let rewards=[20,25,30,40,50,75,100];multiCoinSound(data.loginDay);addXP(rewards[data.loginDay-1]);showToast('+'+rewards[data.loginDay-1]+' XP!');this.classList.remove('show');triggerConfetti();
};

function checkStreakWarning(){
  if(data.streak>0&&data.lastDaily!==new Date().toDateString()){document.getElementById('streakCount').textContent=data.streak;document.getElementById('streakWarning').classList.add('show')}
  else{document.getElementById('streakWarning').classList.remove('show')}
}

function addInsight(text,level){if(text&&!data.insightsCollection.some(i=>i.text===text)){data.insightsCollection.push({text:text,level:level||1,date:new Date().toLocaleDateString()});if(data.insightsCollection.length>200)data.insightsCollection=data.insightsCollection.slice(-200);save()}}

function updateHome(){
  updateXPBar();checkDailyLogin();checkStreakWarning();
  document.getElementById('statPlayed').textContent=data.games;
  document.getElementById('statInsights').textContent=data.insightsCollection?data.insightsCollection.length:0;
  document.getElementById('statStreak').textContent=data.streak||0;
  let acceptRate=data.agreementTotal>0?Math.round((data.agreementAccepted/data.agreementTotal)*100):0;
  document.getElementById('statAcceptRate').textContent=acceptRate+'%';
  let today=new Date().toDateString(),daily=document.getElementById('dailyCard');
  if(data.lastDaily===today){daily.classList.add('done');document.getElementById('dailyCta').textContent='‚úì Completed today'}
  else{daily.classList.remove('done');document.getElementById('dailyCta').textContent='Tap to join the global movement'}
  document.getElementById('mirrorMode').classList.remove('locked','newly-unlocked');document.getElementById('mirrorUnlock').textContent='';
  if(data.unlockedAgreement){
    document.getElementById('agreementMode').classList.remove('locked');
    document.getElementById('agreementUnlock').textContent='';
    if(!data.seenAgreementUnlock){document.getElementById('agreementMode').classList.add('newly-unlocked');}
  }
  else{document.getElementById('agreementMode').classList.add('locked');document.getElementById('agreementMode').classList.remove('newly-unlocked');document.getElementById('agreementUnlock').textContent='Reach Level 2'}
  let map=document.getElementById('levelMap');map.innerHTML='';
  LEVELS.forEach(lv=>{
    let unlocked=data.unlockedLevels.includes(lv.id);
    let isNew=unlocked&&data.newlyUnlockedLevels&&data.newlyUnlockedLevels.includes(lv.id);
    let div=document.createElement('div');div.className='level'+(unlocked?' unlocked':' locked')+(isNew?' newly-unlocked':'');
    let unlockText='Reach Player Level '+lv.id;
    div.innerHTML='<div class="level-num" style="background:'+lv.color+'">'+lv.id+'</div><div class="level-info"><div class="level-name">'+lv.name+(unlocked?'':' üîí')+'</div><div class="level-desc">'+(unlocked?lv.desc:unlockText)+'</div></div>';
    if(unlocked){div.onclick=()=>{if(isNew){data.newlyUnlockedLevels=data.newlyUnlockedLevels.filter(x=>x!==lv.id);save();div.classList.remove('newly-unlocked');}showLevelSelect(lv)};}map.appendChild(div);
  });
  updateTimer();
  updatePatternCard();
}
function updateTimer(){let now=new Date(),tom=new Date(now);tom.setDate(tom.getDate()+1);tom.setHours(0,0,0,0);let d=tom-now,h=String(Math.floor(d/3600000)).padStart(2,'0'),m=String(Math.floor((d%3600000)/60000)).padStart(2,'0'),s=String(Math.floor((d%60000)/1000)).padStart(2,'0');document.getElementById('dailyTimer').textContent='Resets in '+h+':'+m+':'+s}

// ============ PATTERN ANALYSIS SYSTEM ============
const ARCHETYPES = [
  {id:'honest-avoider',name:'The Honest Avoider',icon:'ü™û',condition:(p)=>p.mirrorRecognition>=0.7&&p.acceptanceRate<0.5,edge:'You see yourself clearly but struggle to act on what you see. Your growth edge is courage.',challenges:['Notice one moment today when you see a pattern but choose not to act. What stops you?','When you recognize something about yourself today, take one tiny action on it.','Ask yourself: "What am I protecting by not acting on what I know?"']},
  {id:'compassionate-boundary-breaker',name:'The Compassionate Boundary-Breaker',icon:'üíî',condition:(p)=>p.boundaryTheme>=0.3&&p.acceptanceRate>=0.6,edge:'You accept others easily but let yourself get crossed. Your growth edge is self-protection.',challenges:['Notice one moment today when you say yes but mean no.','Practice: "I hear you, and I need to think about it."','Ask yourself: "Whose feelings am I protecting at the cost of my own?"']},
  {id:'aware-procrastinator',name:'The Aware Procrastinator',icon:'‚è≥',condition:(p)=>p.mirrorRecognition>=0.6&&p.controlTheme>=0.25,edge:'You understand your patterns but delay changing them. Your growth edge is starting before you feel ready.',challenges:['Pick one pattern you recognized recently. Take one 2-minute action on it today.','Notice when "I\'ll do it later" appears. What feeling is underneath?','Ask yourself: "What\'s the smallest possible step I could take right now?"']},
  {id:'self-critical-achiever',name:'The Self-Critical Achiever',icon:'‚ö°',condition:(p)=>p.mirrorRecognition>=0.5&&p.worthTheme>=0.25&&p.acceptanceRate<0.6,edge:'You push yourself hard but struggle with self-compassion. Your growth edge is being as kind to yourself as you are to others.',challenges:['When you catch yourself being self-critical today, ask: "Would I say this to a friend?"','Notice one thing you did well today. Let yourself feel it for 10 seconds.','Practice: "I did my best with what I had."']},
  {id:'peaceful-avoider',name:'The Peaceful Avoider',icon:'üïäÔ∏è',condition:(p)=>p.mirrorRecognition<0.5&&p.acceptanceRate>=0.7,edge:'You accept others easily but may be avoiding your own mirror. Your growth edge is honest self-examination.',challenges:['Ask yourself: "What am I afraid to see about myself?"','Notice if you deflect when someone gives you feedback today.','Try: "That might be true about me. Let me sit with it."']},
  {id:'growth-seeker',name:'The Growth Seeker',icon:'üå±',condition:(p)=>p.mirrorRecognition>=0.6&&p.acceptanceRate>=0.6,edge:'You see yourself and accept what you see. Your growth edge is going deeper, not wider.',challenges:['Pick your most recognized pattern. What\'s underneath it?','Instead of adding new insights, spend time with one you already have.','Ask: "What would change if I fully lived what I already know?"']},
  {id:'emerging-observer',name:'The Emerging Observer',icon:'üëÅÔ∏è',condition:(p)=>p.games>=10&&p.games<20,edge:'You\'re building the habit of self-reflection. Your growth edge is consistency.',challenges:['Play one game today. Streaks build the muscle.','Notice one pattern from yesterday showing up today.','Ask: "What did I learn about myself this week?"']},
  {id:'default',name:'The Aware One',icon:'üîÆ',condition:()=>true,edge:'You\'re on the path. Keep looking.',challenges:['Notice one moment today when you react instead of respond.','Ask yourself: "What pattern am I in right now?"','Practice pausing before responding to anything that triggers you.']}
];

function analyzePatterns(){
  if(data.games<10)return null;
  let insights=data.insightsCollection||[];
  let profile={
    games:data.games,
    mirrorRecognition:data.mirrorTotal>0?(data.mirrorRecognized||insights.length)/Math.max(data.mirrorTotal,1):0,
    acceptanceRate:data.agreementTotal>0?data.agreementAccepted/data.agreementTotal:0.5,
    boundaryTheme:0,
    controlTheme:0,
    worthTheme:0,
    authenticityTheme:0,
    fearTheme:0,
    attachmentTheme:0,
    topLevels:{}
  };
  // Extended keyword detection
  let boundaryWords=['boundary','boundaries','no','yes','peace','please','avoid','conflict','protect','safe','space','limit','refuse','people please','doormat','taken advantage','stand up','speak up','voice','silent'];
  let controlWords=['control','perfect','right','wrong','should','must','fix','order','plan','organize','anxious','worry','certain','uncertain','chaos','mess','failure','mistake'];
  let worthWords=['worth','deserve','enough','value','matter','good enough','worthy','love yourself','self-esteem','confidence','imposter','fraud','belong','fit in','measure up','compare','inferior','prove','validation','approval'];
  let authenticityWords=['authentic','real','true','mask','pretend','fake','hide','show','reveal','vulnerable','honest','lie','truth','self','identity','who I am','perform','image','reputation'];
  let fearWords=['fear','afraid','scared','anxiety','panic','worry','dread','avoid','run','escape','danger','threat','risk','unknown','what if'];
  let attachmentWords=['attach','cling','need','depend','abandon','leave','alone','lonely','connection','close','distant','push away','pull close','smother','neglect','available'];
  
  insights.forEach(i=>{
    let t=(i.text||'').toLowerCase();
    if(boundaryWords.some(w=>t.includes(w)))profile.boundaryTheme+=0.04;
    if(controlWords.some(w=>t.includes(w)))profile.controlTheme+=0.04;
    if(worthWords.some(w=>t.includes(w)))profile.worthTheme+=0.04;
    if(authenticityWords.some(w=>t.includes(w)))profile.authenticityTheme+=0.04;
    if(fearWords.some(w=>t.includes(w)))profile.fearTheme+=0.04;
    if(attachmentWords.some(w=>t.includes(w)))profile.attachmentTheme+=0.04;
    profile.topLevels[i.level]=(profile.topLevels[i.level]||0)+1;
  });
  profile.boundaryTheme=Math.min(profile.boundaryTheme,1);
  profile.controlTheme=Math.min(profile.controlTheme,1);
  profile.worthTheme=Math.min(profile.worthTheme,1);
  profile.authenticityTheme=Math.min(profile.authenticityTheme,1);
  profile.fearTheme=Math.min(profile.fearTheme,1);
  profile.attachmentTheme=Math.min(profile.attachmentTheme,1);
  for(let arch of ARCHETYPES){if(arch.condition(profile))return{archetype:arch,profile:profile}}
  return{archetype:ARCHETYPES[ARCHETYPES.length-1],profile:profile};
}

function getDailyChallenge(archetype){
  let dayOfYear=Math.floor((Date.now()-new Date(new Date().getFullYear(),0,0))/86400000);
  return archetype.challenges[dayOfYear%archetype.challenges.length];
}

function updatePatternCard(){
  let analysis=analyzePatterns();
  let card=document.getElementById('patternCard');
  if(!analysis){card.classList.remove('show');return}
  card.classList.add('show');
  document.getElementById('patternIcon').textContent=analysis.archetype.icon;
  document.getElementById('patternArchetype').textContent=analysis.archetype.name;
  document.getElementById('patternEdge').textContent=analysis.archetype.edge;
  document.getElementById('patternChallenge').textContent=getDailyChallenge(analysis.archetype);
}

function showAIAnalysis(){
  let content='';
  
  // analyzePatterns requires 10 games, so check for that
  if(data.games<10){
    content='<p style="color:var(--muted);text-align:center;">Play at least 10 games to unlock your Deep Insight!</p>';
    content+='<p style="color:var(--muted);text-align:center;margin-top:12px;">Games played: <strong style="color:var(--pink);">'+data.games+'</strong> / 10</p>';
    
    // Show progress bar
    let pct=Math.min((data.games/10)*100,100);
    content+='<div style="margin-top:16px;background:var(--border);border-radius:5px;height:8px;overflow:hidden;"><div style="width:'+pct+'%;height:100%;background:linear-gradient(90deg,#FF4757,#FF6B81);border-radius:5px;"></div></div>';
    
    // Show what they'll get
    content+='<div style="margin-top:20px;padding:16px;background:rgba(0,0,0,0.3);border-radius:12px;text-align:left;">';
    content+='<p style="color:var(--text);font-size:13px;margin-bottom:12px;"><strong>Coming soon:</strong></p>';
    content+='<p style="color:var(--muted);font-size:12px;line-height:2;">‚Ä¢ Your Growth Pattern Summary</p>';
    content+='<p style="color:var(--muted);font-size:12px;line-height:2;">‚Ä¢ Recurring Theme Tags</p>';
    content+='<p style="color:var(--muted);font-size:12px;line-height:2;">‚Ä¢ Personal Archetype Match</p>';
    content+='<p style="color:var(--muted);font-size:12px;line-height:2;">‚Ä¢ Level-Specific Recommendations</p>';
    content+='<p style="color:var(--muted);font-size:12px;line-height:2;">‚Ä¢ Daily Growth Challenges</p>';
    content+='</div>';
  }else{
    let analysis=analyzePatterns();
    if(!analysis){
      content='<p style="color:var(--muted);text-align:center;">Unable to analyze patterns. Keep playing to build data!</p>';
    }else{
      let p=analysis.profile;
      let recPct=Math.round(p.mirrorRecognition*100);
      let accPct=Math.round(p.acceptanceRate*100);
      
      // YOUR GROWTH PATTERN - Summary box
      content='<div style="background:linear-gradient(135deg,rgba(120,75,160,0.2),rgba(255,60,172,0.1));border:1px solid var(--purple);border-radius:12px;padding:16px;margin-bottom:16px;">';
      content+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--purple);font-weight:700;margin-bottom:8px;">Your Growth Pattern</div>';
      
      // Generate dynamic summary based on stats
      let summary='';
      if(recPct>=70 && accPct>=70){
        summary='You see yourself clearly and accept what you see. This is rare. Your growth edge is going deeper, not wider.';
      }else if(recPct>=70 && accPct<50){
        summary='You see yourself clearly but struggle to accept what you see. This tension is where growth happens.';
      }else if(recPct<50 && accPct>=70){
        summary='You accept others easily but may be avoiding your own mirror. Your growth edge is honest self-examination.';
      }else if(recPct>=40 && accPct>=40){
        summary='You\'re developing self-awareness while still avoiding certain difficult truths. This tension is where growth happens.';
      }else{
        summary='You\'re at the beginning of your journey. Every pattern you recognize brings you closer to transformation.';
      }
      content+='<p style="color:var(--text);font-size:14px;line-height:1.6;">'+summary+'</p>';
      content+='</div>';
      
      // Stats row
      content+='<div style="display:flex;gap:12px;margin-bottom:16px;">';
      content+='<div style="flex:1;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center;">';
      content+='<div style="font-size:24px;font-weight:800;color:'+(recPct>=60?'var(--green)':recPct>=40?'var(--yellow)':'var(--orange)')+';">'+recPct+'%</div>';
      content+='<div style="font-size:10px;color:var(--muted);text-transform:uppercase;">Self-Aware</div>';
      content+='</div>';
      content+='<div style="flex:1;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center;">';
      content+='<div style="font-size:24px;font-weight:800;color:'+(accPct>=60?'var(--green)':accPct>=40?'var(--yellow)':'var(--orange)')+';">'+accPct+'%</div>';
      content+='<div style="font-size:10px;color:var(--muted);text-transform:uppercase;">Acceptance</div>';
      content+='</div>';
      content+='</div>';
      
      // RECURRING THEMES - Tag style (now with 6 themes)
      let hasThemes=p.boundaryTheme>0.08||p.controlTheme>0.08||p.worthTheme>0.08||p.authenticityTheme>0.08||p.fearTheme>0.08||p.attachmentTheme>0.08;
      content+='<div style="margin-bottom:16px;">';
      content+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:#FF4757;font-weight:700;margin-bottom:10px;">Recurring Themes</div>';
      content+='<div style="display:flex;flex-wrap:wrap;gap:8px;">';
      if(hasThemes){
        if(p.boundaryTheme>0.08)content+='<span style="background:rgba(255,60,172,0.2);color:var(--pink);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">üõ°Ô∏è Boundaries</span>';
        if(p.controlTheme>0.08)content+='<span style="background:rgba(120,75,160,0.2);color:var(--purple);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">üéõÔ∏è Control</span>';
        if(p.worthTheme>0.08)content+='<span style="background:rgba(47,128,237,0.2);color:var(--blue);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">üíé Self-Worth</span>';
        if(p.authenticityTheme>0.08)content+='<span style="background:rgba(0,210,106,0.2);color:var(--green);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">üé≠ Authenticity</span>';
        if(p.fearTheme>0.08)content+='<span style="background:rgba(255,107,53,0.2);color:var(--orange);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">üò∞ Fear</span>';
        if(p.attachmentTheme>0.08)content+='<span style="background:rgba(247,201,72,0.2);color:var(--yellow);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">üîó Attachment</span>';
      }else{
        content+='<span style="background:rgba(255,255,255,0.1);color:var(--muted);padding:6px 12px;border-radius:20px;font-size:12px;">Keep playing to reveal themes...</span>';
      }
      // Dynamic tags based on behavior
      if(accPct<40)content+='<span style="background:rgba(255,71,87,0.2);color:#FF4757;padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">‚öñÔ∏è Judgment</span>';
      if(recPct>=70)content+='<span style="background:rgba(0,216,255,0.2);color:var(--cyan);padding:6px 12px;border-radius:20px;font-size:12px;font-weight:600;">üëÅÔ∏è High Awareness</span>';
      content+='</div>';
      content+='</div>';
      
      // ARCHETYPE
      content+='<div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:16px;text-align:center;">';
      content+='<div style="font-size:36px;margin-bottom:8px;">'+analysis.archetype.icon+'</div>';
      content+='<div style="font-size:18px;font-weight:800;color:var(--pink);margin-bottom:6px;">'+analysis.archetype.name+'</div>';
      content+='<div style="font-size:13px;color:var(--muted);line-height:1.5;">'+analysis.archetype.edge+'</div>';
      content+='</div>';
      
      // RECOMMENDED PRACTICE - Level-specific
      let topLevel=Object.entries(p.topLevels).sort((x,y)=>y[1]-x[1])[0];
      let recommendedLevel=2;
      let levelName='Family';
      let levelReason='boundary-setting patterns that may be influencing your self-relationship';
      
      if(topLevel){
        let lvlId=parseInt(topLevel[0]);
        let lvl=LEVELS.find(l=>l.id===lvlId);
        if(lvl){
          // Recommend the next level up or same level for deeper work
          if(lvlId<7 && data.unlockedLevels.includes(lvlId+1)){
            recommendedLevel=lvlId+1;
            let nextLvl=LEVELS.find(l=>l.id===recommendedLevel);
            levelName=nextLvl?nextLvl.name:'Family';
          }else{
            recommendedLevel=lvlId;
            levelName=lvl.name;
          }
        }
      }
      
      // Dynamic reason based on themes
      if(p.boundaryTheme>0.15){
        levelReason='boundary-setting patterns that show up in your relationships';
      }else if(p.controlTheme>0.15){
        levelReason='control patterns and where they originate';
      }else if(p.worthTheme>0.15){
        levelReason='self-worth patterns and how they affect your connections';
      }else{
        levelReason='deeper patterns that are ready to emerge';
      }
      
      content+='<div style="background:linear-gradient(135deg,rgba(0,210,106,0.1),rgba(47,128,237,0.1));border:1px solid var(--green);border-radius:12px;padding:16px;">';
      content+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--green);font-weight:700;margin-bottom:8px;">Recommended Practice</div>';
      content+='<p style="color:var(--text);font-size:14px;line-height:1.6;">Focus on <strong>Level '+recommendedLevel+' ('+levelName+')</strong> scenarios to explore '+levelReason+'.</p>';
      content+='</div>';
      
      // TODAY'S CHALLENGE
      content+='<div style="margin-top:16px;padding:16px;background:rgba(0,0,0,0.3);border-radius:12px;border-left:3px solid var(--gold);">';
      content+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--gold);font-weight:700;margin-bottom:8px;">Today\'s Challenge</div>';
      content+='<p style="color:var(--text);font-size:14px;line-height:1.6;">'+getDailyChallenge(analysis.archetype)+'</p>';
      content+='</div>';
    }
  }
  
  document.getElementById('aiAnalysisContent').innerHTML=content;
  document.getElementById('aiModal').classList.add('active');
}

function showPatternModal(){
  let analysis=analyzePatterns();
  if(!analysis)return;
  let p=analysis.profile,a=analysis.archetype;
  let topLevel=Object.entries(p.topLevels).sort((x,y)=>y[1]-x[1])[0];
  let topLevelName='Individual';
  if(topLevel){let lvl=LEVELS.find(l=>l.id===parseInt(topLevel[0]));if(lvl)topLevelName=lvl.name;}
  let html='<div style="text-align:center;margin-bottom:20px;">';
  html+='<div style="font-size:60px;margin-bottom:10px;">'+a.icon+'</div>';
  html+='<div style="font-size:24px;font-weight:800;background:linear-gradient(135deg,var(--purple),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">'+a.name+'</div>';
  html+='</div>';
  html+='<div style="background:rgba(0,0,0,0.3);border-radius:12px;padding:16px;margin-bottom:16px;">';
  html+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--purple);font-weight:700;margin-bottom:8px;">Your Growth Edge</div>';
  html+='<div style="font-size:15px;color:var(--text);line-height:1.6;">'+a.edge+'</div>';
  html+='</div>';
  html+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);font-weight:700;margin-bottom:12px;">Your Numbers</div>';
  html+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px;">';
  html+='<div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center;"><div style="font-size:24px;font-weight:800;color:var(--pink);">'+Math.round(p.mirrorRecognition*100)+'%</div><div style="font-size:10px;color:var(--muted);margin-top:4px;">Self-Recognition</div></div>';
  html+='<div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center;"><div style="font-size:24px;font-weight:800;color:var(--green);">'+Math.round(p.acceptanceRate*100)+'%</div><div style="font-size:10px;color:var(--muted);margin-top:4px;">Acceptance Rate</div></div>';
  html+='</div>';
  html+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);font-weight:700;margin-bottom:12px;">Themes In Your Patterns</div>';
  html+='<div style="display:flex;flex-direction:column;gap:8px;margin-bottom:16px;">';
  if(p.boundaryTheme>0.1)html+='<div style="display:flex;justify-content:space-between;align-items:center;"><span style="font-size:13px;">Boundaries</span><div style="width:100px;height:6px;background:var(--border);border-radius:3px;overflow:hidden;"><div style="width:'+Math.round(p.boundaryTheme*100)+'%;height:100%;background:var(--orange);"></div></div></div>';
  if(p.controlTheme>0.1)html+='<div style="display:flex;justify-content:space-between;align-items:center;"><span style="font-size:13px;">Control</span><div style="width:100px;height:6px;background:var(--border);border-radius:3px;overflow:hidden;"><div style="width:'+Math.round(p.controlTheme*100)+'%;height:100%;background:var(--purple);"></div></div></div>';
  if(p.worthTheme>0.1)html+='<div style="display:flex;justify-content:space-between;align-items:center;"><span style="font-size:13px;">Self-Worth</span><div style="width:100px;height:6px;background:var(--border);border-radius:3px;overflow:hidden;"><div style="width:'+Math.round(p.worthTheme*100)+'%;height:100%;background:var(--pink);"></div></div></div>';
  if(p.boundaryTheme<=0.1&&p.controlTheme<=0.1&&p.worthTheme<=0.1)html+='<div style="font-size:13px;color:var(--muted);font-style:italic;">Keep playing to reveal your themes.</div>';
  html+='</div>';
  html+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--muted);font-weight:700;margin-bottom:12px;">Most Active Level</div>';
  html+='<div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;margin-bottom:16px;text-align:center;">';
  html+='<div style="font-size:16px;font-weight:700;">'+topLevelName+'</div>';
  html+='<div style="font-size:12px;color:var(--muted);">'+((data.insightsCollection||[]).filter(i=>topLevel&&i.level===parseInt(topLevel[0])).length)+' insights collected</div>';
  html+='</div>';
  html+='<div style="background:linear-gradient(135deg,rgba(255,215,0,0.15),rgba(255,107,53,0.1));border:1px solid var(--gold);border-radius:12px;padding:14px;">';
  html+='<div style="font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--gold);font-weight:700;margin-bottom:8px;">Today\'s Practice</div>';
  html+='<div style="font-size:14px;color:var(--text);line-height:1.6;">'+getDailyChallenge(a)+'</div>';
  html+='</div>';
  html+='<div style="text-align:center;margin-top:16px;padding-top:16px;border-top:1px solid var(--border);">';
  html+='<div style="font-size:11px;color:var(--muted);">Based on '+data.games+' games played</div>';
  html+='<div style="font-size:11px;color:var(--muted);margin-top:4px;">Your archetype updates as you grow</div>';
  html+='</div>';
  document.getElementById('patternProfile').innerHTML=html;
  document.getElementById('patternModal').classList.add('active');
}

document.getElementById('patternCard').onclick=showPatternModal;
document.getElementById('patternClose').onclick=function(){document.getElementById('patternModal').classList.remove('active')};
// ============ END PATTERN ANALYSIS SYSTEM ============

let selectedLevel=null;
function showLevelSelect(lv){
  selectedLevel=lv;
  document.getElementById('levelSelectTitle').textContent='Level '+lv.id+': '+lv.name;
  document.getElementById('levelSelectDesc').textContent=lv.desc;
  let levelInsightCount=data.insightsCollection?data.insightsCollection.filter(i=>i.level===lv.id).length:0;
  document.getElementById('levelInsightsCount').textContent=levelInsightCount+' collected';
  let agrBtn=document.getElementById('levelAgreementBtn');
  let mixBtn=document.getElementById('levelMixedBtn');
  if(data.unlockedAgreement){
    agrBtn.style.opacity='1';agrBtn.style.pointerEvents='auto';
    mixBtn.style.opacity='1';mixBtn.style.pointerEvents='auto';
  }else{
    agrBtn.style.opacity='0.4';agrBtn.style.pointerEvents='none';
    mixBtn.style.opacity='0.4';mixBtn.style.pointerEvents='none';
  }
  document.getElementById('levelSelectModal').classList.add('active');
}

function shareGame(){
  let text="I'm Level "+data.level+" on Level Up! üéÆ "+data.games+" games played, üî•"+data.streak+"-day streak. Can you beat me?\n\n";
  let url=window.location.href;
  let fullText=text+url;
  if(navigator.share){
    navigator.share({title:'Level Up - 7 Levels of Self',text:text,url:url}).then(()=>showToast('Shared!')).catch(()=>{copyToClipboard(fullText)});
  }else{
    copyToClipboard(fullText);
  }
}
function copyToClipboard(text){
  if(navigator.clipboard&&navigator.clipboard.writeText){
    navigator.clipboard.writeText(text).then(()=>showToast('üìã Copied to clipboard!')).catch(()=>fallbackCopy(text));
  }else{
    fallbackCopy(text);
  }
}
function fallbackCopy(text){
  let ta=document.createElement('textarea');ta.value=text;ta.style.position='fixed';ta.style.left='-9999px';document.body.appendChild(ta);ta.select();
  try{document.execCommand('copy');showToast('üìã Copied to clipboard!')}catch(e){showToast('Copy: '+text.substring(0,50)+'...')}
  document.body.removeChild(ta);
}

function showHook(){setTimeout(()=>document.getElementById('line1').classList.add('show'),400);setTimeout(()=>document.getElementById('line2').classList.add('show'),1400);setTimeout(()=>document.getElementById('hookSub').classList.add('show'),2600);setTimeout(()=>document.getElementById('hookBtn').classList.add('show'),3400)}
document.getElementById('hookBtn').onclick=function(){document.getElementById('hook').classList.add('hidden');document.getElementById('onboard').classList.add('active');music.play().then(()=>{musicOn=true;document.getElementById('musicBtn').classList.add('on')}).catch(()=>{})};
document.getElementById('skipBtn').onclick=function(){data.seenIntro=true;save();document.getElementById('onboard').classList.remove('active');updateHome()};
document.getElementById('skipBtn2').onclick=function(){data.seenIntro=true;save();document.getElementById('onboard').classList.remove('active');updateHome()};
document.getElementById('nextBtn1').onclick=function(){document.getElementById('onboard1').classList.remove('active');document.getElementById('onboard2').classList.add('active')};
document.getElementById('goBtn').onclick=function(){data.seenIntro=true;save();document.getElementById('onboard').classList.remove('active');updateHome()};

function startMirrorGame(lf){
  game.mode='mirror';game.idx=0;game.answers=[];game.useTimer=false;currentCombo=0;
  let pool=MIRROR_SCENARIOS.filter(s=>lf?s.level===lf:data.unlockedLevels.includes(s.level));
  if(pool.length===0){showToast('No scenarios');return}
  game.scenarios=shuffle(pool).slice(0,10);
  document.getElementById('home').classList.add('hidden');document.getElementById('results').classList.remove('active');document.getElementById('game').classList.add('active');
  document.getElementById('gameMode').textContent='Mirror Game';document.getElementById('gameCombo').textContent='';document.getElementById('timerBar').classList.add('hidden');
  showMirrorScenario();
}
function startAgreementGame(lf){
  if(!data.unlockedAgreement){showToast('üîí Reach Level 2!');return}
  game.mode='agreement';game.idx=0;game.answers=[];game.useTimer=true;currentCombo=0;
  if(typeof DECISION_SCENARIOS==='undefined'||DECISION_SCENARIOS.length===0){showToast('Loading...');return}
  let pool=DECISION_SCENARIOS.filter(s=>lf?s.level===lf:data.unlockedLevels.includes(s.level));
  if(pool.length===0){showToast('No scenarios');return}
  game.scenarios=shuffle(pool).slice(0,10);
  document.getElementById('home').classList.add('hidden');document.getElementById('results').classList.remove('active');document.getElementById('game').classList.add('active');
  document.getElementById('gameMode').textContent='Agreement Game';document.getElementById('gameCombo').textContent='';document.getElementById('timerBar').classList.remove('hidden');
  showAgreementScenario();
}
function startDecisionGame(){
  let today=new Date().toDateString();if(data.lastDaily===today){showToast('Already completed!');return}
  game.mode='decision';game.idx=0;game.answers=[];game.useTimer=true;game.scenarios=[];currentCombo=0;
  if(typeof window.SCENARIOS==='undefined'){showToast('Loading...');return}
  let seed=hashDate(today),all=[];
  for(let l=1;l<=7;l++){if(window.SCENARIOS[l])all=all.concat(window.SCENARIOS[l].map(s=>({...s,level:l})))}
  for(let i=0;i<3&&i<all.length;i++){let idx=(seed+i*31337)%all.length;game.scenarios.push(all[idx]);seed=(seed*31337)&0xFFFFFF}
  if(game.scenarios.length===0){showToast('No scenarios');return}
  document.getElementById('home').classList.add('hidden');document.getElementById('results').classList.remove('active');document.getElementById('game').classList.add('active');
  document.getElementById('gameMode').textContent='Worldwide Challenge';document.getElementById('gameCombo').textContent='';document.getElementById('timerBar').classList.remove('hidden');
  showDecisionScenario();
}

function showMirrorScenario(){
  let s=game.scenarios[game.idx];if(!s){endGame();return}
  document.getElementById('gameProgress').textContent=(game.idx+1)+'/'+game.scenarios.length;
  let lv=LEVELS.find(l=>l.id===s.level);document.getElementById('scenarioCat').textContent='Level '+s.level+': '+(lv?lv.name:'');
  document.getElementById('scenarioText').textContent=s.text;
  let c=document.getElementById('choices');c.innerHTML='';
  [{text:"That's Me",value:true},{text:"That's Not Me",value:false}].forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=ch.text;b.onclick=()=>selectMirrorChoice(ch,b,s);c.appendChild(b)});
}
function selectMirrorChoice(ch,btn,sc){
  document.querySelectorAll('.choice').forEach(b=>b.disabled=true);btn.classList.add('selected');
  game.answers.push({recognized:ch.value,insight:sc.insight,text:sc.text,level:sc.level});
  addInsight(sc.insight,sc.level);addCombo();
  data.mirrorTotal++;if(ch.value)data.mirrorRecognized++;positiveSound();coinSound();addXP(10);maybeBonus();save();
  setTimeout(()=>showMirrorFeedback(sc.text,sc.insight,ch.value),400);
}
function showMirrorFeedback(txt,ins,rec){document.getElementById('fbIcon').textContent='üí°';document.getElementById('fbIcon').style.color='var(--pink)';document.getElementById('fbTitle').textContent='Reflection';document.getElementById('fbLabel').textContent=rec?'‚úì That\'s Me':'‚úó Not Me';document.getElementById('fbText').innerHTML='<div style="font-size:14px;margin-bottom:10px;color:var(--text);">"'+txt+'"</div><div style="font-size:13px;color:var(--muted);font-style:italic;">'+ins+'</div>';document.getElementById('feedbackModal').classList.add('active')}

function showAgreementScenario(){
  let s=game.scenarios[game.idx];if(!s){endGame();return}
  document.getElementById('gameProgress').textContent=(game.idx+1)+'/'+game.scenarios.length;
  let lv=LEVELS.find(l=>l.id===s.level);document.getElementById('scenarioCat').textContent='Level '+s.level+': '+(lv?lv.name:'');
  document.getElementById('scenarioText').textContent=s.scenario;
  let c=document.getElementById('choices');c.innerHTML='';
  shuffle(s.choices).forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=ch.text;b.onclick=()=>selectAgreementChoice(ch,b,s);c.appendChild(b)});
  if(game.useTimer)startTimer();
}
function selectAgreementChoice(ch,btn,sc){
  if(game.timer)clearInterval(game.timer);document.querySelectorAll('.choice').forEach(b=>b.disabled=true);
  let isAcc=ch.type==='acceptance';game.answers.push({type:ch.type,isAcceptance:isAcc,insight:ch.insight,level:sc.level});
  if(isAcc){btn.classList.add('correct');data.agreementAccepted++;positiveSound();multiCoinSound(2);addXP(15);addInsight(ch.insight,sc.level);addCombo()}
  else{btn.classList.add('wrong');let acc=sc.choices.find(c=>c.type==='acceptance');document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===acc.text)b.classList.add('correct');else if(b!==btn)b.classList.add('dim')});neutralSound();addXP(5);resetCombo()}
  data.agreementTotal++;maybeBonus();setTimeout(()=>showAgreementFeedback(ch,isAcc),500);
}
function showAgreementFeedback(ch,isAcc){document.getElementById('fbIcon').textContent=isAcc?'‚úì':'‚öñÔ∏è';document.getElementById('fbIcon').style.color=isAcc?'var(--green)':'var(--yellow)';document.getElementById('fbTitle').textContent=isAcc?'Acceptance':'Judgment';document.getElementById('fbLabel').textContent=isAcc?'Why this works':'Learning opportunity';document.getElementById('fbText').textContent=ch.insight;document.getElementById('feedbackModal').classList.add('active')}

function showDecisionScenario(){
  let s=game.scenarios[game.idx];if(!s){endGame();return}
  document.getElementById('gameProgress').textContent=(game.idx+1)+'/'+game.scenarios.length;
  let lv=LEVELS.find(l=>l.id===s.level);document.getElementById('scenarioCat').textContent='Level '+s.level+': '+(lv?lv.name:'');
  document.getElementById('scenarioText').textContent=s.text;
  let c=document.getElementById('choices');c.innerHTML='';
  s.choices.forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=ch.text;b.onclick=()=>selectDecisionChoice(ch,b,s);c.appendChild(b)});
  if(game.useTimer)startTimer();
}
function selectDecisionChoice(ch,btn,sc){
  if(game.timer)clearInterval(game.timer);document.querySelectorAll('.choice').forEach(b=>b.disabled=true);
  let isCorr=ch.correct===true;game.answers.push({correct:isCorr,feedback:ch.fb,level:sc.level});
  if(isCorr){btn.classList.add('correct');positiveSound();multiCoinSound(3);addXP(20);addInsight(ch.fb,sc.level);addCombo()}
  else{btn.classList.add('wrong');let corr=sc.choices.find(c=>c.correct===true);document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===corr.text)b.classList.add('correct');else if(b!==btn)b.classList.add('dim')});neutralSound();addXP(5);resetCombo()}
  maybeBonus();setTimeout(()=>showDecisionFeedback(ch,isCorr),500);
}
function showDecisionFeedback(ch,isCorr){document.getElementById('fbIcon').textContent=isCorr?'‚úì':'üí°';document.getElementById('fbIcon').style.color=isCorr?'var(--green)':'var(--yellow)';document.getElementById('fbTitle').textContent=isCorr?'Correct!':'Not Quite';document.getElementById('fbLabel').textContent='Insight';document.getElementById('fbText').textContent=ch.fb;document.getElementById('feedbackModal').classList.add('active')}

function startTimer(){let duration=game.timerDuration||15;game.timeLeft=duration;if(game.timer)clearInterval(game.timer);game.timer=setInterval(()=>{game.timeLeft-=0.1;let pct=(game.timeLeft/duration)*100,fill=document.getElementById('timerFill');fill.style.width=pct+'%';fill.classList.remove('warn','danger');if(game.timeLeft<=5)fill.classList.add('danger');else if(game.timeLeft<=duration*0.66)fill.classList.add('warn');if(game.timeLeft<=0){clearInterval(game.timer);timeUp()}},100)}
function timeUp(){
  let s=game.scenarios[game.idx];document.querySelectorAll('.choice').forEach(b=>b.disabled=true);resetCombo();
  if(game.mode==='agreement'||(game.mode==='mixed'&&s.gameType==='agreement')){let acc=s.choices.find(c=>c.type==='acceptance');game.answers.push({type:'timeout',isAcceptance:false,level:s.level});data.agreementTotal++;document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===acc.text)b.classList.add('correct');else b.classList.add('dim')});neutralSound();setTimeout(()=>{document.getElementById('fbIcon').textContent='‚è∞';document.getElementById('fbTitle').textContent="Time's Up";document.getElementById('fbLabel').textContent='The accepting response';document.getElementById('fbText').textContent=acc.insight;document.getElementById('feedbackModal').classList.add('active')},500)}
  else if(game.mode==='decision'||(game.mode==='mixed'&&s.gameType==='decision')){let corr=s.choices.find(c=>c.correct===true);game.answers.push({correct:false,feedback:corr.fb,level:s.level,gameType:'decision'});document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===corr.text)b.classList.add('correct');else b.classList.add('dim')});neutralSound();setTimeout(()=>{document.getElementById('fbIcon').textContent='‚è∞';document.getElementById('fbTitle').textContent="Time's Up";document.getElementById('fbLabel').textContent='The right response';document.getElementById('fbText').textContent=corr.fb;document.getElementById('feedbackModal').classList.add('active')},500)}
}

document.getElementById('nextBtn').onclick=function(){document.getElementById('feedbackModal').classList.remove('active');game.idx++;if(game.idx>=game.scenarios.length)endGame();else{if(game.mode==='mirror')showMirrorScenario();else if(game.mode==='agreement')showAgreementScenario();else if(game.mode==='decision')showDecisionScenario();else if(game.mode==='mixed')showMixedScenario();}};

function endGame(){
  if(game.timer)clearInterval(game.timer);data.games++;
  let score=0,total=game.answers.length;
  if(game.mode==='mirror'){score=game.answers.filter(a=>a.recognized).length}
  else if(game.mode==='agreement'){score=game.answers.filter(a=>a.isAcceptance).length}
  else if(game.mode==='mixed'){score=game.answers.filter(a=>a.recognized||a.isAcceptance).length}
  else if(game.mode==='decision'){
    score=game.answers.filter(a=>a.correct).length;
    let today=new Date().toDateString(),yesterday=new Date(Date.now()-86400000).toDateString();
    if(data.lastDaily===yesterday)data.streak++;else if(data.lastDaily!==today)data.streak=1;
    data.lastDaily=today;
  }
  save();document.getElementById('game').classList.remove('active');document.getElementById('results').classList.add('active');
  let insights=document.getElementById('insightsList');
  if(game.mode==='mirror'){
    document.getElementById('resultsTitle').textContent='Mirror Complete';document.getElementById('finalScore').textContent=total+' Reflections';
    document.getElementById('resultMsg').textContent='Honest self-reflection is the first step.';
    insights.innerHTML='';game.answers.slice(0,10).forEach(a=>{let div=document.createElement('div');div.className='insight-item';div.innerHTML='<span style="color:'+(a.recognized?'var(--green)':'var(--muted)')+';">'+(a.recognized?'‚úì That\'s Me':'‚úó Not Me')+'</span><div style="margin-top:4px;">"'+a.text+'"</div>';insights.appendChild(div)});
  }else if(game.mode==='agreement'){
    document.getElementById('resultsTitle').textContent='Agreement Complete';document.getElementById('finalScore').textContent=score+'/'+total;
    document.getElementById('resultMsg').textContent=score>=8?'Strong acceptance!':score>=5?'Growing awareness.':'Keep practicing.';
    insights.innerHTML='';game.answers.slice(0,5).forEach(a=>{let div=document.createElement('div');div.className='insight-item';div.textContent=(a.isAcceptance?'‚úì ':'‚öñÔ∏è ')+a.insight;insights.appendChild(div)});
    if(score===10){triggerConfetti();showToast('üéâ Perfect! +25 XP');addXP(25)}
  }else if(game.mode==='mixed'){
    let mirrorAnswers=game.answers.filter(a=>a.recognized!==undefined);
    let agreementAnswers=game.answers.filter(a=>a.isAcceptance!==undefined);
    let decisionAnswers=game.answers.filter(a=>a.gameType==='decision');
    let recognized=mirrorAnswers.filter(a=>a.recognized);
    let notMe=mirrorAnswers.filter(a=>!a.recognized);
    let acceptCount=agreementAnswers.filter(a=>a.isAcceptance).length;
    let judgmentCount=agreementAnswers.length-acceptCount;
    let correctCount=decisionAnswers.filter(a=>a.correct).length;
    
    document.getElementById('resultsTitle').textContent='Mixed Complete';
    let scoreText='ü™û '+mirrorAnswers.length+' Reflections';
    if(agreementAnswers.length>0)scoreText+=' ‚Ä¢ ‚öñÔ∏è '+acceptCount+'/'+agreementAnswers.length+' Accepted';
    if(decisionAnswers.length>0)scoreText+=' ‚Ä¢ üéØ '+correctCount+'/'+decisionAnswers.length+' Correct';
    document.getElementById('finalScore').innerHTML=scoreText;
    
    // Build DEEP personalized reflection
    let reflection='<div style="background:linear-gradient(135deg,rgba(120,75,160,0.15),rgba(255,60,172,0.1));border:1px solid var(--purple);border-radius:12px;padding:16px;margin-bottom:16px;text-align:left;">';
    reflection+='<div style="font-weight:700;color:var(--pink);margin-bottom:12px;">üí≠ What This Session Revealed</div>';
    
    // Show specific recognized patterns with actual quotes
    if(recognized.length>0){
      reflection+='<p style="font-size:13px;color:var(--text);margin-bottom:8px;">You recognized:</p>';
      recognized.slice(0,2).forEach(a=>{
        reflection+='<div style="font-size:13px;color:var(--muted);font-style:italic;margin:4px 0 4px 12px;">"'+(a.text||a.insight)+'"</div>';
      });
    }
    
    // Show what they rejected - potential blind spots
    if(notMe.length>0&&recognized.length>0){
      reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0 8px;">But you rejected:</p>';
      reflection+='<div style="font-size:13px;color:var(--muted);font-style:italic;margin:4px 0 4px 12px;">"'+(notMe[0].text||notMe[0].insight)+'"</div>';
      
      // Look for contradiction patterns
      let boundaryWords=['boundary','boundaries','no','yes','peace','please','avoid','conflict'];
      let controlWords=['control','perfect','right','wrong','should','must','fix'];
      let worthWords=['worth','deserve','enough','value','matter'];
      
      let recognizedText=recognized.map(a=>(a.insight||'').toLowerCase()).join(' ');
      let rejectedText=notMe.map(a=>(a.insight||'').toLowerCase()).join(' ');
      
      let hasBoundaryRecognized=boundaryWords.some(w=>recognizedText.includes(w));
      let hasBoundaryRejected=boundaryWords.some(w=>rejectedText.includes(w));
      let hasControlRecognized=controlWords.some(w=>recognizedText.includes(w));
      let hasWorthRejected=worthWords.some(w=>rejectedText.includes(w));
      
      // Generate insight based on contradiction
      if(hasBoundaryRecognized&&hasBoundaryRejected){
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">These might be connected. You see some boundary patterns but not others. The ones you don\'t see often protect you from seeing something deeper.</p>';
      }else if(hasControlRecognized&&hasWorthRejected){
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">Interesting pattern: you recognize control tendencies but may not see how they connect to self-worth. Control is often protection.</p>';
      }else if(recognized.length>=2){
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">These patterns are often connected. The ones you see and the ones you rejected may share a root. That\'s not a flaw‚Äîit\'s how awareness unfolds.</p>';
      }
    }
    
    // Agreement analysis with specific insight
    if(agreementAnswers.length>0){
      if(judgmentCount>acceptCount){
        let judgmentExample=agreementAnswers.find(a=>!a.isAcceptance);
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">In acceptance scenarios, <strong>judgment came up more than acceptance</strong>.';
        if(judgmentExample&&judgmentExample.insight){
          reflection+=' One insight: "'+judgmentExample.insight+'" The trigger is the teacher.</p>';
        }else{
          reflection+='</p>';
        }
      }else if(acceptCount>judgmentCount){
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">You chose acceptance <strong>'+acceptCount+' time'+(acceptCount>1?'s':'')+'</strong>. You\'re building the muscle that creates space for change.</p>';
      }else if(acceptCount===judgmentCount&&acceptCount>0){
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">Equal acceptance and judgment. You\'re in transition‚Äîthe old patterns and new awareness are both present. That\'s exactly where growth happens.</p>';
      }
    }
    
    // Decision analysis
    if(decisionAnswers.length>0){
      if(correctCount===decisionAnswers.length){
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;"><strong>Perfect on decision scenarios.</strong> Your instincts are aligned with wisdom.</p>';
      }else if(correctCount===0){
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">The decision scenarios challenged you. Each "wrong" answer revealed a growth edge.</p>';
      }else{
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">'+correctCount+' of '+decisionAnswers.length+' decisions aligned with the framework. The misses are where learning lives.</p>';
      }
    }
    
    // Pattern summary based on overall session
    if(recognized.length>=3&&acceptCount>=2){
      reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;"><strong>Strong self-awareness and acceptance.</strong> You\'re ready to go deeper into this level.</p>';
    }else if(recognized.length<=1&&judgmentCount>acceptCount){
      reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">This level is challenging you. You may be avoiding looking at yourself, or genuinely don\'t relate. Either is information.</p>';
    }else if(recognized.length>=2&&judgmentCount>acceptCount){
      reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">You see yourself clearly but struggle to accept what you see. <strong>Self-compassion is your next edge.</strong></p>';
    }else if(recognized.length<=1&&acceptCount>=2){
      reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">You accept others easily but may be avoiding the mirror. The reflection is waiting when you\'re ready.</p>';
    }
    
    reflection+='<p style="font-size:11px;color:var(--muted);margin-top:14px;font-style:italic;">This reflection is based on your specific answers‚Äînot a template.</p>';
    reflection+='</div>';
    
    document.getElementById('resultMsg').innerHTML=reflection;
    
    // Show all responses
    insights.innerHTML='<div style="font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Your Responses</div>';
    game.answers.forEach(a=>{
      let div=document.createElement('div');div.className='insight-item';
      if(a.recognized!==undefined){
        div.innerHTML='<span style="color:'+(a.recognized?'var(--green)':'var(--muted)')+';">ü™û '+(a.recognized?'That\'s Me':'Not Me')+'</span><div style="margin-top:4px;">"'+(a.text||a.insight)+'"</div>';
      }else if(a.isAcceptance!==undefined){
        div.innerHTML='<span style="color:'+(a.isAcceptance?'var(--green)':'var(--yellow)')+';">‚öñÔ∏è '+(a.isAcceptance?'Accepted':'Judgment')+'</span> ‚Äî '+a.insight;
      }else if(a.gameType==='decision'){
        div.innerHTML='<span style="color:'+(a.correct?'var(--green)':'var(--yellow)')+';">üéØ '+(a.correct?'Correct':'Missed')+'</span><div style="margin-top:4px;">"'+(a.text||'')+'"</div><div style="font-size:12px;color:var(--muted);margin-top:4px;">'+a.feedback+'</div>';
      }
      insights.appendChild(div);
    });
  }else if(game.mode==='decision'){
    document.getElementById('resultsTitle').textContent='Challenge Complete';document.getElementById('finalScore').textContent='üî• '+data.streak;
    document.getElementById('resultMsg').textContent=score+'/'+total+' correct!';
    insights.innerHTML='';game.answers.forEach(a=>{let div=document.createElement('div');div.className='insight-item';div.textContent=(a.correct?'‚úì ':'üí° ')+a.feedback;insights.appendChild(div)});
    if(score===3){triggerConfetti();showToast('üéâ Perfect! +30 XP');addXP(30)}
  }
}

document.getElementById('homeBtn').onclick=function(){document.getElementById('results').classList.remove('active');document.getElementById('home').classList.remove('hidden');updateHome()};
document.getElementById('quitBtn').onclick=function(){if(game.timer)clearInterval(game.timer);document.getElementById('game').classList.remove('active');document.getElementById('feedbackModal').classList.remove('active');document.getElementById('home').classList.remove('hidden');updateHome()};
document.getElementById('musicBtn').onclick=function(){if(musicOn){music.pause();musicOn=false;this.classList.remove('on')}else{music.play().then(()=>{musicOn=true;this.classList.add('on')}).catch(()=>{})}};
document.getElementById('soundBtn').onclick=function(){soundOn=!soundOn;this.classList.toggle('on',soundOn);if(soundOn)coinSound()};
document.getElementById('qaBtn').onclick=function(){document.getElementById('qaModal').classList.add('active')};
document.getElementById('qaClose').onclick=function(){document.getElementById('qaModal').classList.remove('active')};
document.getElementById('aiBtn').onclick=function(){showAIAnalysis()};
document.getElementById('aiClose').onclick=function(){document.getElementById('aiModal').classList.remove('active')};
document.getElementById('founderBtn').onclick=function(){document.getElementById('founderModal').classList.add('active')};
document.getElementById('founderClose').onclick=function(){document.getElementById('founderModal').classList.remove('active')};
document.getElementById('archetypeClose').onclick=function(){document.getElementById('archetypeModal').classList.remove('active')};
document.getElementById('resetBtn').onclick=function(){document.getElementById('qaModal').classList.remove('active');document.getElementById('resetModal').classList.add('active')};
document.getElementById('resetCancel').onclick=function(){document.getElementById('resetModal').classList.remove('active')};
document.getElementById('resetConfirm').onclick=function(){localStorage.removeItem('levelup_v7');localStorage.removeItem('installDismissed');data={xp:0,level:1,coins:0,games:0,mirrorRecognized:0,mirrorTotal:0,agreementAccepted:0,agreementTotal:0,streak:0,lastDaily:null,lastLogin:null,loginDay:0,unlockedLevels:[1],unlockedAgreement:false,seenIntro:false,insightsCollection:[],newlyUnlockedLevels:[],seenAgreementUnlock:false};save();document.getElementById('resetModal').classList.remove('active');showToast('Progress reset');updateHome()};
document.querySelectorAll('.qa-question').forEach(q=>{q.onclick=function(){this.parentElement.classList.toggle('open')}});
document.getElementById('dailyCard').onclick=function(){if(!this.classList.contains('done'))startDecisionGame()};
document.getElementById('mirrorMode').onclick=()=>startMirrorGame();
document.getElementById('agreementMode').onclick=function(){if(data.unlockedAgreement){data.seenAgreementUnlock=true;save();document.getElementById('agreementMode').classList.remove('newly-unlocked');startAgreementGame();}};
document.getElementById('shareBtn').onclick=shareGame;
document.getElementById('resultsShare').onclick=shareGame;
document.getElementById('insightsStat').onclick=function(){showInsightsModal(null)};
document.getElementById('insightsClose').onclick=function(){document.getElementById('insightsModal').classList.remove('active')};
document.getElementById('levelSelectClose').onclick=function(){document.getElementById('levelSelectModal').classList.remove('active')};
document.getElementById('levelMirrorBtn').onclick=function(){document.getElementById('levelSelectModal').classList.remove('active');startMirrorGame(selectedLevel.id)};
document.getElementById('levelAgreementBtn').onclick=function(){if(data.unlockedAgreement){document.getElementById('levelSelectModal').classList.remove('active');startAgreementGame(selectedLevel.id)}};
document.getElementById('levelMixedBtn').onclick=function(){if(data.unlockedAgreement){document.getElementById('levelSelectModal').classList.remove('active');startMixedGame(selectedLevel.id)}};
document.getElementById('levelInsightsBtn').onclick=function(){document.getElementById('levelSelectModal').classList.remove('active');showInsightsModal(selectedLevel.id)};

function startMixedGame(levelFilter){
  game.mode='mixed';game.idx=0;game.answers=[];game.useTimer=true;game.timerDuration=18;currentCombo=0;
  let mirrorPool=levelFilter?MIRROR_SCENARIOS.filter(s=>s.level===levelFilter):MIRROR_SCENARIOS.filter(s=>data.unlockedLevels.includes(s.level));
  let agreePool=levelFilter&&typeof DECISION_SCENARIOS!=='undefined'?DECISION_SCENARIOS.filter(s=>s.level===levelFilter):typeof DECISION_SCENARIOS!=='undefined'?DECISION_SCENARIOS.filter(s=>data.unlockedLevels.includes(s.level)):[];
  let decisionPool=[];
  if(typeof window.SCENARIOS!=='undefined'){
    if(levelFilter&&window.SCENARIOS[levelFilter]){decisionPool=window.SCENARIOS[levelFilter]}
    else{data.unlockedLevels.forEach(lvl=>{if(window.SCENARIOS[lvl])decisionPool=decisionPool.concat(window.SCENARIOS[lvl].map(s=>({...s,level:lvl})))})}
  }
  let combined=[];
  shuffle(mirrorPool).slice(0,5).forEach(s=>combined.push({...s,gameType:'mirror'}));
  shuffle(agreePool).slice(0,3).forEach(s=>combined.push({...s,gameType:'agreement'}));
  shuffle(decisionPool).slice(0,2).forEach(s=>combined.push({...s,gameType:'decision',level:s.level||levelFilter||1}));
  game.scenarios=shuffle(combined).slice(0,10);
  if(game.scenarios.length===0){showToast('No scenarios available!');return}
  document.getElementById('home').classList.add('hidden');document.getElementById('game').classList.add('active');
  document.getElementById('gameMode').textContent='Mixed';document.getElementById('timerBar').classList.remove('hidden');
  showMixedScenario();
}

function showMixedScenario(){
  let s=game.scenarios[game.idx];if(!s){endGame();return}
  document.getElementById('gameProgress').textContent=(game.idx+1)+'/'+game.scenarios.length;
  let lv=LEVELS.find(l=>l.id===s.level);
  if(s.gameType==='mirror'){
    document.getElementById('scenarioCat').textContent='ü™û Level '+s.level+': '+(lv?lv.name:'');
    document.getElementById('scenarioText').textContent=s.text;
    let c=document.getElementById('choices');c.innerHTML='';
    [{text:"That's Me",value:true},{text:"That's Not Me",value:false}].forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=ch.text;b.onclick=()=>selectMixedMirror(ch,b,s);c.appendChild(b)});
  }else if(s.gameType==='agreement'){
    document.getElementById('scenarioCat').textContent='‚öñÔ∏è Level '+s.level+': '+(lv?lv.name:'');
    document.getElementById('scenarioText').textContent=s.scenario;
    let c=document.getElementById('choices');c.innerHTML='';
    shuffle(s.choices).forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=ch.text;b.onclick=()=>selectMixedAgreement(ch,b,s);c.appendChild(b)});
    if(game.useTimer)startTimer();
  }else if(s.gameType==='decision'){
    document.getElementById('scenarioCat').textContent='üéØ Level '+s.level+': '+(lv?lv.name:'');
    document.getElementById('scenarioText').textContent=s.text;
    let c=document.getElementById('choices');c.innerHTML='';
    s.choices.forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=ch.text;b.onclick=()=>selectMixedDecision(ch,b,s);c.appendChild(b)});
    if(game.useTimer)startTimer();
  }
}

function selectMixedMirror(ch,btn,sc){
  document.querySelectorAll('.choice').forEach(b=>b.disabled=true);btn.classList.add('selected');
  game.answers.push({recognized:ch.value,insight:sc.insight,text:sc.text,level:sc.level});
  addInsight(sc.insight,sc.level);addCombo();
  data.mirrorTotal++;if(ch.value)data.mirrorRecognized++;positiveSound();coinSound();addXP(10);maybeBonus();save();
  setTimeout(()=>{document.getElementById('fbIcon').textContent='üí°';document.getElementById('fbIcon').style.color='var(--pink)';document.getElementById('fbTitle').textContent='Reflection';document.getElementById('fbLabel').textContent=ch.value?'‚úì That\'s Me':'‚úó Not Me';document.getElementById('fbText').innerHTML='<div style="font-size:14px;margin-bottom:10px;color:var(--text);">"'+sc.text+'"</div><div style="font-size:13px;color:var(--muted);font-style:italic;">'+sc.insight+'</div>';document.getElementById('feedbackModal').classList.add('active')},400);
}

function selectMixedAgreement(ch,btn,sc){
  if(game.timer)clearInterval(game.timer);document.querySelectorAll('.choice').forEach(b=>b.disabled=true);
  let isAcc=ch.type==='acceptance';game.answers.push({type:ch.type,isAcceptance:isAcc,insight:ch.insight,level:sc.level,gameType:'agreement'});
  if(isAcc){btn.classList.add('correct');data.agreementAccepted++;positiveSound();multiCoinSound(2);addXP(15);addInsight(ch.insight,sc.level);addCombo()}
  else{btn.classList.add('wrong');let acc=sc.choices.find(c=>c.type==='acceptance');document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===acc.text)b.classList.add('correct');else if(b!==btn)b.classList.add('dim')});neutralSound();addXP(5);resetCombo()}
  data.agreementTotal++;maybeBonus();
  setTimeout(()=>{document.getElementById('fbIcon').textContent=isAcc?'‚úì':'‚öñÔ∏è';document.getElementById('fbIcon').style.color=isAcc?'var(--green)':'var(--yellow)';document.getElementById('fbTitle').textContent=isAcc?'Acceptance':'Judgment';document.getElementById('fbLabel').textContent=isAcc?'Why this works':'Learning opportunity';document.getElementById('fbText').textContent=ch.insight;document.getElementById('feedbackModal').classList.add('active')},500);
}

function selectMixedDecision(ch,btn,sc){
  if(game.timer)clearInterval(game.timer);document.querySelectorAll('.choice').forEach(b=>b.disabled=true);
  let isCorr=ch.correct===true;game.answers.push({correct:isCorr,feedback:ch.fb,text:sc.text,level:sc.level,gameType:'decision'});
  if(isCorr){btn.classList.add('correct');positiveSound();multiCoinSound(3);addXP(20);addInsight(ch.fb,sc.level);addCombo()}
  else{btn.classList.add('wrong');let corr=sc.choices.find(c=>c.correct===true);document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===corr.text)b.classList.add('correct');else if(b!==btn)b.classList.add('dim')});neutralSound();addXP(5);resetCombo()}
  maybeBonus();
  setTimeout(()=>{document.getElementById('fbIcon').textContent=isCorr?'‚úì':'üí°';document.getElementById('fbIcon').style.color=isCorr?'var(--green)':'var(--yellow)';document.getElementById('fbTitle').textContent=isCorr?'Correct!':'Not Quite';document.getElementById('fbLabel').textContent='Insight';document.getElementById('fbText').textContent=ch.fb;document.getElementById('feedbackModal').classList.add('active')},500);
}

function showInsightsModal(filterLevel){
  let filter=document.getElementById('insightsFilter');
  filter.innerHTML='<button style="padding:6px 12px;border-radius:20px;border:none;font-size:12px;font-weight:600;cursor:pointer;background:'+(filterLevel===null?'var(--pink)':'var(--card)')+';color:'+(filterLevel===null?'#fff':'var(--muted)')+';" onclick="showInsightsModal(null)">All</button>';
  LEVELS.forEach(lv=>{
    let hasInsights=data.insightsCollection&&data.insightsCollection.some(i=>i.level===lv.id);
    if(hasInsights){
      filter.innerHTML+='<button style="padding:6px 12px;border-radius:20px;border:none;font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:6px;background:'+(filterLevel===lv.id?'var(--pink)':'var(--card)')+';color:'+(filterLevel===lv.id?'#fff':'var(--muted)')+';" onclick="showInsightsModal('+lv.id+')"><span style="width:10px;height:10px;border-radius:50%;background:'+lv.color+';"></span>'+lv.name+'</button>';
    }
  });
  let list=document.getElementById('insightsListModal');
  list.innerHTML='';
  if(!data.insightsCollection||data.insightsCollection.length===0){
    list.innerHTML='<p style="color:var(--muted);text-align:center;padding:20px;">No insights yet. Play Mirror Game to collect insights about yourself!</p>';
  }else{
    let filtered=filterLevel===null?data.insightsCollection:data.insightsCollection.filter(i=>i.level===filterLevel);
    filtered.slice().reverse().forEach((insight,i)=>{
      let lv=LEVELS.find(l=>l.id===insight.level)||{color:'#888',name:'Unknown'};
      let div=document.createElement('div');
      div.style.cssText='background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;margin-bottom:10px;';
      div.innerHTML='<div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;"><span style="width:10px;height:10px;border-radius:50%;background:'+lv.color+';"></span><span style="font-size:12px;color:var(--muted);">Level '+insight.level+': '+lv.name+(insight.date?' ‚Ä¢ '+insight.date:'')+'</span></div><div style="font-size:14px;color:var(--text);">'+insight.text+'</div>';
      list.appendChild(div);
    });
  }
  document.getElementById('insightsModal').classList.add('active');
}

// PWA Install Logic
let deferredPrompt=null;
let installDismissed=localStorage.getItem('installDismissed');
let isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent);
let isInStandaloneMode=window.matchMedia('(display-mode: standalone)').matches||window.navigator.standalone;

function showInstallBanner(){
  if(isInStandaloneMode||installDismissed)return;
  setTimeout(()=>{document.getElementById('installBanner').classList.add('show')},3000);
}

window.addEventListener('beforeinstallprompt',(e)=>{
  e.preventDefault();
  deferredPrompt=e;
  showInstallBanner();
});

document.getElementById('installBtn').onclick=function(){
  if(isIOS){
    document.getElementById('installBanner').classList.remove('show');
    document.getElementById('iosModal').classList.add('active');
  }else if(deferredPrompt){
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then((result)=>{
      if(result.outcome==='accepted'){showToast('üéâ Added to Home Screen!')}
      deferredPrompt=null;
      document.getElementById('installBanner').classList.remove('show');
    });
  }
};

document.getElementById('installClose').onclick=function(){
  document.getElementById('installBanner').classList.remove('show');
  localStorage.setItem('installDismissed','true');
};

document.getElementById('iosClose').onclick=function(){
  document.getElementById('iosModal').classList.remove('active');
  localStorage.setItem('installDismissed','true');
};

// Show install banner for iOS after a delay
if(isIOS&&!isInStandaloneMode&&!installDismissed){
  showInstallBanner();
}

if(data.seenIntro){document.getElementById('hook').classList.add('hidden');updateHome()}else{showHook()}
setInterval(updateTimer,1000);
</script>
<script src="pattern-analysis.js"></script>
</body>
</html>
