<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Level Up">
<meta name="theme-color" content="#0d0a1a">
<meta name="description" content="Rewire your brain through play. 3 games that reveal your patterns and train new ones.">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://100levelup.com/">
<meta property="og:title" content="Play Level Up - Rewire Your Brain">
<meta property="og:description" content="Rewire your brain through play. 3 games that reveal your patterns and train new ones.">
<meta property="og:image" content="https://100levelup.com/og-game.png">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="https://100levelup.com/">
<meta name="twitter:title" content="Play Level Up - Rewire Your Brain">
<meta name="twitter:description" content="Rewire your brain through play. 3 games that reveal your patterns and train new ones.">
<meta name="twitter:image" content="https://100levelup.com/og-game.png">

<link rel="icon" type="image/png" sizes="32x32" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="16x16" href="apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="manifest" href="manifest.json">
<title>Play Level Up - Rewire Your Brain</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0d0a1a;--card:rgba(30,26,46,0.95);--border:#3d3655;--text:#f5f0ff;--muted:#b8b0cc;--pink:#FF3CAC;--orange:#FF6B35;--purple:#784BA0;--blue:#2F80ED;--green:#00D26A;--yellow:#F7C948;--silver:#C0C0C0;--red:#FF4757;--gold:#FFD700}
body{font-family:'Inter',system-ui,-apple-system,sans-serif;background:linear-gradient(180deg,#1a1035 0%,#0d0a1a 100%);min-height:100vh;color:var(--text);overflow-x:hidden}
body::-webkit-scrollbar{display:none}
*{scrollbar-width:none}
.app{max-width:500px;margin:0 auto;padding:16px;padding-top:20px;padding-bottom:40px}
.hook{position:fixed;inset:0;background:linear-gradient(180deg,#1a1035 0%,#0d0a1a 100%);display:flex;align-items:center;justify-content:center;z-index:300;text-align:center;padding:24px}
.hook.hidden{display:none}
.hook-line{font-size:36px;font-weight:800;margin-bottom:16px;opacity:0;transform:translateY(20px);background:linear-gradient(135deg,var(--orange),var(--pink),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hook-line.show{animation:fadeUp 0.8s forwards}
.hook-sub{font-size:17px;color:var(--muted);line-height:1.6;margin:24px 0;opacity:0}
.hook-sub.show{animation:fadeUp 0.8s forwards}
.hook-btn{padding:18px 48px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:16px;color:#fff;font-size:18px;font-weight:700;cursor:pointer;opacity:0;transform:translateY(20px)}
.hook-btn.show{animation:fadeUp 0.6s forwards}
@keyframes fadeUp{to{opacity:1;transform:translateY(0)}}
.onboard{position:fixed;inset:0;background:linear-gradient(180deg,#1a1035 0%,#0d0a1a 100%);display:none;flex-direction:column;align-items:center;justify-content:center;z-index:200;overflow-y:auto}
.onboard.active{display:flex}
.onboard-screen{display:none;flex-direction:column;align-items:center;justify-content:center;min-height:auto;width:100%;max-width:700px;padding:40px 30px;text-align:center}
.onboard-screen.active{display:flex}
.onboard-title{font-size:32px;font-weight:800;text-align:center;margin:20px 0 16px;background:linear-gradient(135deg,var(--orange),var(--pink),var(--purple),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.onboard-sub{text-align:center;color:var(--muted);font-size:17px;margin-bottom:20px}
.onboard-text{text-align:center;color:var(--muted);font-size:17px;line-height:1.6;margin-bottom:6px}
.onboard-text2{text-align:center;color:var(--text);font-size:16px;margin-bottom:6px}
.onboard-highlight{text-align:center;color:var(--text);font-size:17px;font-weight:600}
.onboard-highlight strong{color:var(--pink)}
.onboard-spacer{height:16px}
.onboard-levels{display:flex;flex-direction:column;gap:8px;margin-bottom:20px;width:100%}
.onboard-level{display:flex;align-items:center;gap:14px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px 16px}
.onboard-num{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700;color:#000;flex-shrink:0}
.onboard-info{flex:1}
.onboard-name{font-size:16px;font-weight:600}
.onboard-desc{font-size:14px;color:var(--muted)}
.onboard-dots{display:flex;justify-content:center;gap:8px;margin:20px 0}
.dot{width:8px;height:8px;border-radius:50%;background:var(--border)}
.dot.active{background:var(--pink)}
.onboard-btns{display:flex;gap:12px;width:100%;max-width:700px;padding:20px 30px;margin-top:24px}
.onboard-skip{padding:18px 28px;background:transparent;border:none;color:var(--muted);font-size:16px;cursor:pointer}
.onboard-next,.onboard-start{flex:1;padding:18px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:12px;color:#fff;font-size:17px;font-weight:700;cursor:pointer}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.logo{font-size:22px;font-weight:800;background:linear-gradient(135deg,var(--orange),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.controls{display:flex;gap:8px}
.ctrl-btn{width:40px;height:40px;border-radius:50%;background:var(--card);border:1px solid var(--border);color:var(--muted);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s}
.ctrl-btn:active{transform:scale(0.95)}
.ctrl-btn.on{background:linear-gradient(135deg,var(--orange),var(--pink));color:#fff;border:none}
.ctrl-btn.qa-btn{background:linear-gradient(135deg,var(--purple),var(--blue));color:#fff;border:none;box-shadow:0 2px 8px rgba(120,75,160,0.4)}
.login-bonus{background:linear-gradient(135deg,rgba(255,215,0,0.15),rgba(255,107,53,0.15));border:2px solid var(--gold);border-radius:12px;padding:14px;margin-bottom:16px;text-align:center;cursor:pointer;display:none}
.login-bonus.show{display:block;animation:glow 2s ease-in-out infinite}
@keyframes glow{0%,100%{box-shadow:0 0 5px var(--gold)}50%{box-shadow:0 0 20px var(--gold)}}
.login-title{font-size:14px;font-weight:700;color:var(--gold);margin-bottom:4px}
.login-sub{font-size:12px;color:var(--muted)}
.streak-warning{background:linear-gradient(135deg,rgba(255,71,87,0.2),rgba(255,107,53,0.2));border:2px solid var(--red);border-radius:12px;padding:12px;margin-bottom:16px;text-align:center;display:none;animation:shake 0.5s ease}
.streak-warning.show{display:block}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
.streak-warning-text{font-size:13px;color:var(--red);font-weight:600}
.hero{text-align:center;margin-bottom:20px}
.hero h1{font-size:26px;font-weight:800;margin-bottom:8px;background:linear-gradient(135deg,var(--orange),var(--pink),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero p{color:var(--muted);font-size:14px}
.challenge{background:var(--card);border:2px solid var(--pink);border-radius:16px;padding:18px;margin-bottom:16px;cursor:pointer;transition:all 0.2s;box-shadow:0 4px 20px rgba(255,60,172,0.15)}
.challenge:hover{box-shadow:0 6px 25px rgba(255,60,172,0.25);transform:translateY(-2px)}
.challenge:active{transform:scale(0.98)}
.badge{display:inline-flex;align-items:center;gap:6px;background:var(--pink);color:#fff;font-size:10px;font-weight:700;padding:5px 10px;border-radius:20px;margin-bottom:10px}
.badge-dot{width:6px;height:6px;background:#fff;border-radius:50%;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
.challenge h2{font-size:20px;font-weight:700;margin-bottom:6px}
.challenge p{color:var(--muted);font-size:13px;margin-bottom:12px}
.challenge-footer{display:flex;justify-content:space-between;font-size:12px;color:var(--muted)}
.challenge.done{opacity:0.6;border-color:var(--green)}
.challenge.done .badge{background:var(--green)}
.xp-container{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:16px;box-shadow:0 2px 10px rgba(0,0,0,0.2)}
.xp-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.xp-level{font-size:15px;font-weight:700;color:var(--gold);text-shadow:0 0 10px rgba(255,215,0,0.3)}
.xp-text{font-size:12px;color:var(--muted);margin-top:8px}
.xp-bar{height:10px;background:var(--border);border-radius:5px;overflow:hidden;box-shadow:inset 0 2px 4px rgba(0,0,0,0.3)}
.xp-fill{height:100%;background:linear-gradient(90deg,var(--orange),var(--gold));border-radius:5px;transition:width 0.5s ease;box-shadow:0 0 10px rgba(255,215,0,0.5)}
.xp-coins{display:flex;align-items:center;gap:4px;font-size:14px;color:var(--gold);font-weight:600}
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:16px}
.stat{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px 6px;text-align:center;transition:all 0.2s;box-shadow:0 2px 8px rgba(0,0,0,0.15)}
.stat:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.2)}
.stat-val{font-size:24px;font-weight:800;background:linear-gradient(135deg,var(--orange),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.stat-label{font-size:9px;font-weight:700;color:var(--muted);text-transform:uppercase;margin-top:4px;letter-spacing:0.5px}
.insights-stat{cursor:pointer;border:2px solid var(--pink);box-shadow:0 0 12px rgba(255,60,172,0.3)}
.insights-stat:hover{box-shadow:0 0 20px rgba(255,60,172,0.5)}
.modes{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px}
.mode{background:var(--card);border:2px solid var(--pink);border-radius:16px;padding:20px 14px;text-align:center;cursor:pointer;position:relative;transition:all 0.2s;box-shadow:0 4px 20px rgba(255,60,172,0.15)}
.mode:hover{box-shadow:0 6px 25px rgba(255,60,172,0.25);transform:translateY(-2px)}
.mode:active{transform:scale(0.97)}
.mode.locked{opacity:0.5;border-color:var(--border);box-shadow:0 2px 10px rgba(0,0,0,0.15)}
.mode.locked:hover{box-shadow:0 2px 10px rgba(0,0,0,0.15);transform:none}
.mode.locked::after{content:'üîí';position:absolute;top:10px;right:10px;font-size:16px}
.mode.newly-unlocked{border-color:var(--purple);box-shadow:0 0 20px rgba(120,75,160,0.5);animation:unlockPulse 2s ease-in-out infinite}
.level.newly-unlocked{border:2px solid var(--purple);box-shadow:0 0 15px rgba(120,75,160,0.4);animation:unlockPulse 2s ease-in-out infinite}
@keyframes unlockPulse{0%,100%{box-shadow:0 0 15px rgba(120,75,160,0.4)}50%{box-shadow:0 0 25px rgba(120,75,160,0.7)}}
.mode-icon{font-size:40px;margin-bottom:12px;line-height:1}
.mode-name{font-size:16px;font-weight:700;margin-bottom:6px}
.mode-desc{font-size:12px;color:var(--muted);line-height:1.4}
.mode-unlock{font-size:10px;color:var(--gold);margin-top:8px;font-weight:600}
.section-title{font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:2px;margin-bottom:14px}
.levels{display:flex;flex-direction:column;gap:8px;margin-bottom:20px}
.level{display:flex;align-items:center;gap:14px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;cursor:pointer;transition:all 0.2s;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.level.unlocked{border:2px solid var(--pink);box-shadow:0 2px 12px rgba(255,60,172,0.25)}
.level:hover{border-color:var(--pink);transform:translateX(4px);box-shadow:0 4px 12px rgba(0,0,0,0.15)}
.level:active{transform:scale(0.98)}
.level.locked{opacity:0.4;cursor:not-allowed}
.level.locked:hover{transform:none;border-color:var(--border)}
.level-num{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:15px;font-weight:800;color:#000;flex-shrink:0;box-shadow:0 2px 8px rgba(0,0,0,0.2)}
.level-info{flex:1}
.level-name{font-size:15px;font-weight:600}
.level-desc{font-size:12px;color:var(--muted);margin-top:2px}
.action-btns{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px}
.action-btn{display:flex;align-items:center;justify-content:center;gap:8px;background:var(--card);border:2px solid var(--border);border-radius:12px;padding:14px;cursor:pointer;text-decoration:none;color:var(--text);transition:all 0.2s;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.action-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.2)}
.action-btn:active{transform:scale(0.97)}
.action-btn-icon{font-size:20px}
.action-btn-text{font-size:14px;font-weight:600}
.action-btn.assess{border-color:var(--blue);background:linear-gradient(135deg,rgba(47,128,237,0.1),rgba(47,128,237,0.05))}
.action-btn.assess:hover{border-color:var(--blue);box-shadow:0 4px 15px rgba(47,128,237,0.3)}
.action-btn.share{border-color:var(--green);background:linear-gradient(135deg,rgba(0,210,106,0.1),rgba(0,210,106,0.05))}
.action-btn.share:hover{border-color:var(--green);box-shadow:0 4px 15px rgba(0,210,106,0.3)}
.footer{text-align:center;padding:16px 0}
.footer-btns{display:flex;flex-direction:column;gap:12px;margin-bottom:12px}
.footer-btn{display:block;padding:14px 24px;background:var(--card);border:2px solid var(--pink);border-radius:12px;color:var(--text);text-decoration:none;font-size:14px;font-weight:600;transition:all 0.2s}
.footer-btn:hover{background:rgba(255,60,172,0.15);transform:translateY(-2px);box-shadow:0 4px 15px rgba(255,60,172,0.2)}
.footer-btn.primary{background:linear-gradient(135deg,var(--orange),var(--pink));border:none;color:#fff}
.footer-btn.primary:hover{box-shadow:0 4px 20px rgba(255,60,172,0.4)}
.game{display:none}
.game.active{display:block}
.home.hidden{display:none}
.game-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
.game-info{font-size:14px}
.game-mode{color:var(--muted);font-size:11px;text-transform:uppercase}
.game-combo{font-size:12px;color:var(--gold);font-weight:700}
.quit{width:40px;height:40px;border-radius:50%;background:rgba(255,71,87,0.15);border:2px solid var(--red);color:var(--red);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.timer{height:6px;background:var(--border);border-radius:3px;margin-bottom:16px;overflow:hidden}
.timer.hidden{display:none}
.timer-fill{height:100%;width:100%;background:var(--green);transition:width 0.1s linear}
.timer-fill.warn{background:var(--gold)}
.timer-fill.danger{background:var(--red)}
.scenario{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px;margin-bottom:14px}
.scenario-cat{display:inline-block;background:var(--border);padding:5px 10px;border-radius:16px;font-size:10px;text-transform:uppercase;margin-bottom:12px}
.scenario-text{font-size:16px;line-height:1.6}
.choices{display:flex;flex-direction:column;gap:10px}
.choice{width:100%;padding:16px;background:var(--card);border:2px solid var(--border);border-radius:12px;color:var(--text);font-size:15px;text-align:left;cursor:pointer;line-height:1.5;transition:all 0.2s;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.choice:hover{border-color:var(--pink);transform:translateX(4px);box-shadow:0 4px 12px rgba(255,60,172,0.15)}
.choice:active{transform:scale(0.98);border-color:var(--pink)}
.choice:disabled{cursor:default;transform:none}
.choice.selected{border-color:var(--pink);background:rgba(255,60,172,0.15);box-shadow:0 0 15px rgba(255,60,172,0.2)}
.choice.correct{border-color:var(--green);background:rgba(0,210,106,0.15);box-shadow:0 0 15px rgba(0,210,106,0.2)}
.choice.wrong{border-color:var(--red);background:rgba(255,71,87,0.15);box-shadow:0 0 15px rgba(255,71,87,0.2)}
.choice.dim{opacity:0.25}
.results{display:none;text-align:center;padding-top:40px}
.results.active{display:block}
.results h2{font-size:26px;margin-bottom:16px;font-weight:800}
.score{font-size:72px;font-weight:900;background:linear-gradient(135deg,var(--orange),var(--pink),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin:20px 0;text-shadow:0 0 40px rgba(255,60,172,0.3)}
.result-msg{font-size:17px;color:var(--muted);margin-bottom:24px}
.results-btn{width:100%;padding:18px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:14px;color:#fff;font-size:16px;font-weight:700;cursor:pointer;margin-bottom:12px;box-shadow:0 4px 15px rgba(255,60,172,0.3);transition:all 0.2s}
.results-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(255,60,172,0.4)}
.results-share{width:100%;padding:16px;background:var(--card);border:2px solid var(--green);border-radius:14px;color:var(--green);font-size:15px;font-weight:700;cursor:pointer;transition:all 0.2s}
.results-share:hover{background:rgba(0,210,106,0.1);box-shadow:0 4px 15px rgba(0,210,106,0.2)}
.insights-list{text-align:left;margin:20px 0;max-height:200px;overflow-y:auto}
.insight-item{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px 14px;margin-bottom:8px;font-size:14px;line-height:1.5;transition:all 0.2s}
.insight-item:hover{border-color:var(--pink)}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.92);display:none;align-items:center;justify-content:center;padding:20px;z-index:100;backdrop-filter:blur(4px)}
.modal.active{display:flex}
.modal-content{background:linear-gradient(180deg,rgba(40,35,60,0.98),rgba(25,20,40,0.98));border:1px solid var(--border);border-radius:20px;padding:28px;max-width:360px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,0.5)}
.modal-icon{font-size:48px;text-align:center;margin-bottom:12px}
.modal-title{font-size:24px;font-weight:800;text-align:center;margin-bottom:18px;background:linear-gradient(135deg,var(--orange),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.feedback-box{background:rgba(0,0,0,0.4);border-radius:12px;padding:16px;margin-bottom:18px;border:1px solid var(--border)}
.feedback-label{font-size:10px;color:var(--purple);text-transform:uppercase;margin-bottom:10px;font-weight:700;letter-spacing:1px}
.feedback-text{font-size:15px;line-height:1.6}
.modal-btn{width:100%;padding:16px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:12px;color:#fff;font-size:16px;font-weight:700;cursor:pointer;transition:all 0.2s;box-shadow:0 4px 15px rgba(255,60,172,0.3)}
.modal-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(255,60,172,0.4)}
.modal-btn:active{transform:scale(0.98)}
.bonus-popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);background:linear-gradient(135deg,var(--gold),var(--orange));border-radius:20px;padding:30px;text-align:center;z-index:400;box-shadow:0 0 40px rgba(255,215,0,0.5)}
.bonus-popup.show{transform:translate(-50%,-50%) scale(1);animation:bonusPop 0.5s ease}
@keyframes bonusPop{0%{transform:translate(-50%,-50%) scale(0)}50%{transform:translate(-50%,-50%) scale(1.1)}100%{transform:translate(-50%,-50%) scale(1)}}
.bonus-icon{font-size:60px;margin-bottom:10px}
.bonus-title{font-size:24px;font-weight:800;color:#000;margin-bottom:8px}
.bonus-sub{font-size:16px;color:rgba(0,0,0,0.7)}
.levelup-popup{position:fixed;inset:0;background:rgba(0,0,0,0.95);display:none;align-items:center;justify-content:center;z-index:500}
.levelup-popup.show{display:flex}
.levelup-content{text-align:center;animation:levelUpAnim 1s ease}
@keyframes levelUpAnim{0%{transform:scale(0) rotate(-10deg);opacity:0}50%{transform:scale(1.2) rotate(5deg)}100%{transform:scale(1) rotate(0);opacity:1}}
.levelup-icon{font-size:80px;margin-bottom:20px}
.levelup-title{font-size:36px;font-weight:900;background:linear-gradient(135deg,var(--gold),var(--orange));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:10px}
.levelup-sub{font-size:18px;color:var(--muted);margin-bottom:20px}
.levelup-unlock{font-size:14px;color:var(--green);margin-bottom:20px}
.levelup-btn{padding:16px 40px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:12px;color:#fff;font-size:16px;font-weight:700;cursor:pointer}
.combo-display{position:fixed;top:100px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,var(--orange),var(--pink));padding:10px 20px;border-radius:20px;font-size:16px;font-weight:800;color:#fff;opacity:0;z-index:50}
.combo-display.show{opacity:1;animation:comboPop 0.5s ease}
@keyframes comboPop{0%{transform:translateX(-50%) scale(0.5)}50%{transform:translateX(-50%) scale(1.2)}100%{transform:translateX(-50%) scale(1)}}
.toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,var(--green),#00B85D);color:#fff;padding:14px 28px;border-radius:14px;font-size:14px;font-weight:600;opacity:0;transition:all 0.3s;z-index:500;pointer-events:none;box-shadow:0 4px 20px rgba(0,210,106,0.4)}
.toast.show{opacity:1;transform:translateX(-50%) translateY(-10px)}
.qa-item{border-bottom:1px solid var(--border);padding:14px 0}
.qa-item:last-of-type{border:none}
.qa-question{font-size:14px;font-weight:600;cursor:pointer;padding:6px 0;display:flex;justify-content:space-between;align-items:center;color:var(--text)}
.qa-question::after{content:'‚ñ∏';color:var(--purple);font-size:12px;transition:transform 0.3s}
.qa-item.open .qa-question::after{transform:rotate(90deg)}
.qa-answer{font-size:13px;color:var(--muted);line-height:1.7;max-height:0;overflow:hidden;transition:max-height 0.3s ease,padding 0.3s ease}
.qa-item.open .qa-answer{max-height:500px;padding-top:12px}
#confetti{position:fixed;inset:0;pointer-events:none;z-index:1000}
.install-banner{position:fixed;bottom:0;left:0;right:0;background:linear-gradient(135deg,var(--purple),var(--blue));padding:16px 20px;display:none;align-items:center;justify-content:space-between;gap:12px;z-index:600;box-shadow:0 -4px 20px rgba(0,0,0,0.4)}
.install-banner.show{display:flex}
.install-banner-text{flex:1}
.install-banner-title{font-size:14px;font-weight:700;margin-bottom:2px}
.install-banner-sub{font-size:12px;color:rgba(255,255,255,0.8)}
.install-banner-btn{padding:10px 20px;background:#fff;color:var(--purple);border:none;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;white-space:nowrap}
.install-banner-close{background:none;border:none;color:rgba(255,255,255,0.6);font-size:20px;cursor:pointer;padding:4px}
.ios-modal{position:fixed;inset:0;background:rgba(0,0,0,0.92);display:none;align-items:flex-end;justify-content:center;padding:20px;z-index:700}
.ios-modal.active{display:flex}
.ios-modal-content{background:var(--card);border:1px solid var(--border);border-radius:20px 20px 0 0;padding:24px;width:100%;max-width:400px;text-align:center}
.ios-modal-title{font-size:18px;font-weight:700;margin-bottom:16px}
.ios-modal-steps{text-align:left;margin:16px 0}
.ios-modal-step{display:flex;align-items:center;gap:12px;margin-bottom:12px;font-size:14px}
.ios-modal-icon{font-size:24px}
.ios-modal-btn{width:100%;padding:14px;background:linear-gradient(135deg,var(--orange),var(--pink));border:none;border-radius:12px;color:#fff;font-size:15px;font-weight:700;cursor:pointer;margin-top:8px}
</style>
</head>
<body>
<canvas id="confetti"></canvas>
<div class="install-banner" id="installBanner">
<button class="install-banner-close" id="installClose">√ó</button>
<div class="install-banner-text">
<div class="install-banner-title">üì≤ Add to Home Screen</div>
<div class="install-banner-sub">Play daily without opening browser</div>
</div>
<button class="install-banner-btn" id="installBtn">Install</button>
</div>
<div class="ios-modal" id="iosModal">
<div class="ios-modal-content">
<div class="ios-modal-title">Add Level Up to Home Screen</div>
<div class="ios-modal-steps">
<div class="ios-modal-step"><span class="ios-modal-icon">üì§</span><span>Tap the <strong>Share</strong> button below</span></div>
<div class="ios-modal-step"><span class="ios-modal-icon">‚ûï</span><span>Scroll and tap <strong>"Add to Home Screen"</strong></span></div>
<div class="ios-modal-step"><span class="ios-modal-icon">‚úì</span><span>Tap <strong>Add</strong> in the top right</span></div>
</div>
<button class="ios-modal-btn" id="iosClose">Got it!</button>
</div>
</div>
<audio id="music" loop><source src="level-up.mp3" type="audio/mpeg"></audio>
<div class="toast" id="toast">+10 XP!</div>
<div class="combo-display" id="comboDisplay">üî• 3x COMBO!</div>
<div class="bonus-popup" id="bonusPopup"><div class="bonus-icon">üéÅ</div><div class="bonus-title">BONUS!</div><div class="bonus-sub" id="bonusText">+25 XP</div></div>
<div class="levelup-popup" id="levelupPopup"><div class="levelup-content"><div class="levelup-icon" id="levelupIcon">‚≠ê</div><div class="levelup-title">LEVEL UP!</div><div class="levelup-sub" id="levelupText">You're now Level 2</div><div class="levelup-unlock" id="levelupUnlock"></div><button class="levelup-btn" id="levelupBtn">Amazing!</button></div></div>

<div class="hook" id="hook"><div><div class="hook-line" id="line1">Something's off.</div><div class="hook-line" id="line2">You can feel it.</div><div class="hook-sub" id="hookSub">Play your way to better patterns.</div><button class="hook-btn" id="hookBtn">Show Me</button></div></div>

<div class="onboard" id="onboard">
<div class="onboard-screen active" id="onboard1"><div class="onboard-title">There Are Levels To This</div><div class="onboard-text">Most people are stuck ‚Äî not because they lack knowledge, but because they're working on the wrong level.</div><div class="onboard-spacer"></div><div class="onboard-text2">Rewire your brain through play.</div><div class="onboard-text2">Mirror reveals. Agreement trains. Decision challenges.</div><div class="onboard-spacer"></div><div class="onboard-highlight">The goal isn't the "highest" level.<br>It's the <strong>right</strong> level.</div><div class="onboard-dots"><span class="dot active"></span><span class="dot"></span></div><div class="onboard-btns"><button class="onboard-skip" id="skipBtn">Skip</button><button class="onboard-next" id="nextBtn1">Next</button></div></div>
<div class="onboard-screen" id="onboard2"><div class="onboard-title">The 7 Levels of Self</div><div class="onboard-sub">Master each level to unlock the next.</div><div class="onboard-levels"><div class="onboard-level"><div class="onboard-num" style="background:#FF6B35">1</div><div class="onboard-info"><div class="onboard-name">Individual</div><div class="onboard-desc">Your relationship with yourself</div></div></div><div class="onboard-level"><div class="onboard-num" style="background:#FF3CAC">2</div><div class="onboard-info"><div class="onboard-name">Family</div><div class="onboard-desc">Your closest relationships</div></div></div><div class="onboard-level"><div class="onboard-num" style="background:#784BA0">3</div><div class="onboard-info"><div class="onboard-name">Groups</div><div class="onboard-desc">Teams, friends, communities</div></div></div><div class="onboard-level"><div class="onboard-num" style="background:#2F80ED">4</div><div class="onboard-info"><div class="onboard-name">Community</div><div class="onboard-desc">Your role in the larger whole</div></div></div><div class="onboard-level"><div class="onboard-num" style="background:#00D26A">5</div><div class="onboard-info"><div class="onboard-name">Society</div><div class="onboard-desc">Systems, culture, nation</div></div></div><div class="onboard-level"><div class="onboard-num" style="background:#F7C948">6</div><div class="onboard-info"><div class="onboard-name">World</div><div class="onboard-desc">Global connection</div></div></div><div class="onboard-level"><div class="onboard-num" style="background:#C0C0C0">7</div><div class="onboard-info"><div class="onboard-name">Generations</div><div class="onboard-desc">Legacy that outlasts you</div></div></div></div><div class="onboard-dots"><span class="dot"></span><span class="dot active"></span></div><div class="onboard-btns"><button class="onboard-skip" id="skipBtn2">Skip</button><button class="onboard-start" id="goBtn">Let's Go</button></div></div>
</div>

<div class="app">
<div class="home" id="home">
<div class="header"><div class="logo">LEVEL UP</div><div class="controls"><button class="ctrl-btn" id="musicBtn">üéµ</button><button class="ctrl-btn on" id="soundBtn">üîä</button><button class="ctrl-btn qa-btn" id="qaBtn">‚ùì</button></div></div>

<div class="login-bonus" id="loginBonus"><div class="login-title">üéÅ Daily Login Bonus!</div><div class="login-sub">Tap to claim <span id="loginReward">+20 XP</span></div></div>
<div class="streak-warning" id="streakWarning"><div class="streak-warning-text">‚ö†Ô∏è Play today or lose your <span id="streakCount">0</span>-day streak!</div></div>

<div class="hero"><h1>Discover Your Level</h1><p>Rewire your brain through play.</p></div>

<div class="challenge" id="dailyCard"><div class="badge"><span class="badge-dot"></span>TRENDING GLOBALLY</div><h2>Worldwide Challenge</h2><p>Same 3 scenarios for everyone on Earth. One chance daily.</p><div class="challenge-footer"><span id="dailyCta">Tap to join the global movement</span><span id="dailyTimer">Resets in --:--:--</span></div></div>

<div class="xp-container"><div class="xp-header"><div class="xp-level" id="playerLevel">Level 1</div><div class="xp-coins">ü™ô <span id="coinCount">0</span></div></div><div class="xp-bar"><div class="xp-fill" id="xpFill" style="width:0%"></div></div><div class="xp-text"><span id="xpCurrent">0</span> / <span id="xpNeeded">100</span> XP</div></div>

<div class="stats"><div class="stat"><div class="stat-val" id="statPlayed">0</div><div class="stat-label">Played</div></div><div class="stat"><div class="stat-val" id="statStreak">0</div><div class="stat-label">Streak</div></div><div class="stat"><div class="stat-val" id="statAcceptRate">0%</div><div class="stat-label">Acceptance</div></div><div class="stat insights-stat" id="insightsStat"><div class="stat-val" id="statInsights">0</div><div class="stat-label">Insights</div></div></div>

<div class="modes"><div class="mode" id="mirrorMode"><div class="mode-icon" style="font-family:'Apple Color Emoji','Segoe UI Emoji','Noto Color Emoji',sans-serif;">ü™û</div><div class="mode-name">Mirror Game</div><div class="mode-desc">See yourself honestly</div><div class="mode-unlock" id="mirrorUnlock"></div></div><div class="mode" id="agreementMode"><div class="mode-icon" style="font-family:'Apple Color Emoji','Segoe UI Emoji','Noto Color Emoji',sans-serif;">‚öñÔ∏è</div><div class="mode-name">Agreement Game</div><div class="mode-desc">Acceptance vs Judgment</div><div class="mode-unlock" id="agreementUnlock"></div></div></div>

<div class="section-title">Your Journey</div>
<div class="levels" id="levelMap"></div>

<div class="action-btns"><a class="action-btn assess" href="https://selfcheck.100levelup.com/assessment.html" target="_blank" rel="noopener"><span class="action-btn-icon">üìã</span><span class="action-btn-text">Full Assessment</span></a><button class="action-btn share" id="shareBtn"><span class="action-btn-icon">üîó</span><span class="action-btn-text">Share</span></button></div>

<div class="footer">
<div class="footer-btns">
<a class="footer-btn primary" href="https://www.levelsofself.com/post/the-7-levels-of-self-explained" target="_blank" rel="noopener">Learn the Full Framework</a>
<a class="footer-btn" href="https://www.levelsofself.com" target="_blank" rel="noopener">LevelsOfSelf.com</a>
</div>
</div>
</div>

<div class="game" id="game"><div class="game-header"><div class="game-info"><div class="game-mode" id="gameMode">Mirror</div><div id="gameProgress">1/5</div><div class="game-combo" id="gameCombo"></div></div><button class="quit" id="quitBtn">‚úï</button></div><div class="timer" id="timerBar"><div class="timer-fill" id="timerFill"></div></div><div class="scenario"><div class="scenario-cat" id="scenarioCat">Level 1: Individual</div><div class="scenario-text" id="scenarioText">Loading...</div></div><div class="choices" id="choices"></div></div>

<div class="results" id="results"><h2 id="resultsTitle">Game Complete</h2><div class="score" id="finalScore">0</div><p class="result-msg" id="resultMsg">Keep going!</p><div class="insights-list" id="insightsList"></div><button class="results-btn" id="homeBtn">Continue</button><button class="results-share" id="resultsShare">üì§ Share Results</button></div>
</div>

<div class="modal" id="qaModal"><div class="modal-content" style="max-height:80vh;overflow-y:auto;position:relative;">
<button onclick="document.getElementById('qaModal').classList.remove('active')" style="position:absolute;top:12px;right:12px;width:32px;height:32px;border-radius:50%;background:var(--card);border:1px solid var(--border);color:var(--muted);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;">‚úï</button>
<div class="modal-title" style="margin-top:8px;">Questions & Answers</div>
<div class="qa-item"><div class="qa-question">What is the 7 Levels framework?</div><div class="qa-answer">The 7 Levels of Self maps human growth across 7 dimensions: Individual (self), Family (close relationships), Groups (teams/friends), Community (local impact), Society (systems/culture), World (global connection), and Generations (legacy). You can't skip levels - each must be mastered before climbing higher.</div></div>
<div class="qa-item"><div class="qa-question">How does the scoring work?</div><div class="qa-answer">You earn XP for every answer. Correct/accepting answers earn more XP. As you accumulate XP, you level up and unlock new content. Streaks multiply your progress!</div></div>
<div class="qa-item"><div class="qa-question">What's the difference between the 3 games?</div><div class="qa-answer"><strong style="color:var(--pink);">ü™û Mirror Game:</strong> Self-reflection. See patterns honestly. No right/wrong.<br><br><strong style="color:var(--purple);">‚öñÔ∏è Agreement Game:</strong> Train yourself to choose acceptance over judgment. Timed.<br><br><strong style="color:var(--orange);">üåç Worldwide Challenge:</strong> Same 3 scenarios for everyone globally. One chance daily.</div></div>
<div class="qa-item"><div class="qa-question">What does "Acceptance ‚â† Agreement" mean?</div><div class="qa-answer">Acceptance means acknowledging reality as it is. Agreement means endorsing it. You can accept that something IS without agreeing it SHOULD BE. Acceptance is the first step to change.</div></div>
<div class="qa-item"><div class="qa-question">How do I unlock new levels?</div><div class="qa-answer">Play games to earn XP. At Player Level 2 you unlock the Agreement Game + Family scenarios. Higher player levels unlock more framework levels and content.</div></div>
<div class="qa-item"><div class="qa-question">Can I use this with my therapist or coach?</div><div class="qa-answer">Yes! Your insights reveal growth patterns. Share your results with your therapist, coach, or accountability partner to deepen your work together.</div></div>
<div class="qa-item"><div class="qa-question">What are Insights?</div><div class="qa-answer">When you play Mirror Game, every pattern you recognize gets saved to your Insights collection. Tap the Insights stat to review them anytime. They're organized by level so you can see your growth patterns.</div></div>
<div style="display:flex;flex-direction:column;gap:12px;margin-top:24px;padding-top:20px;border-top:1px solid var(--border);">
<a href="https://selfcheck.100levelup.com/assessment.html" target="_blank" style="display:block;padding:14px;background:linear-gradient(135deg,var(--orange),var(--pink));border-radius:12px;color:#fff;font-size:15px;font-weight:700;text-decoration:none;text-align:center;">üìã Take Full Assessment</a>
<a href="https://levelsofself.com" target="_blank" style="display:block;padding:14px;background:linear-gradient(135deg,var(--purple),var(--blue));border-radius:12px;color:#fff;font-size:15px;font-weight:600;text-decoration:none;text-align:center;">üåê Visit LevelsOfSelf.com</a>
<button onclick="if(navigator.share){navigator.share({title:'Level Up - 7 Levels of Self',text:'Rewire your brain through play!',url:'https://100levelup.com'})}else{navigator.clipboard.writeText('https://100levelup.com');alert('Link copied!')}" style="padding:14px;background:linear-gradient(135deg,var(--pink),var(--purple));border:none;border-radius:12px;color:#fff;font-size:15px;font-weight:600;cursor:pointer;">üì§ Share This Game</button>
<a href="https://wa.me/qr/OFPFUYXQFBMIF1" target="_blank" style="display:block;padding:14px;background:linear-gradient(135deg,var(--green),#00B85D);border-radius:12px;color:#fff;font-size:15px;font-weight:600;text-decoration:none;text-align:center;">üí¨ Book a Coaching Session</a>
</div>
<button class="modal-btn" id="qaClose" style="margin-top:16px;background:var(--card);border:1px solid var(--border);color:var(--muted);">Close</button></div></div>

<div class="modal" id="feedbackModal"><div class="modal-content"><div class="modal-icon" id="fbIcon">üí°</div><div class="modal-title" id="fbTitle">Insight</div><div class="feedback-box"><div class="feedback-label" id="fbLabel">Reflection</div><div class="feedback-text" id="fbText">...</div></div><button class="modal-btn" id="nextBtn">Next</button></div></div>

<div class="modal" id="insightsModal"><div class="modal-content" style="max-height:80vh;overflow-y:auto"><div class="modal-title">Your Insights</div>
<div id="insightsFilter" style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px;justify-content:center;"></div>
<div id="insightsListModal" style="text-align:left;"></div><div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border);"><button class="modal-btn" id="insightsClose">Close</button></div></div></div>

<div class="modal" id="levelSelectModal"><div class="modal-content">
<div class="modal-title" id="levelSelectTitle">Level 1: Individual</div>
<div style="color:var(--muted);text-align:center;margin-bottom:20px;" id="levelSelectDesc">Your relationship with yourself</div>
<div style="display:flex;flex-direction:column;gap:12px;">
<button class="modal-btn" id="levelMirrorBtn" style="background:linear-gradient(135deg,var(--pink),var(--purple));">ü™û Mirror Game<br><span style="font-size:12px;font-weight:400;opacity:0.8;">See yourself honestly</span></button>
<button class="modal-btn" id="levelAgreementBtn" style="background:linear-gradient(135deg,var(--purple),var(--blue));">‚öñÔ∏è Agreement Game<br><span style="font-size:12px;font-weight:400;opacity:0.8;">Practice acceptance</span></button>
<button class="modal-btn" id="levelMixedBtn" style="background:linear-gradient(135deg,var(--orange),var(--pink));">üé≤ Mixed Mode<br><span style="font-size:12px;font-weight:400;opacity:0.8;">Both games shuffled</span></button>
<button class="modal-btn" id="levelInsightsBtn" style="background:linear-gradient(135deg,var(--gold),var(--orange));">üí° Your Insights<br><span style="font-size:12px;font-weight:400;opacity:0.8;" id="levelInsightsCount">0 collected</span></button>
</div>
<button id="levelSelectClose" style="margin-top:16px;padding:12px;background:transparent;border:1px solid var(--border);border-radius:10px;color:var(--muted);font-size:14px;cursor:pointer;width:100%;">Cancel</button>
</div></div>

<script src="mirror-level1-individual.js"></script>
<script src="mirror-level2-family.js"></script>
<script src="mirror-level3-groups.js"></script>
<script src="mirror-level4-community.js"></script>
<script src="mirror-level5-society.js"></script>
<script src="mirror-level6-world.js"></script>
<script src="mirror-level7-generations.js"></script>
<script src="agreement_game.js"></script>
<script src="worldwide_challenge.js"></script>
<script>
const MIRROR_SCENARIOS=[...(typeof LEVEL_1_INDIVIDUAL!=='undefined'?LEVEL_1_INDIVIDUAL:[]),...(typeof LEVEL_2_FAMILY!=='undefined'?LEVEL_2_FAMILY:[]),...(typeof LEVEL_3_GROUPS!=='undefined'?LEVEL_3_GROUPS:[]),...(typeof LEVEL_4_COMMUNITY!=='undefined'?LEVEL_4_COMMUNITY:[]),...(typeof LEVEL_5_SOCIETY!=='undefined'?LEVEL_5_SOCIETY:[]),...(typeof LEVEL_6_WORLD!=='undefined'?LEVEL_6_WORLD:[]),...(typeof LEVEL_7_GENERATIONS!=='undefined'?LEVEL_7_GENERATIONS:[])];
const LEVELS=[{id:1,name:'Individual',color:'#FF6B35',desc:'Your relationship with yourself'},{id:2,name:'Family',color:'#FF3CAC',desc:'Your closest relationships'},{id:3,name:'Groups',color:'#784BA0',desc:'Teams, friends, communities'},{id:4,name:'Community',color:'#2F80ED',desc:'Your role in the larger whole'},{id:5,name:'Society',color:'#00D26A',desc:'Systems, culture, nation'},{id:6,name:'World',color:'#F7C948',desc:'Global connection'},{id:7,name:'Generations',color:'#C0C0C0',desc:'Legacy that outlasts you'}];
const XP_PER_LEVEL=100;
let music=document.getElementById('music');music.volume=0.4;
let musicOn=false,soundOn=true,currentCombo=0;
let data=JSON.parse(localStorage.getItem('levelup_v7'))||{xp:0,level:1,coins:0,games:0,mirrorRecognized:0,mirrorTotal:0,agreementAccepted:0,agreementTotal:0,streak:0,lastDaily:null,lastLogin:null,loginDay:0,unlockedLevels:[1],unlockedAgreement:false,seenIntro:false,insightsCollection:[],newlyUnlockedLevels:[],seenAgreementUnlock:false};
let game={mode:null,scenarios:[],idx:0,answers:[],timer:null,timeLeft:15,useTimer:true};

function save(){localStorage.setItem('levelup_v7',JSON.stringify(data))}
function shuffle(a){let arr=[...a];for(let i=arr.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]}return arr}
function hashDate(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h=h&h}return Math.abs(h)}

function playSound(f,d){if(!soundOn)return;try{let c=new(window.AudioContext||window.webkitAudioContext)(),o=c.createOscillator(),g=c.createGain();o.frequency.value=f;o.connect(g);g.connect(c.destination);g.gain.setValueAtTime(0.15,c.currentTime);g.gain.exponentialRampToValueAtTime(0.001,c.currentTime+d);o.start();o.stop(c.currentTime+d)}catch(e){}}
function positiveSound(){[523,659,784].forEach((f,i)=>setTimeout(()=>playSound(f,0.15),i*80))}
function neutralSound(){playSound(330,0.2)}
function coinSound(){playSound(988,0.05);setTimeout(()=>playSound(1319,0.3),60)}
function multiCoinSound(n){for(let i=0;i<Math.min(n,5);i++){setTimeout(()=>{playSound(988+i*100,0.05);setTimeout(()=>playSound(1319+i*100,0.2),40)},i*80)}}
function levelUpSound(){[523,659,784,1047].forEach((f,i)=>setTimeout(()=>playSound(f,0.2),i*100))}
function bonusSound(){[784,988,1175,1568].forEach((f,i)=>setTimeout(()=>playSound(f,0.15),i*60))}
function comboSound(n){let base=523;for(let i=0;i<Math.min(n,5);i++){setTimeout(()=>playSound(base+i*50,0.1),i*50)}}

function addXP(amount){
  data.xp+=amount;data.coins+=Math.floor(amount/2);
  let newLevel=Math.floor(data.xp/XP_PER_LEVEL)+1;
  if(newLevel>data.level){
    data.level=newLevel;levelUpSound();triggerConfetti();
    let unlockMsg='';
    if(newLevel===2){data.unlockedAgreement=true;data.seenAgreementUnlock=false;if(!data.unlockedLevels.includes(2)){data.unlockedLevels.push(2);if(!data.newlyUnlockedLevels)data.newlyUnlockedLevels=[];data.newlyUnlockedLevels.push(2);}unlockMsg='üîì Agreement Game unlocked!';}
    if(newLevel===3&&!data.unlockedLevels.includes(3)){data.unlockedLevels.push(3);if(!data.newlyUnlockedLevels)data.newlyUnlockedLevels=[];data.newlyUnlockedLevels.push(3);unlockMsg='üîì Level 3 unlocked!';}
    if(newLevel>=5&&!data.unlockedLevels.includes(4)){data.unlockedLevels.push(4);if(!data.newlyUnlockedLevels)data.newlyUnlockedLevels=[];data.newlyUnlockedLevels.push(4);}
    if(newLevel>=7&&!data.unlockedLevels.includes(5)){data.unlockedLevels.push(5);if(!data.newlyUnlockedLevels)data.newlyUnlockedLevels=[];data.newlyUnlockedLevels.push(5);}
    if(newLevel>=10&&!data.unlockedLevels.includes(6)){data.unlockedLevels.push(6);if(!data.newlyUnlockedLevels)data.newlyUnlockedLevels=[];data.newlyUnlockedLevels.push(6);}
    if(newLevel>=15&&!data.unlockedLevels.includes(7)){data.unlockedLevels.push(7);if(!data.newlyUnlockedLevels)data.newlyUnlockedLevels=[];data.newlyUnlockedLevels.push(7);}
    showLevelUp(newLevel,unlockMsg);
  }
  save();updateXPBar();
}
const GROWTH_ICONS=['üå±','üåø','ü™ª','üå≥','üå≤','üåç','‚≠ê'];
function updateXPBar(){
  let levelXP=(data.level-1)*XP_PER_LEVEL;let currentLevelXP=data.xp-levelXP;let pct=(currentLevelXP/XP_PER_LEVEL)*100;
  let icon=GROWTH_ICONS[Math.min(data.level-1,6)];
  document.getElementById('playerLevel').innerHTML=icon+' Level '+data.level;
  document.getElementById('xpFill').style.width=pct+'%';
  document.getElementById('xpCurrent').textContent=currentLevelXP;
  document.getElementById('xpNeeded').textContent=XP_PER_LEVEL;
  document.getElementById('coinCount').textContent=data.coins;
}
function showLevelUp(level,unlockMsg){
  let icon=GROWTH_ICONS[Math.min(level-1,6)];
  document.getElementById('levelupIcon').textContent=icon;
  document.getElementById('levelupText').textContent="You're now Level "+level+"!";
  document.getElementById('levelupUnlock').textContent=unlockMsg||'';
  document.getElementById('levelupPopup').classList.add('show');
}
document.getElementById('levelupBtn').onclick=function(){document.getElementById('levelupPopup').classList.remove('show')};

function addCombo(){
  currentCombo++;
  if(currentCombo>=3){
    let el=document.getElementById('comboDisplay');el.textContent='üî• '+currentCombo+'x COMBO!';el.classList.add('show');comboSound(currentCombo);
    setTimeout(()=>el.classList.remove('show'),1500);
    if(currentCombo===5){showBonusPopup('+30 XP Combo!');addXP(30);}
    else if(currentCombo===10){showBonusPopup('+50 XP Mega Combo!');addXP(50);}
  }
  document.getElementById('gameCombo').textContent=currentCombo>1?'üî•'+currentCombo+'x':'';
}
function resetCombo(){currentCombo=0;document.getElementById('gameCombo').textContent='';}

function showToast(msg){let t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2000)}
function showBonusPopup(text){document.getElementById('bonusText').textContent=text;document.getElementById('bonusPopup').classList.add('show');bonusSound();setTimeout(()=>document.getElementById('bonusPopup').classList.remove('show'),2500)}
function maybeBonus(){if(Math.random()<0.12){let bonuses=[{text:'+25 XP Bonus!',xp:25},{text:'+50 XP Jackpot!',xp:50},{text:'üíé Rare Insight!',xp:30}];let bonus=bonuses[Math.floor(Math.random()*bonuses.length)];setTimeout(()=>{showBonusPopup(bonus.text);addXP(bonus.xp)},800);return true}return false}

function triggerConfetti(){
  let canvas=document.getElementById('confetti'),ctx=canvas.getContext('2d');canvas.width=window.innerWidth;canvas.height=window.innerHeight;
  let particles=[],colors=['#FF3CAC','#FF6B35','#784BA0','#2F80ED','#00D26A','#F7C948','#FFD700'];
  for(let i=0;i<150;i++){particles.push({x:canvas.width/2,y:canvas.height/2,vx:(Math.random()-0.5)*15,vy:(Math.random()-0.5)*15-5,color:colors[Math.floor(Math.random()*colors.length)],size:Math.random()*8+4,life:1})}
  function animate(){ctx.clearRect(0,0,canvas.width,canvas.height);let alive=false;particles.forEach(p=>{if(p.life<=0)return;alive=true;p.x+=p.vx;p.y+=p.vy;p.vy+=0.3;p.life-=0.015;ctx.globalAlpha=p.life;ctx.fillStyle=p.color;ctx.fillRect(p.x,p.y,p.size,p.size)});if(alive)requestAnimationFrame(animate);else ctx.clearRect(0,0,canvas.width,canvas.height)}animate();
}

function checkDailyLogin(){
  let today=new Date().toDateString();
  if(data.lastLogin!==today){
    let yesterday=new Date(Date.now()-86400000).toDateString();
    data.loginDay=data.lastLogin===yesterday?Math.min(data.loginDay+1,7):1;
    data.lastLogin=today;save();
    let rewards=[20,25,30,40,50,75,100];
    document.getElementById('loginReward').textContent='+'+rewards[data.loginDay-1]+' XP (Day '+data.loginDay+')';
    document.getElementById('loginBonus').classList.add('show');
  }else{document.getElementById('loginBonus').classList.remove('show')}
}
document.getElementById('loginBonus').onclick=function(){
  let rewards=[20,25,30,40,50,75,100];multiCoinSound(data.loginDay);addXP(rewards[data.loginDay-1]);showToast('+'+rewards[data.loginDay-1]+' XP!');this.classList.remove('show');triggerConfetti();
};

function checkStreakWarning(){
  if(data.streak>0&&data.lastDaily!==new Date().toDateString()){document.getElementById('streakCount').textContent=data.streak;document.getElementById('streakWarning').classList.add('show')}
  else{document.getElementById('streakWarning').classList.remove('show')}
}

function addInsight(text,level){if(text&&!data.insightsCollection.some(i=>i.text===text)){data.insightsCollection.push({text:text,level:level||1,date:new Date().toLocaleDateString()});if(data.insightsCollection.length>200)data.insightsCollection=data.insightsCollection.slice(-200);save()}}

function updateHome(){
  updateXPBar();checkDailyLogin();checkStreakWarning();
  document.getElementById('statPlayed').textContent=data.games;
  document.getElementById('statInsights').textContent=data.insightsCollection?data.insightsCollection.length:0;
  document.getElementById('statStreak').textContent=data.streak||0;
  let acceptRate=data.agreementTotal>0?Math.round((data.agreementAccepted/data.agreementTotal)*100):0;
  document.getElementById('statAcceptRate').textContent=acceptRate+'%';
  let today=new Date().toDateString(),daily=document.getElementById('dailyCard');
  if(data.lastDaily===today){daily.classList.add('done');document.getElementById('dailyCta').textContent='‚úì Completed today'}
  else{daily.classList.remove('done');document.getElementById('dailyCta').textContent='Tap to join the global movement'}
  document.getElementById('mirrorMode').classList.remove('locked','newly-unlocked');document.getElementById('mirrorUnlock').textContent='';
  if(data.unlockedAgreement){
    document.getElementById('agreementMode').classList.remove('locked');
    document.getElementById('agreementUnlock').textContent='';
    if(!data.seenAgreementUnlock){document.getElementById('agreementMode').classList.add('newly-unlocked');}
  }
  else{document.getElementById('agreementMode').classList.add('locked');document.getElementById('agreementMode').classList.remove('newly-unlocked');document.getElementById('agreementUnlock').textContent='Reach Level 2'}
  let map=document.getElementById('levelMap');map.innerHTML='';
  LEVELS.forEach(lv=>{
    let unlocked=data.unlockedLevels.includes(lv.id);
    let isNew=unlocked&&data.newlyUnlockedLevels&&data.newlyUnlockedLevels.includes(lv.id);
    let div=document.createElement('div');div.className='level'+(unlocked?' unlocked':' locked')+(isNew?' newly-unlocked':'');
    let unlockText='Reach Player Level '+lv.id;
    div.innerHTML='<div class="level-num" style="background:'+lv.color+'">'+lv.id+'</div><div class="level-info"><div class="level-name">'+lv.name+(unlocked?'':' üîí')+'</div><div class="level-desc">'+(unlocked?lv.desc:unlockText)+'</div></div>';
    if(unlocked){div.onclick=()=>{if(isNew){data.newlyUnlockedLevels=data.newlyUnlockedLevels.filter(x=>x!==lv.id);save();div.classList.remove('newly-unlocked');}showLevelSelect(lv)};}map.appendChild(div);
  });
  updateTimer();
}
function updateTimer(){let now=new Date(),tom=new Date(now);tom.setDate(tom.getDate()+1);tom.setHours(0,0,0,0);let d=tom-now,h=String(Math.floor(d/3600000)).padStart(2,'0'),m=String(Math.floor((d%3600000)/60000)).padStart(2,'0'),s=String(Math.floor((d%60000)/1000)).padStart(2,'0');document.getElementById('dailyTimer').textContent='Resets in '+h+':'+m+':'+s}

let selectedLevel=null;
function showLevelSelect(lv){
  selectedLevel=lv;
  document.getElementById('levelSelectTitle').textContent='Level '+lv.id+': '+lv.name;
  document.getElementById('levelSelectDesc').textContent=lv.desc;
  let levelInsightCount=data.insightsCollection?data.insightsCollection.filter(i=>i.level===lv.id).length:0;
  document.getElementById('levelInsightsCount').textContent=levelInsightCount+' collected';
  let agrBtn=document.getElementById('levelAgreementBtn');
  let mixBtn=document.getElementById('levelMixedBtn');
  if(data.unlockedAgreement){
    agrBtn.style.opacity='1';agrBtn.style.pointerEvents='auto';
    mixBtn.style.opacity='1';mixBtn.style.pointerEvents='auto';
  }else{
    agrBtn.style.opacity='0.4';agrBtn.style.pointerEvents='none';
    mixBtn.style.opacity='0.4';mixBtn.style.pointerEvents='none';
  }
  document.getElementById('levelSelectModal').classList.add('active');
}

function shareGame(){
  let text="I'm Level "+data.level+" on Level Up! üéÆ "+data.games+" games played, üî•"+data.streak+"-day streak. Can you beat me?\n\n";
  let url=window.location.href;
  let fullText=text+url;
  if(navigator.share){
    navigator.share({title:'Level Up - 7 Levels of Self',text:text,url:url}).then(()=>showToast('Shared!')).catch(()=>{copyToClipboard(fullText)});
  }else{
    copyToClipboard(fullText);
  }
}
function copyToClipboard(text){
  if(navigator.clipboard&&navigator.clipboard.writeText){
    navigator.clipboard.writeText(text).then(()=>showToast('üìã Copied to clipboard!')).catch(()=>fallbackCopy(text));
  }else{
    fallbackCopy(text);
  }
}
function fallbackCopy(text){
  let ta=document.createElement('textarea');ta.value=text;ta.style.position='fixed';ta.style.left='-9999px';document.body.appendChild(ta);ta.select();
  try{document.execCommand('copy');showToast('üìã Copied to clipboard!')}catch(e){showToast('Copy: '+text.substring(0,50)+'...')}
  document.body.removeChild(ta);
}

function showHook(){setTimeout(()=>document.getElementById('line1').classList.add('show'),400);setTimeout(()=>document.getElementById('line2').classList.add('show'),1400);setTimeout(()=>document.getElementById('hookSub').classList.add('show'),2600);setTimeout(()=>document.getElementById('hookBtn').classList.add('show'),3400)}
document.getElementById('hookBtn').onclick=function(){document.getElementById('hook').classList.add('hidden');document.getElementById('onboard').classList.add('active');music.play().then(()=>{musicOn=true;document.getElementById('musicBtn').classList.add('on')}).catch(()=>{})};
document.getElementById('skipBtn').onclick=function(){data.seenIntro=true;save();document.getElementById('onboard').classList.remove('active');updateHome()};
document.getElementById('skipBtn2').onclick=function(){data.seenIntro=true;save();document.getElementById('onboard').classList.remove('active');updateHome()};
document.getElementById('nextBtn1').onclick=function(){document.getElementById('onboard1').classList.remove('active');document.getElementById('onboard2').classList.add('active')};
document.getElementById('goBtn').onclick=function(){data.seenIntro=true;save();document.getElementById('onboard').classList.remove('active');updateHome()};

function startMirrorGame(lf){
  game.mode='mirror';game.idx=0;game.answers=[];game.useTimer=false;currentCombo=0;
  let pool=MIRROR_SCENARIOS.filter(s=>lf?s.level===lf:data.unlockedLevels.includes(s.level));
  if(pool.length===0){showToast('No scenarios');return}
  game.scenarios=shuffle(pool).slice(0,10);
  document.getElementById('home').classList.add('hidden');document.getElementById('results').classList.remove('active');document.getElementById('game').classList.add('active');
  document.getElementById('gameMode').textContent='Mirror Game';document.getElementById('gameCombo').textContent='';document.getElementById('timerBar').classList.add('hidden');
  showMirrorScenario();
}
function startAgreementGame(lf){
  if(!data.unlockedAgreement){showToast('üîí Reach Level 2!');return}
  game.mode='agreement';game.idx=0;game.answers=[];game.useTimer=true;currentCombo=0;
  if(typeof DECISION_SCENARIOS==='undefined'||DECISION_SCENARIOS.length===0){showToast('Loading...');return}
  let pool=DECISION_SCENARIOS.filter(s=>lf?s.level===lf:data.unlockedLevels.includes(s.level));
  if(pool.length===0){showToast('No scenarios');return}
  game.scenarios=shuffle(pool).slice(0,10);
  document.getElementById('home').classList.add('hidden');document.getElementById('results').classList.remove('active');document.getElementById('game').classList.add('active');
  document.getElementById('gameMode').textContent='Agreement Game';document.getElementById('gameCombo').textContent='';document.getElementById('timerBar').classList.remove('hidden');
  showAgreementScenario();
}
function startDecisionGame(){
  let today=new Date().toDateString();if(data.lastDaily===today){showToast('Already completed!');return}
  game.mode='decision';game.idx=0;game.answers=[];game.useTimer=true;game.scenarios=[];currentCombo=0;
  if(typeof window.SCENARIOS==='undefined'){showToast('Loading...');return}
  let seed=hashDate(today),all=[];
  for(let l=1;l<=7;l++){if(window.SCENARIOS[l])all=all.concat(window.SCENARIOS[l].map(s=>({...s,level:l})))}
  for(let i=0;i<3&&i<all.length;i++){let idx=(seed+i*31337)%all.length;game.scenarios.push(all[idx]);seed=(seed*31337)&0xFFFFFF}
  if(game.scenarios.length===0){showToast('No scenarios');return}
  document.getElementById('home').classList.add('hidden');document.getElementById('results').classList.remove('active');document.getElementById('game').classList.add('active');
  document.getElementById('gameMode').textContent='Worldwide Challenge';document.getElementById('gameCombo').textContent='';document.getElementById('timerBar').classList.remove('hidden');
  showDecisionScenario();
}

function showMirrorScenario(){
  let s=game.scenarios[game.idx];if(!s){endGame();return}
  document.getElementById('gameProgress').textContent=(game.idx+1)+'/'+game.scenarios.length;
  let lv=LEVELS.find(l=>l.id===s.level);document.getElementById('scenarioCat').textContent='Level '+s.level+': '+(lv?lv.name:'');
  document.getElementById('scenarioText').textContent=s.text;
  let c=document.getElementById('choices');c.innerHTML='';
  [{text:"That's Me",value:true},{text:"That's Not Me",value:false}].forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=ch.text;b.onclick=()=>selectMirrorChoice(ch,b,s);c.appendChild(b)});
}
function selectMirrorChoice(ch,btn,sc){
  document.querySelectorAll('.choice').forEach(b=>b.disabled=true);btn.classList.add('selected');
  game.answers.push({recognized:ch.value,insight:sc.insight,level:sc.level});
  addInsight(sc.insight,sc.level);addCombo();
  data.mirrorTotal++;positiveSound();coinSound();addXP(10);maybeBonus();
  setTimeout(()=>showMirrorFeedback(sc.insight,ch.value),400);
}
function showMirrorFeedback(ins,rec){document.getElementById('fbIcon').textContent='üí°';document.getElementById('fbIcon').style.color='var(--pink)';document.getElementById('fbTitle').textContent='Reflection';document.getElementById('fbLabel').textContent=rec?'‚úì That\'s Me':'‚úó Not Me';document.getElementById('fbText').textContent=ins;document.getElementById('feedbackModal').classList.add('active')}

function showAgreementScenario(){
  let s=game.scenarios[game.idx];if(!s){endGame();return}
  document.getElementById('gameProgress').textContent=(game.idx+1)+'/'+game.scenarios.length;
  let lv=LEVELS.find(l=>l.id===s.level);document.getElementById('scenarioCat').textContent='Level '+s.level+': '+(lv?lv.name:'');
  document.getElementById('scenarioText').textContent=s.scenario;
  let c=document.getElementById('choices');c.innerHTML='';
  shuffle(s.choices).forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=ch.text;b.onclick=()=>selectAgreementChoice(ch,b,s);c.appendChild(b)});
  if(game.useTimer)startTimer();
}
function selectAgreementChoice(ch,btn,sc){
  if(game.timer)clearInterval(game.timer);document.querySelectorAll('.choice').forEach(b=>b.disabled=true);
  let isAcc=ch.type==='acceptance';game.answers.push({type:ch.type,isAcceptance:isAcc,insight:ch.insight,level:sc.level});
  if(isAcc){btn.classList.add('correct');data.agreementAccepted++;positiveSound();multiCoinSound(2);addXP(15);addInsight(ch.insight,sc.level);addCombo()}
  else{btn.classList.add('wrong');let acc=sc.choices.find(c=>c.type==='acceptance');document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===acc.text)b.classList.add('correct');else if(b!==btn)b.classList.add('dim')});neutralSound();addXP(5);resetCombo()}
  data.agreementTotal++;maybeBonus();setTimeout(()=>showAgreementFeedback(ch,isAcc),500);
}
function showAgreementFeedback(ch,isAcc){document.getElementById('fbIcon').textContent=isAcc?'‚úì':'‚öñÔ∏è';document.getElementById('fbIcon').style.color=isAcc?'var(--green)':'var(--yellow)';document.getElementById('fbTitle').textContent=isAcc?'Acceptance':'Judgment';document.getElementById('fbLabel').textContent=isAcc?'Why this works':'Learning opportunity';document.getElementById('fbText').textContent=ch.insight;document.getElementById('feedbackModal').classList.add('active')}

function showDecisionScenario(){
  let s=game.scenarios[game.idx];if(!s){endGame();return}
  document.getElementById('gameProgress').textContent=(game.idx+1)+'/'+game.scenarios.length;
  let lv=LEVELS.find(l=>l.id===s.level);document.getElementById('scenarioCat').textContent='Level '+s.level+': '+(lv?lv.name:'');
  document.getElementById('scenarioText').textContent=s.text;
  let c=document.getElementById('choices');c.innerHTML='';
  s.choices.forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=ch.text;b.onclick=()=>selectDecisionChoice(ch,b,s);c.appendChild(b)});
  if(game.useTimer)startTimer();
}
function selectDecisionChoice(ch,btn,sc){
  if(game.timer)clearInterval(game.timer);document.querySelectorAll('.choice').forEach(b=>b.disabled=true);
  let isCorr=ch.correct===true;game.answers.push({correct:isCorr,feedback:ch.fb,level:sc.level});
  if(isCorr){btn.classList.add('correct');positiveSound();multiCoinSound(3);addXP(20);addInsight(ch.fb,sc.level);addCombo()}
  else{btn.classList.add('wrong');let corr=sc.choices.find(c=>c.correct===true);document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===corr.text)b.classList.add('correct');else if(b!==btn)b.classList.add('dim')});neutralSound();addXP(5);resetCombo()}
  maybeBonus();setTimeout(()=>showDecisionFeedback(ch,isCorr),500);
}
function showDecisionFeedback(ch,isCorr){document.getElementById('fbIcon').textContent=isCorr?'‚úì':'üí°';document.getElementById('fbIcon').style.color=isCorr?'var(--green)':'var(--yellow)';document.getElementById('fbTitle').textContent=isCorr?'Correct!':'Not Quite';document.getElementById('fbLabel').textContent='Insight';document.getElementById('fbText').textContent=ch.fb;document.getElementById('feedbackModal').classList.add('active')}

function startTimer(){game.timeLeft=15;if(game.timer)clearInterval(game.timer);game.timer=setInterval(()=>{game.timeLeft-=0.1;let pct=(game.timeLeft/15)*100,fill=document.getElementById('timerFill');fill.style.width=pct+'%';fill.classList.remove('warn','danger');if(game.timeLeft<=5)fill.classList.add('danger');else if(game.timeLeft<=10)fill.classList.add('warn');if(game.timeLeft<=0){clearInterval(game.timer);timeUp()}},100)}
function timeUp(){
  let s=game.scenarios[game.idx];document.querySelectorAll('.choice').forEach(b=>b.disabled=true);resetCombo();
  if(game.mode==='agreement'){let acc=s.choices.find(c=>c.type==='acceptance');game.answers.push({type:'timeout',isAcceptance:false});data.agreementTotal++;document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===acc.text)b.classList.add('correct');else b.classList.add('dim')});neutralSound();setTimeout(()=>{document.getElementById('fbIcon').textContent='‚è∞';document.getElementById('fbTitle').textContent="Time's Up";document.getElementById('fbLabel').textContent='The accepting response';document.getElementById('fbText').textContent=acc.insight;document.getElementById('feedbackModal').classList.add('active')},500)}
  else if(game.mode==='decision'){let corr=s.choices.find(c=>c.correct===true);game.answers.push({correct:false});document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===corr.text)b.classList.add('correct');else b.classList.add('dim')});neutralSound();setTimeout(()=>{document.getElementById('fbIcon').textContent='‚è∞';document.getElementById('fbTitle').textContent="Time's Up";document.getElementById('fbLabel').textContent='The right response';document.getElementById('fbText').textContent=corr.fb;document.getElementById('feedbackModal').classList.add('active')},500)}
}

document.getElementById('nextBtn').onclick=function(){document.getElementById('feedbackModal').classList.remove('active');game.idx++;if(game.idx>=game.scenarios.length)endGame();else{if(game.mode==='mirror')showMirrorScenario();else if(game.mode==='agreement')showAgreementScenario();else if(game.mode==='decision')showDecisionScenario();else if(game.mode==='mixed')showMixedScenario();}};

function endGame(){
  if(game.timer)clearInterval(game.timer);data.games++;
  let score=0,total=game.answers.length;
  if(game.mode==='mirror'){score=game.answers.filter(a=>a.recognized).length}
  else if(game.mode==='agreement'){score=game.answers.filter(a=>a.isAcceptance).length}
  else if(game.mode==='mixed'){score=game.answers.filter(a=>a.recognized||a.isAcceptance).length}
  else if(game.mode==='decision'){
    score=game.answers.filter(a=>a.correct).length;
    let today=new Date().toDateString(),yesterday=new Date(Date.now()-86400000).toDateString();
    if(data.lastDaily===yesterday)data.streak++;else if(data.lastDaily!==today)data.streak=1;
    data.lastDaily=today;
  }
  save();document.getElementById('game').classList.remove('active');document.getElementById('results').classList.add('active');
  let insights=document.getElementById('insightsList');
  if(game.mode==='mirror'){
    document.getElementById('resultsTitle').textContent='Mirror Complete';document.getElementById('finalScore').textContent=total+' Reflections';
    document.getElementById('resultMsg').textContent='Honest self-reflection is the first step.';
    insights.innerHTML='';game.answers.slice(0,10).forEach(a=>{let div=document.createElement('div');div.className='insight-item';div.innerHTML='<span style="color:'+(a.recognized?'var(--green)':'var(--muted)')+';">'+(a.recognized?'‚úì':'‚úó')+'</span> '+a.insight;insights.appendChild(div)});
  }else if(game.mode==='agreement'){
    document.getElementById('resultsTitle').textContent='Agreement Complete';document.getElementById('finalScore').textContent=score+'/'+total;
    document.getElementById('resultMsg').textContent=score>=8?'Strong acceptance!':score>=5?'Growing awareness.':'Keep practicing.';
    insights.innerHTML='';game.answers.slice(0,5).forEach(a=>{let div=document.createElement('div');div.className='insight-item';div.textContent=(a.isAcceptance?'‚úì ':'‚öñÔ∏è ')+a.insight;insights.appendChild(div)});
    if(score===10){triggerConfetti();showToast('üéâ Perfect! +25 XP');addXP(25)}
  }else if(game.mode==='mixed'){
    let mirrorAnswers=game.answers.filter(a=>a.recognized!==undefined);
    let agreementAnswers=game.answers.filter(a=>a.isAcceptance!==undefined);
    let recognized=mirrorAnswers.filter(a=>a.recognized);
    let notMe=mirrorAnswers.filter(a=>!a.recognized);
    let acceptCount=agreementAnswers.filter(a=>a.isAcceptance).length;
    let judgmentCount=agreementAnswers.length-acceptCount;
    
    document.getElementById('resultsTitle').textContent='Mixed Complete';
    document.getElementById('finalScore').innerHTML='ü™û '+mirrorAnswers.length+' Reflections ‚Ä¢ ‚öñÔ∏è '+acceptCount+'/'+agreementAnswers.length+' Accepted';
    
    // Build DEEP personalized reflection
    let reflection='<div style="background:linear-gradient(135deg,rgba(120,75,160,0.15),rgba(255,60,172,0.1));border:1px solid var(--purple);border-radius:12px;padding:16px;margin-bottom:16px;text-align:left;">';
    reflection+='<div style="font-weight:700;color:var(--pink);margin-bottom:12px;">üí≠ What This Session Revealed</div>';
    
    // Show specific recognized patterns with actual quotes
    if(recognized.length>0){
      reflection+='<p style="font-size:13px;color:var(--text);margin-bottom:8px;">You recognized:</p>';
      recognized.slice(0,2).forEach(a=>{
        reflection+='<div style="font-size:13px;color:var(--muted);font-style:italic;margin:4px 0 4px 12px;">"'+a.insight+'"</div>';
      });
    }
    
    // Show what they rejected - potential blind spots
    if(notMe.length>0&&recognized.length>0){
      reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0 8px;">But you rejected:</p>';
      reflection+='<div style="font-size:13px;color:var(--muted);font-style:italic;margin:4px 0 4px 12px;">"'+notMe[0].insight+'"</div>';
      
      // Look for contradiction patterns
      let boundaryWords=['boundary','boundaries','no','yes','peace','please','avoid','conflict'];
      let controlWords=['control','perfect','right','wrong','should','must','fix'];
      let worthWords=['worth','deserve','enough','value','matter'];
      
      let recognizedText=recognized.map(a=>a.insight.toLowerCase()).join(' ');
      let rejectedText=notMe.map(a=>a.insight.toLowerCase()).join(' ');
      
      let hasBoundaryRecognized=boundaryWords.some(w=>recognizedText.includes(w));
      let hasBoundaryRejected=boundaryWords.some(w=>rejectedText.includes(w));
      let hasControlRecognized=controlWords.some(w=>recognizedText.includes(w));
      let hasWorthRejected=worthWords.some(w=>rejectedText.includes(w));
      
      // Generate insight based on contradiction
      if(hasBoundaryRecognized&&hasBoundaryRejected){
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">These might be connected. You see some boundary patterns but not others. The ones you don\'t see often protect you from seeing something deeper.</p>';
      }else if(hasControlRecognized&&hasWorthRejected){
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">Interesting pattern: you recognize control tendencies but may not see how they connect to self-worth. Control is often protection.</p>';
      }else if(recognized.length>=2){
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">These three are often connected. The patterns you see and the one you rejected may share a root. That\'s not a flaw‚Äîit\'s how awareness unfolds.</p>';
      }
    }
    
    // Agreement analysis with specific insight
    if(agreementAnswers.length>0){
      if(judgmentCount>acceptCount){
        let judgmentExample=agreementAnswers.find(a=>!a.isAcceptance);
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">In acceptance scenarios, <strong>judgment came up more than acceptance</strong>.';
        if(judgmentExample){
          reflection+=' One insight: "'+judgmentExample.insight+'" The trigger is the teacher.</p>';
        }else{
          reflection+='</p>';
        }
      }else if(acceptCount>judgmentCount){
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">You chose acceptance <strong>'+acceptCount+' time'+(acceptCount>1?'s':'')+'</strong>. You\'re building the muscle that creates space for change.</p>';
      }else if(acceptCount===judgmentCount&&acceptCount>0){
        reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">Equal acceptance and judgment. You\'re in transition‚Äîthe old patterns and new awareness are both present. That\'s exactly where growth happens.</p>';
      }
    }
    
    // Pattern summary based on overall session
    if(recognized.length>=3&&acceptCount>=2){
      reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;"><strong>Strong self-awareness and acceptance.</strong> You\'re ready to go deeper into this level.</p>';
    }else if(recognized.length<=1&&judgmentCount>acceptCount){
      reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">This level is challenging you. You may be avoiding looking at yourself, or genuinely don\'t relate. Either is information.</p>';
    }else if(recognized.length>=2&&judgmentCount>acceptCount){
      reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">You see yourself clearly but struggle to accept what you see. <strong>Self-compassion is your next edge.</strong></p>';
    }else if(recognized.length<=1&&acceptCount>=2){
      reflection+='<p style="font-size:13px;color:var(--text);margin:12px 0;">You accept others easily but may be avoiding the mirror. The reflection is waiting when you\'re ready.</p>';
    }
    
    reflection+='<p style="font-size:11px;color:var(--muted);margin-top:14px;font-style:italic;">This reflection is based on your specific answers‚Äînot a template.</p>';
    reflection+='</div>';
    
    document.getElementById('resultMsg').innerHTML=reflection;
    
    // Show all responses
    insights.innerHTML='<div style="font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;">Your Responses</div>';
    game.answers.forEach(a=>{let div=document.createElement('div');div.className='insight-item';if(a.recognized!==undefined){div.innerHTML='<span style="color:'+(a.recognized?'var(--green)':'var(--muted)')+';">ü™û '+(a.recognized?'That\'s Me':'Not Me')+'</span> ‚Äî '+a.insight}else{div.innerHTML='<span style="color:'+(a.isAcceptance?'var(--green)':'var(--yellow)')+';">‚öñÔ∏è '+(a.isAcceptance?'Accepted':'Judgment')+'</span> ‚Äî '+a.insight}insights.appendChild(div)});
  }else if(game.mode==='decision'){
    document.getElementById('resultsTitle').textContent='Challenge Complete';document.getElementById('finalScore').textContent='üî• '+data.streak;
    document.getElementById('resultMsg').textContent=score+'/'+total+' correct!';
    insights.innerHTML='';game.answers.forEach(a=>{let div=document.createElement('div');div.className='insight-item';div.textContent=(a.correct?'‚úì ':'üí° ')+a.feedback;insights.appendChild(div)});
    if(score===3){triggerConfetti();showToast('üéâ Perfect! +30 XP');addXP(30)}
  }
}

document.getElementById('homeBtn').onclick=function(){document.getElementById('results').classList.remove('active');document.getElementById('home').classList.remove('hidden');updateHome()};
document.getElementById('quitBtn').onclick=function(){if(game.timer)clearInterval(game.timer);document.getElementById('game').classList.remove('active');document.getElementById('feedbackModal').classList.remove('active');document.getElementById('home').classList.remove('hidden');updateHome()};
document.getElementById('musicBtn').onclick=function(){if(musicOn){music.pause();musicOn=false;this.classList.remove('on')}else{music.play().then(()=>{musicOn=true;this.classList.add('on')}).catch(()=>{})}};
document.getElementById('soundBtn').onclick=function(){soundOn=!soundOn;this.classList.toggle('on',soundOn);if(soundOn)coinSound()};
document.getElementById('qaBtn').onclick=function(){document.getElementById('qaModal').classList.add('active')};
document.getElementById('qaClose').onclick=function(){document.getElementById('qaModal').classList.remove('active')};
document.querySelectorAll('.qa-question').forEach(q=>{q.onclick=function(){this.parentElement.classList.toggle('open')}});
document.getElementById('dailyCard').onclick=function(){if(!this.classList.contains('done'))startDecisionGame()};
document.getElementById('mirrorMode').onclick=()=>startMirrorGame();
document.getElementById('agreementMode').onclick=function(){if(data.unlockedAgreement){data.seenAgreementUnlock=true;save();document.getElementById('agreementMode').classList.remove('newly-unlocked');startAgreementGame();}};
document.getElementById('shareBtn').onclick=shareGame;
document.getElementById('resultsShare').onclick=shareGame;
document.getElementById('insightsStat').onclick=function(){showInsightsModal(null)};
document.getElementById('insightsClose').onclick=function(){document.getElementById('insightsModal').classList.remove('active')};
document.getElementById('levelSelectClose').onclick=function(){document.getElementById('levelSelectModal').classList.remove('active')};
document.getElementById('levelMirrorBtn').onclick=function(){document.getElementById('levelSelectModal').classList.remove('active');startMirrorGame(selectedLevel.id)};
document.getElementById('levelAgreementBtn').onclick=function(){if(data.unlockedAgreement){document.getElementById('levelSelectModal').classList.remove('active');startAgreementGame(selectedLevel.id)}};
document.getElementById('levelMixedBtn').onclick=function(){if(data.unlockedAgreement){document.getElementById('levelSelectModal').classList.remove('active');startMixedGame(selectedLevel.id)}};
document.getElementById('levelInsightsBtn').onclick=function(){document.getElementById('levelSelectModal').classList.remove('active');showInsightsModal(selectedLevel.id)};

function startMixedGame(levelFilter){
  game.mode='mixed';game.idx=0;game.answers=[];game.useTimer=true;currentCombo=0;
  let mirrorPool=levelFilter?MIRROR_SCENARIOS.filter(s=>s.level===levelFilter):MIRROR_SCENARIOS.filter(s=>data.unlockedLevels.includes(s.level));
  let agreePool=levelFilter&&typeof AGREEMENT_SCENARIOS!=='undefined'?AGREEMENT_SCENARIOS.filter(s=>s.level===levelFilter):typeof AGREEMENT_SCENARIOS!=='undefined'?AGREEMENT_SCENARIOS.filter(s=>data.unlockedLevels.includes(s.level)):[];
  let combined=[];
  shuffle(mirrorPool).slice(0,7).forEach(s=>combined.push({...s,gameType:'mirror'}));
  shuffle(agreePool).slice(0,3).forEach(s=>combined.push({...s,gameType:'agreement'}));
  game.scenarios=shuffle(combined).slice(0,10);
  if(game.scenarios.length===0){showToast('No scenarios available!');return}
  document.getElementById('home').classList.add('hidden');document.getElementById('game').classList.add('active');
  document.getElementById('gameMode').textContent='Mixed';document.getElementById('timerBar').classList.remove('hidden');
  showMixedScenario();
}

function showMixedScenario(){
  let s=game.scenarios[game.idx];if(!s){endGame();return}
  if(s.gameType==='mirror'){
    document.getElementById('gameProgress').textContent=(game.idx+1)+'/'+game.scenarios.length;
    let lv=LEVELS.find(l=>l.id===s.level);document.getElementById('scenarioCat').textContent='ü™û Level '+s.level+': '+(lv?lv.name:'');
    document.getElementById('scenarioText').textContent=s.text;
    let c=document.getElementById('choices');c.innerHTML='';
    [{text:"That's Me",value:true},{text:"That's Not Me",value:false}].forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=ch.text;b.onclick=()=>selectMixedMirror(ch,b,s);c.appendChild(b)});
  }else{
    document.getElementById('gameProgress').textContent=(game.idx+1)+'/'+game.scenarios.length;
    let lv=LEVELS.find(l=>l.id===s.level);document.getElementById('scenarioCat').textContent='‚öñÔ∏è Level '+s.level+': '+(lv?lv.name:'');
    document.getElementById('scenarioText').textContent=s.scenario;
    let c=document.getElementById('choices');c.innerHTML='';
    shuffle(s.choices).forEach(ch=>{let b=document.createElement('button');b.className='choice';b.textContent=ch.text;b.onclick=()=>selectMixedAgreement(ch,b,s);c.appendChild(b)});
    if(game.useTimer)startTimer();
  }
}

function selectMixedMirror(ch,btn,sc){
  document.querySelectorAll('.choice').forEach(b=>b.disabled=true);btn.classList.add('selected');
  game.answers.push({recognized:ch.value,insight:sc.insight,level:sc.level});
  addInsight(sc.insight,sc.level);addCombo();
  data.mirrorTotal++;positiveSound();coinSound();addXP(10);maybeBonus();
  setTimeout(()=>{document.getElementById('fbIcon').textContent='üí°';document.getElementById('fbIcon').style.color='var(--pink)';document.getElementById('fbTitle').textContent='Reflection';document.getElementById('fbLabel').textContent=ch.value?'‚úì That\'s Me':'‚úó Not Me';document.getElementById('fbText').textContent=sc.insight;document.getElementById('feedbackModal').classList.add('active')},400);
}

function selectMixedAgreement(ch,btn,sc){
  if(game.timer)clearInterval(game.timer);document.querySelectorAll('.choice').forEach(b=>b.disabled=true);
  let isAcc=ch.type==='acceptance';game.answers.push({type:ch.type,isAcceptance:isAcc,insight:ch.insight,level:sc.level});
  if(isAcc){btn.classList.add('correct');data.agreementAccepted++;positiveSound();multiCoinSound(2);addXP(15);addInsight(ch.insight,sc.level);addCombo()}
  else{btn.classList.add('wrong');let acc=sc.choices.find(c=>c.type==='acceptance');document.querySelectorAll('.choice').forEach(b=>{if(b.textContent===acc.text)b.classList.add('correct');else if(b!==btn)b.classList.add('dim')});neutralSound();addXP(5);resetCombo()}
  data.agreementTotal++;maybeBonus();
  setTimeout(()=>{document.getElementById('fbIcon').textContent=isAcc?'‚úì':'‚öñÔ∏è';document.getElementById('fbIcon').style.color=isAcc?'var(--green)':'var(--yellow)';document.getElementById('fbTitle').textContent=isAcc?'Acceptance':'Judgment';document.getElementById('fbLabel').textContent=isAcc?'Why this works':'Learning opportunity';document.getElementById('fbText').textContent=ch.insight;document.getElementById('feedbackModal').classList.add('active')},500);
}

function showInsightsModal(filterLevel){
  let filter=document.getElementById('insightsFilter');
  filter.innerHTML='<button style="padding:6px 12px;border-radius:20px;border:none;font-size:12px;font-weight:600;cursor:pointer;background:'+(filterLevel===null?'var(--pink)':'var(--card)')+';color:'+(filterLevel===null?'#fff':'var(--muted)')+';" onclick="showInsightsModal(null)">All</button>';
  LEVELS.forEach(lv=>{
    let hasInsights=data.insightsCollection&&data.insightsCollection.some(i=>i.level===lv.id);
    if(hasInsights){
      filter.innerHTML+='<button style="padding:6px 12px;border-radius:20px;border:none;font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:6px;background:'+(filterLevel===lv.id?'var(--pink)':'var(--card)')+';color:'+(filterLevel===lv.id?'#fff':'var(--muted)')+';" onclick="showInsightsModal('+lv.id+')"><span style="width:10px;height:10px;border-radius:50%;background:'+lv.color+';"></span>'+lv.name+'</button>';
    }
  });
  let list=document.getElementById('insightsListModal');
  list.innerHTML='';
  if(!data.insightsCollection||data.insightsCollection.length===0){
    list.innerHTML='<p style="color:var(--muted);text-align:center;padding:20px;">No insights yet. Play Mirror Game to collect insights about yourself!</p>';
  }else{
    let filtered=filterLevel===null?data.insightsCollection:data.insightsCollection.filter(i=>i.level===filterLevel);
    filtered.slice().reverse().forEach((insight,i)=>{
      let lv=LEVELS.find(l=>l.id===insight.level)||{color:'#888',name:'Unknown'};
      let div=document.createElement('div');
      div.style.cssText='background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;margin-bottom:10px;';
      div.innerHTML='<div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;"><span style="width:10px;height:10px;border-radius:50%;background:'+lv.color+';"></span><span style="font-size:12px;color:var(--muted);">Level '+insight.level+': '+lv.name+(insight.date?' ‚Ä¢ '+insight.date:'')+'</span></div><div style="font-size:14px;color:var(--text);">'+insight.text+'</div>';
      list.appendChild(div);
    });
  }
  document.getElementById('insightsModal').classList.add('active');
}

// PWA Install Logic
let deferredPrompt=null;
let installDismissed=localStorage.getItem('installDismissed');
let isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent);
let isInStandaloneMode=window.matchMedia('(display-mode: standalone)').matches||window.navigator.standalone;

function showInstallBanner(){
  if(isInStandaloneMode||installDismissed)return;
  setTimeout(()=>{document.getElementById('installBanner').classList.add('show')},3000);
}

window.addEventListener('beforeinstallprompt',(e)=>{
  e.preventDefault();
  deferredPrompt=e;
  showInstallBanner();
});

document.getElementById('installBtn').onclick=function(){
  if(isIOS){
    document.getElementById('installBanner').classList.remove('show');
    document.getElementById('iosModal').classList.add('active');
  }else if(deferredPrompt){
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then((result)=>{
      if(result.outcome==='accepted'){showToast('üéâ Added to Home Screen!')}
      deferredPrompt=null;
      document.getElementById('installBanner').classList.remove('show');
    });
  }
};

document.getElementById('installClose').onclick=function(){
  document.getElementById('installBanner').classList.remove('show');
  localStorage.setItem('installDismissed','true');
};

document.getElementById('iosClose').onclick=function(){
  document.getElementById('iosModal').classList.remove('active');
  localStorage.setItem('installDismissed','true');
};

// Show install banner for iOS after a delay
if(isIOS&&!isInStandaloneMode&&!installDismissed){
  showInstallBanner();
}

if(data.seenIntro){document.getElementById('hook').classList.add('hidden');updateHome()}else{showHook()}
setInterval(updateTimer,1000);
</script>
</body>
</html>
